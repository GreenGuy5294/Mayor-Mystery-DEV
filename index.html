<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Mayor Mystery NEW VERSION</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" name="' attr(name) '">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=""]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0) 0%, hsla(14deg, 100%, 87%, 0.25) 50%, hsla(14deg, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0.25) 0%, hsla(14deg, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0) 0%, hsla(14deg, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' "' attr(name) '"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:"..."}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:"↓"}tw-debugger th[data-col][data-order=desc]::after{content:"↑"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=""]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=" color"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=" color"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=" color"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=" color"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media(min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:"▶"}tw-folddown.open::after{content:"▼"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play Mayor Mystery NEW VERSION.</tw-noscript></noscript></tw-story>
<tw-storydata name="Mayor Mystery NEW VERSION" startnode="9" creator="Twine" creator-version="2.6.1" format="Harlowe" format-version="3.3.4" ifid="844AD62D-6CA5-4859-A33E-02A23EB7F7D3" options="" tags="" zoom="0.6" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">@import url('https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Lato&family=Raleway:wght@400&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Schoolbell&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@500&display=swap');

@import url('https://fonts.googleapis.com/css2?family=League+Gothic&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap');

@import url('https://fonts.googleapis.com/css2?family=Kalam&display=swap');

@font-face {
	font-family: HKNova;
	src: url(https://zacstan.github.io/oofboys/HKNova-Narrow.otf);
}

tw-story[tags~="title"] tw-passage {
	min-width:150%;
  	margin-left:-50%;
  	margin-right:-50%;
}

@media only screen and (max-width: 750px) {
	body {
		font-size:75%;
	}
  	tw-link {
	  	font-size:133%;
    }
	#waitingroom {
		width:350px;
	}
}

@media only screen and (min-width:576px) and (max-width:1000px) {
	tw-story tw-passage {
		min-width:125%;
		margin-left:-25%;
		margin-right:-25%
	}
	#waitingroom {
		width:500px;
	}
}

@media only screen and (min-width:1001px) {
	#waitingroom {
		width:800px;
	}
}

tw-sidebar {
  	display: none;
}

tw-link.visited {
	color:#4169e1;
}

tw-link.visited:hover {
	color:#00bfff;
}

html {
	background-color: black;
}

body {
	background-color: black;
}

a:link {
	color:#b963bf 
}

a:visited {
	color:#b963bf 
}

a:hover {
	color:#f2b9f6 
}

a.visited:hover {
	color:#f2b9f6 
}

a:active {
	color:#ffc5ef
}</style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name="The Beginning" tags="" position="1900,250" size="100,100">(if:$testing is &quot;NA&quot;)[Let&#39;s begin, shall we?]
\(if:$testing is &quot;FAIL1&quot;)[Alright, here we go. Remember, pay attention this time.]
\(if:$testing is &quot;FAIL2&quot;)[Here we go.]

#You are Jed Winchester.
You are a hero. A good guy. A town helper. An eerdowell, if you will (the opposite of a neerdowell).

You&#39;re well known around Webster Groves for being nice to everyone and giving a hand whenever you can. At this point, you&#39;ve established quite the reputation, something that you take great pride in.


\(if:$testing is &quot;NA&quot;)[[[Begin-&gt;The Test]]]
\(if:$testing is &quot;FAIL1&quot;)[[[Begin-&gt;Test2]]]
\(if:$testing is &quot;FAIL2&quot;)[[[Begin-&gt;Test3]]]</tw-passagedata><tw-passagedata pid="2" name="The Test" tags="" position="1700,400" size="100,100">You find yourself in the following scenario:
\(set:_option1 to 0)(set:_option2 to 0)(set:_option3 to 0)
\(set: _correct to (random:1,3))
\(if:_correct is 1)[(set:_option1 to &quot;correct&quot;)(set:_option2 to (random:1,5))(set:_option3 to (random:1,5))(if: _option2 is _option3)[(set:_option3 to (_option2 + 1))](if:_option3 is 6)[(set:_option3 to 1)]]
\(if:_correct is 2)[(set:_option2 to &quot;correct&quot;)(set:_option3 to (random:1,5))(set:_option1 to (random:1,5))(if: _option3 is _option1)[(set:_option1 to (_option3 + 1))](if:_option1 is 6)[(set:_option1 to 1)]]
\(if:_correct is 3)[(set:_option3 to &quot;correct&quot;)(set:_option1 to (random:1,5))(set:_option2 to (random:1,5))(if: _option1 is _option2)[(set:_option2 to (_option1 + 1))](if:_option2 is 6)[(set:_option2 to 1)]]

You&#39;re inside Bosco&#39;s Family Food Store. You&#39;re currently looking for the best bread for the amazing gourmet grilled cheese sandwiches that you&#39;re going to make for dinner tonight. Someone walks past you with her arms full of groceries, when suddenly she trips and falls, dropping all her items on the floor.

(if:_option1 is &quot;correct&quot;)[[[Help her pick up the grocieries-&gt;Test Passed]]](if:_option1 is 1)[[[Laugh at her misfortune-&gt;Test Failed]]](if:_option1 is 2)[[[Steal her groceries-&gt;Test Failed]]](if:_option1 is 3)[[[Sneak away from the situation-&gt;Test Failed]]](if:_option1 is 4)[[[Pretend you didn&#39;t see it-&gt;Test Failed]]](if:_option1 is 5)[[[Kick her while she&#39;s down-&gt;Test Failed]]]
(if:_option2 is &quot;correct&quot;)[[[Help her pick up the grocieries-&gt;Test Passed]]](if:_option2 is 1)[[[Laugh at her misfortune-&gt;Test Failed]]](if:_option2 is 2)[[[Steal her groceries-&gt;Test Failed]]](if:_option2 is 3)[[[Sneak away from the situation-&gt;Test Failed]]](if:_option2 is 4)[[[Pretend you didn&#39;t see it-&gt;Test Failed]]](if:_option2 is 5)[[[Kick her while she&#39;s down-&gt;Test Failed]]]
(if:_option3 is &quot;correct&quot;)[[[Help her pick up the grocieries-&gt;Test Passed]]](if:_option3 is 1)[[[Laugh at her misfortune-&gt;Test Failed]]](if:_option3 is 2)[[[Steal her groceries-&gt;Test Failed]]](if:_option3 is 3)[[[Sneak away from the situation-&gt;Test Failed]]](if:_option3 is 4)[[[Pretend you didn&#39;t see it-&gt;Test Failed]]](if:_option3 is 5)[[[Kick her while she&#39;s down-&gt;Test Failed]]]

&lt;!-- Laugh at her misfortune, Steal her groceries, Sneak away from the situation, Pretend you didn&#39;t see it --&gt;</tw-passagedata><tw-passagedata pid="3" name="Test Passed" tags="" position="1600,600" size="100,100">Congratulations! You passed the test!
\(set: $TestFinish to it + 1)

You heard that right, this scenario did not happen. It was in fact just a test to see if you paid attention to the information I gave you in the beginning. And you did!

I think it&#39;s time to send you into the real world now. An adventure of epic proportions lies ahead. Good luck, Jed.

[[Continue-&gt;START]]</tw-passagedata><tw-passagedata pid="4" name="Test Failed" tags="" position="1800,600" size="100,100">Okay, hold the phone.
\(set: $testing to &quot;FAIL1&quot;)

I have a confession to make. 
This actually didn&#39;t happen. It was a test to see if you correctly read the information I gave you at the beginning of the text adventure. Which it would appear that you did not.

I think we need to go back and do this again. Soak in all the little details of Jed&#39;s life. Pay attention to the intricate details of Jed&#39;s deep personality. Become one with Jed. 

Whenever you&#39;re ready just click this link:
[[Go Back-&gt;The Beginning]]</tw-passagedata><tw-passagedata pid="5" name="Test2" tags="" position="2100,400" size="100,100">You find yourself in the following scenario:
\(set:_option1 to 0)(set:_option2 to 0)(set:_option3 to 0)
\(set: _correct to (random:1,3)) (if:_correct is 1)[(set:_option1 to &quot;correct&quot;)(set:_option2 to (random:1,4))(set:_option3 to (random:1,4))(if: _option2 is _option3)[(set:_option3 to (_option2 + 1))](if:_option3 is 5)[(set:_option3 to 1)]] (if:_correct is 2)[(set:_option2 to &quot;correct&quot;)(set:_option3 to (random:1,4))(set:_option1 to (random:1,4))(if: _option3 is _option1)[(set:_option1 to (_option3 + 1))](if:_option1 is 5)[(set:_option1 to 1)]] (if:_correct is 3)[(set:_option3 to &quot;correct&quot;)(set:_option1 to (random:1,4))(set:_option2 to (random:1,4))(if: _option1 is _option2)[(set:_option2 to (_option1 + 1))](if:_option2 is 5)[(set:_option2 to 1)]]

You&#39;re riding the Webuster™️, Webster Groves&#39; public bus. It&#39;s an especially busy day today for the Webster Groves public transport system, so every seat on the bus is taken. All of them except for the one next to you. 

The bus stops and no one gets off. One person walks onto the bus, and then starts walking towards you.
&quot;Excuse me,&quot; they say. &quot;Do you mind if I sit here?&quot;
\(set:_fail1 to &#39;&quot;&#39; + &quot;Wow. You&#39;re ugly. Please find another seat. I can&#39;t look at your face any longer, let alone a whole bus ride.&quot; + &#39;&quot;&#39;)(set:_fail2 to &#39;&quot;&#39; + &quot;Yes, it&#39;s taken. It&#39;s taken by me. I am superior to everyone else in this town, so I deserve two seats on this bus.&quot; + &#39;&quot;&#39;)(set:_fail3 to &#39;&quot;&#39; + &quot;Get lost, nerd. What&#39;s your name, nerd? I bet it&#39;s Nerd, because that&#39;s what your parents thought you were going to amount to in life. A big nerd.&quot; + &#39;&quot;&#39;) (set:_fail4 to &#39;&quot;&#39; + &quot;Why would you ever think I would let you sit here? I don&#39;t even know who you are. No you can&#39;t sit here, weirdo.&quot; + &#39;&quot;&#39;)

(if:_option1 is &quot;correct&quot;)[[[&quot;Not at all!&quot;-&gt;Test2 Passed]]](if:_option1 is 1)[[[_fail1-&gt;Test2 Failed]]](if:_option1 is 2)[[[_fail2-&gt;Test2 Failed]]](if:_option1 is 3)[[[_fail3-&gt;Test2 Failed]]](if:_option1 is 4)[[[_fail4-&gt;Test2 Failed]]]
(if:_option2 is &quot;correct&quot;)[[[&quot;Not at all!&quot;-&gt;Test2 Passed]]](if:_option2 is 1)[[[_fail1-&gt;Test2 Failed]]](if:_option2 is 2)[[[_fail2-&gt;Test2 Failed]]](if:_option2 is 3)[[[_fail3-&gt;Test2 Failed]]](if:_option2 is 4)[[[_fail4-&gt;Test2 Failed]]]
(if:_option3 is &quot;correct&quot;)[[[&quot;Not at all!&quot;-&gt;Test2 Passed]]](if:_option3 is 1)[[[_fail1-&gt;Test2 Failed]]](if:_option3 is 2)[[[_fail2-&gt;Test2 Failed]]](if:_option3 is 3)[[[_fail3-&gt;Test2 Failed]]](if:_option3 is 4)[[[_fail4-&gt;Test2 Failed]]]

&lt;!-- &quot;Wow. You&#39;re ugly. Please find another seat. I can&#39;t look at your face any longer, let alone a whole bus ride.&quot;, &quot;Yes, it&#39;s taken. It&#39;s taken by me. I am superior to everyone else in this town, so I deserver two seats on this bus.&quot;, &quot;Get lost, nerd. What&#39;s your name, nerd? I bet it&#39;s Nerd, because that&#39;s what your parents thought you were going to amount to in life. A big nerd.&quot;, &quot;Why would you ever think I would let you sit here? I don&#39;t even know who you are. No you can&#39;t sit here, weirdo.&quot; --&gt;</tw-passagedata><tw-passagedata pid="6" name="START" tags="" position="1750,800" size="200,100">(set:$maxfun to 16)
\(if:$escapadeArrow contains &quot;ready&quot;)[(set:$escapadeArrow to it + (a:&quot;paint&quot;))]
\(unless:$nextFun is 0)[
\(set:$FUN to $nextFun)(set:$nextFun to 0)] 
\(else:)[
\(if:$ENDINGS contains &quot;NormalRoute&quot;)[(set:$FUN to (random:1,$maxfun))
\(if:$FUN is $previousFun)[(set:$FUN to (random:1,$maxfun))]]]
\(set:$previousFun to $FUN)
\(set:$LOC to &quot;East Side&quot;)
\(if:$FUN is 3)[(set:$MONEY to (random:490,510))
\(unless:$anomalies contains &quot;rich&quot;)[(set:$anomalies to it + (a:&quot;rich&quot;))]](else:)[(set:$MONEY to (random:110,130))]
\(if:$FUN is 8 and $MAILBOX is &quot;empty&quot;)[(set:$MAILBOX to &quot;lightsaber&quot;)]
\(if:$FUN is 15 and $MAILBOX is &quot;empty&quot;)[(set:$MAILBOX to &quot;gameshow&quot;)]
\(set:$gettingReady to (shuffled:&quot;changed his clothes&quot;,&quot;brushed his teeth&quot;,&quot;combed his hair&quot;,&quot;made some breakfast&quot;,&quot;reset his alarm&quot;,&quot;trimmed his nails&quot;,&quot;shaved his face&quot;,&quot;took a quick shower&quot;,&quot;premade some lunch&quot;,&quot;checked his social media&quot;,&quot;wrote in his dream journal&quot;,&quot;checked his calendar&quot;))
\Jed (either:&quot;woke up from&quot;,&quot;fell out of&quot;,&quot;begrudingly got up from&quot;,&quot;leaped out of&quot;) his bed feeling (either:&quot;slightly dazed&quot;,&quot;ready for a new day&quot;,&quot;well rested&quot;,&quot;extraordinarily normal&quot;,&quot;quite giddy&quot;). He (print:$gettingReady&#39;s 1st), (print:$gettingReady&#39;s 2nd), and (print:$gettingReady&#39;s 3rd). But (either:&quot;as he was pouring himself a cup of coffee,&quot;,&quot;when he finally got out of the bathroom,&quot;,&quot;while he shuffled along in his living room,&quot;,&quot;while he was unfruitfully looking for his left shoe,&quot;) Jed noticed (if:$FUN is 1 or 6)[an advertisement](else:)[a news story] on his TV.

(if:$FUN is 1)[&quot;Do you have computer issue? Do you have PC or computer who has issue? We can fix PC who has issue, or computer that has issue. Our product is good. AreWebsite.com. Because We™️&quot;

Jed currently does not own a computer, but he made a vow that when he did get his first computer, the first thing he will do is download AreWebsite software. After all, it is the most powerful software to deal with PC or computer issues! There&#39;s no reason to use anything else!

After fantasizing about antiviruses, Jed walked out of his apartment and went to check his mail on the way. When he did, he found a strange letter written to him from an unknown sender.
\(unless:$anomalies contains &quot;arewebsite ad&quot;)[(set:$anomalies to it + (a:&quot;arewebsite ad&quot;))]]
\(else-if:$FUN is 6)[&quot;Do you feel insignificant? Do you want to help out others? Introducing the Be-Your-Own-Superhero Cape, a dazzling cape made from real superhero felt, that will make you //truly feel// like a superhero! It only costs $109! Get it now at your local clothing store!&quot;

What malarkey. Of course, as the intro to the game clearly states, Jed is already well known as a sort of &quot;superhero.&quot; This cape is just a waste of money. I mean, come on, $109? Buying that would leave you with just $(print:$MONEY - 109). (if:$CLOSET contains &quot;cape&quot;)[Oh, you already have it? Why would you waste your money on that?]

After watching the obnoxious ad, Jed walked out of his apartment and went to check his mail on the way. When he did, he found a strange letter written to him from an unknown sender.
\(unless:$anomalies contains &quot;cape ad&quot;)[(set:$anomalies to it + (a:&quot;cape ad&quot;))]]
\(else-if:$FUN is 9)[&quot;Good morning Webster Groves,&quot; the reporter said. &quot;There has been yet another case of trouble happening in the west side of town. A small criminal group is roaming the area, mugging citizens. Until this group is found, be cautious walking alone in dark areas.&quot;

Jed got quite the chill from watching this warning. He was just in the area last night. Fortunately, nothing happened, but he began to think about how lucky he was, and what would happen if something //did// happen to him last night.

He then shrugged off the existential thoughts and walked out of his apartment, checking the mail on the way. When he did, he found a strange letter written to him from an unknown sender.
\(unless:$anomalies contains &quot;criminal news&quot;)[(set:$anomalies to it + (a:&quot;criminal news&quot;))]]
\(else:)[&quot;Good morning Webster Groves,&quot; the reporter said. &quot;(either:&quot;I hate to kick off the day with some bad news, but beloved&quot;,&quot;Unfortunately we have some bad news. Beloved &quot;,&quot;I&#39;m here early today because I heard beloved &quot;) West Side burger place Burgerocity is being shut down. When asked why this was happening, the place&#39;s owner simply said that the reason was personal.&quot;

This came as quite the surprise to Jed. He was just there last night, and everything seemed fine, why was it being shut down? He wanted to go investigate. Jed walked out of his apartment and went to check his mail on the way. When he did, he found a strange letter written to him from an unknown sender.]

[[Open the Letter-&gt;Letter]]</tw-passagedata><tw-passagedata pid="7" name="Test2 Passed" tags="" position="2000,600" size="100,100">There you go! See that wasn&#39;t so hard, was it? Congratulations, Jed!

Well, I think it&#39;s time I send you out into the real world now, hm? There&#39;s no resets to help you out while you&#39;re out here, so you&#39;ll really have to think things through.

[[Continue-&gt;START]]</tw-passagedata><tw-passagedata pid="8" name="Test2 Failed" tags="" position="2200,600" size="100,100">Are you kidding me? The correct answer in this scenario is so painfully obvious! At this point, the only reason you would &quot;mess up&quot; this test is on purpose!
\(set: $testing to &quot;FAIL2&quot;)

I get it, though. You&#39;re just having some fun with me before we begin. A little bit of &quot;trolling&quot; as you might say. 
\(if: $ENDINGS is not (a:))[And as you might have seen already, I like to do a bit of messing around myself.]

I&#39;ll make you a deal. One last chance to show me whether or not you want to play along. One more test. Let&#39;s go back to the beginning again:
[[Go Back-&gt;The Beginning]]</tw-passagedata><tw-passagedata pid="9" name="Title Screen" tags="title" position="1850,100" size="200,100">===&gt;&lt;===
(if:(history:) contains &quot;The Beginning&quot; and (random:1,25) is 1)[&lt;img id=&quot;waitingroom&quot; src=&quot;https://i.imgur.com/VK6qlSj.png&quot;&gt;
\(set:$theGame to true)](else:)[&lt;img id=&quot;waitingroom&quot; src=&quot;https://i.imgur.com/0yYRLZ7.png&quot;&gt;
\(set:$theGame to false)]
By Blue Cat and Green Guy
\(if:visits is 1)[
\(set: $ENDINGS to (a:))
\(set: $FUN to 0)
\(set: $MAILBOX to &quot;empty&quot;)
\(set: $TestFinish to 0)
\(set: $TestSkip to false)
\(set: $visitsWaitingRoom to 0)
\(set: $visit5 to false)
\(set: $visit6 to false)
\(set: $previousFun to 0)
\(set: $josefineStore to &quot;unknown&quot;)
\(set: $bookReturned to false)
\(set: $incomingMail to &quot;empty&quot;)
\(set: $wallColor to &quot;grey&quot;)
\(set: $CLOSET to (a:))
\(set: $tickets to 0)
\(set: $gotToilet to false)
\(set: $sequel to true)
\(set: $STATS to (a:0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
\(set: $mayorFights to (a:))
\(set: $STANLEY to false)
\(set: $escapadeArrow to (a:))
\(set: $nextFun to 0)
\(set: $sidequests to (a:))
\(set: $PREMIUM to &quot;nope&quot;)
\(set: $ATM to 0)
\(set: $seenSteve to false)
\(set: $anomalies to (a:))
\(set: $BUSTER to false)
\(set: $prankRandom to false)
\(set: $forkliftPhoneNumber to false)
\(set: $JOURNAL to (a:&quot;intro&quot;))
\]
\(set: $toilets to (a:))
\(set: $testing to &quot;NA&quot;)
\(set: $INV to (a:))
\(set: $visitPlumber to false)
\(set: $justSoldTicket to false)
\(set: $visitedBL to (a:))
\(set: $previousPassage to &quot;&quot;)
\(set: $toiletEnding to false)
\(set: $joinGang to false)
\(set: $banned to (a:))
\(set: $wearing to &quot;none&quot;)
\(set: $hatgone to false)
\(set: $boxMask to false)
\(set: $toasterMask to false)
\(set: $tokens to 0)
\(set: $askedNarrator to (a:))
\(set: $citizensHelped to (a:))
\(set: $haircuts to 0)
\(set: $boscoMayhem to (a:))
\(set: $cereal to true)
\(set: $furnitureEaten to (a:))
\(set: $mugged to false)
\(set: $rafaelQuest to (a:))
\(set: $gasStationPurchase to false)
\(set: $winningTickets to 0)
\(set: $lottoSpendings to 0)
\(set: $storeCardQuest to (a:))
\(set: $storeCard to 0)
\(set: $alleywayBathroom to true)
\(set: $buttonBathroom to true)
\(set: $ticketPowers to &quot;unvisited&quot;)
\(set: $visitedKyle to (a:0))
\(set: $cultActivities to (a:))
\(set: $fightReject to false)
\(set: $campPassed to false)
\(set: $currentPage to $JOURNAL&#39;s length)
\
\(if:$visitsJedsToilet &gt; 7)[(set: $visitsJedsToilet to 9)](else:)[(set: $visitsJedsToilet to 0)]
\(set: $visitsCoffeeMaker to 0)
\(set: $visitsRafael to 0)
\(set: $visitsTrainStation to 0)
\(set: $visitsCityHall to 0)
\(set: $visitsBurgerocity to 0)
\(set: $visitsSecretary to 0)
\(set: $visitsJosefine to 0)
\(set: $visitsCloset to 0)
\(set: $visitsTed to 0)
\(set: $visitsPaint to 0)
\(set: $visitsBL to 0)
\(set: $visitsMegaToilet to 0)
\(set: $visitsGang to 0)
\(set: $visitsTokens to 0)
\(set: $visitsBreakRoom to 0)
\(set: $visitsTokenMuncher to 0)
\(set: $visitsStanley to 0)
\(set: $visitsHardwareBald to 0)
\(set: $visitsTickets to 0)
\(set: $visitsPortAPotty to 0)
\(set: $visitsElectronics to 0)
\(set: $visitsATM to 0)
\(set: $visitsPhone to 0)
\(set: $visitsWalkPast to 0)
\(set: $visitsBuster to 0)


(if:$TestSkip)[[[Start-&gt;START]]]
\(else:)[
\(if:$TestFinish is 3)[[[Start-&gt;More Tests?]]]
\(else:)[[[Start-&gt;The Beginning]]]]
\(if:$ENDINGS&#39;s length &gt; 0 or (saved-games:) contains &quot;Slot J2&quot;)[
[[Save &amp; Load-&gt;Save/Load]]]
[[About-&gt;About]]
[[Exit-&gt;Exit]]
\(font:&quot;HKNova&quot;)[]
\&lt;img style=&quot;width:0px;height:0px;&quot; src=&quot;https://i.imgur.com/emvWMoT.png&quot;&gt;&lt;img style=&quot;width:0px;height:0px;&quot;src=&quot;https://i.imgur.com/ElUFkDK.png&quot;&gt;&lt;img style=&quot;width:0px;height:0px;&quot;src=&quot;https://i.imgur.com/u3g5IIX.png&quot;&gt;&lt;img style=&quot;width:0px;height:0px;&quot;src=&quot;https://i.imgur.com/pbg85sl.png&quot;&gt;</tw-passagedata><tw-passagedata pid="10" name="Test3" tags="" position="2400,400" size="100,100">You find yourself in the following scenario:
\(set: _correct to (either:1,2))(set:$hint to false)

When walking into a bookstore, someone follows behind you holding a giant box with both hands. Do you hold the door open for him? 
\(live:1s)[(if: time &gt; 10s)[

Looks like you&#39;re having trouble here. That&#39;s alright. Take your time.]
\(if: time &gt; 20s)[

Hmmm, it looks like I&#39;ve made this too hard for you. Well here&#39;s a hint: it&#39;s yes. The answer is yes. If you want to pass, click yes.
\(set:$hint to true)]]

[[Yes-&gt;Test3 Passed]]
[[No-&gt;Test3 Failed]]</tw-passagedata><tw-passagedata pid="11" name="More Tests?" tags="" position="1600,250" size="100,100">(set:$TestFinish to 4)
\Let&#39;s begin, shall we?

#You are Jed Winchester.
You are a hero. A good guy. A town he-

Hey, aren&#39;t you sick of this by now? You&#39;ve passed the same test multiple times at this point, you&#39;ve probably gotten bored of it. Do you still want to get tested before you start the story?

|option&gt;[
\(link: &quot;Yes&quot;)[(replace: ?option)[Alrighty, then. Have it your way.

[[Begin-&gt;The Test]]]]
(link: &quot;No&quot;)[(replace: ?option)[Yeah, I thought so. Let&#39;s just get to the real part of the story, Jed.
\(set:$TestSkip to true)

[[Begin-&gt;START]]]]]</tw-passagedata><tw-passagedata pid="12" name="Test3 Passed" tags="" position="2350,600" size="100,100">(unless:$hint)[Okay, you do want to play along. Great! Now that you&#39;ve gotten your giggles out of the way, I think it&#39;s time I send you into the real world.]
\(else:)[Glad to see my hint helped you. Now that we&#39;ve gotten that all out of the way I can finally send you off to the real world.]

Be careful out there. Your &quot;trolling&quot; may lead to a lot of unwanted consequences. 

[[Continue-&gt;START]]</tw-passagedata><tw-passagedata pid="13" name="Test3 Failed" tags="" position="2500,600" size="200,100">(set:$JOURNAL to it + (a:&quot;TestFailure&quot;))
\(unless: $ENDINGS contains &quot;TestFailure&quot;)[
\(if:$hint)[Are you kidding me? After all that time you spent thinking about it, you got it wrong? Even with the hint I gave you?]
\(else:)[Wow. Just wow. There&#39;s absolutely no way you just selected that.]

Well, there&#39;s only two possibilities here. The first is that you genuinely read the introduction, tried your best, and still failed all three tests (which is very disappointing). The second is that you purposefully failed all of the tests because you&#39;re such a likable person (that&#39;s sarcasm).

Well, as a punishment for wasting my time, I&#39;m going to waste your time. I&#39;m not going to let you restart for, oh let&#39;s say, 30 seconds? Just enough to be annoying but not long enough to warrant a refresh. You wouldn&#39;t dare lose all your progress, would you? (if: $ENDINGS is an empty)[Oh wait. You don&#39;t even have progress. So this is the first thing you do is mess with me? Well, I... I... 

Yeah I got nothing. You win. Is that what you wanted? Congratulations, you beat a text adventure game made by two random people online. Good one.]
\(live:1s)[(if: time &gt; 30s)[

Well, I&#39;m a man of my word. It&#39;s been 30 seconds, here you go.

[[The End-&gt;Waiting Room Entrance]]]]
(unless: $ENDINGS contains &quot;TestFailure&quot;)[(set:$ENDINGS to it + (a:&quot;TestFailure&quot;))]]
\(else:)[
\Why? Why did you go through the trouble of failing all the tests again? Did you think something special was going to happen? You just want to waste my time again? I understand failing just one or two to see if something is different, but //all 3?// Well, you wasted even more of my time, so I&#39;ll waste even more of your time. One minute until you can restart.
\(live:1s)[(if: time &gt; 60s)[

Alright, that was fun for you wasn&#39;t it? Don&#39;t come back here. I&#39;m serious.

[[The End-&gt;Waiting Room Entrance]]]]]</tw-passagedata><tw-passagedata pid="14" name="Jed&#39;s Apartment" tags="" position="2050,2000" size="100,200">You&#39;re currently inside your apartment. (either:&quot;Home, sweet home.&quot;,&quot;You know what they say, you can&#39;t investigate a town scandal without proper rest!&quot;,&quot;Wow, you should probably get around to cleaning sometime soon. I mean-&quot;,&quot;It looks especially normal today, almost twice as much as yesterday.&quot;,&quot;The best place to spend a &quot; + (weekday:) + &quot; morning.&quot;,&quot;Its &quot; + $wallColor + &quot; walls bring you great comfort.&quot;) Where would you like to go?

[[Kitchenette-&gt;Jed&#39;s Kitchen]]
[[Bedroom-&gt;Jed&#39;s Bedroom]]
[[Bathroom-&gt;Jed&#39;s Bathroom]]
\(if:$INV contains &quot;electronic&quot;)[
[[Set Up Appliance]]]
\(if:$INV contains &quot;vr headset&quot;)[
[[Setup VR Headset-&gt;Setup VR]]]
\(if:$INV contains &quot;paint&quot;)[
[[Paint the Walls-&gt;Paint Apartment]]]
[[Exit-&gt;The Apartment Complex]]</tw-passagedata><tw-passagedata pid="15" name="Letter" tags="letter" position="2000,800" size="100,100">(font:&quot;Kaushan Script&quot;)[
\(if:$FUN is 4)[
\###Dear Jed Winchester,
ALIENS. THEY&#39;RE REAL.

I know it sounds unreal, but you have to believe me. I heard the mayor talk to them. I heard them talk back. Either he&#39;s acting strange or I&#39;m acting strange, and I&#39;m not acting strange. 

I need your help. We //have// to get to the bottom of this.

Attached to the back of this letter is a key. Keep it. Dispose of the letter as soon as possible. We don&#39;t want to leave a paper trail.

Thanks,
An anonymous help-seeker
\(unless:$anomalies contains &quot;weird letter&quot;)[(set:$anomalies to it + (a:&quot;weird letter&quot;))]
\(set: $INV to it + (a:&quot;key&quot;))]
\(else-if:$FUN is 10)[
\###Dear Jed Winchester,
Please meet me at the city hall.

Thanks,
An anonymous help-seeker
\(unless:$anomalies contains &quot;short letter&quot;)[(set:$anomalies to it + (a:&quot;short letter&quot;))]]
\(else-if:$FUN is 12)[(font:&quot;Schoolbell&quot;)[
\###Dear Jed Winchester,
Weve been teying to reach you about your car&#39;s extended warranty. You should of received a noteice in the mail about you&#39;re cars extended warrenty eligabilety. Sinse we&#39;ve not gotten a response, we&#39;re giving you a final curtesy letter before we close out your file. Please call us to be removed and placed on our do not mail list. To speak to some one about possiblely extending your vehicles warrenty, call 202-555-0161.

From, 
IRS (Inturnal Revenue Service)]
\(unless:$anomalies contains &quot;irs letter&quot;)[(set:$anomalies to it + (a:&quot;irs letter&quot;))]]
\(else:)[
\###Dear Jed Winchester,
There&#39;s something going on with the mayor. Last night, he made an agreement with some group that would give him &quot;great power.&quot; Based on people&#39;s behaviors recently I don&#39;t trust anyone inside city hall - that&#39;s why I am writing to you. I&#39;m trying to figure this out on my own, but maybe with your help, we can get to the bottom of this.

Thanks,
An anonymous help-seeker]]
\(set: $INV to it + (a:&quot;letter&quot;))

(cond:$FUN is 4,&quot;Jed took the key off of the letter, and then put them in his pocket.&quot;,&quot;Jed folded the letter and put it in his pocket.&quot;)
\(if:$MAILBOX is not &quot;empty&quot;)[ He then looked in his mailbox again and saw something else pushed further back.

[[Continue-&gt;Mailboxes]]](else:)[

(if:$escapadeArrow contains &quot;paint&quot; and does not contain &quot;arrow&quot;)[(link-reveal-goto:&quot;Return Home&quot;,&quot;Notice Arrow&quot;)[(set:$prevPassage to &quot;home&quot;)]
(link-reveal-goto:&quot;Go to Town&quot;,&quot;Notice Arrow&quot;)[(set:$prevPassage to &quot;town&quot;)]]
\(else:)[(if:$prankRandom and not $fightReject)[[[Return Home-&gt;Phone Call Fight]]](else:)[[[Return Home-&gt;Jed&#39;s Apartment]]]
[[Go to Town-&gt;East Side of Town]]]]</tw-passagedata><tw-passagedata pid="16" name="East Side of Town" tags="" position="1250,1350" size="200,200">You&#39;re in the East Side of Webster Groves. (cond:$wearing is &quot;3d glasses&quot;,&quot;Everything looks so cool in 3D...&quot;,&quot;The weather feels very nice today!&quot;)
\(set:$previousPassage to (passage:)&#39;s name)

(if:$prankRandom and not $fightReject)[[[Apartment Complex-&gt;Phone Call Fight]]](else:)[[[Apartment Complex-&gt;The Apartment Complex]]] 
[[Supermarket-&gt;Bosco&#39;s Family Food Store]] 
[[Electronics Store-&gt;Electronics Store]] 
[[Library-&gt;Library]]
\(if:$escapadeArrow contains &quot;arrow&quot;)[
[[Button Area-&gt;Button Area]]](else-if:$escapadeArrow contains &quot;paint&quot; and contains &quot;seen&quot;)[
[[Follow the Arrow™-&gt;Button Area]]]
[[Train Station-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="17" name="Town Square" tags="" position="4000,1300" size="200,200">You&#39;re in the Webster Groves Town Square. (cond:$wearing is &quot;3d glasses&quot;,&quot;Everything looks so cool in 3D...&quot;,&quot;The scenery looks absolutely beautiful.&quot;) 
\(set:$previousPassage to (passage:)&#39;s name)

[[City Hall-&gt;City Hall]]
[[Hardware Store-&gt;Hardware Store]]
[[Empty Store-&gt;Empty Store]]
[[Arcade-&gt;Arcade]]
\(if:$STATS&#39;s 9th &gt; 2)[
[[Construction Zone-&gt;Construction Area]]]
\(if:$INV contains all of (a:&quot;WS1&quot;,&quot;WS2&quot;,&quot;WS3&quot;,&quot;WS4&quot;,&quot;WS5&quot;,&quot;WS6&quot;,&quot;WS7&quot;))[
[[Summon WACKY STEVE-&gt;WACKY STEVE Ending]]]
[[Train Station-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="18" name="West Side of Town" tags="" position="6100,1300" size="200,200">You&#39;re in the West Side of Webster Groves. (cond:$wearing is &quot;3d glasses&quot;,&quot;Everything looks so cool in 3D...&quot;,&quot;For some reason, the sky looks darker than the rest of the town.&quot;)
\(set:$previousPassage to (passage:)&#39;s name)

[[Burgerocity]]
[[Barber Shop]]
[[Clothing Store]]
[[Gas Station]]
[[Dark Alleyway]]
[[Train Station]] </tw-passagedata><tw-passagedata pid="19" name="Jed&#39;s Kitchen" tags="" position="2050,2250" size="100,100">You go to the kitchenette in your apartment. It&#39;s not a full kitchen but it gets the job done. You&#39;ve got plenty of counterspace to boot!

(if:$FUN is 16)[(unless:$furnitureEaten contains &quot;fridge&quot;)[[[Eat Fridge-&gt;Eat Fridge]]
]](else:)[[[Fridge-&gt;Fridge]]
]
\(if:$INV contains &quot;cereal&quot;)[[[Eat Cereal-&gt;Eat Cereal]]
]
\(if:$FUN is 16)[(unless:$furnitureEaten contains &quot;coffee maker&quot;)[[[Eat Coffee Maker-&gt;Eat Coffee Maker]]
]](else:)[[[Coffee Maker-&gt;Coffee Maker]]
]
\(if:$INV contains &quot;milk&quot;)[[[Pour Milk Down Sink-&gt;Milk Sink]]
]
\(if:$INV contains &quot;toaster&quot;)[[[Set Up Toaster-&gt;Set Up Toaster]]
]
\[[Trash Can-&gt;Trash Can]]
[[Exit-&gt;Jed&#39;s Apartment]]</tw-passagedata><tw-passagedata pid="20" name="Bosco&#39;s Family Food Store" tags="" position="700,1700" size="100,200">You&#39;re inside Bosco&#39;s Family Food Store. They are best known in Webster Groves for their pre-made meals, but you&#39;ve never had one yourself.
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Purchase Items&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Purchase Items-&gt;Buy Food]]]
(if:$rafaelQuest contains &quot;step5&quot; and $wearing is not &quot;icloak&quot;)[[[Sunglasses-&gt;Bosco&#39;s Sunglasses]]
]
\(if:$wearing is &quot;vest&quot;)[[[Employee Break Room-&gt;Bosco Break Room]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;East Side of Town]]</tw-passagedata><tw-passagedata pid="21" name="Jed&#39;s Bedroom" tags="" position="2200,2250" size="100,100">You are now in your bedroom. It&#39;s the room where you keep the bed. (unless:$INV contains any of (a:&quot;train pass&quot;,&quot;train pass new&quot;))[

(if:visits is 1)[Oh! Entering the bedroom again reminded you that you haven&#39;t grabbed your train pass yet. This ticket allows you to ride the train without having to purchase a normal ticket! You keep it in the cabinet next to your bed.]
\(else:)[(if:$ENDINGS is (a:))[You still haven&#39;t grabbed that awesome train pass I was telling you about. It&#39;s in the cabinet!~](else:)[Jed! Don&#39;t forget your train pass! It&#39;s in the cabinet next to your bed!]]]

[[Dream Journal-&gt;Dream Journal]]
(if:$FUN is 16)[(unless:$furnitureEaten contains &quot;cabinet&quot;)[[[Eat Cabinet-&gt;Eat Cabinet]]
]](else:)[[[Cabinet-&gt;Grab Ticket]]
](if:$furnitureEaten contains &quot;cabinet&quot; and $mugged and $INV does not contain &quot;cash stash&quot;)[[[Find Cash Stash-&gt;Find Cash Stash]]
]
\[[Closet-&gt;Closet]]
[[Bed-&gt;Sleep]]
\(if:$BUSTER and $INV does not contain &quot;buster&quot;)[
[[Buster Winchester-&gt;Grab Buster]]]
(if: $INV does not contain all of (a:&quot;train pass&quot;,&quot;train pass new&quot;) and visits is 1)[[[Exit-&gt;Train Ticket Warning]]](else:)[[[Exit-&gt;Jed&#39;s Apartment]]]</tw-passagedata><tw-passagedata pid="22" name="Jed&#39;s Bathroom" tags="" position="1900,2250" size="100,100">You are in your bathroom. It&#39;s pretty cramped, but it fulfills the basic necessities of a bathroom. (if:($visitsJedsToilet is 8 or $visitsJedsToilet is 11) and ($wearing is not &quot;hat&quot;) and ($storeCardQuest does not contain &quot;ask&quot; or $storeCardQuest contains &quot;documents&quot; or $INV contains &quot;documents&quot;))[//There is nothing to do here.//](else:)[There is nothing to do here.]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$visitsJedsToilet is 8 or 11)[[[Flush the Toilet]]](else:)[[[Flush the Toilet-&gt;Flush Toilet]]]
\(if:$wearing is &quot;hat&quot;)[
[[Look At Mirror-&gt;Mirror]]]
\(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[
[[Search for Documents-&gt;Search Documents]]]
[[Exit-&gt;Jed&#39;s Apartment]]</tw-passagedata><tw-passagedata pid="23" name="Flush Toilet" tags="" position="1900,2400" size="100,100">(set:$visitsJedsToilet to it + 1)
\(unless:$toilets contains &quot;JedsApartment&quot;)[(set:$toilets to it + (a:&quot;JedsApartment&quot;))]
\(if:$visitsJedsToilet is 1)[
\You flush the toilet.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 2)[
\You flush the toilet again.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 3)[
\You flush the toilet another time. Surprise surprise, nothing special happens.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 4)[
\Why do you keep flushing the toilet? Are you trying to run up your water bill, because if so you&#39;re succeeding.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 5 or $visitsJedsToilet is 6)[
\Jed, please stop flushing the toilet. I&#39;m serious.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 7)[
\Wow, I thought saying the same thing twice would make you stop. You&#39;re clearly just here to flush the toilet and that&#39;s it. Are you trying to get the toilet ending? Sorry buddy, that&#39;s off limits. Go on now.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 8)[
\Jed, I didn&#39;t want to have to do this but you leave me no choice. I&#39;m going to break the link to this passage. No more toilet flushing for you, mister.(set:$STATS&#39;s 6th to it + 1)
\(set:$toiletEnding to true)]
\(if:$visitsJedsToilet is 9)[
\(font:&quot;Raleway&quot;)If you somehow see this text please let me know, this is not supposed to show up at all!]
\(if:$visitsJedsToilet is 10)[
\You flush the toilet.(set:$STATS&#39;s 6th to it + 1)]
\(if:$visitsJedsToilet is 11)[
\Ha! I&#39;m kidding. Did you really think I would let you do all this again? Oh, no no no. I&#39;m cutting it short. I just wanted to lead you on a little before I did it. Bye bye!(set:$STATS&#39;s 6th to it + 1)
\(set:$toiletEnding to true)]

[[Continue-&gt;Jed&#39;s Bathroom]]</tw-passagedata><tw-passagedata pid="24" name="Train Ticket Warning" tags="" position="2200,2400" size="100,100">Hey Jed, sorry for the &quot;divine interruption,&quot; but I couldn&#39;t help but notice you left your bedroom without grabbing the train pass. Did I not point it out clearly enough? Anyway, I just wanted to let you know that this ticket is pretty helpful; you&#39;re not going to be able to do a lot of traveling without it!

[[Continue-&gt;Jed&#39;s Bedroom]]</tw-passagedata><tw-passagedata pid="25" name="Grab Ticket" tags="" position="2200,2550" size="100,100">(if:$INV contains &quot;train pass new&quot; and (not $mugged or $INV contains &quot;cash stash&quot;))[
\This is where you keep important items, such as your train pass. However, you already bought a new one. Good job Jed, you wasted $(if:$FUN is 7)[20](else:)[80].]
\(else:)[(unless:$INV contains &quot;train pass&quot;)[
\You open your drawer and you grab your train pass. Good thing you grabbed it, Jed, this isn&#39;t cheap to replace!
\(set: $INV to it + (a:&quot;train pass&quot;))]
\(else-if:$mugged and $INV does not contain &quot;cash stash&quot;)[
\(set:$INV to it + (a:&quot;cash stash&quot;))(set:$MONEY to it + 50)
\Jed opened the drawer to his cabinet. In the back is a small lockbox. He grabbed it and inputted the code 2845, which caused it to open up. Inside was a roll of $50. Make sure not to waste this too, Jed.]
\(else:)[This is where you keep important items. There isn&#39;t anything else in here worth grabbing for this adventure.]]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Continue-&gt;Jed&#39;s Bedroom]]</tw-passagedata><tw-passagedata pid="26" name="Closet" tags="" position="2200,2700" size="100,100">What shall you wear today?
\(set:$previousPassage to (passage:)&#39;s name)

(if:$CLOSET contains &quot;3d glasses&quot;)[(if:$wearing is &quot;3d glasses&quot;)[&#39;&#39;3d Glasses - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;3D Glasses&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;3d glasses&quot;)]]
]
\(if:$CLOSET contains &quot;bomber jacket&quot;)[(if:$wearing is &quot;bomber jacket&quot;)[&#39;&#39;Bomber Jacket - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Bomber Jacket&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;bomber jacket&quot;)]]
]
\(if:$wearing is &quot;none&quot;)[&#39;&#39;Everyday Clothes - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Everyday Clothes&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;none&quot;)]]
\(unless:$hatgone)[
(if:$wearing is &quot;hat&quot;)[&#39;&#39;Flamboyant Hat - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Flamboyant Hat&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;hat&quot;)]]]
\(if:$CLOSET contains &quot;ghost&quot;)[
(if:$wearing is &quot;ghost&quot;)[&#39;&#39;Ghost Costume - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Ghost Costume&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;ghost&quot;)]]]
\(if:$CLOSET contains &quot;hoodie&quot;)[
(if:$wearing is &quot;hoodie&quot;)[&#39;&#39;Green Hoodie - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Green Hoodie&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;hoodie&quot;)]]]
\(if:$CLOSET contains &quot;icloak&quot;)[
(if:$wearing is &quot;icloak&quot;)[&#39;&#39;Invisibility Cloak - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Invisibility Cloak&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;icloak&quot;)]]]
\(if:$CLOSET contains &quot;plumber outfit&quot;)[
(if:$wearing is &quot;plumber outfit&quot;)[&#39;&#39;Navy Blue Button-Up - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Navy Blue Button-Up&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;plumber outfit&quot;)]]]
\(if:$CLOSET contains &quot;vest&quot;)[
(if:$wearing is &quot;vest&quot;)[&#39;&#39;Purple Vest - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Purple Vest&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;vest&quot;)]]]
\(if:$CLOSET contains &quot;visor&quot;)[
(if:$wearing is &quot;visor&quot;)[&#39;&#39;Rainbow Visor - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Rainbow Visor&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;visor&quot;)]]]
\(if:$CLOSET contains &quot;ski mask&quot;)[
(if:$wearing is &quot;ski mask&quot;)[&#39;&#39;Ski Mask - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Ski Mask&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;ski mask&quot;)]]]
\(if:$CLOSET contains &quot;cape&quot;)[
(if:$wearing is &quot;cape&quot;)[&#39;&#39;Superhero Cape - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Superhero Cape&quot;,&quot;Closet&quot;)[(set:$wearing to &quot;cape&quot;)]]]

(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Exit-&gt;Jed&#39;s Bedroom]] </tw-passagedata><tw-passagedata pid="27" name="Mirror" tags="" position="1900,2550" size="100,100">(if:$INV contains &quot;documents&quot;)[
\You try to look at yourself in the mirror, but it&#39;s completely broken. What a shame, you won&#39;t be able to see how good this hat looks on you...]
\(else:)[
\Jed, do you see how wonderful this hat is? How amazing, how beautiful, how-

Jed... are you... about to vomit? Is this hat that disgusting to you Jed? Wow. I... I didn&#39;t know you felt that way about this hat. Why&#39;d you even keep it if you don&#39;t even like it, huh? Oh well, your loss. Not my fault you can&#39;t see its true magnificence. Now stop that dry heaving.]

[[Continue-&gt;Jed&#39;s Bathroom]]</tw-passagedata><tw-passagedata pid="28" name="Fridge" tags="" position="2050,2400" size="100,100">You open up your fridge. It&#39;s filled with refrigerated items such as (either:&quot;sodas&quot;,&quot;juice&quot;,&quot;milk&quot;,&quot;tea&quot;), (either:&quot;produce&quot;,&quot;eggs&quot;,&quot;yogurt&quot;,&quot;hummus&quot;), and (either:&quot;butter.&quot;,&quot;jam.&quot;,&quot;leftovers from 4 weeks ago.&quot;,&quot;ice cream. Wait. Jed, ice cream doesn&#39;t go in the fridge! You&#39;re supposed to put it in the freezer! Who raised you?&quot;)
\(set:$previousPassage to (passage:)&#39;s name)

(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Continue-&gt;Jed&#39;s Kitchen]]</tw-passagedata><tw-passagedata pid="29" name="Trash Can" tags="" position="2050,2700" size="100,100">This is a trash can. You throw trash in it. What are we doing here?
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;hat&quot;)[[[Throw Away Hat-&gt;Throw Away Hat]]
]
\(if:$INV contains &quot;key&quot;)[[[Throw Away Key-&gt;Throw Away Key]]
]
\(if:$INV contains &quot;letter&quot;)[[[Throw Away Letter-&gt;Throw Away Letter]]
]
\(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Exit-&gt;Jed&#39;s Kitchen]]</tw-passagedata><tw-passagedata pid="30" name="Throw Away Letter" tags="" position="2050,2850" size="100,100">(if:$FUN is 4)[
\(if:$INV contains &quot;key&quot;)[
\Good job, Jed. Now the aliens won&#39;t be able to track you.

You see how that doesn&#39;t really make sense? Oh well, doesn&#39;t matter too much. As long as you have the key!]
\(else:)[
\Oh, now the letter too? Sure, just throw that away. Not even as blunt of a hook as &quot;ALIENS, THEY&#39;RE REAL!&quot; can make you participate in my story? I see how it is.]]
\(else:)[
\Jed why did you do that? I know you get a lot of junk mail but this isn&#39;t that. Do you really not want to participate in my story? (if:$testing is &quot;FAIL2&quot;)[No, you obviously don&#39;t, considering you failed those tests at the beginning of the game.] I see how it is.]
\(set:$INV to it - (a:&quot;letter&quot;))
\(set:$STATS&#39;s 2nd to it + 1)

[[Continue-&gt;Jed&#39;s Kitchen]] </tw-passagedata><tw-passagedata pid="31" name="Throw Away Hat" tags="" position="2050,3000" size="100,100">Jed no! The hat! Oh, it was such a magnificent hat. You really did look amazing in it. How I&#39;ll miss you, hat. Maybe another time, Jed can see that he was wrong about you.
\(set:$hatgone to true)(set:$wearing to &quot;none&quot;)
\(set:$STATS&#39;s 2nd to it + 1)

[[Continue-&gt;Jed&#39;s Kitchen]]</tw-passagedata><tw-passagedata pid="32" name="Coffee Maker" tags="" position="2050,2550" size="100,100">(set:$visitsCoffeeMaker to it + 1)
\(if:$visitsCoffeeMaker is 1)[
\Ah yes, nothing like a cup of coffee to get yourself energized for the day. You brew yourself a nice hot coffee using your coffee maker. Delicious.]
\(if:$visitsCoffeeMaker is 2)[
\You brew yourself another cup of coffee. Apparently you couldn&#39;t get enough and you&#39;re back for seconds. Drinking it hurt because your tongue was already hot from the previous cup.]
\(if:$visitsCoffeeMaker is 3)[
\Jed, I don&#39;t think this is healthy. You can barely even drink it because you&#39;re basically burning yourself with these hot coffees!]
\(if:$visitsCoffeeMaker is 4)[
\Alright, this definitely isn&#39;t good. Aside from the fact that you seem to be drinking painfully hot coffee, this much caffeine can&#39;t be good for you. You&#39;re causing yourself to crash later on in the day. We can&#39;t have that during such an important mission!]
\(if:$visitsCoffeeMaker is 5)[
\You try to make yourself yet another coffee, but fortunately it appears the coffee maker is out of coffee grounds. What was supposed to last you 4-5 days has now been used up in one morning. Congratulations, Jed.]
\(if:$visitsCoffeeMaker &gt; 5)[
\Sorry Jed, but no matter how many times you try you can&#39;t make coffee magically appear.]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Continue-&gt;Jed&#39;s Kitchen]] </tw-passagedata><tw-passagedata pid="33" name="The Apartment Complex" tags="" position="2300,1700" size="100,200">Here is the apartment complex, the place you live at. It looks incredibly old on the outside.

[[Your Apartment-&gt;Jed&#39;s Apartment]]
[[Visit Rafael-&gt;Rafael&#39;s Apartment]] 
[[Visit Ted-&gt;Ted&#39;s Apartment]] 
[[Visit Josefine-&gt;Josefine&#39;s Apartment]] 
\(if:$STANLEY)[
[[Visit Stanley-&gt;Stanley&#39;s Apartment]]]
[[Visit the Mailboxes-&gt;Mailboxes]]
[[Exit-&gt;East Side of Town]]</tw-passagedata><tw-passagedata pid="34" name="Rafael&#39;s Apartment" tags="" position="2400,2000" size="100,200">(if:$wearing is &quot;icloak&quot;)[
\You go over to Rafael&#39;s apartment and knock on the door.

&quot;Hello? Is someone there?&quot; Rafael looks around but doesn&#39;t see you. He then shuts the door.

[[Continue-&gt;The Apartment Complex]]]
\(else:)[==
\(set:$visitsRafael to it + 1)
\You go over to Rafael&#39;s apartment and knock on the door. (if: $visitsRafael is 1)[You and Rafael are good friends, but you don&#39;t visit that often anymore.

&quot;Hello- oh! Hey Jed! It&#39;s been a while. How have things been?&quot;]
\(if: $visitsRafael is 2)[

&quot;Hey, something else you need?&quot;]
\(if: $visitsRafael is 3)[

&quot;Hello?&quot;]
\(if: $visitsRafael &gt; 3)[

&quot;Hello..?&quot;]

[[Burgerocity-&gt;Rafael Burgerocity]]
(if:(history:) contains &quot;Empty Store&quot; and $josefineStore is &quot;unknown&quot;)[[[Empty Store-&gt;Rafael Empty Store]]
]
\(if:$INV contains &quot;bear&quot;)[[[Gift Teddy Bear-&gt;Rafael Bear]]
]
\(unless:$wearing is &quot;none&quot;)[[[Outfit-&gt;Rafael Outfit]]
]
\(if:$sidequests&#39;s length &gt; 0 and $INV does not contain &quot;bombglasses&quot;)[[[Sidequest-&gt;Rafael Sidequest]]
]
\(if:$INV contains &quot;bombglasses&quot;)[[[Give Sunglasses-&gt;Rafael Sunglasses]]
]
\(if:(history:) contains &quot;Setup VR&quot;)[[[Virtual Reality-&gt;Rafael VR]]
]
\[[&quot;Gotta go!&quot;-&gt;The Apartment Complex]]</tw-passagedata><tw-passagedata pid="35" name="Rafael Burgerocity" tags="" position="2400,2250" size="100,100">You mention Burgerocity shutting down.

&quot;Burgerocity? The burger place? That&#39;s a shame, it&#39;s basically the only fast food joint around for miles. Though it is very strange that it randomly shut down... Any idea what happened?&quot;

&quot;He said that the meaning was personal,&quot; Jed replied. &quot;I&#39;m gonna try and look into it.&quot;

&quot;Let me know when you do! Oh, but be careful over in West Side. I heard there&#39;s some bad people on the loose.&quot;

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="36" name="Sleep" tags="" position="2200,2850" size="100,100">(if:($FUN is 4 and $INV does not contain &quot;key&quot;) or ($FUN is not 4 and $INV does not contain &quot;letter&quot;))[
\Jed? Did you just throw away the (cond:$FUN is 4,&quot;key&quot;,&quot;letter&quot;) and go back to bed? Do you have no consideration for this world? This story? This adventure? I created this just for you, and you decide to throw it all away? I simply cannot understand. (if:$testing is &quot;FAIL2&quot;)[Did you even care at all from the start?]

I see how it is. Go along, Jed. Watch what happens when you decide to neglect the story. See what good it does for you.

[[Zzzzzz....-&gt;Neglect]]]
\(else:)[
\(if:not $bookReturned and $INV does not contain &quot;late book&quot;)[Despite the fact that he had just woken up about 15 minutes ago, Jed tried to fall back asleep. He jumped onto the bed, but in doing so an object bounced up and hit the floor. He got up to look at it, and it was his copy of //The Gigantic Suitcase// that he forgot to return to the library. How he had slept so many times without noticing it, I have no idea.
\(set:$INV to it + (a:&quot;late book&quot;))]
\(else:)[Despite the fact that he had just woken up about 15 minutes ago, Jed tried to fall back asleep. It only took a few seconds until he got bored and got back out of bed.]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Continue-&gt;Jed&#39;s Bedroom]]]</tw-passagedata><tw-passagedata pid="37" name="Neglect" tags="" position="2150,3150" size="200,100">You woke up after a while. How long has it been?

You look at your phone... Oh goodness! You somehow slept for 4 days straight! 

You look at the window, and there appears to be a faint red glow coming from outside, along with heavy fog blocking everything from view. &quot;What happened?&quot; you think to yourself.

You rushed outside, waiting for the fog to clear up.

The buildings around you are all on fire; some are completely destroyed. You can&#39;t hear anyone, only the sound of collapsing buildings.

Jed was at a loss for words. Jed wondered what could have caused all of this. An entire string of events leading to catastrophe that he had no idea about. Of course, there was no way that Jed would&#39;ve known that all of this could have been prevented if he had just kept the letter.
\(unless:$ENDINGS contains &quot;Neglect&quot;)[(set:$ENDINGS to it + (a:&quot;Neglect&quot;))]
\(set:$JOURNAL to it + (a:&quot;Neglect&quot;))
\(set:$STATS&#39;s 1st to it + 1)

[[The End-&gt;Waiting Room Entrance]]</tw-passagedata><tw-passagedata pid="38" name="Library" tags="" position="1100,1700" size="100,200">You&#39;re inside the Webster Groves Public Library.
\(set:$previousPassage to (passage:)&#39;s name)

(unless:$wearing is &quot;icloak&quot;)[[[Talk to Librarian-&gt;Talk to Librarian]]
]
\(if:$rafaelQuest contains &quot;step4&quot; and does not contain &quot;step6&quot; and $wearing is not &quot;icloak&quot;)[[[Sunglasses-&gt;Library Sunglasses]]
]
\[[Computer Lab]]
(if:$bookReturned)[[[Bookshelves-&gt;Bookshelves]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;East Side of Town]]</tw-passagedata><tw-passagedata pid="39" name="City Hall" tags="" position="3530,1717" size="100,200">(set:$visitsCityHall to it + 1)
\(if: $visitsCityHall is 1)[
\You enter the Webster Groves City Hall. It&#39;s a beautiful building. The room you&#39;re standing in is nothing short of luxurious, with lots of decorations and a lot more open space. There are quite a few hallways that branch off of the lobby.

Oddly, in what is a very open and spacious room, you can only see one other person. The mayor&#39;s secretary is sitting at her desk busy. She is completely enveloped in her computer screen, almost frantically typing and scrolling. She hasn&#39;t even noticed that you&#39;ve come in.]
\(else:)[
\You&#39;re inside the City Hall. (if:$visitsSecretary is 0 or $wearing is &quot;icloak&quot;)[The secretary is focused on her computer.](else:)[The secretary does a small wave to you.]]

(if:$wearing is &quot;icloak&quot;)[[[Walk Past Secretary-&gt;Walk Past]]](else:)[[[Talk to the Secretary-&gt;Talk to Secretary]]]
[[Exit-&gt;Town Square]]</tw-passagedata><tw-passagedata pid="40" name="Arcade" tags="" position="3900,1700" size="100,200">You&#39;re inside the Impulse Arcade. The smell of burnt pizza and overcrowding brings you great nostalgia.
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Buy Tokens&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Buy Tokens-&gt;Buy Tokens]]]
[[Play Games-&gt;Arcade Games]]
(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Spend Tickets&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Spend Tickets-&gt;Spend Tickets]]]
(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;Town Square]]</tw-passagedata><tw-passagedata pid="41" name="Hardware Store" tags="" position="4230,1720" size="100,200">(unless:$banned contains &quot;hardware store&quot; and (($wearing is &quot;ski mask&quot; and $boxMask) or ($wearing is not &quot;ski mask&quot; and $boxMask is false)) and $wearing is not &quot;icloak&quot;)[
\You&#39;re inside the Town Square Hardware Store. It feels strangely cold. 
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Purchase Items&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Purchase Items-&gt;Buy Hardware]]]
(if:$joinGang and $INV does not contain &quot;cardboard box&quot;)[[[Backroom-&gt;Back Room]]
]
\(if:$rafaelQuest contains &quot;step3&quot; and does not contain &quot;step5&quot; and $wearing is not &quot;icloak&quot;)[[[Sunglasses-&gt;Hardware Store Sunglasses]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\(if:$haircuts is 3 and $visitsHardwareBald is 0 and $wearing is not &quot;icloak&quot;)[[[Exit-&gt;Hardware Bald]]](else:)[[[Exit-&gt;Town Square]]]]
\(else:)[&quot;What part of banned did you not understand?&quot; the clerk shouts. &quot;Get out!&quot;

[[Exit-&gt;Town Square]]]</tw-passagedata><tw-passagedata pid="42" name="Empty Store" tags="" position="4593,1714" size="100,200">(if:$josefineStore is &quot;unknown&quot;)[You&#39;re inside an empty store. You can make out the counters and shelves, but of course, there is nothing left. You remember going here quite a lot, but you can&#39;t remember what the actual store was.]
\(if:$josefineStore is &quot;known&quot;)[This is where Josefine used to have her old bakery, Taste of Heaven. The store is completely empty now, except for the counters and shelves. You remember going here quite a lot.]
\(if:$josefineStore is &quot;wait&quot;)[This is where Josefine used to have her old bakery, Taste of Heaven. She sent you the deed, and now you&#39;re waiting to get it through the mail.]
\(if:$josefineStore is &quot;has deed&quot;)[
\(if:$INV contains &quot;wallpaper&quot; and &quot;paint&quot;)[
\This is the empty store given to you by Josefine. It&#39;s been your lifelong dream to open a shop called &quot;Jed&#39;s Jams,&quot; a shop where you sell jelly and vinyl records. You have the jelly and records stored at home, and now you have the real estate. You&#39;d be able to make the place look nice using the wallpaper and paint you bought at the hardware store. Jed, your dream, it&#39;s almost come true!]
\(else:)[This is the empty store given to you by Josefine. It&#39;s been your lifelong dream to open a shop called &quot;Jed&#39;s Jams,&quot; a shop where you sell jelly and vinyl records. You have the jelly and records stored at home, and now you have the real estate, so the only thing left to set up shop would be to clean up the place with some wallpaper and paint.]]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$josefineStore is &quot;has deed&quot; and $INV contains &quot;wallpaper&quot; and $INV contains &quot;paint&quot;)[[[Open Jed&#39;s Jams-&gt;Open Jed&#39;s Jams]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;Town Square]]</tw-passagedata><tw-passagedata pid="43" name="Burgerocity" tags="" position="5600,1700" size="100,200">(if:$INV contains &quot;busterShop&quot;)[
\You probably don&#39;t want to come back in here after you stole Buster. It&#39;d be kinda awkward...

[[Continue-&gt;West Side of Town]]]
\(else:)[==
\(if:$wearing is &quot;icloak&quot;)[You walk into Burgerocity. &quot;Is someone there?&quot; the owner says shakily.](else:)[&quot;Hey Jed,&quot; the owner says. &quot;Here to buy some food before I shut down shop?&quot;]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Purchase Food&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Purchase Food-&gt;Burgerocity Counter]]]
(unless:$wearing is &quot;icloak&quot;)[[[Talk to Owner-&gt;Burgerocity Owner]]
]
\(if:$INV contains &quot;power ticket&quot; and $wearing is not &quot;icloak&quot;)[[[Give Ticket-&gt;Burgerocity Ticket]]
]
\(unless:$INV contains &quot;busterShop&quot; or $BUSTER)[[[Cardboard Cutout-&gt;Burgerocity Buster]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;West Side of Town]]</tw-passagedata><tw-passagedata pid="44" name="Barber Shop" tags="" position="5900,1700" size="100,200">(if:$wearing is &quot;cape&quot; or $citizensHelped contains &quot;barber&quot;)[
\(unless:$citizensHelped contains &quot;barber&quot;)[You&#39;re inside the West Side Barber Shop. It doesn&#39;t look like there&#39;s anyone working here at the moment. Despite this, a man is sitting in one of the chairs, waiting for someone. &quot;Is there anyone here to help me?&quot;]
\(else:)[You&#39;re inside the West Side Barber Shop. It doesn&#39;t look like there&#39;s anyone working here at the moment.]]
\(else:)[You&#39;re inside the West Side Barber Shop. (if:$wearing is &quot;icloak&quot;)[&quot;Did someone just come in?&quot; the barber asks.](else:)[&quot;Hey Jed, what are you doing back here?&quot; the barber greets.]]
\(set:$previousPassage to (passage:)&#39;s name)

(unless: $wearing is &quot;cape&quot; or $citizensHelped contains &quot;barber&quot; or $wearing is &quot;icloak&quot;)[[[Get a Haircut-&gt;Haircut]]
]
\(if:$wearing is not &quot;cape&quot; and $citizensHelped does not contain &quot;barber&quot; and $rafaelQuest contains &quot;step1&quot; and does not contain &quot;step3&quot; and $wearing is not &quot;icloak&quot;)[[[Sunglasses-&gt;Barber Shop Sunglasses]]
]
\(if:$wearing is &quot;cape&quot; and $citizensHelped does not contain &quot;barber&quot;)[[[Help the Man-&gt;SuperJed Barber]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;West Side of Town]]</tw-passagedata><tw-passagedata pid="45" name="Clothing Store" tags="" position="6200,1700" size="100,200">You&#39;re inside Tactical Bold, the most well-known clothing store in West Side. (if:$wearing is &quot;icloak&quot;)[&quot;What was that noise?&quot; the clerk shouts.](else:)[&quot;You need help with something?&quot; the clerk asks.]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Look at Clothes&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Look At Clothes-&gt;Clothing Selection]]]
(if:(history:) contains &quot;Talk to Secretary&quot; and not $visitPlumber and $CLOSET does not contain &quot;plumber outfit&quot; and $wearing is not &quot;icloak&quot;)[[[&quot;I&#39;m actually going for a plumber/mechanic kind of look...&quot;-&gt;Plumber Shortcut]]
]
\(if:$rafaelQuest contains &quot;step2&quot; and does not contain &quot;step4&quot; and $wearing is not &quot;icloak&quot;)[[[Sunglasses-&gt;Clothing Store Sunglasses]]
]
\(unless:$wearing is &quot;icloak&quot;)[[[&quot;How do clothes work?&quot;-&gt;Clothing Explain]]
]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)
]
\[[Exit-&gt;West Side of Town]]</tw-passagedata><tw-passagedata pid="46" name="Dark Alleyway" tags="" position="6800,1700" size="100,200">(if:$visitsGang is 1)[You start to walk down a dark alleyway. What are you doing back here?]
\(else-if:$visitsGang &gt; 1)[You start to walk down a dark alleyway. This is where the extremely dangerous and criminal gang is. Y&#39;know, the one that&#39;s being hunted down by the police and you are now associated with. That gang.]
\(else:)[You start to walk down a dark alleyway. (if:$INV contains &quot;buster&quot;)[&quot;Jed, I don&#39;t think we should be going this way,&quot; Buster warns. &quot;(cond:$FUN is 9,&quot;I saw bad stuff happening in West Side on the news this morning!&quot;,&quot;I just have a gut feeling that this is bad...&quot;)&quot;](else:)[(cond:$FUN is 9,&quot;Did you not pay attention to the news this morning? Get out of here!&quot;,&quot;Something tells me you shouldn&#39;t be going this way, Jed. Don&#39;t you know there&#39;s criminal activity in West Side?&quot;)]]

(if:$wearing is &quot;cape&quot; and $ticketPowers is &quot;unvisited&quot;)[[[Continue-&gt;Gang Ticket]]](else-if:($storeCardQuest contains &quot;ask&quot; or $wearing is &quot;icloak&quot; or $ticketPowers is not &quot;unvisited&quot;) and $visitsGang is 0)[[[Continue-&gt;Gang Empty]]](else:)[[[Continue-&gt;The Gang]]]
\(if:$toiletEnding and $alleywayBathroom)[
[[Bathroom-&gt;Alleyway Bathroom]]]
[[Go Back-&gt;West Side of Town]]</tw-passagedata><tw-passagedata pid="47" name="About" tags="title" position="2400,100" size="100,100">=&gt;&lt;=
Written and Developed by Blue Cat Productions and Green Guy.

Illustrations by Wiz.

Originally created for the Beepbox Discord Text Adventure Event.
v1.0 released on July 9, 2022.
v1.1 released on Poo poo pee pee, 2023.

Special thanks to
Jacob, Quirb, Theep, Thurm

[[Continue-&gt;Title Screen]] </tw-passagedata><tw-passagedata pid="48" name="Exit" tags="" position="2400,250" size="100,100">(font:&quot;Raleway&quot;)[
\(unless:(history:) contains &quot;The Beginning&quot;)[
\Hello? You haven&#39;t even played the game and you&#39;re ready to quit? I... well... I don&#39;t know what to say. Go ahead and close the tab I guess... Twine can&#39;t close the game for you.]
\(else:)[
\Hello player. So this is a bit awkward but... Twine doesn&#39;t exactly have a feature to close the tab for you. Trust me, I looked into it just for this joke. I kept the button here because I thought the menu looked nicer with 3 options. So if you want to quit you&#39;re going to have to put in some more effort! But hey, instead of leaving, maybe you could find some more endings!]]

[[Continue-&gt;Title Screen]] </tw-passagedata><tw-passagedata pid="49" name="Train Ride" tags="" position="4000,850" size="100,100">(set:$STATS&#39;s 7th to it + 1)
\(if:$PREMIUM is &quot;yes&quot;)[(set:$trainTime to 1s)(set:$traintext to (either:&quot;Wow, looks like we&#39;re already here!&quot;,&quot;And there&#39;s our stop! Let&#39;s go!&quot;,&quot;Oh we stopped moving? That was so soon I didn&#39;t even notice!&quot;,&quot;Alright, this new \&quot;express train\&quot; thing is working quite nicely!&quot;,&quot;Very shortly after, the train came to a stop and pulled into the station.&quot;))](else:)[(set:$trainTime to 10s)(set:$traintext to (either:&quot;Welp, looks like we&#39;re here!&quot;,&quot;And there&#39;s our stop! Let&#39;s go!&quot;,&quot;Oh we stopped moving? I didn&#39;t even notice!&quot;,&quot;Finally, we&#39;re here! Was it just me or was that train ride unbearably long?&quot;,&quot;Soon after, the train came to a stop and pulled into the station.&quot;))]
\(if:$STATS&#39;s 7th &gt;= 20 and $PREMIUM is &quot;nope&quot;)[(set:$PREMIUM to &quot;ready&quot;)]
\(set:$trainDialogue to (a:&quot;Jed wondered if Burgerocity was selling the Big Boy today. The Big Boy is a special burger that the owner only sells on random days. On one hand, today is Burgerocity&#39;s last day, so it would be a missed opportunity if the owner didn&#39;t sell it. On the other hand, it had only been a few days since it was last sold, and it takes lots of material to make, so he probably does not have enough.&quot;,&quot;Jed looked out the train window for some birds. Jed had made it a habit to birdwatch while on the train. Strangely enough, Jed didn&#39;t see any during his ride. The weather&#39;s normal today, where are all the birds? Did someone scare them all away? Or some//thing//?&quot;,&quot;Jed thought about the events happening today. His favorite burger place being shut down, the letter he received in the mail, and the quest given to him. Jed loves to help people and wanted to succeed in this regard, but the things happening today seem a bit much. Was this quest expected of him? What would happen if he never met up with the writer of the letter? When is it okay to let things take their own course?&quot;,&quot;Jed thought about his neighbor Rafael. He and Jed met when he first moved in the apartment complex, and they got along quite well. They have quite a few things in common and have hung out a few times. However, their schedules rarely line up, so they don&#39;t talk to each other as much as they would like.&quot;,&quot;Jed thought about his neighbor Ted. Ted is much older than Jed, and Ted had been living in the apartment complex way before Jed moved in. Despite the fact that they&#39;ve been neighbors for a while, they have barely gotten to know each other. Ted has almost completely forgotten who Jed is, despite his numerous attempts to introduce himself. Maybe one day they shall become friends…&quot;,&quot;Jed thought about his neighbor Josefine. Jed and Josefine have known each other for years, but only just recently did Josefine move near Jed. She had been living with her parents for a few years but eventually wanted her own place. Jed convinced her to move in near him, and she did. She&#39;s not new to Webster Groves, however, since she used to (cond: $josefineStore is &#39;unknown&#39;,&#39;have a job&#39;,&#39;own a business&#39;) here.&quot;,&quot;Jed wondered if he could ever get a job at Bosco&#39;s Family Food Store, the supermarket next to his apartment complex. On one hand, it wouldn&#39;t be that hard of a job, he&#39;d get to talk to people a lot, and it&#39;s a very short walk from his place to the store. However, the store&#39;s current owner, John Bosco, has developed a slight distaste for Jed. As far as Jed knows, he hasn&#39;t done anything that would warrant this kind of disdain (a disdain that he&#39;s not even aware of), but the owner simply doesn&#39;t like his over-the-top personality.&quot;,&quot;Jed realized he has never been inside the Webster Groves City Hall(cond:$visitsCityHall &gt; 0,&#39; before today&#39;,&#39;&#39;). The building is of course open to the public, but he had simply never thought to enter it, nor had a reason to enter it. But now with the letter he got this morning talking about evil and distrustful people inside City Hall, I think it&#39;s safe to say Jed (cond:$visitsCityHall &gt; 0,&#39;had&#39;,&#39;has&#39;) a pretty good reason for visiting. Its interior has popped up in some conversations with friends: its gigantic size, the beautiful columns, the art on the roof, and the large maze-like structure of its hallways. Would it be wrong to ask for some kind of tour?&quot;,&quot;Jed thought about the computer lab inside the town library. The computers have been out of order for quite a while. Despite this, sometimes when Jed enters the computer lab, he can see stuff on one of the screens, but it&#39;s usually something frozen. Do the computers actually work, and someone&#39;s just been freezing them on command and lying they&#39;re out of order? Or are they so broken that they just show random things whenever they feel like it?&quot;,&quot;Jed thought about the criminal gang in West Side that he keeps hearing about. They&#39;re mostly known for mugging people that are unfortunate enough to cross paths with them. He then began to wonder how much being a mugger pays. You could get lucky and get someone who carries lots of money, but recently there are fewer and fewer people who ever carry cash at all. Imagine being a mugger for a living, but constantly mugging people who don&#39;t carry cash! The mugging economy must be going downhill compared to the past.&quot;,&quot;Jed looked around the train car he was in. &quot; + (cond:$wearing is &#39;3d glasses&#39;,&#39;It looked absolutely incredible in 3D.&#39;,&#39;For some reason, it looked nicer than the other ones he\&#39;s been in before.&#39;) + &quot; The seats were pretty, and also very comfy. There were also tables in between the seats, something Jed knows that only a few of the train cars have. Along with the great landscape view that can be seen through the big glass windows, this ride was very enjoyable.&quot;,&quot;Jed thought about the Gadget Factorie, the electronic store near his apartment. Even if Jed was somehow able to purchase appliances from there, almost everything was self-assembly, and Jed has absolutely no experience in assembling appliances. Self-assembly furniture makes sense, but appliances? No. The only things pre-built are the small items, such as the VR headset and the toaster.&quot;,&quot;Jed thought about the aptly named Town Square Hardware Store. All the times Jed has been in Town Square, he&#39;s seen the store&#39;s owner in the shop. Surely he has to do something else in his day-to-day life, right? Perhaps he truly loves the hardware store, so much so that it has completely thrown off his work-life balance. But even so, there has to be //something// that this guy does when he&#39;s not working. Some kind of meet-up group? A nice hobby? Something else?&quot;,&quot;Jed thought about the Impulse Arcade, the arcade in Town Square. They only have a small handful of games, none of which were any big-name arcade games. Nonetheless, Jed would go there all the time as a kid. He was only ever able to scrounge up change for a few tokens, so he&#39;d never be able to get some of the really big prizes. If you&#39;re able to get enough tickets, you can get some pretty cool stuff that you can&#39;t really get anywhere else.&quot;,&quot;Jed thought about the barber shop in West Side. Jed goes there about once every two weeks, to make sure his hair has a nice, clean shape to it. He&#39;s been getting the same haircut for years. But, you know what they say: if it ain&#39;t broke, don&#39;t fix it! Why take a risk trying a new style when you can just stick with what you got?&quot;,&quot;Jed thought about Tactical Bold, the clothing store in West Side. Jed was never really big into style or fashion. The boldest piece of clothing he owns is a hat that was passed down to him by a friend, (cond:(history:) contains any of (a:&#39;Mirror&#39;,&#39;Throw Away Hat&#39;),&#39;but apparently he hates it or something.&#39;,&#39;but he never really wears it.&#39;) Maybe one day Jed will wear something that will truly catch the eye of people in public in a captivating and innovative way, but until then he can just wear the random stuff in his closet.&quot;,&quot;Jed thought about Gasology, the gas station in West Side. Jed had only been in there a few times, just when he needs something quick and he&#39;s in the area. He&#39;s known the current owner for quite some time, but she only just recently took over the business. One thing that Jed has never interacted with(cond:$lottoSpendings &gt; 0,&#39; before today&#39;,&#39;&#39;) in the gas station is the ticket machine. If you think about it, lottery wouldn&#39;t even exist if there was no way to be able to profit off of it.&quot;))
\(if:(history:) contains &quot;Stanley&#39;s Apartment&quot;)[(set:$trainDialogue to it + (a:&quot;Jed thought about his neighbor Stanley. At the same time, Stanley seemed like he just showed up and that he&#39;s been here for a while. Jed couldn&#39;t remember Stanley living in his apartment complex, but he also couldn&#39;t think of a specific time when Stanley //wasn&#39;t// living in the apartment complex. He also has a sort of... weird... aura around him. Like he doesn&#39;t belong? Not in a social sense but in some other kind of way… Jed couldn&#39;t quite figure out the right words for this.&quot;))]
\(if:(history:) contains &quot;Button Area&quot; and $anomalies&#39;s length &gt; 2)[(set:$trainDialogue to it + (a:&quot;Jed thought about that small button building over in East Side. Has this always been there? Maybe it has. Jed couldn&#39;t say for sure. It only looks like a normal building on the outside. But the inside is where the magic happens (perhaps literally?). Jed has noticed a few random things happening around town. Was it because of the buttons? Is something else at play? If the buttons are causing the weird happenings, then why do they sometimes happen when Jed doesn&#39;t press a button?&quot;))]
\Jed (cond:$INV contains &quot;buster&quot;,&quot;and Buster &quot;,&quot;&quot;)got on the train, and shortly after it began to move. 

During the train ride, (either:...$trainDialogue)
\(live:0s)[(if:time &gt; $trainTime)[

$traintext

(if:$LOC is &quot;East Side&quot;)[[[Continue-&gt;East Side of Town]]](if:$LOC is &quot;Town Square&quot;)[[[Continue-&gt;Town Square]]](if:$LOC is &quot;West Side&quot;)[[[Continue-&gt;West Side of Town]]](stop:)](else-if:$INV contains &quot;busterShop&quot;)[

[[Jump Out-&gt;Jump Out of Train]]]]</tw-passagedata><tw-passagedata pid="50" name="Talk to Secretary" tags="" position="3534,1987" size="100,100">(set:$visitsSecretary to it + 1)
\(if:$visitsSecretary is 1)[
\(if:$wearing is not &quot;plumber outfit&quot;)[
\You walk up to the secretary&#39;s desk. Your steps echo through the room, yet she still stays focused. &quot;Hello?&quot; you say.

&quot;Oh, hello!&quot; she responds, still looking at her computer. &quot;If you&#39;ll give me just one second, I&#39;ve just been a bit... busy. I&#39;ve been busy. Did you have an appoint...&quot; she stops speaking when she turns her head towards you. She then looks around the room to check if anyone else is around. &quot;(if:$wearing is &quot;hat&quot;)[Nice hat,&quot; she says. &quot;Did you get my letter?&quot;](else:)[So you got my letter,&quot; she says.]

(if:$INV does not contain &quot;letter&quot; and $FUN is not 4)[&quot;Uh... yeah... I did...](else:)[&quot;Yes, I did.] What&#39;s going on? What are we going to do?&quot;

&quot;Mayor Dixon communicates to th- these people in a secret room downstairs. However, that floor is on high security, meaning only certain people are allowed downstairs. Fortunately for us, that&#39;s also where the water lines are. That&#39;s why I&#39;ve scheduled a visit from the local plumber.&quot; She winks at you.

[[&quot;Ah, gotcha!&quot;-&gt;Secretary Gotcha]]
[[&quot;What do you mean?&quot;-&gt;Secretary Plan]]]
\(else:)[
\You walk up to the secretary&#39;s desk. Your steps echo through the room, yet she still stays focused. &quot;Hello?&quot; you say.

&quot;Oh, hello!&quot; she responds, still looking at her computer. &quot;If you&#39;ll give me just one second, I&#39;ve just been a bit... busy. I&#39;ve been busy. Did you have an appoint...&quot; she stops speaking when she turns her head towards you. &quot;Jed?&quot;

&quot;Yup, that&#39;s me,&quot; you reply.

She looks at you confused. She looks around the room to make sure no one is here. &quot;I&#39;m sorry, I just- you got my letter, right?&quot;

&quot;Of course.(if:$INV does not contain &quot;letter&quot; and $FUN is not 4)[..]&quot;

&quot;Well, I&#39;m just surprised because my plan was that we&#39;re going to sneak into the basement by disguising you as a plumber. But it looks like you got the look. Well, once we go downstairs there&#39;s no going back. Do you have everything you need? You&#39;ll need some kind of blunt weapon.&quot;

[[&quot;I&#39;m ready!&quot;-&gt;Going Downstairs]]
[[&quot;Not yet...&quot;-&gt;City Hall]]]]
\(if:$visitsSecretary &gt; 1 and $wearing is not &quot;plumber outfit&quot;)[
\You walk up to the secretary&#39;s desk. &quot;Hey Jed,&quot; she greets, &quot;did you need something else?&quot;

[[&quot;Can you tell me the plan again?&quot;-&gt;Secretary Plan]]
[[&quot;Nope!&quot;-&gt;City Hall]]]
\(if:$visitsSecretary &gt; 1 and $wearing is &quot;plumber outfit&quot;)[
\&quot;Hey, hey!&quot; the secretary jokes, &quot;lookin&#39; good! Are you ready to go? Do you have everything you need? Don&#39;t forget you&#39;ll need some kind of tool.&quot;

[[&quot;I&#39;m ready!&quot;-&gt;Going Downstairs]]
[[&quot;Not yet...&quot;-&gt;City Hall]]]</tw-passagedata><tw-passagedata pid="51" name="Secretary Gotcha" tags="" position="3459,2137" size="100,100">&quot;I knew you&#39;d catch on!&quot; the secretary exclaims. &quot;I&#39;ll refinance you after this is all done, whatever you need to pull this off. Thank you so much, Jed. Good luck!&quot;

[[Continue-&gt;City Hall]]</tw-passagedata><tw-passagedata pid="52" name="Secretary Plan" tags="" position="3609,2137" size="100,100">&quot;You&#39;ll be a plumber coming to check in on the water pipes in the basement of city hall,&quot; the secretary explains. &quot;Near here is a hardware store, there you can get a couple of tools like a steel pipe wrench or a crowbar or whatever. There&#39;s a clothing store in West Side that should hopefully have something convincing that you can wear.&quot;

&quot;And look!&quot; The secretary pulls out two name tags from one of the desk drawers. &quot;The finishing touch, your very own employee nametag. And I&#39;ve also got a visitor name tag saved just for you.&quot;

&quot;So the tools and the outfit,&quot; Jed repeats to himself, &quot;got it.&quot;

&quot;Whatever it costs, I&#39;ll refinance you once this is over. Good luck, Jed!&quot;

[[Continue-&gt;City Hall]]</tw-passagedata><tw-passagedata pid="53" name="Waiting Room Entrance" tags="" position="4000,3900" size="200,200">(set:$visitsWaitingRoom to it + 1)(set:$STATS&#39;s 9th to it + 1)
\(font:&quot;Raleway&quot;)[
\(if:$ENDINGS&#39;s last is &quot;Toilet&quot; and not $gotToilet)[
\YOU DID IT!(set:$gotToilet to true)

YOU GOT THE TOILET ENDING! I&#39;M SO PROUD OF YOU!

Your execution was simply flawless. Of course, with an ending so perfect, he was initially upset that I would add such a thing to the game, but I&#39;m glad to see his feelings changed by the time you got to the last toilet.

Well, as always, you&#39;re free to hang out until you&#39;re ready to go. You deserve it this time, buddy!
\(if:$ENDINGS&#39;s length is 3)[

By the way, I have a secret for you. You definitely earned it after that ending. I think - I&#39;m like 95% sure on this - there are 5 endings in this game. I know, it doesn&#39;t seem like a lot but after looking around a bit that&#39;s all that I could find.

That seems like an achievable number! I believe in you!]
\(if:$ENDINGS&#39;s length is 5)[

Oh, and looks like that was ending #5. Does that mean you win? Who knows. There&#39;s still plenty of stuff to do out there. Maybe there&#39;s even more endings? But I was so sure there were only 5 endings... 

There&#39;s only one way to find out. You&#39;re gonna have to go back in there and try your hardest to get a new ending. Whatever it takes. This can&#39;t be it, can it? Prove me wrong, player!(set:$visit5 to true)]
\(if:$ENDINGS&#39;s length is 6)[(set:$visit6 to true)]]
\(else:)[
\(if:visits is 1)[
\(live:0.1s)[(if:time&lt;1.5s)[&lt;img style=&quot;width:300px;height:303px;&quot; float=&quot;center&quot; src=&quot;https://i.imgur.com/emvWMoT.png&quot;&gt;](else:)[&lt;img style=&quot;width:300px;height:303px;&quot; float=&quot;center&quot; src=&quot;https://i.imgur.com/ElUFkDK.png&quot;&gt;]]
Congratulations! You beat the game!

Well, you started the game, did some stuff, and then the game ended. Good enough, right? (if:$ENDINGS contains &quot;NormalRoute&quot; or &quot;Ghost&quot;)[And hey, you saved the town from aliens or whatever, so I bet you&#39;re happy with that.] 

So now you get to chill in my cool waiting room. Sit down, drink some coffee(if:$visitsCoffeeMaker &gt; 4)[ (I know you love your coffee)], just chill for a sec ya know? Then you can go back to the title screen whenever you want.]
\(if:visits is 2)[
\Welcome back! 

(if:$ENDINGS&#39;s length is 2)[Well, how was that? You did something new this time! Did you enjoy it?](else:)[Don&#39;t know why you&#39;d want to do the same thing twice in a row but hey, you do you. As long you&#39;re having a good time we&#39;re all good.]

As always you&#39;re welcome to chill out for a bit before you go back into the fray.]
\(if:visits is 3)[
\Psst... I have a secret for you... I think - I&#39;m like 95% sure on this - there are 5 endings in this game. I know, it doesn&#39;t seem like a lot but after looking around a bit that&#39;s all that I could find.

That seems like an achievable number! I believe in you!

But first, take a second to rest in the waiting room as always.]
\(if:visits &gt; 3)[
\(if:$ENDINGS&#39;s length &lt; 5)[
\Welcome back!

As you know, you&#39;re free to hang out here before you go back in. Only (print:5 - $ENDINGS&#39;s length) more to go!]
\(if:$ENDINGS&#39;s length is 5 and not $visit5)[
\You did it! You got the 5 endings!

So... now what? 

Did you win? Is this over? Surely this can&#39;t be it. There&#39;s still plenty of stuff to do out there. Maybe there&#39;s more endings? Oh, but I was so sure there were only 5 endings...

There&#39;s only one way to find out. You&#39;re gonna have to go back in there and try your hardest to get a new ending. Whatever it takes. This can&#39;t be it, can it? Prove me wrong, player! 
\(set:$visit5 to true)]
\(else:)[(if:$ENDINGS&#39;s length is 5 and $visit5)[
\Hmm... looks like you&#39;ve already gotten that ending...

Does that mean there really are only 5 endings? Am I wrong about being wrong? Is it wrong to want to be wrong?

No! We can&#39;t give up hope! Surely there&#39;s another ending out there. Try something else! Oh, but be sure to rest first. Can&#39;t find new endings without proper relaxation!]]
\(if:$ENDINGS&#39;s length is 6 and not $visit6)[
\(live:0.1s)[(if:time&lt;1.5s)[&lt;img style=&quot;width:300px;height:303px;&quot; float=&quot;center&quot; src=&quot;https://i.imgur.com/emvWMoT.png&quot;&gt;](else:)[&lt;img style=&quot;width:300px;height:303px;&quot; float=&quot;center&quot; src=&quot;https://i.imgur.com/ElUFkDK.png&quot;&gt;]]
YOU DID IT! ENDING NUMBER 6!

See look, I even brought back the party popper. This is a truly momentous occasion.

Are there even more endings? How many are there? How much game is there? I actually don&#39;t know! I guess we&#39;re going to be here for a while. Be sure to take a good amount of rest in the waiting room. You deserve it, especially after that one.
\(set:$visit6 to true)]
\(else:)[(if:$visit6)[
\Welcome back!

I hope you&#39;re having fun. Discovering new things. Checking out the world. (either:&quot;Webster Groves is a pretty wacky place isn&#39;t it?&quot;,&quot;Doesn&#39;t it really make you feel like your choices matter?&quot;,&quot;Does this game have a good //FUN value// to you?&quot;,&quot;Do you have an idea on what you can do next?&quot;,&quot;There&#39;s always something to do, isn&#39;t there?&quot;)

Feel free to rest in my waiting room for as long as you need!
\(set:$visitsWaitingRoom to 1000)]]]]]

[[Continue-&gt;Waiting Room]]</tw-passagedata><tw-passagedata pid="54" name="Waiting Room" tags="" position="3975,4150" size="100,100">(unless:$incomingMail is &quot;empty&quot;)[
\(set:$MAILBOX to $incomingMail)(set:$incomingMail to &quot;empty&quot;)]
\(font:&quot;Raleway&quot;)[
\&lt;img id=&quot;waitingroom&quot; src=&quot;https://i.imgur.com/u3g5IIX.png&quot;&gt;

Endings: (print:$ENDINGS&#39;s length)(if:$visitsWaitingRoom &gt; 2 and $visitsWaitingRoom &lt; 1000)[/5](if:$visitsWaitingRoom &gt; 999)[/???]]
[[View Statistics-&gt;Stats Page]]
\(if:$TestSkip and $TestFinish &gt; 3)[

(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Tests are Disabled&quot;,&quot;Waiting Room&quot;)[(set:$TestSkip to false)]]
\(if:not $TestSkip and $TestFinish &gt; 3)[

(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Tests are Enabled&quot;,&quot;Waiting Room&quot;)[(set:$TestSkip to true)]]

(if:($ENDINGS&#39;s length &gt; 2 and (random:1,10) is 1 and $sequel and $ENDINGS contains &quot;NormalRoute&quot;) or ($sequel and $ENDINGS&#39;s length is 10) or ($nextFun is -1))[[[Restart-&gt;Title Screen 2]]](else:)[[[Restart-&gt;Title Screen]]]</tw-passagedata><tw-passagedata pid="55" name="Mailboxes" tags="" position="2200,1950" size="100,100">(if:$MAILBOX is &quot;empty&quot;)[There is currently nothing inside your mailbox. Check again tomorrow!]
\(if:$MAILBOX is &quot;deed&quot;)[You reach into your mailbox and find a letter signed by Josefine. You open it up, and inside is the deed to the empty store in Town Square.
\(set:$josefineStore to &quot;has deed&quot;)(set:$MAILBOX to &quot;empty&quot;)]
\(if:$MAILBOX is &quot;lightsaber&quot;)[You reach into your mailbox and find a strange device. It&#39;s a small cylindrical shape with a button on the side. You press it and... nothing happens. Must be busted.
\(unless:$anomalies contains &quot;lightsaber&quot;)[(set:$anomalies to it + (a:&quot;lightsaber&quot;))]
\(set:$INV to it + (a:&quot;lightsaber&quot;))(set:$MAILBOX to &quot;empty&quot;)]
\(if:$MAILBOX is &quot;gameshow&quot;)[You reach into your mailbox and find another letter, this one is ornate with a fancy stamp on it. You open it, and it simply reads &quot;Do you want to play a game?&quot; with checkboxes underneath.
\(unless:$anomalies contains &quot;gameshow&quot;)[(set:$anomalies to it + (a:&quot;gameshow&quot;))]]

(if:$MAILBOX is &quot;gameshow&quot;)[[[Yes-&gt;Gameshow Intro]]
[[No-&gt;Reject Gameshow]]
\(set:$MAILBOX to &quot;empty&quot;)]
\(else-if:$escapadeArrow contains &quot;paint&quot; and does not contain &quot;seen&quot;)[
\[[Continue-&gt;Notice Arrow]]
\(set:$prevPassage to &quot;complex&quot;)]
\(else:)[
\[[Continue-&gt;The Apartment Complex]]]</tw-passagedata><tw-passagedata pid="56" name="Clothing Selection" tags="" position="6200,1950" size="100,100">&quot;We have some of the best clothing in Webster Groves. Take your pick.&quot;

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS6&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;HEAD OF WACKY STEVE - $18&#39;,&quot;Clothing Selection&quot;)[(set:$INV to it + (a:&quot;WS6&quot;))(set:$MONEY to it - 18)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS6&quot;)[HEAD OF WACKY STEVE - Sold Out](else:)[[[HEAD OF WACKY STEVE - $18-&gt;Too Poor]]]]
]\
(if:$CLOSET does not contain &quot;ghost&quot; and $MONEY &gt;= 25)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Ghost Costume - $25&quot;,&quot;Clothing Selection&quot;)[(set:$CLOSET to it + (a:&quot;ghost&quot;))(set:$MONEY to it - 25)(set:$STATS&#39;s 3rd to it + 25)]](else:)[(if:$CLOSET contains &quot;ghost&quot;)[Ghost Costume - Owned](else:)[[[Ghost Costume - $25-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;hoodie&quot; and $MONEY &gt;= 30)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Green Hoodie - $30&quot;,&quot;Clothing Selection&quot;)[(set:$CLOSET to it + (a:&quot;hoodie&quot;))(set:$MONEY to it - 30)(set:$STATS&#39;s 3rd to it + 30)]](else:)[(if:$CLOSET contains &quot;hoodie&quot;)[Green Hoodie - Owned](else:)[[[Green Hoodie - $30-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;plumber outfit&quot; and $MONEY &gt;= 15)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Navy Blue Button-Up - $15&quot;,&quot;Clothing Selection&quot;)[(set:$CLOSET to it + (a:&quot;plumber outfit&quot;))(set:$MONEY to it - 15)(set:$STATS&#39;s 3rd to it + 15)]](else:)[(if:$CLOSET contains &quot;plumber outfit&quot;)[Navy Blue Button-Up - Owned](else:)[[[Navy Blue Button-Up - $15-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;ski mask&quot; and $MONEY &gt;= 10)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Ski Mask - $10&quot;,&quot;Clothing Selection&quot;)[(set:$CLOSET to it + (a:&quot;ski mask&quot;))(set:$MONEY to it - 10)(set:$STATS&#39;s 3rd to it + 10)]](else:)[(if:$CLOSET contains &quot;ski mask&quot;)[Ski Mask - Owned](else:)[[[Ski Mask - $10-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;cape&quot; and $MONEY &gt;= 109)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Superhero Cape - $109&quot;,&quot;Clothing Selection&quot;)[(set:$CLOSET to it + (a:&quot;cape&quot;))(set:$MONEY to it - 109)(set:$STATS&#39;s 3rd to it + 109)]](else:)[(if:$CLOSET contains &quot;cape&quot;)[Superhero Cape - Owned](else:)[[[Superhero Cape - $109-&gt;Too Poor]]]]

[[Return-&gt;Clothing Store]]	</tw-passagedata><tw-passagedata pid="57" name="Plumber Shortcut" tags="" position="6200,2100" size="100,100">(set:$visitPlumber to true)
\&quot;Hmmm,&quot; the clerk thinks. They look at you for a few seconds. &quot;Yes, I can see it... You&#39;ll be able to pull this off, and I know just what you need.&quot;

The clerk goes back to the clothing selection and comes back with a navy blue button-up shirt. &quot;Sometimes simple is best. And this shirt will only cost you $15. What do you say?&quot;

(if:$MONEY &lt; 15)[Well. Good job, Jed. This is one of the things we need to complete the story and you don&#39;t enough money. You&#39;re quite the frugal fella, aren&#39;t you?

(link:&quot;\&quot;I don&#39;t have enough money.\&quot;&quot;)[&quot;You don&#39;t have enough?&quot; the clerk gasps. &quot;Oh well, that&#39;s a shame.&quot; They then turn around and walk away.

[[Continue-&gt;Clothing Store]]]]
\(else:)[
\|option&gt;[
\(link:&quot;\&quot;I&#39;ll take it!\&quot;&quot;)[(replace:?option)[
\(set:$CLOSET to it + (a:&quot;plumber outfit&quot;))(set:$MONEY to it - 15)(set:$STATS&#39;s 3rd to it + 15)
\&quot;There you go! Glad I could help.&quot;

[[Continue-&gt;Clothing Store]]]]
[[&quot;No thanks.&quot;-&gt;Clothing Store]]]]</tw-passagedata><tw-passagedata pid="58" name="Buy Hardware" tags="" position="4225,2000" size="100,100">&quot;You need it, we got it.&quot; the clerk boasts.

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS4&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;CAPE OF WACKY STEVE - $18&#39;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;WS4&quot;))(set:$MONEY to it - 18)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS4&quot;)[CAPE OF WACKY STEVE - Sold Out](else:)[[[CAPE OF WACKY STEVE - $18-&gt;Too Poor]]]]
]\
(if:$INV does not contain &quot;wrench&quot; and $MONEY &gt;= 20)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Steel Pipe Wrench - $20&quot;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;wrench&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[(if:$INV contains &quot;wrench&quot;)[Steel Pipe Wrench - Sold Out](else:)[[[Steel Pipe Wrench - $20-&gt;Too Poor]]]]
(if:$INV does not contain &quot;hammer&quot; and $MONEY &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Hammer - $5&quot;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;hammer&quot;))(set:$MONEY to it - 5)(set:$STATS&#39;s 3rd to it + 5)]](else:)[(if:$INV contains &quot;hammer&quot;)[Hammer - Sold Out](else:)[[[Hammer - $5-&gt;Too Poor]]]]
(if:$INV does not contain &quot;crowbar&quot; and $MONEY &gt;= 20)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Crowbar - $20&quot;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;crowbar&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[(if:$INV contains &quot;crowbar&quot;)[Crowbar - Sold Out](else:)[[[Crowbar - $20-&gt;Too Poor]]]]
(if:$INV does not contain &quot;wallpaper&quot; and $MONEY &gt;= 15)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Wallpaper - $15&quot;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;wallpaper&quot;))(set:$MONEY to it - 15)(set:$STATS&#39;s 3rd to it + 15)]](else:)[(if:$INV contains &quot;wallpaper&quot;)[Wallpaper - Sold Out](else:)[[[Wallpaper - $15-&gt;Too Poor]]]]
(if:$MONEY &gt;= 40)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Bucket of Paint - $40&quot;,&quot;Buy Hardware&quot;)[(set:$INV to it + (a:&quot;paint&quot;))(set:$MONEY to it - 40)(set:$STATS&#39;s 3rd to it + 40)]](else:)[[[Bucket of Paint - $40-&gt;Too Poor]]]

[[Exit-&gt;Hardware Store]] </tw-passagedata><tw-passagedata pid="59" name="Burgerocity Counter" tags="" position="5600,1950" size="100,100">Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS5&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;LEFT ARM OF WACKY STEVE - $18&#39;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;WS5&quot;))(set:$MONEY to it - 18)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS5&quot;)[LEFT ARM OF WACKY STEVE - Sold Out](else:)[[[LEFT ARM OF WACKY STEVE - $18-&gt;Too Poor]]]]
]\
(if:$MONEY &gt;= 2)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Cheeseburger - $2&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;burger&quot;))(set:$MONEY to it - 2)(set:$STATS&#39;s 3rd to it + 2)]](else:)[[[Cheeseburger - $2-&gt;Too Poor]]]
(if:$MONEY &gt;= 4)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;The Bifurcated Burger - $4&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;burger&quot;))(set:$MONEY to it - 4)(set:$STATS&#39;s 3rd to it + 4)]](else:)[[[The Bifurcated Burger - $4-&gt;Too Poor]]]
(if:$MONEY &gt;= 6)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;The Behemoth - $6&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;burger&quot;))(set:$MONEY to it - 6)(set:$STATS&#39;s 3rd to it + 6)]](else:)[[[The Behemoth - $6-&gt;Too Poor]]]
(if:$MONEY &gt;= 9)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;The Burgerocity - $9&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;burger&quot;))(set:$MONEY to it - 9)(set:$STATS&#39;s 3rd to it + 9)]](else:)[[[The Burgerocity - $9-&gt;Too Poor]]]
\(if:$FUN is 2)[
(if:$MONEY &gt;= 14)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;The Big Boy - $14&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;burger&quot;))(set:$MONEY to it - 14)(set:$STATS&#39;s 3rd to it + 14)]](else:)[[[The Big Boy - $14-&gt;Too Poor]]]
\(unless:$anomalies contains &quot;big boy&quot;)[(set:$anomalies to it + (a:&quot;big boy&quot;))]]
(if:$MONEY &gt;= 1)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Fries - $1&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;fries&quot;))(set:$MONEY to it - 1)(set:$STATS&#39;s 3rd to it + 1)]](else:)[[[Fries - $1-&gt;Too Poor]]]
(if:$MONEY &gt;= 1)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Soda - $1&quot;,&quot;Burgerocity Counter&quot;)[(set:$INV to it + (a:&quot;soda&quot;))(set:$MONEY to it - 1)(set:$STATS&#39;s 3rd to it + 1)]](else:)[[[Soda - $1-&gt;Too Poor]]]

[[Exit-&gt;Burgerocity]] </tw-passagedata><tw-passagedata pid="60" name="Going Downstairs" tags="" position="3536,2273" size="100,100">The secretary hands you two name tags: one has a fake name and fake plumbing business, and one labels you as a City Hall visitor. The secretary then gets up from her desk and gestures for you to follow her. You go through the two large double doors on the right side of the room.

The doors lead into a long hallway with an elevator at the end. Throughout the hallway, there are about 5-6 security guards walking around. You start to feel a little uneasy, but you follow the secretary nonetheless.

The two of you arrive at the elevator, and two security guards are standing beside it - one on each side. The guards look at you while you enter the elevator, but they don&#39;t say anything. The elevator doors close and you can feel a slight sense of relief. The secretary presses a button and the elevator starts to go downwards.

&quot;That was the easy part,&quot; the secretary explains. &quot;Once we get downstairs, there&#39;s a door tucked away behind the elevator. That&#39;s where we need to go.&quot;

[[Continue-&gt;City Hall Basement]]</tw-passagedata><tw-passagedata pid="61" name="City Hall Basement" tags="" position="3537,2411" size="100,100">You&#39;ve arrived in the basement of City Hall. It&#39;s quite dark, but there are small dim lights spread around. Pipes run around the room in no particular fashion.

[[Elevator-&gt;City Hall Elevator]]
[[Maintenance Room-&gt;City Hall Maintenance Room]]
[[Secret Room-&gt;City Hall Secret Room]]</tw-passagedata><tw-passagedata pid="62" name="City Hall Elevator" tags="" position="3550,2575" size="100,100">You turn around to call for the elevator, but the secretary stops you.

&quot;Jed, what are you doing?&quot; the secretary asks. &quot;When I said there&#39;s no going back, there&#39;s no going back. We can&#39;t give up now!&quot;

[[Continue-&gt;City Hall Basement]]</tw-passagedata><tw-passagedata pid="63" name="City Hall Maintenance Room" tags="" position="3450,3025" size="100,100">(if:$visitsMegaToilet is 9)[The final bathroom. It&#39;s all come to this. Whatever happens, Jed, don&#39;t forget the amazing time we had together flushing all those toilets. Whatever happens next can&#39;t be better than that.](else:)[You go into the maintenance room. The wall is full of buttons, levers, and blinking lights. You don&#39;t understand any of it. Strangely enough, the room also seems to function as a bathroom.]

(if:$visitsMegaToilet is 9)[[[Flush the Toilet-&gt;The Final Flush]]](else:)[[[Flush the Toilet-&gt;City Hall Toilet]]]
[[Exit-&gt;City Hall Basement]] </tw-passagedata><tw-passagedata pid="64" name="City Hall Secret Room" tags="" position="3525,3150" size="100,100">(if:$INV contains &quot;letter&quot; and ($INV contains &quot;key&quot; or $FUN is not 4))[
\You and the secretary walk around the elevator, and sure enough, you can just barely see a door behind it, but it&#39;s painted to match the color of the wall. You try to open it but it&#39;s locked.

&quot;I found the key to this door last night,&quot; the secretary says, &quot;and I taped it to the back of the letter I sent you!&quot;

You reach into your pocket and pull out the letter. Indeed, taped to the back, is a small silver key. (if:$FUN is 4)[

&quot;Hey, woah woah woah!&quot; the secretary says. &quot;You were supposed to get rid of that letter!&quot;

&quot;Oh, oops. Too late now.&quot; ]You take (cond:$FUN is 4,&quot;the key off the letter&quot;,&quot;it off&quot;) and open up the door...

[[Continue-&gt;City Hall Confrontation]]]
\(else:)[
\(if:$FUN is 4)[
\You and the secretary walk around the elevator, and sure enough, you can just barely see a door behind it, but it&#39;s painted to match the color of the wall. You try to open it but it&#39;s locked.

&quot;I found the key to this door last night,&quot; the secretary says, &quot;and I taped it to the back of the letter I sent you!&quot;

(if:$INV contains &quot;key&quot;)[You reach into your pocket and pull out the small, silver key. You take it and open up the door...]
\(else:)[
\&quot;Oh, sorry,&quot; you explain. &quot;I threw that away.&quot;

The secretary just stares at you. &quot;WHAT!?&quot; she cries. &quot;You were only supposed to throw away the letter! Okay then, let&#39;s just... uh... let&#39;s just go back upstairs. I guess.&quot;

The two of you start to walk around toward the front of the elevator. But before you can press one of the buttons, the doors open up, revealing four security guards. They grab you in pairs and take you into the elevator.

&quot;This is a restricted area. Only certified persons are allowed.&quot; They rip off your plumber nametag. &quot;We know about your little setup. You two are under arrest for fraud and trespassing.&quot;

[[Continue-&gt;Trespassing Ending]]]]
\(else:)[
\You and the secretary walk around the elevator, and sure enough, you can just barely see a door behind it, but it&#39;s painted to match the color of the wall. You try to open it but it&#39;s locked.

&quot;I found the key to this door last night,&quot; the secretary says, &quot;and I taped it to the back of the letter I sent you!&quot;

You know, the important letter that you got at the beginning of the game! The one that I told you that you shouldn&#39;t have thrown away!(if:$testing is &quot;FAIL2&quot;)[ I told you your actions would have consequences.] Let&#39;s see how you deal with this one, Jed.

&quot;Well you see...&quot; you start to explain, &quot;I have a bad habit of uhh, throwing away mail after I read it, so I maybe sorta kinda threw away the letter after reading it and I also never noticed that there was a key behind it. Ha ha.&quot; 

The secretary just stares at you. &quot;Okay then,&quot; she replies, &quot;let&#39;s just... uh... let&#39;s just go back upstairs. I guess.&quot;

The two of you start to walk around toward the front of the elevator. But before you can press one of the buttons, the doors open up, revealing four security guards. They grab you in pairs and take you into the elevator.

&quot;This is a restricted area. Only certified persons are allowed.&quot; They rip off your plumber nametag. &quot;We know about your little setup. You two are under arrest for fraud and trespassing.&quot;

[[Continue-&gt;Trespassing Ending]]]]</tw-passagedata><tw-passagedata pid="65" name="City Hall Toilet" tags="" position="3625,3025" size="100,100">(unless:$toilets contains &quot;CityHall&quot;)[
\(set:$STATS&#39;s 6th to it + 1)
\(set: $toilets to it + (a:&quot;CityHall&quot;))
\(if:$visitsJedsToilet &gt; 3)[Jed, why do you keep doing this? What&#39;s your deal with toilets?](else:)[You flush the toilet.

&quot;What are you doing Jed?&quot; the secretary whispers. &quot;You don&#39;t have to be a real plumber, but I appreciate the getting-in-character.&quot;]]
\(else:)[
\The toilet doesn&#39;t flush.

&quot;Looks like we&#39;ll have to call a real plumber once this is over,&quot; the secretary quips.]

[[Continue-&gt;City Hall Maintenance Room]] </tw-passagedata><tw-passagedata pid="66" name="Trespassing Ending" tags="" position="3250,3175" size="200,100">(unless:$ENDINGS contains &quot;Trespassing&quot;)[(set:$ENDINGS to it + (a:&quot;Trespassing&quot;))]
\(set:$JOURNAL to it + (a:&quot;Trespassing&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\Next thing you know, you&#39;re inside a holding cell. &quot;We&#39;ll be back to you in a couple hours,&quot; the guards tell you.

A couple of hours pass and nothing happens.

What feels like a day passes. Nothing.

After what feels like an eternity, you hear a loud booming sound while you were asleep. You instantly wake up to find the walls of the police station destroyed. Was this freedom? A chance to go out into the world and get some food?

However, you quickly realized the atmosphere was off. The sky was a dark red, and you noticed that many other buildings had damage done to them as well. You couldn&#39;t shake the feeling that you could&#39;ve prevented this. (if: $INV does not contain &quot;letter&quot;)[Maybe now you see why you shouldn&#39;t have thrown away that letter.](else:)[Did the mayor have something to do with this? Perhaps you&#39;ll never know.]

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="67" name="City Hall Confrontation" tags="" position="3525,3325" size="100,100">The mayor is sitting inside the room already waiting for you. &quot;Hello, Jed.&quot;

You turn around and security has already grabbed the secretary and pulled her away. The door then shuts, leaving you, the mayor, and a couple of security guards alone in the room.

On the back wall of the room is a giant TV screen with a big panel underneath it. You can&#39;t make out what most of it says, but you can clearly see a map of Webster Groves with a dot over Burgerocity.

&quot;So,&quot; the mayor says, &quot;you heard about my little shutdown. You&#39;re upset that your favorite burger place is shutting down. I get that.&quot; He starts to walk towards you. &quot;But let me explain why. I met up with some people last night, Jed. People not of this earth. And they are going to give me great power. I just have to do a little something for them in return.&quot;

&quot;What are you talking about?&quot; you interrogate.

&quot;They told me that long long ago, they left something behind, something very important to them. It got left right under that nasty burger shop over in West Side.&quot;

&quot;You take that back!&quot;

&quot;Unfortunately for you, I&#39;m not going to. They&#39;re going to tear that place down and dig. And keep on digging until they find what I need. And then... I&#39;ll be a god on Earth. And as for you, well, you&#39;ve got two options here. Option number 1: I arrest you for fraud and trespassing. Option number 2: you join me, helping me get what we need, and then we can share the power.&quot; 

The mayor turns around and looks at the TV, down at the panel, then back to you. &quot;So, which is it? I assume this won&#39;t be a hard decision.&quot;

[[&quot;Go ahead and arrest me.&quot;-&gt;Arrest]]
[[&quot;I&#39;ll join you.&quot;-&gt;Evil Ending]]
[[&quot;I choose the third option... FIGHT!&quot;-&gt;Fight!]]</tw-passagedata><tw-passagedata pid="68" name="Arrest" tags="" position="3300,3325" size="100,100">Wait, what? You&#39;re arresting yourself? You&#39;d rather do that than fight him?

&quot;Wait, what?&quot; the mayor says. &quot;You&#39;re arresting yourself? You&#39;d rather do that than join me?&quot;

Jed, you do realize you actually had a third option, right? You saw that, didn&#39;t you? It was the bottom option on the page. Maybe you didn&#39;t scroll down far enough? I&#39;m trying to give you the benefit of the doubt here. I just, I didn&#39;t think you&#39;d select this option.

&quot;Very well then,&quot; the mayor continues, &quot;I won&#39;t try to push you. More power for me! //Guards!//&quot;

The two guards grab you by your arms and drag you out of the room.

[[Continue-&gt;Trespassing Ending]] </tw-passagedata><tw-passagedata pid="69" name="Evil Ending" tags="" position="3750,3150" size="200,100">(unless:$ENDINGS contains &quot;Evil&quot;)[(set:$ENDINGS to it + (a:&quot;Evil&quot;))]
\(set:$JOURNAL to it + (a:&quot;Evil&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\Jed... what have you done? 

&quot;I knew you&#39;d come to your senses, Jed,&quot; the mayor says. &quot;Together we are going to rule this earth.&quot;

The mayor escorts you out of the room, where you walk by the secretary, who is being handcuffed by security guards. She looks at you confused as if she doesn&#39;t believe the scenario she is watching unfold.

The next day, Burgerocity is shut down. A company arrives to demolish it, and by nightfall, the digging begins. It takes about 5 days total until they find a strange, red, glowing capsule. They bring it in to you, collect their payment from the mayor, and then leave City Hall.

You and the mayor then go back downstairs to the communications room. The mayor presses some buttons on the panel, and suddenly a distorted voice begins speaking. (text-style: &quot;fidget&quot;)[&quot;Have you found it yet?&quot;]

&quot;Yes, we found it this morning,&quot; the mayor replies. &quot;How do we get it to you?&quot;

A hatch opens up on the far-right side of the panel. (text-style: &quot;fidget&quot;)[&quot;Please slide it in there.&quot;]

The mayor puts the capsule into the hole, which then closes. &quot;So now what?&quot; he asks. &quot;What do we get?&quot;

(text-style: &quot;fidget&quot;)[&quot;You get to live.&quot;]

You then hear a giant booming sound coming from the surface. You and the mayor rush upstairs. The sky is a dark shade of red, and you can see what you believe to be alien ships up in the sky. Buildings are being demolished, set on fire, exploded, and destroyed. Many are running out into the streets in fear. People run up to you for help. &quot;Mayor Dixon, what do we do?&quot;

&quot;I... I don&#39;t know.&quot;

There you go, Jed. Was that worth it?

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="70" name="Fight!" tags="" position="3750,3325" size="100,100">Alright, Jed. We&#39;re about to go into a - dare I say - //epic// fight scene. But first, we&#39;re going to need to choose a weapon! What do you choose?

(if:$INV contains all of (a:&quot;burger&quot;,&quot;soda&quot;,&quot;fries&quot;))[(link-reveal-goto:&quot;Burgerocity Meal Combo&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;meal combo&quot;)(unless:$mayorFights contains &quot;meal combo&quot;)[(set:$mayorFights to it + (a:&quot;meal combo&quot;))]]
]
\(if:$INV contains &quot;buster&quot;)[(link-reveal-goto:&quot;Buster Winchester&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;buster&quot;)(unless:$mayorFights contains &quot;buster&quot;)[(set:$mayorFights to it + (a:&quot;buster&quot;))]]
]
\(if:$INV contains &quot;crowbar&quot;)[(link-reveal-goto:&quot;Crowbar&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;crowbar&quot;)(unless:$mayorFights contains &quot;crowbar&quot;)[(set:$mayorFights to it + (a:&quot;crowbar&quot;))]]
]
\(if:$INV contains &quot;nerf gun&quot;)[(link-reveal-goto:&quot;Foam-Dart Gun&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;nerf gun&quot;)(unless:$mayorFights contains &quot;nerf gun&quot;)[(set:$mayorFights to it + (a:&quot;nerf gun&quot;))]]
]
\(link-reveal-goto:&quot;Good Ol&#39; Fisticuffs&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;fists&quot;)(unless:$mayorFights contains &quot;fists&quot;)[(set:$mayorFights to it + (a:&quot;fists&quot;))]]
(if:$INV contains &quot;hammer&quot;)[(link-reveal-goto:&quot;Hammer&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;hammer&quot;)(unless:$mayorFights contains &quot;hammer&quot;)[(set:$mayorFights to it + (a:&quot;hammer&quot;))]]
]
\(if:$INV contains &quot;wrench&quot;)[(link-reveal-goto:&quot;Steel Pipe Wrench&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;wrench&quot;)(unless:$mayorFights contains &quot;wrench&quot;)[(set:$mayorFights to it + (a:&quot;wrench&quot;))]]
]
\(if:$INV contains &quot;lightsaber&quot;)[(link-reveal-goto:&quot;Strange Device&quot;,&quot;The City Hall Fight&quot;)[(set:$weapon to &quot;lightsaber&quot;)(unless:$mayorFights contains &quot;lightsaber&quot;)[(set:$mayorFights to it + (a:&quot;lightsaber&quot;))]]
]</tw-passagedata><tw-passagedata pid="71" name="The City Hall Fight" tags="" position="3750,3500" size="100,100">(if:$weapon is &quot;meal combo&quot;)[You pull out one of Burgerocity&#39;s signature burgers and shove it into the right guard&#39;s mouth. The mayor steps back, while the second guard jumps toward you. You smack them across the head with your order of fries and they fall down.

&quot;I choose option 3!&quot; you yell.

&quot;Woah there Jed,&quot; the mayor bellows, &quot;but I&#39;m not looking for a food fight. Food fight or normal fight, either way, you&#39;d lose.&quot;

&quot;That&#39;s fine,&quot; you retort, &quot;I don&#39;t need to fight you.&quot; You jump towards the TV past the mayor and dump the soda onto the communication panel. The screen glitches out, sparks begin to fly, and suddenly it bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. &quot;C&#39;mon!&quot; you say, gesturing towards the elevator. The mayor runs after you, but when he gets to the elevator doorway you kick him back as the doors shut. You then ride the elevator up and exit City Hall as fast as you can.]
\(else-if:$weapon is &quot;nerf gun&quot;)[You pull out your foam-dart gun and shoot darts at the guard to your right. While he&#39;s trying to pull them off of his face, the second guard jumps toward you. You shoot them in the head and they fall face-first into the floor.

&quot;I choose option 3!&quot; you yell.

&quot;Jed, I can see that&#39;s not a real gun,&quot; the mayor bellows, &quot;so if you&#39;re trying to intimidate me it&#39;s not going to work.&quot;

&quot;EAT FOAM!&quot; you shout. You unleash a barrage of darts toward the mayor, but he moves out of the way. The darts then all land on the TV screen, which then glitches out, causes sparks to begin to fly, and suddenly bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. &quot;C&#39;mon!&quot; you say, gesturing towards the elevator. The mayor runs after you, but when he gets to the elevator doorway you kick him back as the doors shut. You then ride the elevator up and exit City Hall as fast as you can.]
\(else-if:$weapon is &quot;lightsaber&quot;)[You pull out the strange device that you received in your mailbox this morning. Despite the fact that it didn&#39;t work earlier, you try again. You push the button, and then a beam of energy comes out of the device. The device is actually a lightsaber. 

&quot;I choose option 3!&quot; you yell.

&quot;Woah there Jed,&quot; the mayor quivers, &quot;what is that?&quot;

&quot;It&#39;s that thing from Star Wars, I think. Anyway, I&#39;m gonna cut through your controls now.&quot;

&quot;You can&#39;t do that!&quot;

You point the lightsaber toward him. &quot;Are you gonna try and stop me?&quot; The guards and the mayor keep their distance. You walk up to the communications panel and slash it, causing sparks to fly and burst into flames. While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. 

&quot;This thing really came in handy,&quot; you tell the secretary.

&quot;What? Is that a lightsaber? How did you get that?&quot;

&quot;I got it in the mail when I got your letter.&quot;

&quot;Well, I didn&#39;t give that to you...&quot;

Suddenly, the mayor runs after you, but you and the secretary get in the elevator and kick the mayor back as the doors shut. You then ride the elevator up and exit City Hall as fast as you can.]
\(else-if:$weapon is &quot;buster&quot;)[You pull out Buster Winchester and whack the guard to your right. The mayor steps back, while the second guard jumps toward you. Buster uppercuts them and they fall face-first into the floor.

&quot;We choose option 3!&quot; you yell.

&quot;Oh no, I&#39;m so scared,&quot; the mayor bellows, &quot;the Burgerocity mascot is trying to save its dumpster fire of a restaurant.&quot;

You give a nod to Buster. While you hold the mayor back, Buster jumps towards the TV and smashes his fists down on the panel as hard as he can. The screen glitches out, sparks begin to fly, and suddenly it bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. &quot;C&#39;mon!&quot; you say, gesturing towards the elevator. The mayor runs after you, but when he gets to the elevator doorway you kick him back as the doors shut. You, Buster, and the secretary then ride the elevator up and exit City Hall as fast as you can.]
\(else:)[You pull out your $weapon and knock out the guard to your right. The mayor steps back, while the second guard jumps toward you. You hit them in the head and they fall face-first into the floor.

&quot;I choose option 3!&quot; you yell.

(if:$weapon is &quot;hammer&quot;)[&quot;What are you going to do&quot; the mayor bellowed, &quot;hammer me to death? You&#39;re a few nails loose if you think you can beat me in combat.&quot;](if:$weapon is &quot;fists&quot;)[&quot;You may have knocked out my guards somehow,&quot; the mayor bellows, &quot;but you won&#39;t beat me //mano a mano//.&quot;](if:$weapon is &quot;crowbar&quot;)[&quot;Nice weapon there Jed,&quot; the mayor bellows, &quot;but I already opened up to you earlier. You&#39;ll find that won&#39;t help you against me.&quot;](if:$weapon is &quot;wrench&quot;)[&quot;Woah there Mr. Mario,&quot; the mayor bellows, &quot;the pipes are in the other room. That wrench won&#39;t help you in a fight against me.&quot;]

&quot;That&#39;s fine,&quot; you retort, &quot;I don&#39;t need to fight you.&quot; You jump towards the TV past the mayor and smash your $weapon down on the panel as hard as you can. The screen glitches out, sparks begin to fly, and suddenly it bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. &quot;C&#39;mon!&quot; you say, gesturing towards the elevator. The mayor runs after you, but when he gets to the elevator doorway you kick him back as the doors shut. You then ride the elevator up and exit City Hall as fast as you can.]

[[Continue-&gt;Normal Ending]] </tw-passagedata><tw-passagedata pid="72" name="Normal Ending" tags="" position="3400,3500" size="200,100">(unless:$ENDINGS contains &quot;NormalRoute&quot;)[(set:$ENDINGS to it + (a:&quot;NormalRoute&quot;))]
\(set:$JOURNAL to it + (a:&quot;NormalRoute&quot;))
\When you exit City Hall, you notice a large gathering of people outside in the walkway. A commotion has begun due to the large amount of smoke pouring from the building.

&quot;Is everything okay, Jed?&quot; a spectator asks you.

You look at the secretary. &quot;The mayor is the reason why Burgerocity shut down,&quot; she yells. &quot;He&#39;s working with an independent business from outside of town and taking property away just for them. They bribed him, and he accepted their bribe.&quot;

The crowd gasps and then murmurs amongst themselves. In almost perfect timing, the mayor runs out of the building. The crowd stares at him. &quot;That&#39;s... not true...&quot; he huffs.

&quot;Oh really?&quot; a voice barks from the crowd. She steps forward. It&#39;s none other than Chairwoman Sandra Clifton of the County Board of Commissions! &quot;Well then, what happened, Mayor Dixon? Why is Burgerocity being shut down? And why are there construction plans beginning tonight?&quot;

(if:$FUN is 11 or $theGame)[&quot;I- uh... well there&#39;s uh-&quot; the mayor stammers, &quot;the place failed a uh... it failed the... game! It failed the game! YOU LOST THE GAME!!&quot;

The crowd goes completely silent. Someone begins screaming. &quot;NOOOOOOOOOOOO!!!! I LOST MY STREAK!&quot;

Suddenly, everyone starts shouting in anger. How could the mayor have done this? What could have caused the mayor to resort to such cruelty?
\(unless:$anomalies contains &quot;mayor game&quot;)[(set:$anomalies to it + (a:&quot;mayor game&quot;))]]
\(else:)[&quot;I- uh... well there&#39;s uh-&quot; the mayor stammers, &quot;the place failed a uh... health examination! So for the safety of the town, I uh.. had to shut it down immediately!&quot;

The crowd is quiet. Everyone knows Burgerocity has a very high health rating; the owner always has his results posted on his door.]

&quot;Glen Dixon,&quot; states Chairwoman Sandra Clifton of the County Board of Commissions, &quot;I will see that your impeachment trial happens soon. And I&#39;m canceling those construction plans of yours.&quot;

The fire department soon arrives, ushering everyone away. As you begin to walk towards the train station, the secretary catches you. &quot;Thank you so much, Jed,&quot; she says. &quot;Not only for trusting me but for diving head first to fix the problem.(if:$visitsSecretary is 1)[ Still strange how you already came to my desk in uniform, though!] Tomorrow I&#39;ll talk to you about refinancing. Have a good night!&quot; She then walked off.

Congratulations, Jed. Your work here is done.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="73" name="Supermarket Ending" tags="" position="700,2550" size="200,100">(unless:$ENDINGS contains &quot;Supermarket&quot;)[(set:$ENDINGS to it + (a:&quot;Supermarket&quot;))]
\(set:$JOURNAL to it + (a:&quot;Supermarket&quot;))
\Jed sat next to the front door of Bosco&#39;s, wondering what to do now. While Jed does understand that what he did was deserving of a ban, he also felt that he never would have done those things if he didn&#39;t find out what John Bosco truly felt about him. So there he sat next to the door, almost as if he was protesting his ban.

He sat there all day. As the store closed, John walked past him and paid no attention.

He sat there overnight, where the opening manager of the store saw him but also paid no attention (more so because she was confused rather than disliking Jed). He sat there the rest of the day, where John passed him twice: when he came into work and when he closed the store.

This pattern happened for days. Jed simply refused to go to another store for his groceries. He just could never believe what happened between him and John. He thought they were friends; they talked every time he came to the store, John always seemed interested in what he had to say, and always let Jed speak as long as he wanted, with minimal interruption. 

But of course, you can&#39;t sit in one place for long before your basic human needs need to be fulfilled. And since Jed refused to go anywhere else, it was only a matter of time before he died. 

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="74" name="Josefine&#39;s Apartment" tags="" position="2700,2000" size="100,200">(if:$wearing is &quot;icloak&quot;)[
\You go over to Josefine&#39;s apartment and knock on the door.

&quot;Hi, what ca-&quot; Josefine stops talking once she sees that no one is at her door. &quot;Hello?&quot; She looks around for a few seconds. &quot;Jed, I swear if you&#39;re somehow involved in this...&quot; she then goes back into her apartment and shuts her door.

[[Continue-&gt;The Apartment Complex]]]
\(else:)[==
\(set:$visitsJosefine to it + 1)
\You go over to Josefine&#39;s apartment and knock on her door. (if:$visitsJosefine is 1)[You find that you and Josefine chat with each other from time to time about very random topics.]

(if:$visitsJosefine is 1)[&quot;Good morning, Jed! How are you?&quot;](if:$visitsJosefine is 2 or 3)[&quot;What&#39;s up?&quot;](if:$visitsJosefine &gt; 3)[&quot;Hey,&quot;] Josefine greets.

(if:$INV contains &quot;book series&quot;)[//[[The Adventures of Charles Howard-&gt;Josefine Book Series]]//
]
\[[Burgerocity-&gt;Josefine Burgerocity]] 
(if:$josefineStore is &quot;wait&quot;)[[[Deed-&gt;Josefine Deed]]
]
\(if:(history:) contains &quot;Empty Store&quot; and $josefineStore is &quot;unknown&quot;)[[[Empty Store-&gt;Josefine Empty Store]]
]
\(if:$INV contains &quot;bear&quot;)[[[Gift Teddy Bear-&gt;Josefine Bear]]
]
\(unless:$wearing is &quot;none&quot;)[[[Outfit-&gt;Josefine Outfit]]
]
\(if:(history:) contains &quot;Setup VR&quot;)[[[Virtual Reality-&gt;Josefine VR]]
]
\[[&quot;Gotta go!&quot;-&gt;The Apartment Complex]]</tw-passagedata><tw-passagedata pid="75" name="Josefine Burgerocity" tags="" position="2700,2250" size="100,100">You mention Burgerocity shutting down.

&quot;Yeah I heard about that,&quot; Josefine says. &quot;I saw a news story on it this morning. I was just there yesterday actually, I wonder why he didn&#39;t say anything about it.&quot;

&quot;I was there last night too. I&#39;m gonna try and go talk to him, see what&#39;s up.&quot;

&quot;Yeah, that&#39;s a good idea. You two are friends, right? He didn&#39;t tell the news but he&#39;ll probably tell you.&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="76" name="Rafael Empty Store" tags="" position="2400,2400" size="100,100">&quot;Do you remember what was in that space next to the hardware store in Town Square?&quot; you ask Rafael.

&quot;Hmm, it&#39;s been a while,&quot; he responds, &quot;but I think it was some kind of bakery? I don&#39;t know what it was called though.&quot;

&quot;Yeah, that sounds about right. For some reason, I couldn&#39;t remember. Have I told you about my store idea?&quot;

&quot;Oh, uh, yes... it was uh... Jed&#39;s Jams? Where you sell jelly and music?&quot;

&quot;That&#39;s the one! When visiting that empty store I thought that this could be the place. I&#39;ll let you know if I find out more.&quot;

&quot;See ya, Jed!&quot;

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="77" name="Josefine Empty Store" tags="" position="2700,2400" size="100,100">(set:$josefineStore to &quot;known&quot;)
\&quot;Do you remember what was in that space next to the hardware store in Town Square?&quot; you ask Josefine.

&quot;You really forgot?&quot; Josefine smirks.

&quot;I guess so...&quot;

&quot;That was where my old bakery was! &#39;Taste of Heaven&#39; it was called. Remember?&quot;

&quot;Oh yeah! I knew I had been there all the time, now that I remember you owned it that makes more sense. Anyway, I was asking because... I&#39;m really interested in starting my own shop.&quot; 

&quot;Oh no,&quot; Josefine winces, &quot;Jed&#39;s Jams... Okay, don&#39;t get me wrong, I think that idea is really... cute, and I&#39;d be willing to help you with the real estate, but-&quot;

&quot;Really?&quot; Jed interrupts.

&quot;BUT,&quot; Josefine continues, &quot;I scratch your back, you scratch mine. I would like something in return. You have a library membership, right? If you could somehow get ahold of the entire //Adventures of Charles Howard// series, I&#39;ll see what I can do about the deed.&quot;

&quot;Thank you, Josefine!&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="78" name="Ted&#39;s Apartment" tags="" position="2550,2000" size="100,200">(if:$wearing is &quot;icloak&quot;)[
\You go over to Ted&#39;s apartment and knock on the door.

&quot;Who&#39;s there?&quot; Ted tries to look around for someone. &quot;Dang kids. Always with their ding-dong ditching.&quot; He then goes back into his apartment and shuts the door.

[[Continue-&gt;The Apartment Complex]]]
\(else:)[==
\(set:$visitsTed to it + 1)
\You go over to Ted&#39;s apartment and knock on the door. (if: $visitsTed is 1)[You and Ted have talked a few times, but not often.

&quot;Hello, sir. How can help you?&quot;]
\(if: $visitsTed is 2)[

&quot;Didya need somethin&#39; from me?&quot;]
\(if: $visitsTed is 3)[

&quot;What do you want?&quot;]
\(if: $visitsTed &gt; 3)[

&quot;Go away.&quot;]

[[Burgerocity-&gt;Ted Burgerocity]]
(if:(history:) contains &quot;Empty Store&quot; and $josefineStore is &quot;unknown&quot;)[[[Empty Store-&gt;Ted Empty Store]]
]
\(if:$INV contains &quot;bear&quot; and $CLOSET does not contain &quot;purple vest&quot;)[[[Gift Teddy Bear-&gt;Ted Bear]]
]
\[[Names-&gt;Ted Names]]
(unless:$wearing is &quot;none&quot;)[[[Outfit-&gt;Ted Outfit]]
]
\(if:(history:) contains &quot;Setup VR&quot;)[[[Virtual Reality-&gt;Ted VR]]
]
\[[&quot;Gotta go!&quot;-&gt;The Apartment Complex]]</tw-passagedata><tw-passagedata pid="79" name="Talk to Librarian" tags="" position="1100,1950" size="100,100">(unless:$bookReturned)[
\(unless:$INV contains &quot;late book&quot;)[
\&quot;Oh, hello Jed,&quot; the librarian sighs. &quot;It&#39;s been a while.&quot;

&quot;Yes, it has,&quot; Jed says. (if:$josefineStore is &quot;known&quot;)[&quot;But I&#39;m here to check out some books finally!&quot;]

&quot;(unless:$josefineStore is &quot;known&quot;)[Are you here to check something out? ]You do know that you can&#39;t check anything out with that unresolved late return on your record?&quot;

&quot;Oh yeah,&quot; Jed whispers to himself. He then asks the librarian, &quot;Can I just pay for the book?&quot;

The librarian types into her computer, &quot;Sorry, Jed. That book is so old it&#39;s not possible to replace.&quot;]
\(else:)[
\&quot;Oh, hello Jed,&quot; the librarian sighs. &quot;It&#39;s been a while.&quot;

&quot;Yes, it has,&quot; Jed says. (if:$josefineStore is &quot;known&quot;)[&quot;But I&#39;m here to check out some books finally!&quot;]

&quot;(unless:$josefineStore is &quot;known&quot;)[Are you here to check something out? ]You do know that you can&#39;t check anything out with that unresolved late return on your record?&quot;

&quot;Yes I do, that&#39;s why I&#39;m returning it!&quot;

&quot;Oh wow,&quot; the librarian gasps, &quot;I didn&#39;t think I&#39;d live to see the day. Well, I&#39;ll take that off your hands. Go have fun, or whatever.
\(set:$bookReturned to true)]]
\(else:)[
\&quot;Hello, Jed,&quot; the librarian greets. &quot;What did you need?&quot;

&quot;Do you have a recommendation on what book to read?&quot;

&quot;(either:&quot;I somehow got my hands on a little book called //What to do if the World is Ending.// The advice is... interesting to say the least.&quot;,&quot;Have you ever wanted to read a murder mystery where the mystery is \&quot;what&#39;s the plot?\&quot; That&#39;s basically the appeal of //Magic Recliner Couches//.&quot;,&quot;My daughter really enjoyed //Charles Howard and the Magnificent Mop//. It seems like a book right up your alley.&quot;,&quot;//Vela// is a dystopion book about trying to stay hopeful in light of difficult circumstances.&quot;,&quot;If you want a cute little story about finding others like yourself, you should check out //The Woman and the Lilac//.&quot;,&quot;We just got this book called //Greg and Ron//, if you have a kid I&#39;d recommend that to them.&quot;,&quot;//Starch and Crinkle Visit the Big City// is a fun story about four kids, one rollercoaster, and lots of shenanigans.&quot;)&quot;]

[[Continue-&gt;Library]] </tw-passagedata><tw-passagedata pid="80" name="Computer Lab" tags="" position="1100,2100" size="100,100">(if:$FUN is 5)[You walk up to the library&#39;s computer lab. All of the computers are out of order, except for one. You walk up to it, and it looks like something is wrong with it. There are tons of error messages on the screen, all saying various sentences in broken English. You can just barely make out the browser behind all the windows, where the search bar says &quot;http://arewebsite.com&quot;
\(unless:$anomalies contains &quot;computer virus&quot;)[(set:$anomalies to it + (a:&quot;computer virus&quot;))]] 
\(else-if: $FUN is 13)[You walk up to the library&#39;s computer lab. All of the computers are out of order, except for one. You can barely make out the text on its screen.]
\(else:)[You walk up to the library&#39;s computer lab. Each computer is turned off, with a piece of paper taped to them that reads &quot;OUT OF ORDER.&quot; (if:$FUN is 1)[What a shame. We could&#39;ve installed AreWebsite Antivirus onto all of them.]]

(if:$FUN is 13)[[[Look at Computer-&gt;Fun BBTA]]
]
\[[Continue-&gt;Library]]</tw-passagedata><tw-passagedata pid="81" name="Bookshelves" tags="" position="1100,2250" size="100,100">(set:_book1 to &quot;//[[What to do if the World is Ending-&gt;Book 1]]//&quot;)
\(set:_book2 to &quot;//[[Magic Recliner Couches-&gt;Book 2]]//&quot;)
\(set:_book3 to &quot;//[[Starch &amp; Crinkle Visit the Big City-&gt;Book 3]]//&quot;)
\(set:_book4 to &quot;//[[Vela-&gt;Book 4]]//&quot;)
\(set:_book5 to &quot;//[[Greg and Ron-&gt;Book 5]]//&quot;)
\(set:_book6 to &quot;//[[The Woman and the Lilac-&gt;Book 6]]//&quot;)
\(set:_book7 to &quot;//[[Rulebook-&gt;Book 7]]//&quot;)
\You walk over to the library&#39;s bookshelves. The library has a very small selection, filling only about two and a half bookshelves worth.
\(if: $wearing is &quot;cape&quot; and $citizensHelped does not contain &quot;library&quot;)[

You see a woman looking at another bookshelf. &quot;Is there anyone around to help?&quot; you hear her say.]

(if:$josefineStore is &quot;known&quot; and $INV does not contain &quot;book series&quot;)[//[[The Adventures of Charles Howard and the Formidable Fruitcake-&gt;Book Series]]//
]
\(if:$INV contains &quot;bald card&quot;)[//[[Greg and Ron-&gt;Pull the Book]]//](else:)[_book5]
_book2
\(if:$theGame or (history:) contains &quot;Book 7&quot;)[
_book7]
_book3
_book4
_book1
_book6
(if: $wearing is &quot;cape&quot; and $citizensHelped does not contain &quot;library&quot;)[[[Help the Woman-&gt;SuperJed Library]]
]
\[[Exit-&gt;Library]] 

&lt;!-- //[[Magic Recliner Couches-&gt;Book 2]]// --&gt;</tw-passagedata><tw-passagedata pid="82" name="Book 1" tags="" position="1100,2550" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[What to do if the World is Ending]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by Reuben Griffiths]

&lt;==&gt;
---
(font:&quot;Libre Baskerville&quot;)[
\If you&#39;re reading this book, then that means that you think the world is about to end, or the world is literally about to end. But don&#39;t worry. This book will guide you through the three simple steps to help you prepare for the end.

&#39;&#39;Step 1) Talk to people.&#39;&#39; No one wants to go alone. The want to talk to people before the world ends is going to be shared by everyone. In chapter 1, I will describe who is best to talk to, and also show you a list of predetermined end-of-world phrases such as &quot;How are you coping?&quot; or &quot;So... are you gonna pay me back that $5 now?&quot;

&#39;&#39;Step 2) Do something.&#39;&#39; Whether this means crossing something off your bucket list or trying to stop impending doom, you&#39;re not gonna get the most out of life by simply sitting down on your couch. In chapter 2, I discuss the perfect activities to do before the world ends.

&#39;&#39;Step 3) Invest all of your money into cryptocurrency.&#39;&#39; If the world is ending, so is your money. And if you&#39;re not going to spend it, don&#39;t let it go to waste! In chapter 3, I will give the pros and cons of investing in different &quot;cryptos,&quot; and also show you my very own cryptocurrency that has no flaws whatsoever.]

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="83" name="Book Series" tags="" position="1100,2400" size="100,100">You notice one of the books in the book series Josefine was asking for: //The Adventures of Charles Howard and the Formidable Fruitcake//. You look nearby and eventually find the other books in the series, //The Adventures of Charles Howard and the Magnificent Mop//, //The Adventures of Charles Howard and the Towering Table//, and //The Adventures of Charles Howard: The Pointless Prequel//.
\(set:$INV to it + (a:&quot;book series&quot;))

You gather all 4 of the books, and take them to the front desk, where the librarian then checks you out.

[[Continue Looking-&gt;Bookshelves]] 
[[Exit-&gt;East Side of Town]] </tw-passagedata><tw-passagedata pid="84" name="Book 2" tags="" position="1100,2700" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[Magic Recliner Couches]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by Bread McApple]

&lt;==
---
(font:&quot;Libre Baskerville&quot;)[
\###COLD WAS THE NIGHT. I WAS STABBED.
“Wait; If you got stabbed, how are you alive writing this story?” you may ask. Well, let me tell you a story called “I survived.” 

It begins with me sitting on my couch, like any couch potato. However, I was no ordinary potato on a couch. You may not have noticed, but this couch was actually a recliner couch. Once again, this is no ordinary couch; it is a magic couch!

“But how is it magic?” you whine. Say that again and I will turn you into a couch. Yep; I have a couch that can turn you into a couch because science magic is really cool and does stuff!

Now, back to me getting stabbed. Spoiler: it was a magic recliner couch that stabbed me to death.

“TO DEATH?”, you yell loudly, “BUT YOU SAID YOU SURVIVED!” Yep, I survived, and I am telling you this story, so stop interrupting me!

Anyway, it begins with me sitting on my couch, like any couch potato. This was right before my epic adventure started. The magic recliner couch slowly reached over for a knife; I could see it, but I said nothing about it. As it swung the knife at me, I ducked because I had just dropped my piece of chocolate cake onto the floor.

I looked up, noticing I dodged a knife, and I said, “Hey. That&#39;s pretty good. However, don&#39;t stab me, couch, I have a book to write later about this situation.&quot;]

You close the book as it got too confusing for you to follow.

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="85" name="Josefine Book Series" tags="" position="2700,3000" size="100,100">(set:$INV to it - (a:&quot;book series&quot;))(set:$josefineStore to &quot;wait&quot;)(set:$incomingMail to &quot;deed&quot;)(set:$sidequests to it + (a:&quot;Josefine&quot;))
\&quot;Wow!&quot; Josefine exclaims, &quot;the library actually had all of them? That&#39;s awesome!&quot;

&quot;Yup, I was surprised to find them all, given their small selection.&quot;

&quot;Well, I guess I should uphold my end of the deal, huh? I&#39;ll contact the person holding onto the deed for me and I&#39;ll get it sent to you. Should come through the mail in a day or two.&quot;

&quot;Awesome, thank you, Josey!&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="86" name="Ted Burgerocity" tags="" position="2550,2250" size="100,100">You mention Burgerocity shutting down.

Ted looks at you confused. &quot;Oh, that burger place. I&#39;ve never been.&quot;

&quot;Well, today&#39;s your last chance to go eat there!&quot;

&quot;I&#39;ve lived my whole life without going there. I can live the rest just the same.&quot;

[[Continue-&gt;Ted&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="87" name="Ted Empty Store" tags="" position="2550,2400" size="100,100">&quot;Do you remember what was in that space next to the hardware store in Town Square?&quot; you ask Ted.

&quot;Yeah, what about it?&quot; Ted responds.

&quot;Do you remember what it was, or what it was called?&quot;

&quot;It was a bakery. I remember not liking the owner.&quot;

&quot;Okay, thank you, Ted!&quot;

&quot;Who are you again? Tell me how you know my name.&quot;

[[&quot;Goodbye!&quot;-&gt;Ted&#39;s Apartment]]</tw-passagedata><tw-passagedata pid="88" name="Ted Names" tags="" position="2550,3000" size="100,100">&quot;Have you ever thought about how our names rhyme?&quot; you ask Ted.

Ted stares at you. &quot;I don&#39;t know who you are. How do you know my name?&quot;

&quot;I don&#39;t remember how I remember stuff! That&#39;d be useless!&quot;

Ted shuts the door on you.

[[Continue-&gt;Ted&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="89" name="Open Jed&#39;s Jams" tags="" position="4599,1983" size="100,100">You spend the next day or two starting to clean up the store. You started mostly by sweeping and vacuuming and dusting, and then eventually painting, putting up wallpapers, and finally setting up items.

At long last, your life dream had been completed. Jed&#39;s Jams was open for business.

[[Continue-&gt;Capitalism Ending]] </tw-passagedata><tw-passagedata pid="90" name="Capitalism Ending" tags="" position="4550,2147" size="200,100">(unless:$ENDINGS contains &quot;Capitalism&quot;)[(set:$ENDINGS to it + (a:&quot;Capitalism&quot;))]
\(set:$JOURNAL to it + (a:&quot;Capitalism&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\5 long days passed.

No one&#39;s bought anything. No one even came into the store. And it&#39;s not like you didn&#39;t advertise it! You told many people about it: your neighbors, random people in the supermarket, random people on the train, random people that happened to walk by your shop, and more.

Was Jed&#39;s Jams never meant to be? Was it too good to be true? Or did Jed care about this idea so much that he never realized it was something no one wanted? (if:$INV contains &quot;buster&quot;)[Buster tried to console you, but it didn&#39;t matter. That wouldn&#39;t change the fact no one cared about his idea.]

The incoming bills began to scare you. In about 25 days you&#39;d have to pay them all. What revenue would you pay them with? You walked out of the store and looked at the front, wondering where you went wrong.

And that&#39;s when the sky went red and the entire store exploded.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="91" name="Burgerocity Owner" tags="" position="5600,2100" size="100,100">(set: $visitsBurgerocity to it + 1)
\&quot;Why the want to shut down shop all the sudden?&quot; you ask. &quot;And why so soon?&quot;

The owner leans forward. &quot;If anyone asks, you never heard this. I was told not to tell anyone.&quot;

&quot;What happened?&quot;

&quot;It was the mayor,&quot; the owner explains. &quot;He shut down my business just this morning. He told me he has deconstruction plans starting //tonight//.&quot;

&quot;Oh no! Is there anything I can do to help you? That sounds too sudden to be ethical or legal...&quot;

&quot;If you wanna talk to the people at City Hall, be my guest. I don&#39;t like it either but I&#39;m not gonna be the one to disrespect Mayor Dixon, y&#39;know?&quot;

&quot;Don&#39;t worry. I&#39;ll get to the bottom of this.&quot;(if:$BUSTER)[(if:$INV contains &quot;buster&quot;)[

&quot;Hey, wait a minute, is that my cardboard cutout?&quot;

&quot;Oh uhhh, no this is just a replica I made after the other one disappeared!](else:)[

&quot;Hey, by the way, did you ever see what happened to Buster? He just kinda disappeared.&quot;

&quot;Uhhhh, no idea! That&#39;s a little weird, haha...&quot;]]

[[Continue-&gt;Burgerocity]] </tw-passagedata><tw-passagedata pid="92" name="Josefine Deed" tags="" position="2700,3150" size="100,100">You mention the deed to the empty store.

&quot;I already talked to the person who was holding onto it for me,&quot; Josefine responds, &quot;so now we&#39;re just waiting for snail mail! Should arrive in your mailbox in a day or two.&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="93" name="Train Station" tags="" position="4000,600" size="200,200">(set:$visitsTrainStation to it + 1)
\(if:$wearing is &quot;icloak&quot;)[Jed temporarily took off his invisibility cloak while inside the train station.

]
\(if:$visitsTrainStation is 1)[
\(if:$PREMIUM is &quot;ready&quot;)[(set:$PREMIUM to &quot;canpurchase&quot;)(either:&quot;Good morning&quot;,&quot;Hey there&quot;,&quot;Howdy&quot;,&quot;Hello&quot;,&quot;How&#39;s it going&quot;,&quot;How ya doin&#39;&quot;,&quot;What&#39;s up&quot;) Jed!&quot; the ticket seller greets. &quot;Welcome to the $LOC Train Station! Today we&#39;ve introduced a new premium access feature! For a one-time $99 payment, you&#39;ll be able to get faster train rides, and get access to our premium member room which includes a free-to-use phone and ATM! Let us know if you&#39;re interested!&quot;

&quot;Will do,&quot; Jed replies.

&quot;Do you have your pass?&quot; the ticket seller asks.

(if:$INV contains &quot;train pass&quot;)[&quot;Never leave home without it!&quot;](else:)[&quot;Oh shoot, I left it at home.&quot;

&quot;We can just sell you a ticket if you&#39;d like.(if:$FUN is 7)[ We have a special promotion where train passes are 75% off!]&quot;]]
\(else:)[(either:&quot;Good morning&quot;,&quot;Hey there&quot;,&quot;Howdy&quot;,&quot;Hello&quot;,&quot;How&#39;s it going&quot;,&quot;How ya doin&#39;&quot;,&quot;What&#39;s up&quot;) Jed!&quot; the ticket seller greets. &quot;Welcome to the $LOC Train Station! Do you have your pass?&quot; the ticket seller asks.

(if:$INV contains &quot;train pass&quot;)[&quot;Never leave home without it!&quot;](else:)[&quot;Oh shoot, I left it at home.&quot;

&quot;We can just sell you a ticket if you&#39;d like.(if:$FUN is 7)[ We have a special promotion where train passes are 75% off!]&quot;]]]
\(else:)[
\&quot;(if:$previousPassage is not &quot;Train Station&quot;)[Welcome to the $LOC Train Station!&quot; the ticket seller greets. &quot;](if:$INV contains any of (a:&quot;train ticket&quot;,&quot;train pass&quot;,&quot;train pass new&quot;) and $PREMIUM is &quot;nope&quot;)[Where would you like to go?](else:)[What can I do for you?](if:$FUN is 7)[ Don&#39;t forget our train passes are 75% off today!]&quot;
\(if:$MONEY &lt; 10 and $ATM &lt; 10 and $LOC is not &quot;East Side&quot; and $INV does not contain all of (a:&quot;train pass&quot;,&quot;train ticket&quot;,&quot;train pass new&quot;))[

&quot;I don&#39;t have enough money for the ride back, can you set me up for a ride to East Side and I&#39;ll pay you back later?&quot;

&quot;Jed, of course I can! Don&#39;t worry about paying us back, consider this a thank you for your service!&quot;]]

(if:$PREMIUM is &quot;yes&quot;)[
\(if:$MONEY &lt; 10 and $ATM &lt; 10 and $LOC is not &quot;East Side&quot; and $INV does not contain all of (a:&quot;train pass&quot;,&quot;train ticket&quot;,&quot;train pass new&quot;))[(link-reveal-goto:&quot;Go to East Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;East Side&quot;)]](else:)[(if:$INV contains any of (a:&quot;train pass&quot;,&quot;train ticket&quot;,&quot;train pass new&quot;))[[[Train Ride-&gt;Train Ride Options]]](else:)[[[Purchase Ticket-&gt;Train Station Shop]]]]
[[Phone-&gt;Train Station Phone]]
[[ATM-&gt;Train Station ATM]]
(if:$LOC is &quot;East Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;East Side of Town&quot;)]
\(if:$LOC is &quot;Town Square&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;Town Square&quot;)]
\(if:$LOC is &quot;West Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;West Side of Town&quot;)]]
\(else:)[
\(if:$MONEY &lt; 10 and $ATM &lt; 10 and $LOC is not &quot;East Side&quot; and $INV does not contain all of (a:&quot;train pass&quot;,&quot;train ticket&quot;,&quot;train pass new&quot;))[
\(link-reveal-goto:&quot;East Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;East Side&quot;)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
(if:$LOC is &quot;East Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;East Side of Town&quot;)]
\(if:$LOC is &quot;Town Square&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;Town Square&quot;)]
\(if:$LOC is &quot;West Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;West Side of Town&quot;)]]
\(else:)[
\(if:$INV does not contain all of (a:&quot;train pass&quot;,&quot;train pass new&quot;,&quot;train ticket&quot;))[
\Current funds: $$MONEY

(if:$PREMIUM is &quot;canpurchase&quot;)[(if:$MONEY &gt;= 99)[[[Activate Premium - $99-&gt;Activate Premium]]](else:)[[[Activate Premium - $99-&gt;Too Poor]]]
]
\(if:$MONEY &gt;= 10)[(link-reveal-goto: &#39;Train Ticket - $10&#39;,&quot;Train Station&quot;)[(set:$INV to it + (a:&quot;train ticket&quot;))(set:$MONEY to it - 10)(set:$STATS&#39;s 3rd to it + 10)]](else:)[[[Train Ticket - $10-&gt;Too Poor]]]
(if:$FUN is 7)[(if:$MONEY &gt;= 20)[(link-reveal-goto: &#39;Train Pass - $20&#39;,&quot;Train Station&quot;)[(set:$INV to it + (a:&quot;train pass new&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[[[Train Pass - $20-&gt;Too Poor]]]
\(unless:$anomalies contains &quot;pass deal&quot;)[(set:$anomalies to it + (a:&quot;pass deal&quot;))]]
\(else:)[(if:$MONEY &gt;= 80)[(link-reveal-goto: &#39;Train Pass - $80&#39;,&quot;Train Station&quot;)[(set:$INV to it + (a:&quot;train pass new&quot;))(set:$MONEY to it - 80)(set:$STATS&#39;s 3rd to it + 80)]](else:)[[[Train Pass - $80-&gt;Too Poor]]]]
(if:$LOC is &quot;East Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;East Side of Town&quot;)]
\(if:$LOC is &quot;Town Square&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;Town Square&quot;)]
\(if:$LOC is &quot;West Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;West Side of Town&quot;)]]
\(else:)[
\(if:$PREMIUM is &quot;canpurchase&quot;)[
\Current funds: $$MONEY

(if:$MONEY &gt;= 99)[[[Activate Premium - $99-&gt;Activate Premium]]](else:)[[[Activate Premium - $99-&gt;Too Poor]]]
]
\(unless:$LOC is &quot;East Side&quot;)[(link-reveal-goto:&quot;East Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;East Side&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(unless:$LOC is &quot;Town Square&quot;)[(link-reveal-goto:&quot;Town Square&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;Town Square&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(unless:$LOC is &quot;West Side&quot;)[(link-reveal-goto:&quot;West Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;West Side&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(if:$ENDINGS&#39;s length &gt; 6 and $ENDINGS does not contain &quot;Glitch&quot;)[[[&quot;Are there any trains going out of town?&quot;-&gt;Out of Town]]
]
\(if:$ENDINGS&#39;s length &gt; 6 and $ENDINGS contains &quot;Glitch&quot;)[[[Bloomhurst Lake-&gt;Out of Town]]
]
\(if:$LOC is &quot;East Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;East Side of Town&quot;)]
\(if:$LOC is &quot;Town Square&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;Town Square&quot;)]
\(if:$LOC is &quot;West Side&quot;)[(link-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;West Side of Town&quot;)]
\]
\]
\]
\
\(set:$previousPassage to (passage:)&#39;s name)</tw-passagedata><tw-passagedata pid="94" name="Out of Town" tags="" position="4450,450" size="100,100">&quot;Are there any trains going out of town?&quot; you ask the ticket seller.
\(set:$justSoldTicket to false)

&quot;The trains that go in and out of town are only for business reasons,&quot; the ticket seller explains. &quot;If you want to get a ride out of town you&#39;ll need t- wait, what&#39;s this? Ok, it looks like there is one train going out of town. To a place called &#39;Bloomhurst Lake...&#39; Oddly enough, it doesn&#39;t look like any trains are coming back from this location. What do you think?&quot;

[[&quot;I&#39;ll do it!&quot;-&gt;Train Ride Bloomhurst Lake]]
(if:$LOC is &quot;East Side&quot;)[(link-reveal-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;East Side of Town&quot;)[(set:$justSoldTicket to false)]](if:$LOC is &quot;Town Square&quot;)[(link-reveal-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;Town Square&quot;)[(set:$justSoldTicket to false)](if:$LOC is &quot;West Side&quot;)[(link-reveal-goto:&#39;&quot;Nevermind&quot;&#39;,&quot;West Side of Town&quot;)[(set:$justSoldTicket to false)]]]</tw-passagedata><tw-passagedata pid="95" name="Paint Apartment" tags="" position="1900,2100" size="100,100">(set:$visitsPaint to it + 1)
\(set:_a2 to (rotated-to: where it is &quot;paint&quot;,...$INV))
\(set:$INV to _a2&#39;s 2ndtolast)
\(set:$wallColor to (a:&quot;vermilion&quot;,&quot;gamboge&quot;,&quot;glaucous&quot;,&quot;ginerline&quot;,&quot;smalt&quot;,&quot;coquelicot&quot;,&quot;eburnean&quot;,&quot;skobeloff&quot;,&quot;wenge&quot;,&quot;zaffre&quot;,&quot;puce&quot;,&quot;falu&quot;,&quot;incarnadine&quot;,&quot;pervenche&quot;,&quot;Green-Guy-green&quot;,&quot;Blue-Cat-blue&quot;,&quot;sang-de-boeuf&quot;,&quot;sinoper&quot;,&quot;watchet&quot;)&#39;s random)
\(if:$visitsPaint is 1)[
\You decide that the grey walls of your apartment needed a change. You open up the buckets of paint you bought at the hardware store and start painting your walls. You splash paint on quite a few things, but it&#39;s all worth it when the walls finally become a beautiful shade of $wallColor.
\(set:$STATS&#39;s 8th to it + 1)]
\(else:)[
\You open up another paint bucket and quickly repaint. It was quite difficult considering that the other coat hasn&#39;t fully dried yet, but it was all worth it when the walls finally became a beautiful shade of $wallColor.
\(set:$STATS&#39;s 8th to it + 1)]

[[Continue-&gt;Jed&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="96" name="Book 3" tags="" position="1100,2850" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)[
\(size:2)[Starch &amp; Crinkle]
(size:1.4)[Visit the Big City]]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by Nicole Di Bisceglie]

&lt;==
---
(font:&quot;Libre Baskerville&quot;)[
\Starch and Crinkle, equally known as Arruga y Chuño, are not exactly known for having the craziest adventures. They live within an abandoned room of a 2-star hotel with their cat Porche, and occasionally hang out with their family friend Yeyé in the trailer park.

Of course, not everything can stay the same!

One fateful day following the events of their last adventure, where they needed to find the thief of Crinkle&#39;s meal from BurgerZone™, they decided to go from their home of Santa Teresa, New Mexico to Sunland Park, the bigger city down the road. Except this time, they didn&#39;t need to go while on a hunt!

Since their last adventure, Starch and Crinkle&#39;s friends Salvia and Nabo have since gotten jobs at the local amusement park, Super Amusement Land. With a little coordination beforehand, the two of them set up Starch, Crinkle, and even Yeyé with an all day pass. Did management know about it? No, but that&#39;s okay!

Yeyé only actually participated in two rides - more than expected - but even Crinkle began to tap out after the Super Hanging Upside Down Epic Fear Coaster. Only Chuño remained, ready to brave the final ride: the Hyper Speedy Zoom-Zoom Wowie-Wow-Wow Zoom Fast Machine Super Super Coaster.

“This will be nothing,” he said, well knowing the only way he was allowed to ride was through a combination of 6-inch platform shoes and very tall pants to hide the evidence that he might not reach the height requirement.

Strapping into the seat, the Hyper Speedy Zoom-Zoom Wowie-Wow-Wow Zoom Fast Machine Super Super Coaster blasted off immediately, and a mere 30 seconds later it had already done four laps across the perimeter of Super Amusement Land.

“Yeah, I think I&#39;m done,” Starch uttered, ready to go home.]

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="97" name="Electronics Store" tags="" position="1500,1700" size="100,200">(unless:$banned contains &quot;electronics&quot; and (($wearing is &quot;ski mask&quot; and $toasterMask) or ($wearing is not &quot;ski mask&quot; and $toasterMask is false)) and $wearing is not &quot;icloak&quot;)[
\You&#39;re inside the Gadget Factorie, an electronics store in East Side. The interior has a very sleek and modern design. (if:$wearing is &quot;icloak&quot;)[&quot;Is someone there?&quot; the clerk asks.](else:)[&quot;How ya doin&#39; (cond:$wearing is &quot;ski mask&quot;,&quot;sir&quot;,&quot;Jed&quot;)?&quot; the clerk greets.]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Purchase Items&quot;,&quot;Ghost Purchase&quot;)](else:)[(if:$visitsGang is 2 and $INV does not contain &quot;toaster&quot;)[[[&quot;Purchase&quot; Items-&gt;Buy Electronics]]](else:)[[[Purchase Items-&gt;Buy Electronics]]]]
\(if:(history:) contains &quot;Buy Electronics&quot; and $storeCardQuest does not contain &quot;documents&quot; and not $joinGang and $wearing is not &quot;icloak&quot;)[(if:$storeCardQuest does not contain &quot;ask&quot;)[
[[&quot;How am I supposed to afford this stuff?&quot;-&gt;Store Card]]](else:)[
(if:$INV contains &quot;documents&quot;)[[[Give Documents-&gt;Store Card]]](else:)[[[Store Card-&gt;Store Card]]]]]
\(if:$toiletEnding and $toilets does not contain (passage:)&#39;s name)[
(link-goto:&quot;Bathroom&quot;,&quot;Mega-Bathroom&quot;)]
[[Exit-&gt;East Side of Town]]]
\(else:)[
\&quot;Hey, you&#39;re the dude that stole my toaster! I&#39;ve already called the cops on you, bud!&quot;

&quot;Oops, that&#39;s my queue to leave!&quot;

[[Exit-&gt;East Side of Town]]]</tw-passagedata><tw-passagedata pid="98" name="Buy Electronics" tags="" position="1500,1950" size="100,100">(set:$visitsElectronics to it + 1)
\(if:$visitsElectronics is 1)[&quot;Remember: most of this stuff is self assembly. If you don&#39;t know how to do it you probably shouldn&#39;t buy it.&quot;](else:)[&quot;We got the goods, provided you got the dough.&quot;]

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]
\(if:$storeCardQuest contains &quot;documents&quot;)[
Store card debt: $(if:5000 - $storeCard &gt; 999)[(digit-format:&quot;###,###&quot;,5000 - $storeCard)](else:)[(print:5000 - $storeCard)]]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS2&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;BODY OF WACKY STEVE - $18&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;WS2&quot;))(set:$MONEY to it - 18)(set:$visitsElectronics to it - 1)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS2&quot;)[BODY OF WACKY STEVE - Sold Out](else:)[[[BODY OF WACKY STEVE - $18-&gt;Too Poor]]]]
]\
(if:$storeCard &gt; 649)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;24&quot; Dishwasher - $649 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$storeCard to it - 649)(set:$STATS&#39;s 12th to it + 649)(set:$visitsElectronics to it - 1)]](else:)[(if:$MONEY &gt;= 649)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;24&quot; Dishwasher - $649&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$MONEY to it - 649)(set:$STATS&#39;s 3rd to it + 649)(set:$visitsElectronics to it - 1)]](else:)[[[24&quot; Dishwasher - $649-&gt;Too Poor]]]]
(if:$storeCard &gt;= 2799)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;28 Cu. ft. Smart Fridge - $2,799 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$storeCard to it - 2799)(set:$STATS&#39;s 12th to it + 2799)(set:$visitsElectronics to it - 1)]](else:)[(if:$MONEY &gt;= 2799)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;28 Cu. ft. Smart Fridge - $2,799&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$MONEY to it - 2799)(set:$STATS&#39;s 3rd to it + 2799)(set:$visitsElectronics to it - 1)]](else:)[[[28 Cu. ft. Smart Fridge - $2,799-&gt;Too Poor]]]]
(if:$storeCard &gt;= 599)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;70&quot; Smart TV - $599 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$storeCard to it - 599)(set:$STATS&#39;s 12th to it + 599)(set:$visitsElectronics to it - 1)]](else:)[(if:$MONEY &gt;= 599)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;70&quot; Smart TV - $599&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$MONEY to it - 599)(set:$STATS&#39;s 3rd to it + 599)(set:$visitsElectronics to it - 1)]](else:)[[[70&quot; Smart TV - $599-&gt;Too Poor]]]]
(if:$storeCard &gt;= 1299)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;30&quot; Stove - $1,299 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$storeCard to it - 1299)(set:$STATS&#39;s 12th to it + 1299)(set:$visitsElectronics to it - 1)]](else:)[(if:$MONEY &gt;= 1299)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;30&quot; Stove - $1,299&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$MONEY to it - 1299)(set:$STATS&#39;s 3rd to it + 1299)(set:$visitsElectronics to it - 1)]](else:)[[[30&quot; Stove - $1,299-&gt;Too Poor]]]]
(if:$visitsGang is 2 and $INV does not contain &quot;toasterStolen&quot;)[[[18&quot; Toaster - $4,999 (Steal)-&gt;Steal Toaster]]](else:)[(if:$storeCard &gt;= 4999)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;18&quot; Toaster - $4,999 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;toaster&quot;))(set:$storeCard to it - 4999)(set:$STATS&#39;s 12th to it + 4999)(set:$visitsElectronics to it - 1)]](else:)[(if:$INV does not contain &quot;toaster&quot; and $MONEY &gt;= 4999)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;18&quot; Toaster - $4,999&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;toaster&quot;))(set:$MONEY to it - 4999)(set:$STATS&#39;s 3rd to it + 4999)(set:$visitsElectronics to it - 1)]](else:)[(if:$INV contains &quot;toaster&quot;)[18&quot; Toaster - Sold Out](else:)[[[18&quot; Toaster - $4,999-&gt;Too Poor]]]]]]
(if:$storeCard &gt;= 399)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;VR Headset - $399 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;vr headset&quot;))(set:$storeCard to it - 399)(set:$STATS&#39;s 12th to it + 399)(set:$visitsElectronics to it - 1)]](else:)[(if:$MONEY &gt;= 399)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;VR Headset - $399&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;vr headset&quot;))(set:$MONEY to it - 399)(set:$STATS&#39;s 3rd to it + 399)(set:$visitsElectronics to it - 1)]](else:)[[[VR Headset - $399-&gt;Too Poor]]]]
(if:$storeCard &gt;= 699)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;27&quot; Washer &amp; Dryer Set - $699 (Store Card)&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$storeCard to it - 699)(set:$STATS&#39;s 12th to it + 699)(set:$visitsElectronics to it + 1)]](else:)[(if:$MONEY &gt;= 699)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;27&quot; Washer &amp; Dryer Set - $699&#39;,&quot;Buy Electronics&quot;)[(set:$INV to it + (a:&quot;electronic&quot;))(set:$MONEY to it - 699)(set:$STATS&#39;s 3rd to it + 699)(set:$visitsElectronics to it - 1)]](else:)[[[27&quot; Washer &amp; Dryer Set - $699-&gt;Too Poor]]]]

[[Exit-&gt;Electronics Store]] </tw-passagedata><tw-passagedata pid="99" name="Train Ride Bloomhurst Lake" tags="" position="4450,600" size="100,100">(set:$STATS&#39;s 7th to it + 1)
\(if:$STATS&#39;s 7th is 15 and $PREMIUM is &quot;nope&quot;)[(set:$PREMIUM to &quot;ready&quot;)]
\Jed (cond:$INV contains &quot;buster&quot;,&quot;and Buster &quot;,&quot;&quot;)got on the train, and shortly after it began to move. 

During the train ride, (either:&quot;Jed wondered if Burgerocity was selling the Big Boy today. The Big Boy is a special burger that the owner only sells on random days. On one hand, today is Burgerocity&#39;s last day, so it would be a missed opportunity if the owner didn&#39;t sell it. On the other hand, it had only been a few days since it was last sold, and it takes lots of material to make, so he probably does not have enough.&quot;,&quot;Jed looked out the train window for some birds. Jed had made it a habit to birdwatch while on the train. Strangely enough, Jed didn&#39;t see any during his ride. The weather&#39;s normal today, where are all the birds? Did someone scare them all away? Or some//thing//?&quot;,&quot;Jed thought about the events happening today. His favorite burger place being shut down, the letter he received in the mail, and the quest given to him. Jed loves to help people and wanted to succeed in this regard, but the things happening today seem a bit much. Was this quest expected of him? What would happen if he never met up with the writer of the letter? When is it okay to let things take their own course?&quot;,&quot;Jed thought about his neighbor Rafael. He and Jed met when he first moved in the apartment complex, and they got along quite well. They have quite a few things in common and have hung out a few times. However, their schedules rarely line up, so they don&#39;t talk to each other as much as they would like.&quot;,&quot;Jed thought about his neighbor Ted. Ted is much older than Jed, and Ted had been living in the apartment complex way before Jed moved in. Despite the fact that they&#39;ve been neighbors for a while, they have barely gotten to know each other. Ted has almost completely forgotten who Jed is, despite his numerous attempts to introduce himself. Maybe one day they shall become friends…&quot;,&quot;Jed thought about his neighbor Josefine. Jed and Josefine have known each other for years, but only just recently did Josefine move near Jed. She had been living with her parents for a few years but eventually wanted her own place. Jed convinced her to move in near him, and she did. She&#39;s not new to Webster Groves, however, since she used to (cond: $josefineStore is &#39;unknown&#39;,&#39;have a job&#39;,&#39;own a business&#39;) here.&quot;,&quot;Jed wondered if he could ever get a job at Bosco&#39;s Family Food Store, the supermarket next to his apartment complex. On one hand, it wouldn&#39;t be that hard of a job, he&#39;d get to talk to people a lot, and it&#39;s a very short walk from his place to the store. However, the store&#39;s current owner, John Bosco, has developed a slight distaste for Jed. As far as Jed knows, he hasn&#39;t done anything that would warrant this kind of disdain (a disdain that he&#39;s not even aware of), but the owner simply doesn&#39;t like his over-the-top personality.&quot;,&quot;Jed realized he has never been inside the Webster Groves City Hall(cond:$visitsCityHall &gt; 0,&#39; before today&#39;,&#39;&#39;). The building is of course open to the public, but he had simply never thought to enter it, nor had a reason to enter it. But now with the letter he got this morning talking about evil and distrustful people inside City Hall, I think it&#39;s safe to say Jed (cond:$visitsCityHall &gt; 0,&#39;had&#39;,&#39;has&#39;) a pretty good reason for visiting. Its interior has popped up in some conversations with friends: its gigantic size, the beautiful columns, the art on the roof, and the large maze-like structure of its hallways. Would it be wrong to ask for some kind of tour?&quot;,&quot;Jed thought about the computer lab inside the town library. The computers have been out of order for quite a while. Despite this, sometimes when Jed enters the computer lab, he can see stuff on one of the screens, but it&#39;s usually something frozen. Do the computers actually work, and someone&#39;s just been freezing them on command and lying they&#39;re out of order? Or are they so broken that they just show random things whenever they feel like it?&quot;,&quot;Jed thought about the criminal gang in West Side that he keeps hearing about. They&#39;re mostly known for mugging people that are unfortunate enough to cross paths with them. He then began to wonder how much being a mugger pays. You could get lucky and get someone who carries lots of money, but recently there are fewer and fewer people who ever carry cash at all. Imagine being a mugger for a living, but constantly mugging people who don&#39;t carry cash! The mugging economy must be going downhill compared to the past.&quot;,&quot;Jed looked around the train car he was in. (cond:$wearing is &#39;3d glasses&#39;,&#39;It looked absolutely incredible in 3D.&#39;,&#39;For some reason, it looked nicer than the other ones he&#39;s been in before.&#39;) The seats were pretty, and also very comfy. There were also tables in between the seats, something Jed knows that only a few of the train cars have. Along with the great landscape view that can be seen through the big glass windows, this ride was very enjoyable.&quot;)
\(live:1s)[(if:time &gt; 10s)[

Hey, Jed, I don&#39;t think that you should&#39;ve gotten on this train. I didn&#39;t say anything earlier because it hadn&#39;t clicked for me yet, but now I think I remember what Bloomhurst Lake is. And I don&#39;t think what we&#39;re going to see is going to be pretty.]
\(if:time &gt; 20s)[

Well, looks like the train has stopped. Let&#39;s be careful out here.

[[Continue-&gt;Bloomhurst Lake]](stop:)]]</tw-passagedata><tw-passagedata pid="100" name="Bloomhurst Lake" tags="" position="7300,1300" size="200,200">(set:$visitsBL to it + 1)
\Youre in Bloomhurst Lake a small town outside of Webster Groves. The town is build around a lake of the same name. The sky feels very warm and your happy to be here.
\(if:$visitsBL is 1)[

Wow... it&#39;s worse than I thought. Look at all those typos in just those three sentences! Let&#39;s explore around a bit, Jed.]

[[Apartment Complex-&gt;BL Apartments]]
[[Pet Store-&gt;BL Pet Store]]
[[Ice Rink-&gt;Ice Rink BL]]
[[Train Station-&gt;BL Train Station]]
\(if:$visitedBL contains all of (a:&quot;train station&quot;,&quot;pet store&quot;,&quot;apartments&quot;,&quot;ice rink&quot;))[
[[Leave Town-&gt;Leave BL]]
(if:$ENDINGS contains &quot;Glitch&quot;)[(font:&quot;Raleway&quot;)[[[Somewhere-&gt;Somewhere]]]]]</tw-passagedata><tw-passagedata pid="101" name="BL Train Station" tags="" position="7600,1200" size="100,100">You enter the train station.
\(set:$visitedBL to it + (a:&quot;train station&quot;))

&quot;Hey Jed!&quot; the ticket seller greats. &quot;Welcome to the `$LOCATION` Train Station! Where did you want to go?&quot;

Curent funds: $$$MONEY

`[[Webster Groves-&gt;Train Ride]]`
[[Exit-&gt;Bloomhurst Lake]] </tw-passagedata><tw-passagedata pid="102" name="Leave BL" tags="" position="7350,1550" size="100,100">Well Jed, I hope you had fun exploring that broken area. I might as well explain what this place is:

Bloomhurst Lake was going to be a DLC for this game. It would&#39;ve added a completely new area to the game, with its own subareas like Webster Groves. But as we worked on it, we realized a crucial problem: what was the point of this whole area? What would it have done to the game? Sure, there would have been &quot;more,&quot; but what good does &quot;more&quot; do when it&#39;s not adding to anything? So we threw it away.

But now that makes me wonder, how was the ticket seller able to access this area? We chopped it off from the rest of the game very early on. There shouldn&#39;t have been any links to these passages... maybe something in town will explain it?

[[Go Back-&gt;Glitch Ending]]</tw-passagedata><tw-passagedata pid="103" name="BL Pet Store" tags="" position="7600,1500" size="100,100">&quot;HelloHeyGood morningHow are yaHowdy, Jed!&quot; the clerk greets. &quot;Adoption fee is fifty dollars!
\(set:$visitedBL to it + (a:&quot;pet store&quot;))

Curent Funds: $(if:$MONEY &gt; 999 or $MONEY &lt; -999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Cat - $50&quot;,&quot;BL Pet Store&quot;)[(set:$MONEY to it - 50)(set:$STATS&#39;s 4th to it + 1)]
(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Dog - $50&quot;,&quot;BL Pet Store&quot;)[(set:$MONEY to it - 50)(set:$STATS&#39;s 4th to it + 1)]
(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Ferret - $50&quot;,&quot;BL Pet Store&quot;)[(set:$MONEY to it - 50)(set:$STATS&#39;s 4th to it + 1)]
(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Hamster - $50&quot;,&quot;BL Pet Store&quot;)[(set:$MONEY to it - 50)(set:$STATS&#39;s 4th to it + 1)]
(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Rabbit - $50&quot;,&quot;BL Pet Store&quot;)[(set:$MONEY to it - 50)(set:$STATS&#39;s 4th to it + 1)]

[[Exit-&gt;Bloomhurst Lake]] </tw-passagedata><tw-passagedata pid="104" name="BL Apartments" tags="" position="7600,1650" size="100,100">`(if:$resident)[&quot;Welcome back, Jed,&quot; the man at the counter says.]
\(else:)[You walk up to the apartment complex. It looks simlar to the one you live in back to Wesbter Groves. When you get to the doors you notice that there is a keycard scanner next to the front door. Perhaps you can find a way to get in...`
\(set:$visitedBL to it + (a:&quot;apartments&quot;))

`$resident[`[[Your Apartment-&gt;Apartment Room BL]]]
[[Continue-&gt;Bloomhurst Lake]] </tw-passagedata><tw-passagedata pid="105" name="Apartment Room BL" tags="" position="7750,1650" size="100,100">You&#39;re currently inside your apartment in Bloomhurst Lake. Your home away from home Where would you like to go?

[[Kitchenette-&gt;BL Apartments]]
[[Bedroom-&gt;BL Apartments]]
[[Bathroom-&gt;BL Apartments]]
[[Exit-&gt;BL Apartments]]</tw-passagedata><tw-passagedata pid="106" name="Ice Rink BL" tags="" position="7600,1350" size="100,100">(set:$currentTime to (current-time:))
\&quot;Welcome to the Bloomhurst Lake Ice rink. Good (if:$currentTime)[morning](else:)[afternoon] Want to sake but the lake&#39;s not frozen over yet? You&#39;ve come to the right place!&quot;
\(set:$visitedBL to it + (a:&quot;ice rink&quot;))

(if:$STANLEY is false and $ENDINGS contains &quot;Glitch&quot;)[[[Enter the door on the left-&gt;Add Stanley]]](else:)[[[Enter the door on the left-&gt;Too Poor]]]
[[Exit-&gt;Bloomhurst Lake]] </tw-passagedata><tw-passagedata pid="107" name="Glitch Ending" tags="" position="7300,1700" size="200,100">Double-click this passage to edit it.
\(unless:$ENDINGS contains &quot;Glitch&quot;)[(set:$ENDINGS to it + (a:&quot;Glitch&quot;))]
\(set:$JOURNAL to it + (a:&quot;Glitch&quot;))
\(live:0.1s)[(if:time&gt;10s)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(go-to:&quot;Waiting Room Entrance&quot;)]]

Oh no. The passage is broken. And I don&#39;t see a way to go back from here. Are we trapped? Trapped inside this broken area of the game? Well then. Looks like it will be just me and you, Jed. Here... forever. Until the game gets closed. Alright Jed, I hope you brought some kind of activity with you to Bloomhurst Lake. I actually have a rebus book over here that I&#39;m going to take a crack at. That should last me a little while at least. I&#39;ll be back to you when I get bored!</tw-passagedata><tw-passagedata pid="108" name="Mega-Bathroom" tags="" position="3000,3500" size="100,100">(set:$visitsMegaToilet to it + 1)
\(if:$visitsMegaToilet is 1)[Oh, so now that I&#39;ve stopped you from flushing your own toilet, you&#39;re gonna go and flush someone else&#39;s toilet? You&#39;re that petty?]
\(if:$visitsMegaToilet is 2)[Again? Are you really going to go from building to building just so that you can flush the toilet? You&#39;re not even using it! You don&#39;t need to use it; we&#39;re in a fictional game world where no one has to use the bathroom!]
\(if:$visitsMegaToilet is 3)[Oh no. I know what you&#39;re doing. I thought I got rid of this ending. It shouldn&#39;t be possible. Well, //shouldn&#39;t// being the key word here.]
\(if:$visitsMegaToilet is 4)[Jed, if you&#39;re going for the Toilet Ending, it&#39;s not possible. I removed it from the game before publishing it. Or at least I vividly remember removing it from the game. This either means I&#39;m going crazy or... or he added it back...]
\(if:$visitsMegaToilet is 5)[Oh, of course he added back this ending. Why wouldn&#39;t he? I&#39;m trying to create a nice little town with a nice little story with a nice little good ending, and //he// has to come in here and &#39;&#39;literally&#39;&#39; crap all over it. This is just great.]
\(if:$visitsMegaToilet is 6)[I just realized, Jed. Since he added it back without telling me, and also without me knowing, that also means that I don&#39;t know what&#39;s going to happen when we flush all the toilets. Knowing him, he&#39;s changed it on me. Unfortunately, if I really do want to find out what happens when we flush all the toilets, there&#39;s only one way to get that information...]
\(if:$visitsMegaToilet is 7)[Well Jed, I never thought I was going to say this, but I think I am... actually... invested in this ending. Is something going to happen? I don&#39;t know. I... I actually don&#39;t know! Oh, this is exciting! The //Toilet Ending// is exciting me, of all things. Okay Jed, hurry along! We only have 3 more toilets to go after this one.]
\(if:$visitsMegaToilet is 8)[Do you think there&#39;s actually an ending to all this? Sure, it&#39;s called the Toilet //Ending//, but how do we know that it upholds that title? Is it just a trust thing we have to do? Do you have trust in the Toilet Ending, Jed?

Oh, why am I asking you? You had trust in it from the very start. It was I who was unfaithful. You&#39;ve pulled me along this amazing journey. And I truly mean journey, because our destination, while elusive and mystical, is belittled in comparison to the adventure we&#39;ve had together. The character growth. The toilet flushing. 

There&#39;s only two more to go after this one. Godspeed, Jed!]
\(if:$visitsMegaToilet is 9)[There is only more toilet left. One more toilet left in the game after this. Do you (cond:$ENDINGS contains any of (a:&quot;NormalRoute&quot;,&quot;Evil&quot;,&quot;Arrested&quot;),&quot;remember&quot;,&quot;know&quot;) where it is? I don&#39;t want to give away the answer, but to find it you&#39;re going to have to go underground.]

[[Flush the Toilet-&gt;Mega-Toilet]] </tw-passagedata><tw-passagedata pid="109" name="Mega-Toilet" tags="" position="3000,3650" size="100,100">You flush the toilet.
\(if:$toilets does not contain $previousPassage)[(set:$toilets to it + (a:$previousPassage))]
\(set:$STATS&#39;s 6th to it + 1)

(link-goto:&quot;Continue&quot;,$previousPassage)</tw-passagedata><tw-passagedata pid="110" name="The Final Flush" tags="" position="4075,3150" size="100,100">You flush the toilet. And...

Nothing? Nothing special happens?

Alright, I know this is going to be rich coming from me, after all that talk about how &quot;it&#39;s not about the destination, it&#39;s about the journey&quot; but...

Well this is a big giant letdown.

Oh well, let&#39;s go defeat the mayor... or whatever...

[[Continue-&gt;The Toilet Ending]] 
\(set:$STATS&#39;s 6th to it + 1)</tw-passagedata><tw-passagedata pid="111" name="The Toilet Ending" tags="" position="4025,3325" size="200,100">(unless:$ENDINGS contains &quot;Toilet&quot;)[(set:$ENDINGS to it + (a:&quot;Toilet&quot;))]
\(set:$JOURNAL to it + (a:&quot;Toilet&quot;))
\(font:&quot;Raleway&quot;)[
\(unless:$wearing is &quot;icloak&quot;)[
\As the narrator started to mope, Jed and the secretary walked out of the maintenance room. Jed and the narrator are both upset, while the secretary is just confused. How would Jed explain to her what was happening? Would she ever be able to understand? Would the concept of a &quot;toilet ending&quot; ever make sense to her? Would the process of explaining the Toilet Ending give her an existential crisis?

However, moments later, the room began to shake. &quot;This is it!&quot; the narrator cried. The toilet inside the maintenance room began to grow. Jed and the secretary looked back and saw it begin to take up the entire room. They ran to the elevator and pushed the button to go up, but the door quickly opened and revealed four security guards. 

&quot;What are you two doing down here?&quot; they shout. &quot;This is a restricted area! We know about your dress-up plans!&quot;

&quot;Look!&quot; Jed yells, pointing at the growing toilet. &quot;We have to get out of here before we get crushed!&quot;

The guards stare at Jed for a second, but then invite Jed and the secretary into the elevator. After an awkward ride upwards, the six run out of the elevator, ushering for others to follow them.

A commotion has begun around city hall. People began gathering around, wondering what the noise was. After a minute or two, the toilet grew so large that it completely destroyed City Hall. Once there was nothing left, it stopped growing.]
\(else:)[As the narrator started to mope, Jed walked out of the maintenance room, upset. Questions began to pop up in their minds. Was the toilet ending even a real thing? Was this all for naught? Was the real toilet ending the friends we made along the way?

However, moments later, the room began to shake. &quot;This is it!&quot; the narrator cried. The toilet inside the maintenance room began to grow. Jed looked back and saw it begin to take up the entire room. He ran to the elevator and pushed the button to go up, but the door quickly opened and revealed four security guards. 

&quot;What are you doing down here?&quot; they shout. &quot;This is a restricted area! We know about your dress-up plans!&quot;

&quot;Look!&quot; Jed yells, pointing at the growing toilet. &quot;We have to get out of here before we get crushed!&quot;

The guards stare at Jed for a second, but then invite him into the elevator. After an awkward ride upwards, the five run out of the elevator, ushering for others to follow them.

A commotion has begun around city hall. People began gathering around, wondering what the noise was. After a minute or two, the toilet grew so large that it completely destroyed City Hall. Once there was nothing left, it stopped growing.]]

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="112" name="Fun BBTA" tags="" position="1250,2100" size="100,100">You walk up to the computer and see a story written on the screen.

&lt;blockquote&gt;//It stalks the countryside with ears that cannot hear...//

Your body jolts upwards in an unfamiliar bed by the startling sound of crows mocking you in the distance. The frigid air streaks across your face, cooling the sweat from your fever dream. Your vision is hazy, perhaps from the abrupt wake-up call, but starts to slowly clear up. Looking past the dusty sheets, you find yourself in a surprisingly well-furnished room.

Next to you is a nightstand with a crumbled, cryptic note written in seemingly incoherent gibberish; perhaps another language you don&#39;t understand. Atop the note is a pouch of shillings held there by a small, strategically placed knife. On the opposite side of the room, is an open window with an unrealistically large crow sitting on the window frame, staring you dead in the eyes. It doesn&#39;t blink, move, or appear to be breathing at all.

You&#39;re unsure of how long it had been sitting there for. For all you know, it could&#39;ve been there for hours. It could&#39;ve also just gotten here, given what woke you up. The window frame it sits upon has been royally fucked by deep claw marks as the crow grips onto the polished wood firmly—not only is it large, but incredibly strong as well.

What do you do about the bird? Should you (color:#4169e1)[&#39;&#39;Talk to the Bird&#39;&#39;], (color:#4169e1)[&#39;&#39;Ignore the Bird&#39;&#39;] or (color:#4169e1)[&#39;&#39;Throw Knife at the Bird&#39;&#39;]?&lt;/blockquote&gt;
\You try to click the links, but it looks like the screen is frozen.

[[Continue-&gt;Computer Lab]] 
\(unless:$anomalies contains &quot;bbta&quot;)[(set:$anomalies to it + (a:&quot;bbta&quot;))]</tw-passagedata><tw-passagedata pid="113" name="Setup VR" tags="" position="1900,1950" size="100,100">(set:_a2 to (rotated-to: where it is &quot;vr headset&quot;,...$INV))
\(set:$INV to _a2&#39;s 2ndtolast)
\(if:visits is 1)[You set up your VR Headset inside your apartment, and you enter a virtual version of Webster Groves! Everything seems so realistic... it looks almost exactly like your apartment! I wonder what kind of shenanigans we can get up to in this fake VR world, Jed!]
\(else-if:visits is 2)[Hey, aren&#39;t we already inside a virtual world? How is this going to work? Are we now going to be in a virtual world in a virtual world? This is getting too confusing for me to handle. Well, let&#39;s see if this virtual world is any different than the previous one.]
\(else:)[Alright, we&#39;re (if:visits &lt; 10)[(print:(visits) of (a:&quot;one&quot;,&quot;two&quot;,&quot;three&quot;,&quot;four&quot;,&quot;five&quot;,&quot;six&quot;,&quot;seven&quot;,&quot;eight&quot;,&quot;nine&quot;))](else:)[(print:visits)] layers deep now. (either:&quot;I don&#39;t think my mind can even comprehend this.&quot;,&quot;I&#39;ve given up trying to understand what&#39;s going on at this point.&quot;,&quot;I don&#39;t even remember where you got all these VR headsets at this point.&quot;,&quot;This must be draining a lot of power.&quot;,&quot;Is there even any way to go back up a layer? How do you escape?&quot;,&quot;How are you even controlling yourself with this many layers?&quot;)

Not sure if I noticed anything different last time we added a layer. Let&#39;s see if anything changes this time around...]

[[Continue-&gt;Jed&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="114" name="Rafael VR" tags="" position="2400,2850" size="100,100">You explain to Rafael how you are both currently inside virtual reality.

&quot;Haha, yeah,&quot; he kids, &quot;//we&#39;re all living in a simulation!//&quot;

You stare back at him blankly.

&quot;Oh... you&#39;re serious?&quot;

&quot;I bought a VR headset from the electronics store, set it up, and now here I am. The real me is inside my apartment with the headset on. We&#39;re in some kind of Groundhog-Day-ish scenario.&quot;

&quot;Hmmm... I need a second to think about that.&quot;

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="115" name="Ted VR" tags="" position="2550,2850" size="100,100">(set:$visitsTed to 4)
\You explain to Ted how you are both currently inside virtual reality.

&quot;So what you&#39;re trying to say is that we are in a fake, virtual world with no consequences?&quot; Ted asks.

&quot;That&#39;s right.&quot;

Ted smirks. &quot;Alright then. Since you moved in, I knew I would never like you. You&#39;re extremely annoying and you can&#39;t take any hints.&quot; Ted then slams the door on you.

[[Continue-&gt;Ted&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="116" name="Josefine VR" tags="" position="2700,2850" size="100,100">You explain to Josefine how you are both currently inside virtual reality.

&quot;Y&#39;know, I&#39;ve thought about that idea a lot,&quot; Josefine explains, &quot;and I&#39;ve come to the conclusion that I don&#39;t care whether or not we live in a virtual reality. As long as I&#39;m having a good time, it&#39;s all good, y&#39;know?&quot;

&quot;Alrighty then, I&#39;m going to exploit this fact by committing many shenanigans.&quot;

&quot;You do you.&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="117" name="The Gang" tags="" position="6800,1950" size="100,100">(if:($visitsGang is 0) and ($storeCardQuest does not contain &quot;ask&quot;) and ($wearing is not &quot;cape&quot;))[
\(set:$visitsGang to 1)
\(if:$MONEY &gt; 0)[
\&quot;Well, well, well,&quot; you hear a voice say from further down the alley, &quot;woulda look at who we got here. It&#39;s Mista Goody-Two-Shoes!&quot; Three people then walk out of the darkness: a short person, a tall person, and a third person. &quot;Get his money.&quot;

The tall one grabs your legs and flips you upside down. Your wallet falls out of your pocket, and the third person picks your wallet up off the ground, takes the money out, and then throws it at your face.

(if:$MONEY &lt; 30)[&quot;Only $$MONEY... I was expecting more...&quot;

&quot;At least this guy had money...&quot; the short one says. &quot;If another guy comes in here without money I&#39;d... I don&#39;t even know. Oh well, we got what we needed.&quot; The tall one drops you, then the three of them walk off.]
\(else-if:$MONEY &gt;= 30 and $MONEY &lt; 80)[&quot;$$MONEY, not bad. Thanks, kiddo!&quot;

&quot;I&#39;m glad this guy had //some// money,&quot; the short one says. &quot;If another guy comes in here with no money I&#39;d... I don&#39;t even know. Oh well, we got what we needed.&quot; The tall one drops you, then the three of them walk off.]
\(else-if:$MONEY &gt;= 80 and $MONEY &lt; 131)[&quot;$$MONEY! This is probably our best haul yet, boys!&quot;

&quot;This is a nice change of pace,&quot; the short one says. &quot;I was //this// close to just flipping my lid. Alright boys, we got what we needed.&quot; The tall one drops you, then the three of them walk off.]
\(else-if:$MONEY &gt; 130)[&quot;$$MONEY!?!? What the heck were you doing carrying that much money? You ever heard of a bank? Guess we&#39;re teaching you a lesson about financial security, huh?&quot;

&quot;This is a nice change of pace,&quot; the short one says. &quot;I was //this// close to just flipping my lid. Alright boys, we got what we needed.&quot; The tall one drops you, then the three of them walk off.]

I don&#39;t want to say I told you so, but... I told you so. At least you have that backup stash of money in your cabinet. (if:$furnitureEaten contains &quot;cabinet&quot;)[Let&#39;s hope you didn&#39;t eat it when eating the cabinet this morning...]
\(set:$MONEY to 0)(set:$mugged to true)

[[Continue-&gt;West Side of Town]]]
\(else:)[
\(set:$visitsGang to 1)
\&quot;Well, well, well,&quot; you hear a voice say from further down the alley, &quot;woulda look at who we got here. It&#39;s Mista Goody-Two-Shoes!&quot; Three people then walk out of the darkness: a short person, a tall person, and a third person. &quot;Get his money.&quot;
\(set:$joinGang to true)

The tall one grabs your legs and flips you upside down. Your wallet falls out of your pocket, and the third person picks your wallet up off the ground and then throws it at your face.

&quot;Nothing!&quot;

&quot;NOTHING!?&quot; the short one yells. &quot;Oh, you&#39;re gonna get it now.&quot; He then starts walking towards you.

&quot;Wait!&quot; you yell. &quot;What if... I joined you guys?&quot;

The short one stops. Then he laughs. &quot;You? The straight-laced kid?&quot;

&quot;Yeah, everyone thinks of me as the good guy! I know my way around and into places! They&#39;ll never suspect a thing!&quot;

&quot;Hmm... y&#39;know what? There is something we&#39;ve been needin&#39; help with. Inside the hardware store is a package that we need. It&#39;s a big, navy blue, cardboard box. The clerk&#39;ll prolly be hiding it in the backroom.&quot;

&quot;I&#39;ll do it,&quot; you say. The tall person then drops you down.

&quot;Don&#39;t let me down, or else...&quot; The three of them then walk off.

That was some quick thinking, Jed! Pretending to join their gang so that you can get away was genius!

[[Continue-&gt;West Side of Town]]]]
\(else-if:$joinGang)[
\(if:$visitsGang is 1)[
\(if:$INV contains &quot;cardboard box&quot;)[(set:$visitsGang to 2)(set:$INV to it - (a:&quot;cardboard box&quot;))
\You walk back to where the gang was, holding the big cardboard box. &quot;Hello?&quot; you shout. &quot;I have that box you guys wanted.&quot;

&quot;Yes!&quot; Suddenly, the short one runs towards you, grabs the box out of your hands, and tears it open. Inside is a pirate hat and eyepatch, which he puts on. &quot;How do I look?&quot;

&quot;You look great,&quot; the tall one says. The third one nods in agreement.

&quot;Now, on to your next task. Me and the boys here have been eating nothing but bread for breakfast.&quot;

&quot;Oh, that&#39;s pretty sad...&quot;

&quot;Right? We don&#39;t have any toaster to turn that bread into toast! So, we need you to get your hands onto one. We shall dine like kings. Oh, I&#39;m so excited. Go on now!&quot;

[[Continue-&gt;West Side of Town]]]
\(else:)[You walk back to where you were the gang was, but it doesn&#39;t look like anyone is here.

[[Continue-&gt;West Side of Town]]]]
\(else-if:$visitsGang is 2)[
\(if:$INV contains &quot;toasterStolen&quot;)[(goto:&quot;Gang Ending&quot;)]
\(else:)[&quot;Do you got the goods?&quot; the short one asks.

&quot;No.&quot;

&quot;Well, what are you doing back here? Go on!&quot;

[[Continue-&gt;West Side of Town]]]]]
\(else:)[(if:$visitsGang &gt; 0 and not $joinGang)[
\You walk back to where you were mugged, but it doesn&#39;t look like anyone is here. (if:$mugged and $INV does not contain &quot;cash stash&quot;)[You should probably grab your extra stash of cash from your bedroom.]

[[Continue-&gt;West Side of Town]]]]</tw-passagedata><tw-passagedata pid="118" name="Back Room" tags="" position="4235,2137" size="100,100">You run past the clerk into the backroom. &quot;Hey!&quot; they shout, &quot;that&#39;s a restricted area! Get out of there!&quot;

Jed, are you actually helping that gang? I thought you just said that to get out of a tough scenario. I can&#39;t believe you were being serious...

Surprisingly, there doesn&#39;t seem to be much back here other than a large number of paint buckets. After a few seconds of searching, you find the cardboard box that the gang described to you. You quickly grab it and run out of the store.

&quot;You&#39;re now banned from this store! I hope that was worth it!&quot;
\(set:$banned to it + (a:&quot;hardware store&quot;))(set:$INV to it + (a:&quot;cardboard box&quot;))(if:$wearing is &quot;ski mask&quot;)[(set:$boxMask to true)]

[[Exit-&gt;Town Square]] </tw-passagedata><tw-passagedata pid="119" name="Steal Toaster" tags="" position="1500,2100" size="100,100">(set:$INV to it + (a:&quot;toasterStolen&quot;))(set:$banned to it + (a:&quot;electronics&quot;))(if:$wearing is &quot;ski mask&quot;)[(set:$toasterMask to true)]
\You pick up the toaster. It looks like a normal toaster. &quot;`$5K` is a bit much for a toaster like this, don&#39;t you think?&quot;

&quot;I assure you that that&#39;s no ordinary toaster,&quot; the clerk explains. &quot;I&#39;m sure you&#39;ll find it&#39;s well worth the price once you buy it and use it.&quot;

&quot;Do you know what price I think it&#39;s worth? Free!&quot; You then run out of the store as fast as you can.

&quot;Get back here!&quot; the clerk shouts. &quot;I&#39;m calling the cops!&quot;

After you exit the store you take a moment to inspect the toaster. It is indeed a normal toaster.

[[Continue-&gt;East Side of Town]] </tw-passagedata><tw-passagedata pid="120" name="Gang Ending" tags="" position="6800,2400" size="200,100">(unless:$ENDINGS contains &quot;Gang&quot;)[(set:$ENDINGS to it + (a:&quot;Gang&quot;))]
\(set:$JOURNAL to it + (a:&quot;Gang&quot;))
\&quot;Do you got the goods?&quot; the short one asks.

You hold up the toaster. &quot;You know it!&quot;

&quot;This is great. This is amazing. Oh my goodness. Alright guys, come here.&quot; The three gang members then circle around you. &quot;I think it&#39;s time we make this official. But first, we need to introduce ourselves.&quot;

&quot;I&#39;m Nolan,&quot; the tall person says.

&quot;I&#39;m Stan,&quot; the third person says.

&quot;And I&#39;m the leader of the group, Ma-&quot;

&quot;ARRESTED!&quot; you hear a voice yell. You all turn around to see four police officers. You start to run, but the officers quickly catch up, cuff all four of you, and take you to the holding cell.

You know Jed, you could&#39;ve gotten away from this entire scenario if you just listened to me in the hardware store. Why did you feel the need to uphold a promise you made to a criminal gang? Why didn&#39;t you, oh I don&#39;t know, //go to the police?// Well, you waited too long, and now the police have come to you.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="121" name="Clothing Explain" tags="" position="6200,2250" size="100,100">&quot;How do clothes work?&quot; you ask the clerk.

&quot;Well you see,&quot; the clerk says, &quot;when you buy clothing, you can take it home and put it in your closet, and in there you will be able to change outfits!&quot;

&quot;Ok, thank you!&quot;

&quot;Wait a minute, how&#39;d you put on clothes without knowing how clothes work?&quot;

&quot;Lucky guess.&quot;

[[Continue-&gt;Clothing Store]] </tw-passagedata><tw-passagedata pid="122" name="Buy Food" tags="" position="700,1950" size="100,100">Looking at the selection of food makes you hungry.

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS1&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;RIGHT ARM OF WACKY STEVE - $18&#39;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;WS1&quot;))(set:$MONEY to it - 18)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS1&quot;)[RIGHT ARM OF WACKY STEVE - Sold Out](else:)[[[RIGHT ARM OF WACKY STEVE - $18-&gt;Too Poor]]]]
]
\(if:$MONEY &gt;= 1)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Loaf of Bread - $1&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;bread&quot;))(set:$MONEY to it - 1)(set:$STATS&#39;s 3rd to it + 1)]](else:)[[[Loaf of Bread - $1-&gt;Too Poor]]]
(if:$MONEY &gt;= 4)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Milk - $4&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;milk&quot;))(set:$MONEY to it - 4)(set:$STATS&#39;s 3rd to it + 4)]](else:)[[[Milk - $4-&gt;Too Poor]]]
(if:$MONEY &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Pre-Made Pasta - $5&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;pasta&quot;))(set:$MONEY to it - 5)(set:$STATS&#39;s 3rd to it + 5)]](else:)[[[Pre-Made Pasta - $5-&gt;Too Poor]]]
(if:$cereal and $MONEY &gt;= 8)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;WACKY STEVE&#39;S CRAZY CEREAL (CHOCOLATE EXPLOSION) - $8&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;cereal&quot;))(set:$MONEY to it - 8)(set:$STATS&#39;s 3rd to it + 8)(set: $cereal to false)]](else:)[(if:$INV contains &quot;cereal&quot;)[WACKY STEVE&#39;S CRAZY CEREAL (CHOCOLATE EXPLOSION) - Sold Out](else:)[[[WACKY STEVE&#39;S CRAZY CEREAL (CHOCOLATE EXPLOSION) - $8-&gt;Too Poor]]]]
(if:(current-date:) contains &quot;Oct&quot;)[(if:$MONEY &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Halloween Candy - $5&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;candy&quot;))(set:$MONEY to it - 5)(set:$STATS&#39;s 3rd to it + 5)]](else:)[[[Halloween Candy - $5-&gt;Too Poor]]]](else:)[(if:$MONEY &gt;= 3)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Candy - $3&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;candy&quot;))(set:$MONEY to it - 3)(set:$STATS&#39;s 3rd to it + 3)]](else:)[[[Candy - $3-&gt;Too Poor]]]]
(if:$MONEY &gt;= 1)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Instant Ramen - $1&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;ramen&quot;))(set:$MONEY to it - 1)(set:$STATS&#39;s 3rd to it + 1)]](else:)[[[Instant Ramen - $1-&gt;Too Poor]]]
(if:$MONEY &gt;= 2)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Pre-Made Lunch Sandwich - $2&quot;,&quot;Buy Food&quot;)[(set:$INV to it + (a:&quot;sandwich&quot;))(set:$MONEY to it - 2)(set:$STATS&#39;s 3rd to it + 2)]](else:)[[[Pre-Made Lunch Sandwich - $2-&gt;Too Poor]]]

(if:$wearing is &quot;vest&quot;)[[[Break Room-&gt;Bosco Break Room]]
]
\[[Exit-&gt;East Side of Town]] </tw-passagedata><tw-passagedata pid="123" name="Eat Cereal" tags="" position="2000,3150" size="100,100">And when Jed entered the kitchen, he suddenly got struck with with a wonderful idea.

Earlier, Jed bought some Wacky Steve&#39;s Crazy Cereal at the supermarket, and what better time than now to give it a taste? Looking at the box, the packaging was very colorful with many edited-in explosions in the background. On the back of the box, there was a maze and several explosion-related jokes. Oddly enough, there were no nutrition facts on the side of the box, but Jed decided not to think anything of this.

Jed got out milk, added it to a bowl, and then poured in the cereal. Suddenly, the cereal started popping, similar to popping candy. Because of this, Jed was struck with a feeling of uncertainty. Was this something Jed really wanted to eat?

[[Eat It-&gt;Eat Cereal 2]] 
[[Back-&gt;No Cereal]]</tw-passagedata><tw-passagedata pid="124" name="Somewhere" tags="" position="7350,1850" size="100,100">Well Jed, I hope you had fun exploring-

Wait, where are you going? Jed, there is nothing over there; You have already seen everything in Bloomhurst. What do you think you are going to find? I assure you that you will find absolutely nothing of interest.

Jed, if you keep going I won&#39;t be able to follow you. I&#39;ll no longer be able to narrate your actions.

Well, if you are so determined to waste your time, then I suppose I won&#39;t stop you. I&#39;ll be waiting for your return.

(live:1s)[(if:time&gt;15s)[(font:&quot;Raleway&quot;)[
\Hey Jed! It&#39;s me. You may remember me from that little waiting room I always set up for you.

You probably have a lot of questions, so I&#39;ll start with why I&#39;m here.

The Narrator assigned me the job of keeping track of your progress through the waiting room, which is a place outside of this world. I&#39;ve had tons of free time, so I&#39;ve occasionally been tampering with the game&#39;s code in some places. One of the things I was able to achieve was allowing you to come here, all the way over to Bloomhurst.

I mostly do this for fun, but seeing as you came back, I think you are looking for something new.

It just so happens that these &quot;Passages&quot; are the closest ones to the narrator&#39;s location, so if you are interested, I can bring you there if you are still curious about this world. But if not, I can bring you back to the waiting room.

[[Continue-&gt;Workspace]]
[[The End-&gt;Waiting Room Entrance]]]]]</tw-passagedata><tw-passagedata pid="125" name="Workspace" tags="" position="7350,2000" size="100,100">(font:&quot;Raleway&quot;)[
\Alright! Also, forgot to mention, because the narrator can&#39;t follow us here, I will be narrating everything from now on.

Another thing, just for clarity, my name is GM.

//Ahem...//

GM and Jed kept walking until they reached a seemingly invisible border. You could see for miles ahead of the barrier, but are unable to go any further.

GM pulls out a strange device and presses some buttons. A large hole appears in the barrier where the two walk out of the passage.

Outside of the barrier was a seemingly infinite grid pattern, with a large gray line stretching out for miles. Looking around, you can see huge boxes scattered throughout the void.

Alright, here we are! This is the Twine &quot;Workspace.&quot; This is basically where every section of this game is located, somewhere in-between space. From here, we are able to visit any section of the game! This gray arrow right here will lead us right to the narrator.

[[Continue-&gt;Ominous Building]]]</tw-passagedata><tw-passagedata pid="126" name="Ominous Building" tags="" position="9550,1900" size="100,100">(font:&quot;Raleway&quot;)[
\After a very long walk, the two find themselves at another giant box.
GM once again presses some buttons on the device, and both enter the passage.

Inside, there appears to be a small building on a large field of grass.
The two enter the building, and are met with a staircase with a sign that says: &quot;CONNECTION POINT.&quot;

Well Jed, here we are! Just down those stairs, you will meet the narrator. Let&#39;s just hope that nothing goes wrong...

[[Continue-&gt;Narrator]]]</tw-passagedata><tw-passagedata pid="127" name="Buy Tokens" tags="" position="3877,1994" size="100,100">(set:$visitsTokens to it + 1)
\&quot;Welcome back, Jed!&quot; the arcade worker greets. &quot;(if:$visitsTokens is 1)[I haven&#39;t seen you in a while! ]How many tokens you want?&quot;

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]
Current tokens: (if:$tokens &gt; 999)[(digit-format:&quot;###,###&quot;,$tokens)](else:)[$tokens]

(if:$MONEY &gt;= 10)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;5 Tokens - $10&quot;,&quot;Buy Tokens&quot;)[(set:$tokens to it + 5)(set:$MONEY to it - 10)(set:$STATS&#39;s 3rd to it + 10)(set:$visitsTokens to it - 1)]](else:)[[[5 Tokens - $10-&gt;Too Poor]]]
(if:$MONEY &gt;= 25)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;15 Tokens - $25&quot;,&quot;Buy Tokens&quot;)[(set:$tokens to it + 15)(set:$MONEY to it - 25)(set:$STATS&#39;s 3rd to it + 25)(set:$visitsTokens to it - 1)]](else:)[[[15 Tokens - $25-&gt;Too Poor]]]
(if:$MONEY &gt;= 50)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;40 Tokens - $50&quot;,&quot;Buy Tokens&quot;)[(set:$tokens to it + 40)(set:$MONEY to it - 50)(set:$STATS&#39;s 3rd to it + 50)(set:$visitsTokens to it - 1)]](else:)[[[40 Tokens - $50-&gt;Too Poor]]]
(if:$MONEY &gt;= 80)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;100 Tokens - $80&quot;,&quot;Buy Tokens&quot;)[(set:$tokens to it + 100)(set:$MONEY to it - 80)(set:$STATS&#39;s 3rd to it + 80)(set:$visitsTokens to it - 1)]](else:)[[[100 Tokens - $80-&gt;Too Poor]]]
(if:$MONEY &gt;= 250)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;500 Tokens - $250&quot;,&quot;Buy Tokens&quot;)[(set:$tokens to it + 500)(set:$MONEY to it - 250)(set:$STATS&#39;s 3rd to it + 250)(set:$visitsTokens to it - 1)]](else:)[[[500 Tokens - $250-&gt;Too Poor]]]

[[Exit-&gt;Arcade]]</tw-passagedata><tw-passagedata pid="128" name="Arcade Games" tags="" position="3875,2275" size="100,100">(if:$wearing is &quot;cape&quot; and $citizensHelped does not contain &quot;arcade&quot;)[You enter the games area of the arcade. You see a boy playing a 2-player game by himself. &quot;Ugh, I need help to beat this!&quot; he complains.](else:)[A little fun to help relieve stress won&#39;t hurt, right? Let&#39;s just be sure not to spend too much time in here, we do have a mission to finish.]

Current tokens: (if:$tokens &gt; 999)[(digit-format:&quot;###,###&quot;,$tokens)](else:)[$tokens]
Current tickets: (if:$tickets &gt; 999)[(digit-format:&quot;###,###&quot;,$tickets)](else:)[$tickets]

(if:$FUN is 14)[
(if:$tokens &gt;= 1)[[[The Token Muncher - 1 Token-&gt;Arcade Muncher Game]]](else:)[[[The Token Muncher - 1 Token-&gt;Too Poor]]]]
\(if:$tokens &gt;= 4)[[[Brenton&#39;s Button Masher 5000 - 4 Tokens-&gt;Arcade Mashing Game]]](else:)[[[Brenton&#39;s Button Masher 5000 - 4 Tokens-&gt;Too Poor]]]
\(if:$seenSteve and (history:) does not contain &quot;Masher Tickets&quot;)[
[[Look Under Button Game-&gt;Masher Tickets]]]
(if:$tokens &gt;= 4)[[[Romeo&#39;s Recreational Fishing - 4 Tokens-&gt;Arcade Fishing Game]]](else:)[[[Romeo&#39;s Recreational Fishing - 4 Tokens-&gt;Too Poor]]]
(if:$tokens &gt;= 5)[[[The Giganto Big Wheel - 5 Tokens-&gt;Arcade Wheel Game]]](else:)[[[The Giganto Big Wheel - 5 Tokens-&gt;Too Poor]]]
\(if:$wearing is &quot;cape&quot; and $citizensHelped does not contain &quot;arcade&quot;)[
[[Help the Boy-&gt;SuperJed Arcade]]]
[[Exit-&gt;Arcade]]</tw-passagedata><tw-passagedata pid="129" name="Spend Tickets" tags="" position="3876,2139" size="100,100">&quot;Here&#39;s where you can redeem your tickets. What&#39;d you want?&quot;

Current tickets: (if:$tickets &gt; 999)[(digit-format:&quot;###,###&quot;,$tickets)](else:)[$tickets]

(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$tickets &gt;= 500)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;LEFT LEG OF WACKY STEVE - 500 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$INV to it + (a:&quot;WS3&quot;))(set:$tickets to it - 500)]](else:)[[[LEFT LEG OF WACKY STEVE - 500 Tickets-&gt;Too Poor]]]
]\
(if:$tickets &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Lollipop - 5 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$INV to it + (a:&quot;lollipop&quot;))(set:$tickets to it - 5)]](else:)[[[Lollipop - 5 Tickets-&gt;Too Poor]]]
(if:$tickets &gt;= 30)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Slinky - 30 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$INV to it + (a:&quot;slinky&quot;))(set:$tickets to it - 30)]](else:)[[[Slinky - 30 Tickets-&gt;Too Poor]]]
(if:$tickets &gt;= 50)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Slap Bracelet - 50 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$INV to it + (a:&quot;bracelet&quot;))(set:$tickets to it - 50)]](else:)[[[Slap Bracelet - 50 Tickets-&gt;Too Poor]]]
(if:$CLOSET does not contain &quot;3d glasses&quot; and $tickets &gt;= 150)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;3D Glasses - 150 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$CLOSET to it + (a:&quot;3d glasses&quot;))(set:$tickets to it - 150)]](else:)[(if:$CLOSET contains &quot;3d glasses&quot;)[3D Glasses - Owned](else:)[[[3D Glasses - 150 Tickets-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;visor&quot; and $tickets &gt;= 300)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Rainbow Visor - 300 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$CLOSET to it + (a:&quot;visor&quot;))(set:$tickets to it - 300)]](else:)[(if:$CLOSET contains &quot;visor&quot;)[Rainbow Visor - Owned](else:)[[[Rainbow Visor - 300 Tickets-&gt;Too Poor]]]]
(if:$INV does not contain &quot;nerf gun&quot; and $tickets &gt;= 750)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Foam-Dart Gun - 750 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$INV to it + (a:&quot;nerf gun&quot;))(set:$tickets to it - 750)]](else:)[(if:$INV contains &quot;nerf gun&quot;)[Foam-Dart Gun - Sold Out](else:)[[[Foam-Dart Gun - 750 Tickets-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;bomber jacket&quot; and $tickets &gt;= 1000)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Bomber Jacket - 1,000 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$CLOSET to it + (a:&quot;bomber jacket&quot;))(set:$tickets to it - 1000)]](else:)[(if:$CLOSET contains &quot;bomber jacket&quot;)[Bomber Jacket - Owned](else:)[[[Bomber Jacket - 1,000 Tickets-&gt;Too Poor]]]]
(if:$CLOSET does not contain &quot;icloak&quot; and $tickets &gt;= 2500)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;WACKY STEVE&#39;S INVISIBILITY CLOAK OF MAGICAL WONDERS - 2,500 Tickets&quot;,&quot;Spend Tickets&quot;)[(set:$CLOSET to it + (a:&quot;icloak&quot;))(set:$tickets to it - 2500)]](else:)[(if:$CLOSET contains &quot;icloak&quot;)[WACKY STEVE&#39;S INVISIBILITY CLOAK OF MAGICAL WONDERS - Owned](else:)[[[WACKY STEVE&#39;S INVISIBILITY CLOAK OF MAGICAL WONDERS - 2,500 Tickets-&gt;Too Poor]]]]
(if:$INV does not contain &quot;bear&quot; and $tickets &gt;= 2500)[[[Giant Stuffed Teddy Bear - 2,500 Tickets-&gt;Arcade Buy Bear]]](else:)[(if:$INV contains &quot;bear&quot;)[Giant Stuffed Teddy Bear - Sold Out](else:)[[[Giant Stuffed Teddy Bear - 2,500 Tickets-&gt;Too Poor]]]]

[[Exit-&gt;Arcade]]</tw-passagedata><tw-passagedata pid="130" name="Arcade Wheel Game" tags="" position="3880,2418" size="100,100">(set:$tokens to it - 5)(set:$wheelresult to (random:1,50))
\You spin the Giganto Big Wheel and...

(live:0.1s)[(if:time &lt; 5s)[(either:&quot;JACKPOT! You won 500 tickets! Congrats!&quot;,&quot;You won 200 tickets! Awesome!&quot;,&quot;You won 100 tickets! Pretty good!&quot;,&quot;You won 50 tickets! Not bad!&quot;,&quot;You won 20 tickets. Could be worse.&quot;,&quot;You won 5 tickets... ouch...&quot;)](else:)[
\(if:$wheelresult is 1)[JACKPOT! You won 500 tickets! Congrats!](if:$wheelresult &gt; 1 and $wheelresult &lt; 6)[You won 200 tickets! Awesome!](if:$wheelresult &gt; 5 and $wheelresult &lt; 16)[You won 100 tickets! Pretty good!](if:$wheelresult &gt; 15 and $wheelresult &lt; 31)[You won 50 tickets! Not bad!](if:$wheelresult &gt; 30 and $wheelresult &lt; 46)[You won 20 tickets. Could be worse.](if:$wheelresult &gt; 45)[You won 5 tickets... ouch...]

(link-reveal-goto:&quot;Continue&quot;,&quot;Arcade Games&quot;)[(if:$wheelresult is 1)[(set:$tickets to it + 500)(set:$STATS&#39;s 5th to it + 500)](if:$wheelresult &gt; 1 and $wheelresult &lt; 6)[(set:$tickets to it + 200)(set:$STATS&#39;s 5th to it + 200)](if:$wheelresult &gt; 5 and $wheelresult &lt; 16)[(set:$tickets to it + 100)(set:$STATS&#39;s 5th to it + 100)](if:$wheelresult &gt; 15 and $wheelresult &lt; 31)[(set:$tickets to it + 50)(set:$STATS&#39;s 5th to it + 50)](if:$wheelresult &gt; 30 and $wheelresult &lt; 46)[(set:$tickets to it + 20)(set:$STATS&#39;s 5th to it + 20)](if:$wheelresult &gt; 45)[(set:$tickets to it + 5)(set:$STATS&#39;s 5th to it + 5)]](stop:)]]</tw-passagedata><tw-passagedata pid="131" name="Arcade Fishing Game" tags="" position="3883,2560" size="100,100">(set:$tokens to it - 4)
\Alright Jed, pay attention, you have to reel in the fish at the right time.(set:$isFish to false)

|fish&gt;[(live:0.5s)[(if:(random:1,20) is 1)[(set:$isFish to true)DO IT, JED! DO IT NOW!](else:)[(set:$isFish to false)Keep waiting...]]

(link:&quot;Reel In&quot;)[(replace:?fish)[
\(if:$isFish)[(if:(random:1,15) is 2)[Congratulations! You reeled in a giant fish and got 300 tickets!(set:$tickets to it + 300)(set:$STATS&#39;s 5th to it + 300)](else:)[Congrats! You got the fish and got 150 tickets!(set:$tickets to it + 150)(set:$STATS&#39;s 5th to it + 150)]](else:)[Sorry, Jed. You didn&#39;t reel in at the correct time. You only get 5 tickets...(set:$tickets to it + 5)(set:$STATS&#39;s 5th to it + 5)]

[[Continue-&gt;Arcade Games]]]]]</tw-passagedata><tw-passagedata pid="132" name="Arcade Buy Bear" tags="" position="4038,2133" size="100,100">(set:$INV to it + (a:&quot;bear&quot;))(set:$tickets to it - 2500)
\&quot;Here you go, Jed!&quot; the arcade worker says. &quot;The giant bear! Good job getting enough tickets!&quot; They hand you the bear. &quot;I don&#39;t know what you plan on doing this with, but I&#39;m sure anyone you gave this to would instantly become your best friend!&quot;

[[Continue-&gt;Spend Tickets]] </tw-passagedata><tw-passagedata pid="133" name="Rafael Bear" tags="" position="2400,2550" size="100,100">You show Rafael the bear you won at the arcade.

&quot;Wow,&quot; he gasps, &quot;that&#39;s huge.&quot;

&quot;Yeah, it cost me 2,500 tickets. Did you want it?&quot;

&quot;Hmmm, I appreciate the offer but I don&#39;t really have anywhere to put it. Thank you, though!&quot;

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="134" name="Ted Bear" tags="" position="2550,2550" size="100,100">You show Ted the bear you won at the arcade.
\(set:$INV to it - (a:&quot;bear&quot;))(set:$CLOSET to it + (a:&quot;vest&quot;))(set:$sidequests to it + (a:&quot;Ted&quot;))

&quot;Good for you,&quot; Ted grunts. He then turns and starts walking back into his apartment.

&quot;It cost me 2,500 tickets. Did you want it?&quot;

He stops, then turns his head back to you. &quot;You serious?&quot;

&quot;Of course!&quot;

&quot;Oh, well... thanks, kid. My niece will love this. Her birthday is coming up, so this will be a nice addition. That reminds me, I was doing some cleaning the other day, and I found this vest. It&#39;s too small for me now, but I&#39;m sure it will fit you.(if:$CLOSET&#39;s length &gt; 4)[ I know you like your outfits.]&quot;

You take a closer look at the vest Ted gave you. It looks exactly like the purple vests that the employees at Bosco&#39;s Family Food Store wear.

[[Continue-&gt;Ted&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="135" name="Josefine Bear" tags="" position="2700,2550" size="100,100">You show Josefine the bear you won at the arcade.

&quot;Oh my gosh!&quot; she exclaims, &quot;It&#39;s so cute!&quot;

&quot;Yeah, it cost me 2,500 tickets. Did you want it?&quot;

&quot;My girlfriend has been wanting something like that but... I don&#39;t want to take yours! I&#39;ll just go to the arcade and get my own! I&#39;ve been meaning to go back there someday, so here&#39;s a good excuse. But thank you for offering!&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="136" name="Arcade Mashing Game" tags="" position="4043,2413" size="100,100">(set:$tokens to it - 4)
\When the timer starts, you&#39;ll have 5 seconds to mash the button as much as you can.
\(set:$clicks to 0)
\(live:5s)[(if:time&gt;1s and time&lt;6s)[

(link-repeat:&quot;MASH HERE&quot;)[(set:$clicks to it + 1)]](if:time&gt;6s)[(stop:)

&#39;&#39;MASH HERE&#39;&#39;

Time&#39;s up! You won (print:$clicks * 5) tickets!
\(set:$tickets to it + ($clicks * 5))(set:$STATS&#39;s 5th to it + ($clicks * 5))

(if:$clicks is 0 and (history:) does not contain &quot;Trailer Secret&quot; and $INV contains all of (a:&quot;ramen&quot;,&quot;coffee&quot;,&quot;fries&quot;,&quot;slinky&quot;))[[[Continue-&gt;Trailer Secret]]](else:)[[[Continue-&gt;Arcade Games]]]]]</tw-passagedata><tw-passagedata pid="137" name="Rafael Outfit" tags="" position="2400,2700" size="100,100">You ask Rafael how he likes your outfit.

&quot;(if:$wearing is &quot;3d glasses&quot;)[
\I think the 3D glasses add a very subtle but unique touch. Plus, you get to see stuff in 3D! Bonus!](if:$wearing is &quot;bomber jacket&quot;)[
\Wow, that jacket is a throwback. I kind of like it, though!](if:$wearing is &quot;hat&quot;)[
\Wow. That is... a hat. A very... interesting hat.](if:$wearing is &quot;hoodie&quot;)[
\What&#39;s the logo on the front supposed to mean?&quot;

&quot;Don&#39;t think about it too much.](if:$wearing is &quot;plumber outfit&quot;)[
\No offense, but you look like you&#39;re gonna come in here and fix my toilet.&quot;

&quot;That&#39;s the point! I&#39;m going to sneak into city hall, pretending to be a plumber, and then stop the mayor&#39;s evil plan!&quot;

&quot;Okay then.](if:$wearing is &quot;vest&quot;)[
\Did you get a job at Bosco&#39;s?&quot;

&quot;No, I just got this vest from Ted that somehow looks almost identical to theirs.&quot;

&quot;From Ted? Interesting.](if:$wearing is &quot;visor&quot;)[
\Don&#39;t know if I&#39;d really call that an outfit. I like those glasses, though.](if:$wearing is &quot;ski mask&quot;)[
\Are you about to go rob a store?(if:$joinGang)[&quot;

&quot;Yes, actually!&quot;

&quot;Haha, good one Jed!]](if:$wearing is &quot;cape&quot;)[
\Wow, that cape looks awesome! You&#39;re a real superhero now! SuperJed!](if:$wearing is &quot;ghost&quot;)[
\(cond:(current-date:) contains &quot;Oct 31&quot;,&quot;Classic. Can&#39;t go wrong with a good ghost costume. Here, have some candy!&quot;,&quot;Ooh spooky! You look like you&#39;re going to haunt me!&quot;)]&quot;

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="138" name="Bosco Break Room" tags="" position="700,2100" size="100,100">(set:$visitsBreakRoom to it + 1)
\(if:$visitsBreakRoom is 1)[
\Jed enters the supermarket&#39;s breakroom. With the purple vest he was wearing, no one questioned him when he walked into the employee-only area.

&quot;Hello fellow Bosco employees,&quot; he said to the people in the breakroom. &quot;It is I, fellow cashier! Wow, I sure am ready to work and help the customers!&quot;

&quot;No way,&quot; one of the employees said. &quot;He actually hired you?&quot;

&quot;What do you mean?&quot; Jed asked, confused.

&quot;You&#39;re infamous around here. For whatever reason, the owner here absolutely //hates// you. But uh, you didn&#39;t hear that from me.&quot; 

&quot;I wouldn&#39;t say //hate//,&quot; the other worker says, &quot;it&#39;s more like a &#39;dislike&#39; kind of thing.&quot;

&quot;Well then,&quot; Jed says to himself, &quot;I might be able to &#39;thank&#39; John for giving me this job.&quot;]
\(else:)[(if:$boscoMayhem&#39;s length &lt; 2)[You&#39;re back in the employee breakroom. No one has found you out so far...](else:)[You&#39;re back in the employee breakroom. Maybe John will calm down after hiding for a bit?]]

[[Enter the Store-&gt;Supermarket Mayhem]]
[[Exit-&gt;Bosco&#39;s Family Food Store]] </tw-passagedata><tw-passagedata pid="139" name="Ted Outfit" tags="" position="2550,2700" size="100,100">You ask Ted how he likes your outfit.

&quot;(if:$wearing is &quot;3d glasses&quot;)[
\Your outfit just looks like your normal one except with 3D glasses. Is this what modern fashion is?](if:$wearing is &quot;bomber jacket&quot;)[
\I think I have that exact jacket in my closet. Only difference is that it&#39;s 30 years old.](if:$wearing is &quot;hat&quot;)[
\My thoughts on this hat depend on how honest you want me to be.](if:$wearing is &quot;hoodie&quot;)[
\Isn&#39;t that just a normal hoodie?](if:$wearing is &quot;plumber outfit&quot;)[
\What&#39;s with the get up?&quot;

&quot;I&#39;m going to infiltrate City Hall and stop the mayor&#39;s evil plans!&quot;

&quot;Glen Dixon? I never liked that guy. We went to high school together, he was a jerk. Have fun.](if:$wearing is &quot;vest&quot;)[
\Hey, that doesn&#39;t look too bad on ya. &#39;Course I wore it better back when I had it.](if:$wearing is &quot;visor&quot;)[
\&quot;Outfit? That&#39;s just a pair of sunglasses.&quot;](if:$wearing is &quot;ski mask&quot;)[
\You&#39;re pretending to be a robber now?&quot;

&quot;Sure(cond:$joinGang,&quot;...&quot;,&quot;!&quot;)&quot;](if:$wearing is &quot;cape&quot;)[
\What&#39;s this?&quot;

&quot;I&#39;m SuperJed!&quot;

&quot;Hmmm.](if:$wearing is &quot;ghost&quot;)[
\(cond:(current-date:) contains &quot;Oct 31&quot;,&quot;Oh what the heck, it&#39;s Halloween. Here, take a lollipop and get out, ya rascal.&quot;,&quot;It&#39;s not Halloween, kid. I&#39;m sure you have enough money to just go buy some candy.&quot;)]&quot;

[[Continue-&gt;Ted&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="140" name="Josefine Outfit" tags="" position="2700,2700" size="100,100">You ask Josefine how she likes your outfit.

&quot;(if:$wearing is &quot;3d glasses&quot;)[
\Can you see the world in 3D now?&quot;

&quot;Yeah, everything looks so realistic now...](if:$wearing is &quot;bomber jacket&quot;)[
\Is that the jacket they have at the arcade?&quot;

&quot;Yup! It&#39;s only 1000 tickets, I expected it to be more.&quot;

(if:(history:) contains &quot;Josefine Bear&quot;)[&quot;Stop giving me good reasons to go back to the arcade!](else:)[&quot;Might have to go back to that arcade some day...]](if:$wearing is &quot;hat&quot;)[
\Jed, how do you still own that hat?](if:$wearing is &quot;hoodie&quot;)[
\Hey, I bet you could make a character based on that hoodie!](if:$wearing is &quot;plumber outfit&quot;)[
\What are you wearing all that for?&quot;

&quot;Oh, it&#39;s simple. I&#39;m going to sneak into city hall disguised as a plumber and defeat the mayor!&quot;

&quot;Oh, good luck with that.](if:$wearing is &quot;vest&quot;)[
\Do you have a job at Bosco&#39;s now?&quot;

&quot;No, I just got this cool vest from Ted.&quot;

&quot;I bet you could sneak in if you&#39;re confident enough about it!~](if:$wearing is &quot;ski mask&quot;)[
\Why are you hiding your face?&quot;

&quot;No reason...](if:$wearing is &quot;cape&quot;)[
\Could it be... I haven&#39;t seen you in a //long// time...&quot;

&quot;That&#39;s right! SuperJed to the rescue!](if:$wearing is &quot;ghost&quot;)[
\(cond:(current-date:) contains &quot;Oct 31&quot;,&quot;That&#39;s a pretty budget costume, Jed. I expected more from you. Have some candy, but you better have a better costume next year.&quot;,&quot;What is this, your Halloween costume? C&#39;mon Jed, you can do better. You&#39;ve got time, haha!&quot;)]&quot;

[[Continue-&gt;Josefine&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="141" name="Narrator" tags="" position="9700,1850" size="200,200">(set: $visitsNarrator to it + 1)
\(if:$visitsNarrator is 1)[
\(font:&quot;Raleway&quot;)[Jed and GM walked down the stairs, and they found themselves in a giant room. At the end of the room is a huge monitor, where there appears to be someone typing on a computer keyboard.

As you begin to walk closer, the person looks up.]

Wait... Jed? Is that you? How in the world did you get here? You aren&#39;t supposed to be here. Hold on, Game Master? You too? What are you doing?

(font:&quot;Raleway&quot;)[We just wanted to ask...]]
\(else:)[Is there anything else?](font:&quot;Raleway&quot;)[

(unless:$askedNarrator contains &quot;endings&quot;)[[[Why alternate endings?-&gt;Narrator Endings]]
]
\(unless:$askedNarrator contains &quot;waitingroom&quot;)[[[What is the waiting room for?-&gt;Narrator Waiting Room]]
]
\(unless:$askedNarrator contains &quot;narratorroom&quot;)[[[What is this place?-&gt;Narrator Room]]
]
\(if:$askedNarrator contains all of (a:&quot;endings&quot;,&quot;waitingroom&quot;,&quot;narratorroom&quot;))[[[That&#39;s all.-&gt;The End]]]]</tw-passagedata><tw-passagedata pid="142" name="Narrator Endings" tags="" position="9950,1750" size="100,100">(font:&quot;Raleway&quot;)[Why did you include alternate choices if you want Jed to stay on the regular path?]
\(set:$askedNarrator to it + (a:&quot;endings&quot;))

Basically, I just wanted Webster Groves to feel more &quot;alive,&quot; so I decided to add plenty of buildings and such. However, it seems I got too carried away. And by the time I realized, it was too late to make any major changes.

(font:&quot;Raleway&quot;)[[[Back-&gt;Narrator]]]</tw-passagedata><tw-passagedata pid="143" name="Narrator Waiting Room" tags="" position="9950,1900" size="100,100">(set:$askedNarrator to it + (a:&quot;waitingroom&quot;))
\(font:&quot;Raleway&quot;)[Why did you keep me in the waiting room? It was starting to get really boring just waiting there...]

I made the waiting room so someone could manage the menus, and make sure that nothing goes wrong. Speaking of, how did you two even get here, or even to Bloomhurst? I completely separated it from the rest of the game.

(font:&quot;Raleway&quot;)[Not sure. Everything seemed fine to me.]

How strange...

(font:&quot;Raleway&quot;)[[[Back-&gt;Narrator]]]</tw-passagedata><tw-passagedata pid="144" name="Narrator Room" tags="" position="9950,2050" size="100,100">(set:$askedNarrator to it + (a:&quot;narratorroom&quot;))
\(font:&quot;Raleway&quot;)[What even is this place? What are these monitors for? And where are you?]

This place is how I communicate with this world; the place that allows me to make changes and narrate Jed&#39;s actions. I&#39;m not here physically, I&#39;m in &quot;another world&quot; you could say.

(font:&quot;Raleway&quot;)[[[Back-&gt;Narrator]]]</tw-passagedata><tw-passagedata pid="145" name="The End" tags="" position="9700,2100" size="200,100">(font:&quot;Raleway&quot;)[That&#39;s everything!]

Alright, then. If you two are done, I&#39;ll teleport you back to the start. Game Master, if you can, please make sure that this doesn&#39;t happen again.
\(unless:$ENDINGS contains &quot;Narrator&quot;)[(set:$ENDINGS to it + (a:&quot;Narrator&quot;))]
\(set:$JOURNAL to it + (a:&quot;Narrator&quot;))

[[The End-&gt;Waiting Room Entrance]]</tw-passagedata><tw-passagedata pid="146" name="SuperJed Library" tags="" position="1250,2250" size="100,100">(set:$citizensHelped to it + (a:&quot;library&quot;))(set:$lastLocation to &quot;library&quot;)
\&quot;I&#39;ll help you!&quot; you shout to the woman. You run over to her. &quot;SuperJed to the rescue!&quot; 

&quot;Uhh, okay. I just wanted to know which of these two cookbooks I should get.&quot;

&quot;Well, that all depends on what materials you have available. I&#39;ve found that this book has a lot of budget recipes and good spins on common recipes. However, if you&#39;ve got the money to spend and also more time on your hands, then this book will be better suited for your needs.&quot;

&quot;Wow, thanks, Mr. uhh, SuperJed!&quot;

&quot;Just doin&#39; my job. SuperJed out!&quot;

(if:$citizensHelped&#39;s length is 3)[[[Continue-&gt;SuperJed Ending]]](else:)[[[Continue-&gt;Bookshelves]]]</tw-passagedata><tw-passagedata pid="147" name="Haircut" tags="" position="5900,1950" size="100,100">(unless:$haircuts is 3)[&quot;You want another haircut?&quot; the barber asks. &quot;I just gave you one(if:$haircuts is 0)[ a few days ago]! It&#39;s $20 if you really want one.&quot;

(unless:$MONEY &lt; 20)[|haircut&gt;[Current funds: $$MONEY

(link:&#39;&quot;Yes&quot;&#39;)[(replace:?haircut)[
\(set:$haircuts to it + 1)(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)(set:$STATS&#39;s 10th to it + 1)
\(if:$haircuts is 1)[&quot;Yes.&quot;

The barber gives you an all-around trim. You usually have your hair relatively short, so it just became even shorter.]
\(if:$haircuts is 2)[&quot;Yes.&quot;

The barber has a hard time giving you a decent-looking haircut with how short your hair is. He basically makes it as short as possible without making it look like you have hair loss.]
\(if:$haircuts is 3)[&quot;Yes.&quot;

&quot;Your hair is so short, the only haircut I could even give you is to just shave it all off. Do you really want me to do that?&quot;

&quot;Go ahead.&quot;

The barber then shaves all your hair off. You are now bald.]

[[Continue-&gt;Barber Shop]]]]
[[&quot;No&quot;-&gt;Barber Shop]]]]
\(else:)[&quot;Oops, I don&#39;t have enough money.&quot;

[[Continue-&gt;Barber Shop]]]]
\(else:)[&quot;Jed, I can&#39;t give you a haircut. You&#39;re bald.&quot;

[[Continue-&gt;Barber Shop]]]</tw-passagedata><tw-passagedata pid="148" name="SuperJed Barber" tags="" position="5900,2100" size="100,100">(set:$citizensHelped to it + (a:&quot;barber&quot;))(set:$lastLocation to &quot;barber shop&quot;)
\&quot;I&#39;ll help you!&quot; you shout to the man. You run over to him. &quot;SuperJed to the rescue!&quot;

&quot;Finally,&quot; the man says. &quot;I&#39;ve been waiting all day. I&#39;d just like to trim my beard a bit. It&#39;s gotten a bit too rowdy.&quot;

Jed has never been a barber. He shaves every morning, so he had absolutely no experience in trimming facial hair. Despite this, Jed begins trimming this man&#39;s beard, and he does... a surprisingly decent job. Of course, it&#39;s not the greatest or best beard trimming ever, but at least you didn&#39;t shave his beard off accidentally. The man thanks you, pays for his trim, and then leaves.

What, were you expecting something more standoffish? It was his first time trimming, give him a break.

(if:$citizensHelped&#39;s length is 3)[[[Continue-&gt;SuperJed Ending]]](else:)[[[Continue-&gt;Barber Shop]]]</tw-passagedata><tw-passagedata pid="149" name="SuperJed Ending" tags="" position="4500,2500" size="200,100">(if:$ticketPowers is &quot;yes&quot;)[
\While you leave, a person comes running into the $lastLocation. &quot;SuperJed!&quot; they shout. &quot;We need your help!&quot;

You follow them outside to see that the sky has turned a dark red, and buildings are being destroyed throughout town. &quot;You have to help us SuperJed!&quot; someone says to you.

You look up into the sky and see what you believe to be an alien spaceship, shooting down at buildings around town. &quot;Hey you,&quot; you yell up to the sky, &quot;stop messing with our town!&quot;

You then fly up to the spaceship and uppercut it so hard, it spins off up into the sky. You see two more spaceships, which you blast to pieces using your laser vision. Everyone claps and cheers for you!

&quot;Thank you, SuperJed! You&#39;re our hero!&quot;

[[Continue-&gt;Jed Woke Up]]]
\(else:)[
\(unless:$ENDINGS contains &quot;SuperJed&quot;)[(set:$ENDINGS to it + (a:&quot;SuperJed&quot;))]
\(set:$JOURNAL to it + (a:&quot;SuperJed&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\While you leave, a person comes running into the $lastLocation. &quot;SuperJed!&quot; they shout. &quot;We need your help!&quot;

You follow them outside to see that the sky has turned a dark red, and buildings are being destroyed throughout town. &quot;You have to help us SuperJed!&quot; someone says to you.

You look up into the sky and see what you believe to be an alien spaceship, shooting down at buildings around town. &quot;Hey you,&quot; you yell up to the sky, &quot;stop messing with our town or I&#39;ll destroy you!&quot;

The $lastLocation then explodes.

People start running. No one seems to come to Jed for help anymore. As Jed may not have known, he actually did have an opportunity to stop this alien invasion. In fact, said opportunity was given to him in the mail not too long ago but has now since passed. But of course, he had to //pretend// to be a hero instead of being a real one.

It looks like you bit off more than you can chew. (if:$FUN is 6)[I warned you about this cape. I can&#39;t believe you let it get to your head.]

[[The End-&gt;Waiting Room Entrance]]]</tw-passagedata><tw-passagedata pid="150" name="SuperJed Arcade" tags="" position="4045,2281" size="100,100">(set:$citizensHelped to it + (a:&quot;arcade&quot;))(set:$lastLocation to &quot;arcade&quot;)
\&quot;I&#39;ll help you!&quot; you shout to the boy. You run over to him. &quot;SuperJed to the rescue!&quot; 

&quot;Wow, a real superhero! Okay, here you go!&quot; The boy then inserts tokens into the Player 2 slot for you. &quot;Let&#39;s go!&quot;

The two of you then play the game as best you can. Level after level, enemy after enemy, the two of you are unstoppable. (if:$INV contains &quot;buster&quot;)[Buster even came in and helped push some buttons for the both of you when needed. ]It was only a matter of time before you made it to the boss and defeated it. The two of you get one of the high scores! The boy puts (if:$INV contains &quot;buster&quot;)[GJB](else:)[G&amp;J] as the name.

&quot;Thanks, SuperJed! You&#39;re really good at arcade games. Here, you can have half the tickets!&quot; He then hands you 250 tickets.
\(set:$tickets to it + 250)(set:$STATS&#39;s 5th to it + 250)

(if:$citizensHelped&#39;s length is 3)[[[Continue-&gt;SuperJed Ending]]](else:)[[[Continue-&gt;Arcade Games]]]</tw-passagedata><tw-passagedata pid="151" name="Arcade Muncher Game" tags="" position="3875,2825" size="100,100">(set:$tokens to it - 1)(set:$visitsTokenMuncher to it + 1)
\You insert a token into the Token Muncher. 
\(if:$visitsTokenMuncher &lt;= 3)[It only gives you 5 tickets.(set:$tickets to it + 5)(set:$STATS&#39;s 5th to it + 5)]
\(if:$visitsTokenMuncher is 4)[This time it gives you 10 tickets.(set:$tickets to it + 10)(set:$STATS&#39;s 5th to it + 10)]
\(if:$visitsTokenMuncher is 5)[It then gives you 20 tickets. Why is it giving more tickets all of the sudden?(set:$tickets to it + 20)(set:$STATS&#39;s 5th to it + 20)]
\(if:$visitsTokenMuncher is 6)[It then gives you 40 tickets. Is it going to keep ramping it up like this?(set:$tickets to it + 40)(set:$STATS&#39;s 5th to it + 40)]
\(if:$visitsTokenMuncher is 7)[It then gives you 80 tickets. Keep going, Jed! You&#39;re going to get a lot more soon!(set:$tickets to it + 80)(set:$STATS&#39;s 5th to it + 80)]
\(if:$visitsTokenMuncher is 8)[It then gives you 160 tickets. Let&#39;s hope this machine doesn&#39;t break!(set:$tickets to it + 160)(set:$STATS&#39;s 5th to it + 160)]
\(if:$visitsTokenMuncher is 9)[The machine gives you 320 tickets. Uh oh, I might&#39;ve jinxed us, I think it&#39;s starting to shake.(set:$tickets to it + 320)(set:$STATS&#39;s 5th to it + 320)]
\(if:$visitsTokenMuncher is 10)[It then gives you 640 tickets. It&#39;s starting to shake more.(set:$tickets to it + 640)(set:$STATS&#39;s 5th to it + 640)]
\(if:$visitsTokenMuncher is 11)[The machine gives you 1,280 tickets. It starts shaking even more.(set:$tickets to it + 1280)(set:$STATS&#39;s 5th to it + 1280)]
\(if:$visitsTokenMuncher is 12)[The machine gives you 2,520 tickets, and then promptly sets on fire. After a few seconds, the fire is out but the machine is permanently damaged.(set:$tickets to it + 2520)(set:$STATS&#39;s 5th to it + 2520)]
\(if:$visitsTokenMuncher &gt; 12)[(set:$tokens to it + 1)The machine has blown up. Putting a token inside of it would not be the brightest idea.]

[[Continue-&gt;Arcade Games]] 
\(unless:$anomalies contains &quot;token muncher&quot;)[(set:$anomalies to it + (a:&quot;token muncher&quot;))]</tw-passagedata><tw-passagedata pid="152" name="Supermarket Mayhem" tags="" position="700,2250" size="100,100">You&#39;re inside the main area of Bosco&#39;s Family Food Store. (if:$boscoMayhem&#39;s length &lt; 2)[You don&#39;t see John Bosco around anywhere...](if:$boscoMayhem&#39;s length is 2)[John Bosco has spotted you and you can hear him walking towards you.]

[[Shop-&gt;Buy Food]] 
[[Break Room-&gt;Bosco Break Room]] 
(if:$boscoMayhem does not contain &quot;samples&quot;)[[[Take Free Samples-&gt;Free Samples]]
]
\(if:$boscoMayhem does not contain &quot;display&quot;)[[[Knock Down a Display-&gt;Knock Down Display]]
]
\(if:$boscoMayhem does not contain &quot;soda&quot;)[[[Drink Some Soda-&gt;Drink Soda]]
]
\[[Exit-&gt;East Side of Town]] </tw-passagedata><tw-passagedata pid="153" name="Free Samples" tags="" position="700,2400" size="100,100">(set:$boscoMayhem to it + (a:&quot;samples&quot;))
\You walk up to the free samples table in the deli and eat one. Then you eat another. And another. Before you know it, you&#39;ve shoved all the free samples in your mouth like some kind of human squirrel. (if:$boscoMayhem&#39;s length is 1)[It doesn&#39;t look like anyone saw you do that.

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 2)[Uh oh, Jed. I think someone saw you this time. And that someone is none other than John Bosco.

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 3)[As you turn around. You see John Bosco standing right in front of you. &quot;Funny that you wear that vest, cause I don&#39;t remember hiring you at all.&quot;

&quot;Well luckily for you, I wouldn&#39;t want to work for you anyway.&quot;

&quot;Luckily for me, you&#39;ve given me good enough reason to do something I&#39;ve wanted to do for a long time. You&#39;re now &#39;&#39;banned&#39;&#39; from my store.&quot;

&quot;Wait, where am I supposed to get my groceries now?&quot;

John doesn&#39;t respond but instead points at the front door. You slowly shuffle your way out of the store.

[[Continue-&gt;Supermarket Ending]]]</tw-passagedata><tw-passagedata pid="154" name="Knock Down Display" tags="" position="850,2400" size="100,100">(set:$boscoMayhem to it + (a:&quot;display&quot;))
\You walk up to a display of cereal boxes. It&#39;s none other than WACKY STEVE&#39;S CEREAL. Except... it&#39;s the healthy version! Oh, what a disgrace! WACKY STEVE CEREAL was never meant to be healthy! You kick the display, knocking it down  and causing a giant mess. (if:$boscoMayhem&#39;s length is 1)[It doesn&#39;t look like anyone saw you do that.

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 2)[Uh oh, Jed. I think someone saw you this time. And that someone is none other than John Bosco.

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 3)[As you turn around. You see John Bosco standing right in front of you. &quot;Funny that you wear that vest, cause I don&#39;t remember hiring you at all.&quot;

&quot;Well luckily for you, I wouldn&#39;t want to work for you anyway.&quot;

&quot;Luckily for me, you&#39;ve given me good enough reason to do something I&#39;ve wanted to do for a long time. You&#39;re now &#39;&#39;banned&#39;&#39; from my store.&quot;

&quot;Wait, where am I supposed to get my groceries now?&quot;

John doesn&#39;t respond but instead points at the front door. You slowly shuffle your way out of the store.

[[Continue-&gt;Supermarket Ending]]]</tw-passagedata><tw-passagedata pid="155" name="Drink Soda" tags="" position="850,2250" size="100,100">(set:$boscoMayhem to it + (a:&quot;soda&quot;))
\You walk up to the vending machine and start shaking it. It makes a large amount of noise. After a few seconds, a can falls out. You open it to drink it, but due to how shaken up it is it sprays you in the face. You reactively drop the can on the ground. (if:$boscoMayhem&#39;s length is 1)[It doesn&#39;t look like anyone saw you do that (but they definitely heard it.)

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 2)[Uh oh, Jed. I think someone saw you this time. And that someone is none other than John Bosco.

[[Continue-&gt;Supermarket Mayhem]]](if:$boscoMayhem&#39;s length is 3)[As you turn around. You see John Bosco standing right in front of you. &quot;Funny that you wear that vest, cause I don&#39;t remember hiring you at all.&quot;

&quot;Well luckily for you, I wouldn&#39;t want to work for you anyway.&quot;

&quot;Luckily for me, you&#39;ve given me good enough reason to do something I&#39;ve wanted to do for a long time. You&#39;re now &#39;&#39;banned&#39;&#39; from my store.&quot;

&quot;Wait, where am I supposed to get my groceries now?&quot;

John doesn&#39;t respond but instead points at the front door. You slowly shuffle your way out of the store.

[[Continue-&gt;Supermarket Ending]]]</tw-passagedata><tw-passagedata pid="156" name="Title Screen 2" tags="" position="5500,2450" size="200,100">===&gt;&lt;===
&lt;img id=&quot;waitingroom&quot; src=&quot;https://i.imgur.com/pbg85sl.png&quot;&gt;
By Blue Cat and Green Guy

\(set: $sequel to false)
\(set: $toilets to (a:))
\(set: $testing to &quot;NA&quot;)
\(set: $INV to (a:))
\(set: $visitPlumber to false)
\(set: $justSoldTicket to false)
\(set: $visitedBL to (a:))
\(set: $previousPassage to &quot;&quot;)
\(set: $toiletEnding to false)
\(set: $joinGang to false)
\(set: $banned to (a:))
\(set: $wearing to &quot;none&quot;)
\(set: $hatgone to false)
\(set: $boxMask to false)
\(set: $toasterMask to false)
\(set: $tokens to 0)
\(set: $askedNarrator to (a:))
\(set: $citizensHelped to (a:))
\(set: $haircuts to 0)
\(set: $boscoMayhem to (a:)) 
\(set: $sequelProgress to (a:))
\(set: $SKILLS to (a:))
\(set: $skillPoints to 6)
\(set: $nextFun to 0)
\(set: $visitFlush2 to false)
\(set: $visitMaintenance2 to false)
\
\(if:$visitsJedsToilet is 8 or $visitsJedsToilet is 11)[(set: $visitsJedsToilet to 9)](else:)[(set: $visitsJedsToilet to 0)]
\(set: $visitsCoffeeMaker to 0)
\(set: $visitsRafael to 0)
\(set: $visitsTrainStation to 0)
\(set: $visitsCityHall to 0)
\(set: $visitsBurgerocity to 0)
\(set: $visitsSecretary to 0)
\(set: $visitsJosefine to 0)
\(set: $visitsCloset to 0)
\(set: $visitsTed to 0)
\(set: $visitsPaint to 0)
\(set: $visitsBL to 0)
\(set: $visitsMegaToilet to 0)
\(set: $visitsGang to 0)
\(set: $visitsTokens to 0)
\(set: $visitsBreakRoom to 0)
\(set: $visitsTokenMuncher to 0)


[[Start-&gt;Begin2]]
[[About-&gt;About2]]
[[Exit-&gt;Exit2]]</tw-passagedata><tw-passagedata pid="157" name="Begin2" tags="" position="5400,2600" size="100,100">(font:&quot;Roboto Mono&quot;)[
\Good [INSERT TIME OF DAY]. If you are receiving this message, that means you have been randomly selected to participate in Mayor Mystery&#39;s AB Testing program. We have developed a new version of the game based on player feedback. Currently, only the normal route is available in this version. Once you finish your playthrough, there will be a link to a survey at the end where you can input your thoughts about this new version.

Whenever you are ready to begin, click the link below.]

[[Begin-&gt;Start3]]</tw-passagedata><tw-passagedata pid="158" name="About2" tags="" position="5550,2600" size="100,100">=&gt;&lt;=
Written and Developed by Harrison Buffington and Delaney Stroud. 
Mayor Mystery Written and Developed by Blue Cat Productions and Green Guy.

New Graphic Design by Ettie Rupp.
Original Illustrations by Wiz.

Mayor Mystery for the Beepbox Discord Text Adventure Event.

Special thanks to
Jacob, Quirb, Theep, Thurm

[[Continue-&gt;Title Screen 2]] </tw-passagedata><tw-passagedata pid="159" name="Exit2" tags="" position="5700,2600" size="100,100">(font:&quot;Raleway&quot;)[
\Woah woah woah, hey! Don&#39;t close the game! Do you know how many people get selected to test the sequel? Yeah, that&#39;s right, a very small number of people, that&#39;s who! I mean, isn&#39;t this just beautiful? It&#39;s red now. That&#39;s awesome. You should totally play this.]

[[Continue-&gt;Title Screen 2]] </tw-passagedata><tw-passagedata pid="160" name="Start3" tags="" position="5400,2750" size="100,100">Let&#39;s begin, shall we?

#You are Jed Winchester.
The Jeddest of all Winchesters. The most Jed out of all of us. A million times Jed Winchester. One of the people of all time.

You&#39;re well known around Webster Groves for being Jed Winchester and Jedding all over the place. At this point, you&#39;ve established quite the Jedputation, something that you take great pride in.

[[Begin-&gt;START 2]]</tw-passagedata><tw-passagedata pid="161" name="START 2" tags="" position="5550,2750" size="200,100">(font:&quot;Roboto Mono&quot;)[Due to various complaints made by players, we have decided to remove the testing feature, despite the narrator&#39;s feelings. Your regularly scheduled story will begin now.]
\(set:$MONEY to 999)

Jed woke up from his bed feeling Jedder than ever. Jed hopped out of bed and went on to get ready for the day. As Jed was drinking his Jed Coffee™, he noticed the news story on his TV.

&quot;Good morning Webster Groves,&quot; the reporter said. &quot;It looks like the West Side burger place Burgerocity can no longer Burgerocity. When asked why this was happening, the place&#39;s owner simply said that the reason was Burgerocital.&quot;

This came as quite the surprise to Jed. Jed was just there last night, and the place was Burgerociting just fine, why was it being shut down? Jed wanted to go investigate. Jed walked out of his apartment and went to check his mail on the way. When Jed did, he found someone had lettered him.

[[Open the Letter-&gt;Letter2]]</tw-passagedata><tw-passagedata pid="162" name="Letter2" tags="" position="5575,2900" size="100,100">(set:$previousPassage to (passage:)&#39;s name)
\(font:&quot;Kaushan Script&quot;)[
\###Dear Jed Winchester,
I have a bit of a (color:#ff0000)[Mayor Mystery]. I can&#39;t remember the last time I slept more than 8 hours. The mayor keeps going into the basement and yelling about things. I&#39;ve had to pick up a hobby to help pass the time when I should be sleeping. I need your help. That&#39;s why I am writing to you, Jed Winchester. I&#39;m trying to figure this out on my own, but maybe with your help, Jed Winchester, we can solve this (color:#ff0000)[Mayor Mystery].

Thanks,
An anonymous help-seeker]

Jed folded the letter and put it in his pocket.

[[Return Home-&gt;Jed&#39;s Apartment 2]]
[[Go to Town-&gt;LOL]] </tw-passagedata><tw-passagedata pid="163" name="Jed&#39;s Apartment 2" tags="" position="5225,3450" size="100,200">(set:$previousPassage to (passage:)&#39;s name)
\You&#39;re inside the Jedpartment. (if:$sequelProgress contains &quot;del&quot;)[&quot;(either:&quot;I&#39;m so excited to solve this (color:#ff0000)[Mayor Mystery] with you!&quot;,&quot;I wonder where we get to go next!&quot;,&quot;I&#39;m so glad it&#39;s &quot; + (weekday:) + &quot;, because that means I get to go outside!&quot;,&quot;I can&#39;t wait to see what happens today. I&#39;m so excited!&quot;,&quot;I love you, Jed!&quot;)&quot; Del exclaims.](else:)[(either:&quot;Home, sweet home.&quot;,&quot;You know what they say, you can&#39;t investigate a (color:#ff0000)[Mayor Mystery] without proper rest!&quot;,&quot;Wow, you should probably get around to cleaning sometime soon. I mean-&quot;,&quot;It looks especially Jedtastic today, almost twice as much as yesterday.&quot;,&quot;The best place to spend a &quot; + (weekday:) + &quot; morning.&quot;,&quot;Its red walls bring you great comfort.&quot;)] Where would you like to go?

[[Jedroom-&gt;Jed&#39;s Bedroom 2]]
[[Bathroom-&gt;Jed&#39;s Bathroom 2]]
(if:$sequelProgress contains &quot;del&quot;)[[[Exit-&gt;Sequel Town]]](else:)[[[Exit-&gt;LOL]]]</tw-passagedata><tw-passagedata pid="164" name="Sequel Town" tags="" position="5550,3125" size="200,200">(set:$previousPassage to (passage:)&#39;s name)
\(if:visits is 1)[(font:&quot;Roboto Mono&quot;)[Welcome to the new version of Webster Groves. To give a more streamlined experience, we have removed most of the optional content.]

]
\You&#39;re in the Webster Groves Town Square. &quot;(either:&quot;I&#39;m so excited to solve this (color:#ff0000)[Mayor Mystery] with you!&quot;,&quot;I wonder where we get to go next!&quot;,&quot;I&#39;m so glad it&#39;s &quot; + (weekday:) + &quot;, because that means I get to go outside!&quot;,&quot;I can&#39;t wait to see what happens today. I&#39;m so excited!&quot;,&quot;I love you, Jed!&quot;)&quot; Del exclaims.

(if:$sequelProgress contains &quot;burgerocity&quot;)[[[City Hall-&gt;City Hall 2]]](else:)[[[City Hall-&gt;LOL]]]
[[Jed&#39;s Apartment-&gt;Jed&#39;s Apartment 2]] 
(if:$sequelProgress contains &quot;secretary&quot;)[[[Hardware Store-&gt;Hardware Store 2]]](else:)[[[Hardware Store-&gt;LOL]]]
[[Burgerocity-&gt;Burgerocity 2]] </tw-passagedata><tw-passagedata pid="165" name="LOL" tags="" position="5300,3200" size="100,100">(font:&quot;Roboto Mono&quot;)[
\(if:visits is 1)[As part of our experience streamlining, we have removed speedrunning from the game. This means you are trying to go to areas earlier than expected. Please return to your previous area and do all required tasks there.]
\(if:visits is 2)[It appears that you are trying to speedrun again. Whether intentional or not, when players speedrun they detriment their experience of the game. Since we would like you to have the best and fullest experience possibly playing (color:#ff0000)[Mayor Mystery 2], we have removed speedrunning from the game.]
\(if:visits is 3)[This is a reminder that speedrunning has been removed from the game. We would like all players of (color:#ff0000)[Mayor Mystery 2] to be able to explore all the game has to offer, and so we have removed speedrunning. Please finish all required tasks before entering a new area.]
\(if:visits &gt; 3)[It seems you have forgotten that speedrunning has been removed from the game. Please finish your current task before entering this area.]]

(link-goto:&quot;Continue&quot;,$previousPassage)</tw-passagedata><tw-passagedata pid="166" name="Jed&#39;s Bedroom 2" tags="" position="5150,3700" size="100,100">(if:visits is 1)[(set:$sequelProgress to it + (a:&quot;del&quot;))
\Jed walks down the hallway to the Jedroom door, which is currently closed. Jed knocks on it, and the door swings open.

&quot;Good morning, Jed!&quot; shouts Del Buffington. Del is your sidekick. &quot;Oh boy, I&#39;m so excited for what we have planned today!&quot;

Jed explains to Del the (color:#ff0000)[Mayor Mystery] that he has been informed of.

&quot;Wow, that sounds like fun! Let&#39;s go solve this (color:#ff0000)[Mayor Mystery]!&quot;

[[Continue-&gt;Jed&#39;s Apartment 2]]]
\(else:)[
\You are now in the Jedroom. It&#39;s the room where you keep the beds. To the left is a bed with an ornate bedframe, a very fluffy pillow, and a giant comforter. To the right is a mattress on the floor with two blankets, one of which has been fashioned into a makeshift pillow.

[[Exit-&gt;Jed&#39;s Apartment 2]]] </tw-passagedata><tw-passagedata pid="167" name="Jed&#39;s Bathroom 2" tags="" position="5300,3700" size="100,100">You are in your bathroom. It&#39;s pretty cramped, but it fulfills the basic necessities of a bathroom. (if:$visitFlush2)[//There is nothing to do here.//](else:)[There is nothing to do here.]

(if:$visitFlush2)[[[Flush the Toilet-&gt;Too Poor]]](else:)[[[Flush the Toilet-&gt;Flush 2]]]
[[Exit-&gt;Jed&#39;s Apartment 2]]</tw-passagedata><tw-passagedata pid="168" name="Flush 2" tags="" position="5300,3850" size="100,100">(font:&quot;Roboto Mono&quot;)[Due to high abuse of the toilet feature in the previous game, we have removed it from this game.]
\(set:$visitFlush2 to true)

[[Continue-&gt;Jed&#39;s Bathroom 2]] </tw-passagedata><tw-passagedata pid="169" name="City Hall 2" tags="" position="5600,3475" size="100,200">(set:$visitsCityHall to it + 1)
\(if: $visitsCityHall is 1)[
\Jed and Del enter the Webster Groves City Hall. It&#39;s a wacky building. The room you&#39;re standing in is nothing short of luxurious, with lots of decorations and a lot more open space. It&#39;s also home to the great (color:#ff0000)[Mayor Mystery] you two have been tasked to solve.

Oddly, in what is a very open and spacious room, you can only see one other person. The mayor&#39;s secretary is sitting at her desk, secetarying away. She is completely enveloped in her computer screen, almost frantically typing and scrolling. Maybe she&#39;s busy gaming? She hasn&#39;t even noticed that you&#39;ve come in.]
\(else:)[
\You&#39;re inside the City Hall. (if:$visitsSecretary is 0)[The secretary is still focused on her computer.](else:)[The secretary does the (either:&quot;griddy&quot;,&quot;default dance&quot;,&quot;orange justice&quot;,&quot;floss&quot;,&quot;Gangnam Style dance&quot;,&quot;distraction dance&quot;).]]

[[Talk to the Secretary-&gt;Talk to Secretary 2]]
[[Exit-&gt;Sequel Town]]</tw-passagedata><tw-passagedata pid="170" name="Hardware Store 2" tags="" position="5886,3463" size="100,200">You&#39;re inside the Town Square Hardware Store. It feels strangely cold.

[[Purchase Items-&gt;Buy Hardware 2]]
[[Exit-&gt;Sequel Town]]</tw-passagedata><tw-passagedata pid="171" name="Burgerocity 2" tags="" position="6100,3475" size="100,200">&quot;Hey Jed, hey Del,&quot; the owner says. &quot;Here to buy some food before I shut down shop?&quot;
\(set:$previousPassage to (passage:)&#39;s name)

[[Purchase Food-&gt;Burgerocity Counter 2]]
[[Talk to Owner-&gt;Burgerocity Owner 2]]
[[Exit-&gt;Sequel Town]]</tw-passagedata><tw-passagedata pid="172" name="Burgerocity Owner 2" tags="" position="6100,3750" size="100,100">(set:$sequelProgress to it + (a:&quot;burgerocity&quot;))
\&quot;Why the want to shut down shop all the sudden?&quot; Jed asks. &quot;And why so soon?&quot;

&quot;Yeah,&quot; Del adds, &quot;I ated a burger like, one day ago.&quot;

The owner leans forward. &quot;If anyone asks, you never heard this. I was told not to tell anyone.&quot;

&quot;What happened?&quot; Jed asks.

&quot;It was the mayor,&quot; the owner explains. &quot;He shut down my business just this morning. He told me he has deconstruction plans starting //tonight//.&quot;

&quot;Oh no! Is there anything I can do to help you? That sounds too sudden to be ethical or legal...&quot;

&quot;Yeah, that sounds sus!&quot; Del screams. &quot;Like Among Us (2018)!&quot;

&quot;If you wanna talk to the people at City Hall, be my guest. I don&#39;t like it either but I&#39;m not gonna be the one to disrespect Mayor Dixon, y&#39;know?&quot;

&quot;Don&#39;t worry. I&#39;ll get to the bottom of this.&quot; 

&quot;Hey, you mean //we//, right?&quot; Del wimps.

&quot;Right, yeah, of course.&quot; Jed adds.

[[Continue-&gt;Burgerocity 2]] </tw-passagedata><tw-passagedata pid="173" name="Burgerocity Counter 2" tags="" position="6100,3900" size="100,100">(font:&quot;Roboto Mono&quot;)[To ensure players do not ruin themselves financially, we have disabled the ability to purchase food. Do not worry, Jed and Del are fictional characters, and as such, do not require food to survive.]

Current funds: $$MONEY

[[Cheeseburger - $2-&gt;Too Poor]]
[[The Bifurcated Burger - $4-&gt;Too Poor]]
[[The Behemoth - $6-&gt;Too Poor]]
[[The Burgerocity - $9-&gt;Too Poor]]
[[Fries - $1-&gt;Too Poor]]
[[Soda - $1-&gt;Too Poor]]

[[Exit-&gt;Burgerocity 2]] </tw-passagedata><tw-passagedata pid="174" name="Talk to Secretary 2" tags="" position="5600,3725" size="100,100">(set:$visitsSecretary to it + 1)(set:$sequelProgress to it + (a:&quot;secretary&quot;))
\(if:$visitsSecretary is 1)[
\Jed and Del (either:&quot;sashay&quot;,&quot;swagger&quot;,&quot;strut&quot;,&quot;flounce&quot;,&quot;swank&quot;,&quot;prance&quot;,&quot;stride&quot;,&quot;slide&quot;,&quot;gambol&quot;,&quot;romp&quot;,&quot;hoof it&quot;,&quot;frolic&quot;,&quot;cavort&quot;,&quot;caracole&quot;) up to the secretary&#39;s desk. Your steps echo through the room, however, she still stays focused. &quot;Yo wassup,&quot; Jed says.

&quot;Oh, hello!&quot; she responds, still looking at her computer. &quot;If you&#39;ll give me just one second, I&#39;ve just been a bit... busy. I&#39;ve been doing work-related things, and definitely not playing Fortnite (2017).&quot; She stops speaking when she turns her head towards you. She then looks around the room to check if anyone else is around. &quot;So you got my letter,&quot; she says.

&quot;Yes, we did. What&#39;s going on? What are we going to do?&quot;

&quot;Mayor Dixon has been going on wacky ramblings down in the basement. His yelling is keeping me up at night, it&#39;s quite uncanny. However, that floor is on high security, meaning only certain people are allowed downstairs. Fortunately for us, that&#39;s also where the water lines are. That&#39;s why I&#39;ve scheduled a visit from the local plumber.&quot; She winks at you.

&quot;Oh my goodness gracious,&quot; Del shouts, &quot;we&#39;re gonna be the Mario brothers! Okay, I want to be Luigi, so you can be Mario!&quot;

&quot;I&#39;ve got two nametags for each of you, one is like a fake business tag, and the other marks you as a city hall visitor. All you need to do is participate in capitalism by going next door to the hardware store and getting some tools.&quot;

&quot;Will do,&quot; Jed states. &quot;I love participating in free-market capitalism. Gotta be one of the economic systems.&quot;

[[Continue-&gt;City Hall 2]]] 
\(else:)[
\(if:$sequelProgress contains &quot;tools&quot;)[
\Jed and Del (either:&quot;sashay&quot;,&quot;swagger&quot;,&quot;strut&quot;,&quot;flounce&quot;,&quot;swank&quot;,&quot;prance&quot;,&quot;stride&quot;,&quot;slide&quot;,&quot;gambol&quot;,&quot;romp&quot;,&quot;hoof it&quot;,&quot;frolic&quot;,&quot;cavort&quot;,&quot;caracole&quot;) up to the secretary. &quot;We&#39;re ready to go!&quot; Del exclaims.

&quot;Alrighty then!&quot; The secretary gets up from her desk. &quot;Just follow me and we&#39;ll... Oh, Jed! We can&#39;t go yet!&quot;

&quot;Why not?&quot;

&quot;You haven&#39;t even spent any of your skill points yet! You should definitely do that before we leave.&quot;

[[Spend Skill Points-&gt;Skill Tree 2]]](else:)[
\Jed and Del (either:&quot;sashay&quot;,&quot;swagger&quot;,&quot;strut&quot;,&quot;flounce&quot;,&quot;swank&quot;,&quot;prance&quot;,&quot;stride&quot;,&quot;slide&quot;) up to the secretary. &quot;We&#39;re ready to go!&quot; Del exclaims.

&quot;No you&#39;re not,&quot; the secretary states dryly.

&quot;Oh yeah,&quot; Jed says.

[[Continue-&gt;City Hall 2]]]]</tw-passagedata><tw-passagedata pid="175" name="Skill Tree 2" tags="" position="5625,3875" size="100,100">(if:visits is 1)[(set:$skillPoints to 8)(set:$SKILLS to (a:))]
\Remaining Skill Points: $skillPoints

(if:$skillPoints is 0)[[[Continue-&gt;Elevator 2]]](else:)[
\(if:$SKILLS contains any of (a:&quot;pocs&quot;,&quot;fh&quot;) and $SKILLS does not contain &quot;bhk&quot;)[(link-reveal-goto: &quot;Beginner&#39;s Hypnotism Kit&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;bhk&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains any of (a:&quot;pi&quot;,&quot;tap&quot;) and $SKILLS does not contain &quot;c&quot;)[(link-reveal-goto: &quot;Chestplate&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;c&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;ryfb&quot; and $SKILLS does not contain &quot;ctot&quot;)[(link-reveal-goto: &quot;Count to One Thousand&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;ctot&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS does not contain &quot;dss&quot;)[(link-reveal-goto: &quot;Do Some Stretches&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;dss&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;dss&quot; and $SKILLS does not contain &quot;dkys&quot;)[(link-reveal-goto: &quot;Double Knot Your Shoes&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;dkys&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS does not contain &quot;eanm&quot;)[(link-reveal-goto: &quot;Eat a Nice Meal&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;eanm&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains any of (a:&quot;dkys&quot;,&quot;qf&quot;) and $SKILLS does not contain &quot;ee&quot;)[(link-reveal-goto: &quot;Emergency Eject&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;ee&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;ryfb&quot; and $SKILLS does not contain &quot;fowucya&quot;)[(link-reveal-goto: &quot;Find Out Which Undertale Character You Are&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;fowucya&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;gah&quot; and $SKILLS does not contain &quot;fh&quot;)[(link-reveal-goto: &quot;Funny Hat&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;fh&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS does not contain &quot;gah&quot;)[(link-reveal-goto: &quot;Get a Haircut&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;gah&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;eanm&quot; and $SKILLS does not contain &quot;pi&quot;)[(link-reveal-goto: &quot;Poison Immunity&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;pi&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;gah&quot; and $SKILLS does not contain &quot;pocs&quot;)[(link-reveal-goto: &quot;Put on Cool Shades&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;pocs&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;dss&quot; and $SKILLS does not contain &quot;qf&quot;)[(link-reveal-goto: &quot;Quieter Footsteps&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;qf&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS does not contain &quot;ryfb&quot;)[(link-reveal-goto: &quot;Read Your First Book&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;ryfb&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains any of (a:&quot;fowucya&quot;,&quot;ctot&quot;) and $SKILLS does not contain &quot;ee&quot;)[(link-reveal-goto: &quot;Read Your Second Book&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;rysb&quot;))(set:$skillPoints to it - 1)]
]
\(if:$SKILLS contains &quot;eanm&quot; and $SKILLS does not contain &quot;tap&quot;)[(link-reveal-goto: &quot;Take a Powernap&quot;,&quot;Skill Tree 2&quot;)[(set:$SKILLS to it + (a:&quot;tap&quot;))(set:$skillPoints to it - 1)]]
\]</tw-passagedata><tw-passagedata pid="176" name="Elevator 2" tags="" position="5625,4000" size="100,100">(cond:$SKILLS contains &quot;tap&quot;,&quot;Feeling well-rested and equipped with&quot;,&quot;With&quot;) his new set of skills, Jed felt ready to take on the (color:#ff0000)[Mayor Mystery]. The secretary handed Jed and Del their name tags, labeled &quot;Mario Mario&quot; and &quot;Luigi Mario(cond:$SKILLS contains &quot;fowucya&quot;,&#39;,&quot; however, Jed was upset that she didn\&#39;t make him a tag that said &quot;Frisk Undertale.&quot;&#39;,&#39;.&quot;&#39;) The secretary gets up from her desk and gestures for Jed and Del to follow her. You all go through the two large double doors on the right side of the room.

The doors lead into a long hallway with an elevator at the end. Throughout the hallway were exactly 27 security guards walking around. Del starts to feel a little uneasy, but Jed consoles him. (if:$SKILLS contains &quot;ctot&quot;)[&quot;Just take a deep breath and count to one thousand. It worked for me!&quot;]

(cond:$SKILLS contains &quot;dkys&quot;,&quot;Thanks to double-knotting his shoes, Jed was able to walk down the hallway and experience no trips whatsoever.&quot;,&quot;While walking down the hallway, Jed trips and falls&quot; + (cond:$SKILLS contains &quot;pocs&quot;,&quot;, which almost breaks his sunglasses.&quot;,&quot;.&quot;) + &quot; Wow, you really should&#39;ve tied those shoes better, Jed.&quot;)

The three of you arrive at the elevator, and six security guards are standing beside it - three on each side. The guards stare the three of you down while you enter the elevator(cond:$SKILLS contains &quot;fh&quot;,&quot;. \&quot;Nice hat,\&quot; one of them remarks.&quot;,&quot;, but they don&#39;t say anything.&quot;) The elevator doors close and you can feel a slight sense of relief. The secretary presses a button and the elevator starts to go downwards.

&quot;That was the easy part,&quot; the secretary explains. &quot;Once we get downstairs, there&#39;s a door tucked away behind the elevator. That&#39;s where we need to go.&quot;(if:$SKILLS contains &quot;ryfb&quot;)[

&quot;Did you know that (either:&quot;elevators used to be called &#39;rising rooms?&#39;&quot;,&quot;in Germany, it would take three years to become an elevator operator?&quot;,&quot;before elevators were invented, higher floors would be cheaper than lower floors?&quot;)&quot; Jed randomly states. &quot;I learned about it in this book that I read.&quot; The others return a blank stare.] 

[[Continue-&gt;City Hall Basement 2]]</tw-passagedata><tw-passagedata pid="177" name="Book 4" tags="" position="1100,3000" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[Vela]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by &lt;a href=&quot;https://asnev.neocities.org/journal#vela&quot; target=&quot;_blank&quot;&gt;asnev&lt;/a&gt;]

&lt;==
---
(font:&quot;Times New Roman&quot;)[
\sometimes it can be difficult to cultivate bread. your bread crops aren&#39;t fairing well right now and there&#39;s not much choice in the matter. you thought about finding solution after solution for your predicament. none will work, and those were made obvious with your experience. you decided that it&#39;s not so bad. there&#39;s nothing to cry over when other people with their plants are also going to face the same widespread problem. it&#39;s inevitable, really. you feel like you should be feeling regret and frustration for having spent a not at all insignificant amount of time honing your craft on panimintology and kalimistronomy only to be dealt with the expected outcome that everybody expected: failure. but… you decided to contemplate life for a bit on this moment.

the windy breeze feels fresh. unusually fresh. you can smell hints of lime from the experimental lime vine hybrid plant you planted a few months ago at the other side of the garden. general green scented fumes followed along to complement the olfactory orchestra. you can see Vela frolicking, hopping in and out of the field of Jili sunflowers you and your colleagues planted and cared for together to finish your complementary project studies. a little trampling won&#39;t hurt them, they&#39;re quite resilient as plants go. it&#39;s all beautiful. just like the Panskrelah breed of cultivatable bread you tried growing, they are all but permanent, swishing in the breeze as their internal clock ticks towards their end time. when these technologies were first unveiled for the world to see, people were furious for the very nature of their impermanence. for the first few decades, they didn&#39;t take in on the action and simply stuck to their traditional ways of planting and managing agriculture. stuck to ancient and comparatively barbaric methods. you and your partners then stepped in and proved the world how incredibly beneficial this new technology can be for everyone, despite its shortcomings. companies stepped in, new research gets published every other day, everyone is raving on and on about it online, and the global economy changed drastically. everyone seemed content for a while.

of course, now seeing Specimen Zero slowly rotting away in front of your eyes can still be quite heartbreaking. it&#39;s a secret to nobody, everyone was made clear that this tech cannot last long, and a permanent solution still needs to be made in order to satisfy the world&#39;s needs. a permanent solution where people are still puzzled by the lack of progress. you know how much the world will be in flames in the following week or two. you stood still amongst the greenery and blueery around you. Vela still looks busy with her motorized tennis ball bouncing all over the places.

despite all of this, you still felt hope. you&#39;ve gone this far with a lot of success, and you&#39;re feeling lucky. a little bit. okay, nevermind that, it&#39;s less luck and more… something? what is this feeling? reassurance? no, not really. not very optimistic but, also not pessimistic either. you know that it&#39;ll take a while for things to cool back down again and for people to band together again as a group to tackle a problem as a collective. you know how not easy that is to execute. during the press conference for your team&#39;s newest findings, it&#39;s as if the audience in front is already discussing about segregating itself into a group of advocates, and another group of contrarians. but you&#39;re not gonna give up now. you forgot how to do that a long time ago. you better do something, anything. even if the result is a failure, we can at the very least culminate our findings and further learn from our actions. to perpetually improve.

you stopped contemplating and whistled to catch the attention of Vela. she was more than happy to switch her attention into playing with you now.]

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="178" name="Buy Hardware 2" tags="" position="5894,3731" size="100,100">&quot;You need it, we got it.&quot; the clerk boasts.

Current funds: $$MONEY

(if:$INV does not contain &quot;wrench&quot; and $MONEY &gt;= 20)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Steel Pipe Wrench - $20&quot;,&quot;Buy Hardware 2&quot;)[(set:$INV to it + (a:&quot;wrench&quot;))(set:$sequelProgress to it + (a:&quot;tools&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[(if:$INV contains &quot;wrench&quot;)[Steel Pipe Wrench - Sold Out](else:)[[[Steel Pipe Wrench - $20-&gt;Too Poor]]]]
(if:$INV does not contain &quot;hammer&quot; and $MONEY &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Hammer - $5&quot;,&quot;Buy Hardware 2&quot;)[(set:$INV to it + (a:&quot;hammer&quot;))(set:$sequelProgress to it + (a:&quot;tools&quot;))(set:$MONEY to it - 5)(set:$STATS&#39;s 3rd to it + 5)]](else:)[(if:$INV contains &quot;hammer&quot;)[Hammer - Sold Out](else:)[[[Hammer - $5-&gt;Too Poor]]]]
(if:$INV does not contain &quot;crowbar&quot; and $MONEY &gt;= 20)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Crowbar - $20&quot;,&quot;Buy Hardware 2&quot;)[(set:$INV to it + (a:&quot;crowbar&quot;))(set:$sequelProgress to it + (a:&quot;tools&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[(if:$INV contains &quot;crowbar&quot;)[Crowbar - Sold Out](else:)[[[Crowbar - $20-&gt;Too Poor]]]]
(if:$INV does not contain &quot;wallpaper&quot; and $MONEY &gt;= 15)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Wallpaper - $15&quot;,&quot;Buy Hardware 2&quot;)[(set:$INV to it + (a:&quot;wallpaper&quot;))(set:$MONEY to it - 15)(set:$STATS&#39;s 3rd to it + 15)]](else:)[(if:$INV contains &quot;wallpaper&quot;)[Wallpaper - Sold Out](else:)[[[Wallpaper - $15-&gt;Too Poor]]]]
(if:$MONEY &gt;= 40)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Bucket of Paint - $40&quot;,&quot;Buy Hardware 2&quot;)[(set:$INV to it + (a:&quot;paint&quot;))(set:$MONEY to it - 40)(set:$STATS&#39;s 3rd to it + 40)]](else:)[[[Bucket of Paint - $40-&gt;Too Poor]]]

[[Exit-&gt;Hardware Store 2]] </tw-passagedata><tw-passagedata pid="179" name="City Hall Basement 2" tags="" position="5625,4150" size="100,100">Jed, Del, and the secretary have arrived in the basement of City Hall. It&#39;s quite dark, but there are small dim lights spread around. Pipes run around the room in no particular fashion.

[[Elevator-&gt;Elevator Back 2]]
(if:$visitMaintenance2)[[[Maintenance Room-&gt;Too Poor]]](else:)[[[Maintenance Room-&gt;Maintenance Room 2]]]
[[Secret Room-&gt;Secret Room 2]]</tw-passagedata><tw-passagedata pid="180" name="Elevator Back 2" tags="" position="5475,4150" size="100,100">You turn around to call for the elevator, but the secretary stops you.

&quot;Jed, you better turn yourself around right.&quot; the secretary says. &quot;When I said there&#39;s no going back, there&#39;s no going back. We gucci?&quot;

[[Continue-&gt;City Hall Basement 2]] </tw-passagedata><tw-passagedata pid="181" name="Maintenance Room 2" tags="" position="5475,4300" size="100,100">(font:&quot;Roboto Mono&quot;)[(if:$visitFlush2)[
\Nice try. But we blocked this one too.](else:)[
\Due to high abuse of the toilet feature in the previous game, we have removed it from this game.]]
\(set:$visitMaintenance2 to true)

[[Continue-&gt;City Hall Basement 2]] </tw-passagedata><tw-passagedata pid="182" name="Secret Room 2" tags="" position="5625,4300" size="100,100">Jed, Del, and the secretary all walk behind the elevator, and //quelle surprise//, the three of you can just barely make out a door. It&#39;s painted to match the color of the wall, but there&#39;s a piece of paper taped to it that reads &quot;NOT A SECRET LAIR.&quot; 

&quot;Open sesame!&quot; Del yells at the door. It has no effect.(if:$SKILLS contains &quot;bhk&quot;)[

&quot;Let me try something,&quot; Jed says. He pulls out a pocket watch and begins to swing it in front of the door. &quot;You will open up to us...&quot; This continues for about 5 minutes until he gives up.]  

&quot;I found the key to the door last night,&quot; the secretary says. &quot;It&#39;s taped to the back of the letter I gave you.&quot;

&quot;Hmm, what an interesting place to hide it,&quot; Jed remarks. &quot;You&#39;re lucky I didn&#39;t throw away this letter!&quot; 

&quot;Alright, you wanna do that? You wanna go this route? You&#39;d have to be pretty nonobservant to not notice the key. It would make the letter heavier, and you&#39;d be able to feel it on the back. Secondly, if I held on to the key, there is a high probability that it could&#39;ve been found and taken back.&quot;

&quot;Okay, sorry. My bad.&quot; Jed takes the key off of the letter and opens up the door...

[[Continue-&gt;Confrontation 2]]</tw-passagedata><tw-passagedata pid="183" name="Save/Load" tags="" position="2100,100" size="100,100">(font:&quot;Raleway&quot;)[(either:&quot;You know, you should be lucky. There were people in the past who could never save their Mayor Mystery game in their lifetime.&quot;,&quot;(cond:visits is 1,&#39;Here to load your save, huh? Be sure to come back soon. Specifically next Tuesday. I&#39;m not gonna spoil anything.&#39;,&#39;Here to save your game, huh? Be sure to come back soon. Specifically next Tuesday. I&#39;m not gonna spoil anything.&#39;)&quot;,&quot;Good morning, Jed! Don&#39;t worry, I totally haven&#39;t touched your save data! Wink!&quot;,&quot;Jed, this is very important. Don&#39;t alter your save data after midnight. It spoils the cookies if you do that, and then the game refuses to eat them.&quot;,&quot;Did I ever tell you the story of the man who tried to manage his save data, but then his computer exploded? Well, let&#39;s just say you might want to be careful.&quot;)]

(if:(history:) contains &quot;The Beginning&quot;)[(link:&quot;Save Game&quot;)[(if:(save-game:&quot;Slot J2&quot;))[(font:&quot;Raleway&quot;)[Game saved!]](else:)[(font:&quot;Raleway&quot;)[Oops! Something went wrong.]]]
]
\(if: (saved-games: ) contains &quot;Slot J2&quot;)[(link:&quot;Load Game&quot;)[(link: &quot;--Are You Sure?--&quot;)[(load-game:&quot;Slot J2&quot;)(go-to:&quot;Title Screen&quot;)]]
]
\[[Back to Menu-&gt;Title Screen]]</tw-passagedata><tw-passagedata pid="184" name="Confrontation 2" tags="" position="5625,4450" size="100,100">The mayor is sitting inside the room already waiting for you. &quot;Hello, Jed and Del.(cond:$SKILLS contains &quot;gah&quot;,&#39; Did you get a haircut? It looks good.&quot;&#39;,&#39;&quot;&#39;)

&quot;HOW&#39;DJA KNOW WE WERE HERE?&quot; Del screams.

&quot;(cond:$SKILLS contains &quot;qf&quot;,&quot;Well first I was waiting to hear footsteps, but I never heard any of those for some reason. Fortunately for me &quot;,&quot;First I listened for your footsteps, and then &quot;)you guys stood outside the door arguing for a couple of minutes.&quot;

The mayor then snaps his fingers, and guards enter the room, taking away Del and the secretary. &quot;AVENGE US, JED!!!&quot; Del cries.

(cond:$SKILLS contains &quot;pocs&quot;,&quot;Jed pushes up his sunglasses and strikes a cool pose. &quot;,&quot;&quot;)&quot;You just made a big mistake,&quot; Jed asserts. (cond:$SKILLS contains &quot;rysb&quot;,&#39;&quot;You\&#39;re about to get impeached. I learned what that is from a book I just read earlier.&quot;&#39;,&#39;&quot;Your days of mayoring are over.&quot;&#39;)

&quot;Jed, perhaps there&#39;s been a misunderstanding. Come sit down, have a drink. I&#39;ll explain what I&#39;ve been up to.&quot; (if:$SKILLS contains &quot;eanm&quot;)[

&quot;Actually, I just had a drink with the meal I just ate.&quot;

&quot;Who cares? Just sit down and let me exposition dump.&quot;]

[[Sit Down-&gt;Dinner 2]]</tw-passagedata><tw-passagedata pid="185" name="Dinner 2" tags="" position="5775,4000" size="100,100">Jed sits down across from the mayor. &quot;You better have a darn good explanation for this.&quot; He takes a big sip of the drink.

&quot;Taste good?&quot; the mayor asks.

&quot;Sure.&quot;
\(if:$SKILLS contains &quot;pi&quot;)[

&quot;Even with the POISON I added?&quot;

&quot;Even if there was poison, I&#39;m immune to it.&quot;

&quot;Oh, um, I mean- that was just a joke. Anyway...&quot; ]
\(else:)[

&quot;Good.&quot; ]The mayor leans forward. &quot;Listen, Jed, who doesn&#39;t love a good (color:#ff0000)[sequel]? Taking something old and making it new again. It&#39;s the way of life. That&#39;s why I&#39;m tearing down Burgerocity to make way for Burgerocity 2!&quot;

&quot;Okay, that doesn&#39;t seem so bad.&quot;

&quot;The difference is that the burgers contain a secret chemical. And when I press this button&quot; - the mayor turns around and points at a big red button on the wall - &quot;everyone who has eaten a burger will turn into a burger monster!&quot;

&quot;What?&quot;

&quot;Sorry, I&#39;m evil. LOL.&quot;

&quot;Then as the protagonist of this story, I have no choice but to fight you!&quot;

[[Continue-&gt;Fight 2]]</tw-passagedata><tw-passagedata pid="186" name="Fight 2" tags="" position="5775,4150" size="100,100">Jed stands up and pushes the table out of the way. &quot;Let&#39;s do this!&quot; he shouts. (if:$SKILLS contains &quot;dss&quot;)[&quot;Man, it&#39;s a good thing I did some stretches earlier.&quot;]

The mayor puts out a first and begins running towards Jed. (cond:$SKILLS contains &quot;c&quot;,&quot;Jed does not react. The mayor hits Jed&#39;s chestplate, which causes the mayor to grab his hand in pain.&quot;,&quot;Jed, however, has ample time to react, and slowly moves out of the way.&quot;)

(cond:$SKILLS contains &quot;c&quot;,&#39;&quot;Where did you even get that chestplate from?&quot; the mayor yells, bumfuzzled.&#39;,&#39;&quot;How did you dodge my extreme attack?&quot; the mayor yells, bumfuzzled.&#39;)

&quot;I&#39;m just that good at fighting.&quot; Jed then slaps the mayor across the face.  He then pulls out a water gun and begins spraying it at the mayor. 

&quot;Hey, be careful!&quot; the mayor exclaims. &quot;The equipment in this room is very sensitive to water!&quot;

Jed then begins pointing the water gun at all the electronics in the room. Sparks begin to fly, and the room begins to fill up with smoke. 

&quot;Looks like we mayored too many mysteries.&quot; Jed quickly runs out the door. 

Del and the secretary are in the middle of fighting some of the security guards that dragged them out of the room. (if:$SKILLS contains &quot;ee&quot;)[Jed grabs onto Del and the secretary. &quot;EMERGENCY EJECT!&quot; He pushes a button on his belt, and the three of them fly straight upwards, breaking through the ceiling and layers of ground above them.](else:)[&quot;C&#39;mon, let&#39;s go!&quot; Jed yells. The secretary and Del follow Jed into the elevator, and they go back to the ground floor as fast as they can.]

[[Continue-&gt;The End 2]]</tw-passagedata><tw-passagedata pid="187" name="The End 2" tags="" position="5775,4300" size="100,100">Jed, Del, and the secretary (cond:$SKILLS contains &quot;ee&quot;,&quot;pop out of the floor and begin to &quot;,&quot;&quot;)run out of the city hall as fast as they can. (cond:$SKILLS contains &quot;dkys&quot;,&quot;Gosh, imagine if you tripped now due to not tying your shoes well. That would&#39;ve been awful.&quot;,&quot;&quot;) Once outside, they turn around and look at the city hall, which is emanating smoke.

&quot;Wow, that was really wacky!&quot; Del exclaims. &quot;(cond:$SKILLS contains &quot;ee&quot;,&quot;I&#39;m glad you had that emergency eject to g-&quot;,&quot;I&#39;m glad we were able to get out of there so qui-&quot;)&quot;

City hall then explodes. 

[[The End-&gt;Sequel End]]</tw-passagedata><tw-passagedata pid="188" name="Sequel End" tags="" position="5750,4450" size="200,100">(font:&quot;Roboto Mono&quot;)[
\This is the end of the current sequel content. More will come with future updates.

Please provide feedback of the sequel using &lt;a href=&quot;https://forms.gle/KEhGQv4p3jrLycRJ9&quot; target=&quot;_blank&quot;&gt;this Google form&lt;/a&gt;. We appreciate your feedback on (color:#ff0000)[Mayor Mystery 2]. Your comments are meaningful to us, and integral to the development of this sequel.]

[[Continue-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="189" name="Stats Page" tags="" position="4125,4150" size="100,100">(font:&quot;Raleway&quot;)[&lt;u&gt;The Paper of Amazing Statistics&lt;/u&gt;

Times Played: (print:$STATS&#39;s 9th)
(cond:$anomalies&#39;s length is 0,&quot;?????:&quot;,&quot;Anomalies Witnessed:&quot;) (print:$anomalies&#39;s length)/16
(cond:$STATS&#39;s 12th is 0,&quot;?????:&quot;,&quot;Debt Accrued:&quot;) (print:&quot;$&quot; + (str:$STATS&#39;s 12th))
(cond:$STATS&#39;s 10th is 0,&quot;?????:&quot;,&quot;Haircuts:&quot;) (print:$STATS&#39;s 10th)
(cond:$STATS&#39;s 2nd is 0,&quot;?????:&quot;,&quot;Items Thrown Away:&quot;) (print:$STATS&#39;s 2nd)
(cond:$STATS&#39;s 11th is 0,&quot;?????:&quot;,&quot;Lottery Winnings:&quot;) (print:&quot;$&quot; + (str:$STATS&#39;s 11th))
(cond:$STATS&#39;s 3rd is 0,&quot;?????:&quot;,&quot;Money Spent:&quot;) (print:&quot;$&quot; + (str:$STATS&#39;s 3rd))
Outfits Owned: (print:$CLOSET&#39;s length + 2)/12
(cond:$STATS&#39;s 4th is 0,&quot;?????:&quot;,&quot;Pets Adopted:&quot;) (print:$STATS&#39;s 4th)
(cond:$STATS&#39;s 13th is 0,&quot;?????:&quot;,&quot;Prank Calls:&quot;) (print:$STATS&#39;s 13th)
(cond:$STATS&#39;s 8th is 0,&quot;?????:&quot;,&quot;Room Paintings:&quot;) (print:$STATS&#39;s 8th)
(cond:$STATS&#39;s 5th is 0,&quot;?????:&quot;,&quot;Tickets Won:&quot;) (print:$STATS&#39;s 5th)
(cond:$STATS&#39;s 6th is 0,&quot;?????:&quot;,&quot;Toilet Flushes:&quot;) (print:$STATS&#39;s 6th)
(cond:$STATS&#39;s 7th is 0,&quot;?????:&quot;,&quot;Train Rides:&quot;) (print:$STATS&#39;s 7th)
(cond:$mayorFights&#39;s length is 0,&quot;?????:&quot;,&quot;Unique Mayor Fights:&quot;) (print:$mayorFights&#39;s length)/8
(cond:$STATS&#39;s 1st is 0,&quot;?????:&quot;,&quot;World Endings:&quot;) (print:$STATS&#39;s 1st)
\]

[[Return-&gt;Waiting Room]] </tw-passagedata><tw-passagedata pid="190" name="Throw Away Key" tags="" position="1900,2850" size="100,100">(if:$INV contains &quot;letter&quot;)[
\Jed, you fool! You were supposed to throw away the letter, not the key! There&#39;s no way you could&#39;ve made that mistake, unless-

You did this on purpose, didn&#39;t you? Why? It would&#39;ve been cool! You could&#39;ve fought the mayor! Oh well, your loss.]
\(else:)[
\What? The key too? Jed, you were only supposed to throw away the letter! There&#39;s no way you could&#39;ve made that mistake unless-

You did this on purpose didn&#39;t you? Not even as blunt of a hook as &quot;ALIENS, THEY&#39;RE REAL!&quot; can make you participate in my story? I see how it is.]
\(set:$INV to it - (a:&quot;key&quot;))
\(set:$STATS&#39;s 2nd to it + 1)

[[Continue-&gt;Jed&#39;s Kitchen]] </tw-passagedata><tw-passagedata pid="191" name="Gameshow Intro" tags="" position="800,3600" size="100,100">(set:$questions to (shuffled:...(range:1,11)))
\(set:$questionNum to 1)
\(set:$qwords to (a:&quot;First question, worth $20: &quot;,&quot;Question number 2, worth $50: &quot;,&quot;Third question, now worth $80: &quot;,&quot;You&#39;re almost there! Fourth question for $150: &quot;,&quot;Final question, for 200 big ones, $500 all together: &quot;))
\Jed ticks the box marked &quot;yes.&quot; Suddenly, Jed finds himself in a live gameshow set, with a host and a studio audience.

&quot;Hello, everyone!&quot; the host announces. &quot;Welcome to &#39;&#39;Mayor Mystery Mystery&#39;&#39;!! Today, we have the one and only Jed Winchester!&quot;

The crowd goes absolutely wild. They start chanting your name: &quot;Jed! Jed! Jed! Jed!&quot;

&quot;Here&#39;s how the game works, kid. I&#39;m going to ask you a series of questions. If you get it right, you go on to the next. Get it wrong and you go home. Each one is worth more than the other. If you can get all of them correct, you&#39;ll go home with $500 dollars. Are you ready?&quot;

(link-reveal-goto:&#39;&quot;Yes!&quot;&#39;,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to &quot;yes&quot;)]
(link-reveal-goto:&#39;&quot;No...&quot;&#39;,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to &quot;no&quot;)]</tw-passagedata><tw-passagedata pid="192" name="Reject Gameshow" tags="" position="2200,2100" size="100,100">Jed ticks the box marked &quot;No.&quot; Suddenly, the letter crumples in on itself and completely disappears.

Jed, did you see that? What the heck just happened?

[[Continue-&gt;The Apartment Complex]] </tw-passagedata><tw-passagedata pid="193" name="Question 1" tags="" position="950,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Toaster&quot;,&quot;Washer &amp; Dryer Set&quot;,&quot;Smart Fridge&quot;,&quot;Stove&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) What is the most expensive item at the Gadget Factorie?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="194" name="Add Stanley" tags="" position="7750,1350" size="100,100">(live: 0.05s)[
\(either:&quot;Well Jed, I hope you had fun exploring that broken area. I might as well explain what this place is:

Bloomhurst Lake was going to be a DLC for this game. It would&#39;ve added a completely new area to the game, with its own subareas like Webster Groves. But as we worked on it, we realized a crucial problem: what was the point of this whole area? What would it have done to the game? Sure, there would have been \&quot;more,\&quot; but what good does \&quot;more\&quot; do when it&#39;s not adding to anything? So we threw it away.

But now that makes me wonder, how was the ticket seller able to access this area? We chopped it off from the rest of the game very early on. There shouldn&#39;t have been any links to these passages... maybe something in town will explain it?&quot;,&quot;You pull out your crowbar and knock out the guard to your right. The mayor steps back, while the second guard jumps toward you. You hit them in the head and they fall face-first into the floor.

\&quot;I choose option 3!\&quot; you yell.

\&quot;Nice weapon there Jed,\&quot; the mayor bellows, \&quot;but I already opened up to you earlier. You&#39;ll find that won&#39;t help you against me.\&quot;

\&quot;That&#39;s fine,\&quot; you retort, \&quot;I don&#39;t need to fight you.\&quot; You jump towards the TV past the mayor and smash your $weapon down on the panel as hard as you can. The screen glitches out, sparks begin to fly, and suddenly it bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room, where you see two guards laying down on the ground, and the secretary holding her heels. \&quot;C&#39;mon!\&quot; you say, gesturing towards the elevator. The mayor runs after you, but when he gets to the elevator doorway you kick him back as the doors shut. You then ride the elevator up and exit City Hall as fast as you can.&quot;,&quot;\&quot;Why the want to shut down shop all the sudden?\&quot; you ask. \&quot;And why so soon?\&quot;

The owner leans forward. \&quot;If anyone asks, you never heard this. I was told not to tell anyone.\&quot;

\&quot;What happened?\&quot;

\&quot;It was the mayor,\&quot; the owner explains. \&quot;He shut down my business just this morning. He told me he has deconstruction plans starting //tonight//.\&quot;

\&quot;Oh no! Is there anything I can do to help you? That sounds too sudden to be ethical or legal...\&quot;

\&quot;If you wanna talk to the people at City Hall, be my guest. I don&#39;t like it either but I&#39;m not gonna be the one to disrespect Mayor Dixon, y&#39;know?\&quot;

\&quot;Don&#39;t worry. I&#39;ll get to the bottom of this.\&quot;&quot;,&quot;The secretary hands you two name tags: one has a fake name and fake plumbing business, and one labels you as a City Hall visitor. The secretary then gets up from her desk and gestures for you to follow her. You go through the two large double doors on the right side of the room.

The doors lead into a long hallway with an elevator at the end. Throughout the hallway, there are about 5-6 security guards walking around. You start to feel a little uneasy, but you follow the secretary nonetheless.

The two of you arrive at the elevator, and two security guards are standing beside it - one on each side. The guards look at you while you enter the elevator, but they don&#39;t say anything. The elevator doors close and you can feel a slight sense of relief. The secretary presses a button and the elevator starts to go downwards.

\&quot;That was the easy part,\&quot; the secretary explains. \&quot;Once we get downstairs, there&#39;s a door tucked away behind the elevator. That&#39;s where we need to go.\&quot;&quot;,&quot;\&quot;You&#39;ll be a plumber coming to check in on the water pipes in the basement of city hall,\&quot; the secretary explains. \&quot;Near here is a hardware store, there you can get a couple of tools like a steel pipe wrench or a crowbar or whatever. There&#39;s a clothing store in West Side that should hopefully have something convincing that you can wear.\&quot;

\&quot;And look!\&quot; The secretary pulls out two name tags from one of the desk drawers. \&quot;The finishing touch, your very own employee nametag. And I&#39;ve also got a visitor name tag saved just for you.\&quot;

\&quot;So the tools and the outfit,\&quot; Jed repeats to himself, \&quot;got it.\&quot;

\&quot;Whatever it costs, I&#39;ll refinance you once this is over. Good luck, Jed!\&quot;&quot;,&quot;You find yourself in the following scenario:

You&#39;re riding the Webuster™️, Webster Groves&#39; public bus. It&#39;s an especially busy day today for the Webster Groves public transport system, so every seat on the bus is taken. All of them except for the one next to you. 

The bus stops and no one gets off. One person walks onto the bus, and then starts walking towards you.
\&quot;Excuse me,\&quot; they say. \&quot;Do you mind if I sit here?\&quot;&quot;,&quot;\&quot;Hmmm,\&quot; the clerk thinks. They look at you for a few seconds. \&quot;Yes, I can see it... You&#39;ll be able to pull this off, and I know just what you need.\&quot;

The clerk goes back to the clothing selection and comes back with a navy blue button-up shirt. \&quot;Sometimes simple is best. And this shirt will only cost you $15. What do you say?\&quot;&quot;,&quot;You show Josefine the bear you won at the arcade.

\&quot;Oh my gosh!\&quot; she exclaims, \&quot;It&#39;s so cute!\&quot;

\&quot;Yeah, it cost me 2500 tickets. Did you want it?\&quot;

\&quot;My girlfriend has been wanting something like that but... I don&#39;t want to take yours! I&#39;ll just go to the arcade and get my own! I&#39;ve been meaning to go back there someday, so here&#39;s a good excuse. But thank you for offering!\&quot;&quot;,&quot;\&quot;I&#39;ll help you!\&quot; you shout to the man. You run over to him. \&quot;SuperJed to the rescue!\&quot;

\&quot;Finally,\&quot; the man says. \&quot;I&#39;ve been waiting all day. I&#39;d just like to trim my beard a bit. It&#39;s gotten a bit too rowdy.\&quot;

Jed has never been a barber. He shaves every morning, so he had absolutely no experience in trimming facial hair. Despite this, Jed begins trimming this man&#39;s beard, and he does... a surprisingly decent job. Of course, it&#39;s not the greatest or best beard trimming ever, but at least you didn&#39;t shave his beard off accidentally. The man thanks you, pays for his trim, and then leaves.

What, were you expecting something more standoffish? It was his first time trimming, give him a break.&quot;,&quot;On the fifth day, Jed began his routine like normal. However, no one came to his stand. In fact, he noticed that the people who usually walked past his stand weren&#39;t even here in Town Square at all. He packed up early and went home. Bored, he turned on the news.

\&quot;Good afternoon, Webster Groves. You may have heard of a man giving out free food at Town Square the past few days. When we first heard about this, we began to dig deeper into this man&#39;s ulterior motives, because why would anyone do anything they don&#39;t personally gain something from?\&quot;

\&quot;Eventually, we found out that he had no soul. We came to the logical conclusion that the &#39;free food&#39; shtick was all a setup to steal //your// soul. If you want to keep your soul, &#39;&#39;stay clear of this man!&#39;&#39;\&quot;

Oh, goodness. All Jed wanted to do was help people. And now he got canceled. Feeling upset, Jed went to his bed to take an early nap. Jed was so sad he never noticed the sky going red and the explosions happening all over town.&quot;,&quot;Jed and Buster put their heads together and planned a small wedding. It wasn&#39;t extravagant by any means (Jed had no money to his name), but it was good to them.

No one showed up. They forgot to tell anyone that the wedding was happening. However, it did not change the fact that they thought the wedding was amazing.

The priest began the vows. \&quot;Jed Winchester, do you take Buster to be your spouse? Do you promise to be faithful to him in good times and in bad, in sickness and in health, to love him and to honor him all the days of your life?\&quot;

Jed looks at Buster&#39;s beautiful, unwavering, painted eyes. \&quot;I do.\&quot;

\&quot;Buster Burgermann, do you take Jed to be your spouse? Do you promise to be faithful to him in good times and in bad, in sickness and in health, to love him and to honor him all the days of your life?\&quot;

Buster looks at Jed&#39;s warm, friendly smile. There were a few seconds of silence, but all could tell that Buster would have said \&quot;I do.\&quot;

\&quot;Then by the power vested in me, I now pronounce you married!\&quot;

Jed picked up Buster and did a big spin with him. Together, they ran off into the woods, never seen by anyone from Webster Groves ever again.&quot;)
\(if:time&gt;5s)[(goto:&quot;Add Stanley 2&quot;)]]</tw-passagedata><tw-passagedata pid="195" name="Add Stanley 2" tags="" position="7750,1500" size="100,100">(set:$STANLEY to true)
(set:$STATS&#39;s 9th to it + 1)
(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(goto:&quot;Title Screen&quot;)</tw-passagedata><tw-passagedata pid="196" name="Stanley&#39;s Apartment" tags="" position="2850,2000" size="100,200">(if:$wearing is &quot;icloak&quot;)[
\You go over to Stanley&#39;s apartment and knock on the door.

(font:&quot;HKNova&quot;)[Stanley opened the door, and to his surprise, saw no one there. Stanley looked around trying to find someone nearby but didn&#39;t see anyone. Stanley came to the logical conclusion that it must&#39;ve been the wind.]

[[Continue-&gt;The Apartment Complex]]]
\(else:)[==
\(set:$visitsStanley to it + 1)
\You go over to Stanley&#39;s apartment and knock on his door. (if:$visitsStanley is 1)[(either:&quot;Wait, who the heck is Stanley?&quot;,&quot;Strange, I don&#39;t have any notes on this neighbor.&quot;,&quot;Hmm, must&#39;ve just moved in, I&#39;ve never seen this guy before.&quot;,&quot;A new neighbor, perhaps you can introduce yourself?&quot;,&quot;Funny, I remember the apartment numbers stopping at 26 before.&quot;)]

(font:&quot;HKNova&quot;)[Stanley opens the door. (if:$visitsStanley is 1)[&quot;Hello, neighbor!&quot; Stanley said. &quot;It sure is nice to be in an apartment complex with neighbors and friends!&quot;](else-if:$visitsStanley is 2)[&quot;Hello again!&quot; Stanley greeted. Stanley was excited that Jed had come back to talk to him again.](else-if:$visitsStanley is 3)[&quot;Is there something else you need?&quot; Stanley asked Jed.](else:)[&quot;Can&#39;t talk for much longer!&quot; Stanley said. &quot;(either:&quot;It&#39;s almost 4:30!&quot;,&quot;I have to go to work soon!&quot;,&quot;I&#39;m going to the art museum!&quot;,&quot;The bucket calls for me!&quot;,&quot;Leave me a text message at 202-555-2845!&quot;,&quot;It&#39;s almost button-pressing time!&quot;)&quot;]]
\(if:visits is 1)[

GM is that you? Why do you get to narrate this guy?]

[[Burgerocity-&gt;Stanley Burgerocity]]
(if:(history:) contains &quot;Empty Store&quot; and $josefineStore is &quot;unknown&quot;)[[[Empty Store-&gt;Stanley Empty Store]]
]
\(if:$INV contains &quot;bear&quot;)[[[Gift Teddy Bear-&gt;Stanley Bear]]
]
\(if:$INV contains &quot;paint&quot; and (history:) contains &quot;Stanley Favor&quot; and $escapadeArrow does not contain &quot;paint&quot;)[[[Give Paint Bucket-&gt;Stanley Paint]]
]
\(unless:$wearing is &quot;none&quot;)[[[Outfit-&gt;Stanley Outfit]]
]
\(if:(history:) contains &quot;Setup VR&quot;)[[[Virtual Reality-&gt;Stanley VR]]
]
\(if:$escapadeArrow contains &quot;ready&quot;)[[[&quot;Gotta go!&quot;-&gt;The Apartment Complex]]](else:)[[[&quot;Gotta go!&quot;-&gt;Stanley Favor]]]</tw-passagedata><tw-passagedata pid="197" name="Stanley Burgerocity" tags="" position="2850,2250" size="100,100">You mention Burgerocity shutting down.

(font:&quot;HKNova&quot;)[Stanley had never been to Burgerocity. However, he had heard its name pop up ever since he arrived in Webster Groves. Stanley got the bright idea to act as if he had been there before.

&quot;Oh, that&#39;s such a shame!&quot; Stanley said. &quot;I heard they had good... burgers.&quot;]

&quot;Yeah,&quot; Jed replied, &quot;I&#39;m gonna go investigate why it got shut down.&quot;

(font:&quot;HKNova&quot;)[&quot;Okay, have fun!&quot; said Stanley.]

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="198" name="Stanley Empty Store" tags="" position="2850,2400" size="100,100">&quot;Do you remember what was in that space next to the hardware store in Town Square?&quot; you ask Stanley.

(font:&quot;HKNova&quot;)[Stanley did not know what was in that space next to the hardware store in Town Square. Stanley doesn&#39;t really know anything about Webster Groves. But Stanley didn&#39;t want to deal with the embarrassment of not knowing the answer, so Stanley decided to fabricate an answer to the question.

&quot;Yes, I remember quite well,&quot; he said. &quot;It was a giant amusement park specifically made for cats!&quot;]

Jed just returned a blank stare at Stanley.

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="199" name="Stanley Bear" tags="" position="2850,2550" size="100,100">You show Stanley the bear you won at the arcade.

(font:&quot;HKNova&quot;)[&quot;What a beaut!&quot; exclaimed Stanley. &quot;Truly a work of art.&quot;]

&quot;Yeah, it cost me 2,500 tickets. Did you want it?&quot;

(font:&quot;HKNova&quot;)[&quot;Alas, I cannot,&quot; remorsed Stanley. &quot;My heart is with another inanimate object.&quot;]

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="200" name="Stanley VR" tags="" position="2850,2850" size="100,100">You explain to Stanley how you are both currently inside virtual reality.

(font:&quot;HKNova&quot;)[Stanley just recieved a piece of mind-blowing information. Something that could change his view of the world forever. Perhaps it would keep him awake at night. Instead, Stanley just sort-of shrugged it off.

&quot;Okay,&quot; replied Stanley.]

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="201" name="Stanley Outfit" tags="" position="2850,2700" size="100,100">You ask Stanley how he likes your outfit.

(if:$wearing is &quot;3d glasses&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Wow!&quot; said Stanley in awe, &quot;you can see the whole world in 3D with those, I reckon!&quot;]](if:$wearing is &quot;bomber jacket&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Cool!&quot; said Stanley, &quot;now you&#39;ll be able to fight against Time Dracule in style!&quot;]](if:$wearing is &quot;hat&quot;)[
\(font:&quot;HKNova&quot;)[Stanley stared at Jed&#39;s hat in awe. What an astonishing hat. A fabulous hat. Stanley had never seen a hat so fabulous, so bold, so beautiful. The only time he had seen a hat so glorious was when he put a bucket on his head.

&quot;I must know,&quot; said Stanley, &quot;where did you get that hat from?&quot;]

&quot;No idea. I just have it. To be honest, I don&#39;t even like it that much.&quot;

(font:&quot;HKNova&quot;)[Stanley felt a wave of sadness rush over him. He felt he had been cheated. The universe had presented such a great hat to him, just out of reach. As if to taunt him. Mock him. And its wearer didn&#39;t even appreciate its true immaculateness. What a joke.

&quot;Oh,&quot; pouted Stanley, trying not to show his true sorrow and anger. &quot;I think it looks great...&quot;]](if:$wearing is &quot;hoodie&quot;)[
\(font:&quot;HKNova&quot;)[Stanley stared at the symbol on Jed&#39;s hoodie for a while. &quot;I don&#39;t understand,&quot; said Stanley, &quot;what is that symbol supposed to mean?&quot;]

&quot;Try not to think about it too much.&quot;](if:$wearing is &quot;plumber outfit&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Is this for your job?&quot; asked Stanley.]

&quot;I&#39;m going to go stop a scandal involving the mayor!&quot;

(font:&quot;HKNova&quot;)[&quot;Interesting. Believe it or not, I&#39;ve done something similar.&quot;]](if:$wearing is &quot;vest&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Hmm,&quot; thought Stanley, &quot;I think I&#39;ve seen a vest like that before.&quot;]

&quot;Have you been inside Bosco&#39;s?&quot;

(font:&quot;HKNova&quot;)[&quot;Nope.&quot;]](if:$wearing is &quot;ski mask&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Please don&#39;t hurt me!&quot; cried Stanley, &quot;I don&#39;t have any money! If you really must take something, I have a buc-&quot;]

&quot;Hey, woah woah woah, calm down. It&#39;s just me, Jed.&quot;

(font:&quot;HKNova&quot;)[&quot;JED, HOW DARE YOU COME TO ROB M-&quot;]

&quot;I&#39;m not here to rob you! I&#39;m just wearing the mask!&quot;

(font:&quot;HKNova&quot;)[Stanley let out a sigh of relief. &quot;Goodness, you really scared me there, Jed!&quot;]](if:$wearing is &quot;cape&quot;)[
\(font:&quot;HKNova&quot;)[&quot;Who are you supposed to be?&quot; asked Stanley.]

&quot;I&#39;m SuperJed!&quot;

(font:&quot;HKNova&quot;)[&quot;Do you have any superpowers?&quot;]

&quot;I&#39;m //super good// at helping people!&quot;

(font:&quot;HKNova&quot;)[&quot;Oh.&quot; sighed Stanley, disappointed. For a small portion of his life, Stanley thought that he could&#39;ve met a real superhero. How quickly that dream was pinched out.]](if:$wearing is &quot;ghost&quot;)[
\(font:&quot;HKNova&quot;)[(cond:(current-date:) contains &quot;Oct 31&quot;,&quot;\&quot;AGHHH!\&quot; screamed Stanley. \&quot;A GHOST! Here, take my candy and leave!\&quot;&quot;,&quot;\&quot;AGHHH!\&quot; screamed Stanley. \&quot;A GHOST! Oh, it&#39;s just you Jed! You gave me quite a scare right then!\&quot;&quot;)]]

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="202" name="Eat Cereal 2" tags="" position="1850,3300" size="100,100">Okay, Jed, I am going to admit, that cereal seems incredibly off. Are you &#39;&#39;really&#39;&#39; sure you actually want to eat this?

[[Eat it-&gt;Explosion Ending]] 
[[Back-&gt;No Cereal]]</tw-passagedata><tw-passagedata pid="203" name="No Cereal" tags="" position="1850,3150" size="100,100">But you decided it was not worth the risk. After throwing away the rest of the cereal into the trash, you notice something odd. There is smoke emerging from the trash, and upon closer inspection, the smoke seems to be rising from the cereal!

You take the trash bag outside to the dumpster before the smoke detectors went off. After returning to the apartment, you feel a sudden wave of relief. What would have happened when you ate the cereal? Perhaps this was for the best.
\(set:$INV to it - (a:&quot;cereal&quot;))

[[Back-&gt;Jed&#39;s Kitchen]]</tw-passagedata><tw-passagedata pid="204" name="Explosion Ending" tags="" position="1975,3300" size="200,100">(unless:$ENDINGS contains &quot;Explosion&quot;)[(set:$ENDINGS to it + (a:&quot;Explosion&quot;))]
\(set:$JOURNAL to it + (a:&quot;Explosion&quot;))
\Jed, for whatever reason, decided that eating this cereal was a good idea. He took the bowl and headed over to the couch to watch some television.

After taking a single bite, the flavor was beyond overwhelming. It was the most chocolate-tasting thing Jed had ever experienced! This, along with the popping, made it very difficult to continue eating. Despite this, Jed was determined to finish this bowl of cereal.

After several bites, something strange started to happen. Smoke started rapidly emerging from the bowl, and the popping began to sound louder. But Jed did not care and continued eating anyway. 

Jed was going to finish this bowl if it was the last thing he did.

And last thing it was, as after a few more bites, a very loud pop could be heard from the bowl. And before Jed could figure out what was next...

The entire complex was instantly eliminated in a huge chocolate-scented explosion. Jed never took the time to read the instructions on the packaging, as these were actually water-activated fireworks!

(if:$ENDINGS contains all of (a:&quot;Explosion&quot;,&quot;Kyle&quot;,&quot;Ghost&quot;) and $seenSteve is false)[[[The End-&gt;WACKY STEVE Visit]]](else:)[[[The End-&gt;Waiting Room Entrance]]]</tw-passagedata><tw-passagedata pid="205" name="Stanley Favor" tags="" position="2850,3000" size="100,100">Jed began to walk away from Stanley&#39;s apartment.

(font:&quot;HKNova&quot;)[&quot;Wait!&quot; Stanley cried out. &quot;Before you go there is something I need to ask you. Do you happen to have any paint?&quot;]

&quot;What for?&quot; Jed asked.

(font:&quot;HKNova&quot;)[&quot;Don&#39;t worry about it, friend! Just let me know if you have any extra paint lying around.&quot;]

[[Continue-&gt;The Apartment Complex]] </tw-passagedata><tw-passagedata pid="206" name="Stanley Paint" tags="" position="2850,3150" size="100,100">(set:_a2 to (rotated-to: where it is &quot;paint&quot;,...$INV))
\(set:$INV to _a2&#39;s 2ndtolast)
\(set:$escapadeArrow to it + (a:&quot;ready&quot;))
\(set:$sidequests to it + (a:&quot;Stanley&quot;))
\Jed handed Stanley the bucket of paint. 

(font:&quot;HKNova&quot;)[&quot;Thanks, Jed!&quot; said Stanley. &quot;This will be very useful for my project.]

&quot;What exactly are you using it for?&quot;

(font:&quot;HKNova&quot;)[&quot;Okay, bye!&quot;]

[[Continue-&gt;Stanley&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="207" name="Notice Arrow" tags="" position="2150,800" size="100,100">As Jed was walking away from the mailboxes, he noticed a giant line originating from the apartment complex&#39;s entrance and going out into town. He walked up to it. At the beginning of the line was the text &quot;The Escapade Arrow™.&quot; Where did this come from?
\(set:$escapadeArrow to it + (a:&quot;seen&quot;))

(if:$prevPassage is &quot;home&quot;)[[[Continue-&gt;Jed&#39;s Apartment]]](else-if:$prevPassage is &quot;town&quot;)[[[Continue-&gt;East Side of Town]]](else:)[[[Continue-&gt;The Apartment Complex]]]</tw-passagedata><tw-passagedata pid="208" name="Button Area" tags="" position="400,1700" size="100,200">(if:visits is 1)[Jed followed the Arrow™. It eventually led him to a small building. This is a building that you&#39;ve noticed before, but never actually been inside. There are no markings on the outside to indicate what would be inside the building, for all you knew it was someone&#39;s home. But now it&#39;s almost like you&#39;re being invited in a way.

Despite better judgments, Jed carefully went inside the building. The building consists of one white room, with a plaque in the middle. The back wall is filled with 16 randomly colored buttons.
\(set:$escapadeArrow to it + (a:&quot;arrow&quot;))] 
\(else:)[You&#39;re now inside the button building. (either:&quot;It&#39;s quite cozy in here.&quot;,&quot;You hear what sounds like a very faint choir.&quot;,&quot;It&#39;s almost relaxing being in this room.&quot;,&quot;This must be therapeutic to some people.&quot;)]

[[Read the Plaque-&gt;Button Plaque]]
[[Push Buttons-&gt;Push Buttons]]
\(if:$toiletEnding and $buttonBathroom)[
[[Bathroom-&gt;Button Bathroom]]]
[[Exit-&gt;East Side of Town]] </tw-passagedata><tw-passagedata pid="209" name="Button Plaque" tags="" position="400,1950" size="100,100">You walk up to the plaque in the center of the room and begin reading.

=&gt;&lt;=
(font:&quot;Cinzel Decorative&quot;)[PRESS A BUTTON

SEE ITS RESULTS TOMORROW]

&lt;=
[[Continue-&gt;Button Area]] </tw-passagedata><tw-passagedata pid="210" name="Push Buttons" tags="" position="400,2100" size="100,100">You walk up to the wall of buttons. There are 16 buttons to choose from.

(if:$nextFun is 13)[&#39;&#39;Brown Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Brown Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 13)]]
(if:$nextFun is 6)[&#39;&#39;Lime Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Lime Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 6)]]
(if:$nextFun is 8)[&#39;&#39;Gray Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Gray Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 8)]]
(if:$nextFun is 5)[&#39;&#39;Yellow Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Yellow Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 5)]]
(if:$nextFun is 3)[&#39;&#39;Magenta Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Magenta Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 3)]]
(if:$nextFun is -1)[&#39;&#39;Red Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Red Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to -1)]]
(if:$nextFun is 10)[&#39;&#39;Cyan Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Cyan Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 10)]]
(if:$nextFun is 2)[&#39;&#39;Orange Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Orange Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 2)]]
(if:$nextFun is 7)[&#39;&#39;Pink Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Pink Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 7)]]
(if:$nextFun is 4)[&#39;&#39;Indigo Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Indigo Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 4)]]
(if:$nextFun is 15)[&#39;&#39;Beige Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Beige Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 15)]]
(if:$nextFun is 14)[&#39;&#39;Green Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Green Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 14)]]
(if:$nextFun is 11)[&#39;&#39;Purple Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Purple Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 11)]]
(if:$nextFun is 9)[&#39;&#39;Violet Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Violet Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 9)]]
(if:$nextFun is 1)[&#39;&#39;White Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;White Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 1)]]
(if:$nextFun is 16)[&#39;&#39;Black Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Black Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 16)]]
(if:$nextFun is 12)[&#39;&#39;Blue Button - Pressed&#39;&#39;](else:)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto:&quot;Blue Button&quot;,&quot;Push Buttons&quot;)[(set:$nextFun to 12)]]

[[Return-&gt;Button Area]] </tw-passagedata><tw-passagedata pid="211" name="Eat Fridge" tags="" position="1750,2250" size="100,100">(if:$furnitureEaten&#39;s length is 0)[
\Jed felt extremely hungry this morning. More hungry than usual. Simply getting a meal out of his fridge would not be enough to satisfy his hunger. So, Jed did what anyone in his scenario would do and eat the fridge.]
\(else-if:$furnitureEaten&#39;s length is 1)[
\The (print:$furnitureEaten&#39;s 1st) was not enough to satisfy Jed&#39;s hunger. Looking for something more to eat, Jed noticed the fridge. However, Jead realized that nothing inside the fridge would satisfy his hunger. So of course, he opted to eat the entire fridge.](else:)[
\Even after eating his (print:$furnitureEaten&#39;s 1st) and his (print:$furnitureEaten&#39;s 2nd), Jed&#39;s hunger was still not satisfied. Of course, the next logical step would be to go to the fridge. This was not because it has more food, but because its the biggest appliance Jed owns. 

&quot;Yes...&quot; Jed thought. &quot;This will do quite nicely.&quot;]
\(set:$furnitureEaten to it + (a:&quot;fridge&quot;))

Jed pointed his head upwards and hoisted the fridge above his face. He immediately let go of the fridge and let it drop into his mouth. It took him a few minutes to chew through the metal, but he eventually finished eating the fridge. He could definitely taste the (either:&quot;sodas&quot;,&quot;juice&quot;,&quot;milk&quot;,&quot;tea&quot;), (either:&quot;produce&quot;,&quot;eggs&quot;,&quot;yogurt&quot;,&quot;hummus&quot;), and (either:&quot;butter that were inside.&quot;,&quot;jam that were inside.&quot;,&quot;leftovers from 4 weeks ago that were inside.&quot;,&quot;ice cream that were inside. Wait. Jed, ice cream doesn&#39;t go in the fridge! You&#39;re supposed to put it in the freezer! Who raised you?&quot;)

[[Continue-&gt;Jed&#39;s Kitchen]] 
\(unless:$anomalies contains &quot;eat furniture&quot;)[(set:$anomalies to it + (a:&quot;eat furniture&quot;))]</tw-passagedata><tw-passagedata pid="212" name="Eat Coffee Maker" tags="" position="1750,2400" size="100,100">(if:$furnitureEaten&#39;s length is 0)[
\Jed felt extremely hungry this morning. More hungry than usual. However, since coffee is a liquid, it wouldn&#39;t do much to satisfy his hunger. Of course, Jed would have to eat something more solid: the coffee maker itself.]
\(else-if:$furnitureEaten&#39;s length is 1)[
\The (print:$furnitureEaten&#39;s 1st) was not enough to satisfy Jed&#39;s hunger. Looking for something more to eat, Jed noticed the coffee maker. Since coffee is a liquid, this wouldn&#39;t do much to satisfy his hunger. So he opted to eat the coffee maker itself.](else:)[
\Even after eating his (print:$furnitureEaten&#39;s 1st) and his (print:$furnitureEaten&#39;s 2nd), Jed&#39;s hunger was still not satisfied. The fridge especially helped alleviate it, so he just needed something small. The coffee maker immediately caught his eye.]
\(set:$furnitureEaten to it + (a:&quot;coffee maker&quot;))

Jed grabbed his coffee maker with both hands and pulled on it, ripping its cord out of the plug. He opened his mouth as wide as he could and shoved the coffee maker inside, swallowing it in one bite. And as a snack, Jed opened up his can of coffee grounds and poured them into his mouth.

[[Continue-&gt;Jed&#39;s Kitchen]] 
\(unless:$anomalies contains &quot;eat furniture&quot;)[(set:$anomalies to it + (a:&quot;eat furniture&quot;))]</tw-passagedata><tw-passagedata pid="213" name="Eat Cabinet" tags="" position="1750,2550" size="100,100">(if:$furnitureEaten&#39;s length is 0)[
\Jed felt extremely hungry this morning. More hungry than usual. Instead of going to the kitchen to satiate himself, he went into his bedroom. An ordinary meal would satisfy an ordinary appetite, but an unordinary appetite requires an unordinary meal. So, Jed decided that he was going to eat his cabinet.]
\(else-if:$furnitureEaten&#39;s length is 1)[
\The (print:$furnitureEaten&#39;s 1st) was not enough to satisfy Jed&#39;s hunger. When he walked into the bedroom, he heard his stomach growl. When he saw his cabinet, he could feel his mouth begin to salivate. Jed needed to eat his cabinet.](else:)[
\Even after eating his (print:$furnitureEaten&#39;s 1st) and his (print:$furnitureEaten&#39;s 2nd), Jed&#39;s hunger was still not satisfied. Eating everything he could in the kitchen, Jed went into his bedroom. His eyes immediately went to his cabinet.] But first, before Jed began eating, he opened the drawer and grabbed his train pass. Imagine the money needed to replace that!
\(set:$furnitureEaten to it + (a:&quot;cabinet&quot;))
\(set: $INV to it + (a:&quot;train pass&quot;))

Jed then leaned over the cabinet and grabbed onto its sides and began gnawing on the corner. Jed was biting on the wood so quickly it made an extremely loud sound that resonated throughout his entire apartment. Jed made quick work of the cabinet until nothing was left but small wood shavings where the cabinet used to be.

[[Continue-&gt;Jed&#39;s Bedroom]] 
\(unless:$anomalies contains &quot;eat furniture&quot;)[(set:$anomalies to it + (a:&quot;eat furniture&quot;))]</tw-passagedata><tw-passagedata pid="214" name="Gameshow Lose" tags="" position="800,3750" size="100,100">&quot;I&#39;m sorry Jed,&quot; the host says sadly, &quot;but that is incorrect. That means it&#39;s game over for you! (if:$questionNum is 2)[(set:$winnings to 0)Since you messed up on the first question, you do not get any money.](else-if:$questionNum is 3)[(set:$winnings to 20)Since you only got one question right, you only win $20.](else-if:$questionNum is 4)[(set:$winnings to 70)But, you got the first two right, so you get to go home with $70!](else-if:$questionNum is 5)[(set:$winnings to 150)You got three questions correct, and all that together adds up to $150!](else-if:$questionNum is 6)[(set:$winnings to 300)You were so close but weren&#39;t able to get that last question. But you&#39;re going home empty-handed, because all together you won $300!]&quot; The host then turns to the crowd. &quot;That&#39;s our show, folks! Tune in next time we try to solve this &#39;&#39;Mayor Mystery Mystery&#39;&#39;!&quot; 

Jed then blinks and finds himself back at his apartment complex. He reached in the mailbox in an attempt to try and look at the letter that transported him to the gameshow but didn&#39;t find it. (unless:$winnings is 0)[However, he did find $$winnings in cash.](else:)[How strange...]
\(set:$MONEY to it + $winnings)

[[Continue-&gt;The Apartment Complex]] </tw-passagedata><tw-passagedata pid="215" name="Question 2" tags="" position="1100,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Jed&#39;s Jams&quot;,&quot;Jedwelry&quot;,&quot;Juice by Jed&quot;,&quot;Junior Jed&#39;s Jackets&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) What is the name of your dream shop?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="216" name="Gameshow Win" tags="" position="1700,3750" size="100,100">&quot;CONGRATULATIONS!&quot; the host shouted. &quot;You answered all 5 questions correctly, and won the big prize of $500!&quot;
\(set:$winnings to 500)

The crowd began shouting and cheering as loud as they could. They started to chant. &quot;Jed! Jed! Jed! Jed!&quot;

The host then turns to the crowd. &quot;That&#39;s our show, folks! Tune in next time we try to solve this &#39;&#39;Mayor Mystery Mystery&#39;&#39;!&quot; 

Jed then blinks and finds himself back at his apartment complex. He reached in the mailbox in an attempt to try and look at the letter that transported him to the gameshow but didn&#39;t find it. (unless:$winnings is 0)[However, he did find $$winnings in cash.](else:)[How strange...]
\(set:$MONEY to it + $winnings)

[[Continue-&gt;The Apartment Complex]] </tw-passagedata><tw-passagedata pid="217" name="Question 3" tags="" position="1250,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;$15&quot;,&quot;$20&quot;,&quot;$25&quot;,&quot;$30&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) How much did the plumber outfit cost?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="218" name="Question 4" tags="" position="1400,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Five&quot;,&quot;Four&quot;,&quot;Six&quot;,&quot;Seven&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) How many different burgers does Burgerocity sell?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="219" name="Question 5" tags="" position="1550,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;20&quot;,&quot;30&quot;,&quot;15&quot;,&quot;25&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) How much does a haircut from the local barber cost?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="220" name="Question 6" tags="" position="1700,3600" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Taste of Heaven&quot;,&quot;The Hidden Garden&quot;,&quot;The Handmade Haven&quot;,&quot;Heirloom Home&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) What used to be in the empty lot in Town Square?&quot; 
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="221" name="Question 7" tags="" position="950,3750" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Brenton&quot;,&quot;Brendon&quot;,&quot;Brandon&quot;,&quot;Brently&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) Who developed the button mashing game at Impulse Arcade?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="222" name="Question 8" tags="" position="1100,3750" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;4&quot;,&quot;2&quot;,&quot;3&quot;,&quot;5&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) How many times can you drink coffee before you run out of coffee beans?&quot;
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="223" name="Question 9" tags="" position="1250,3750" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;//The Giant Suitcase//&quot;,&quot;//The Magnificent Mop//&quot;,&quot;//The Formidable Fruitcake//&quot;,&quot;//The Original Pidgeon//&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) What&#39;s the name of the book you forgot to return to the library?
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="224" name="Question 10" tags="" position="1400,3750" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;A Pirate Costume&quot;,&quot;A Foam-Dart Gun&quot;,&quot;Lots of Paint&quot;,&quot;A Crowbar&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) What&#39;s inside that cardboard box in the back of the hardware store?
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="225" name="Question 11" tags="" position="1550,3750" size="100,100">(if:$questionNum is not 1 and $prevAnswer is not $correct)[(go-to:&quot;Gameshow Lose&quot;)]
\(if:$questionNum is 6)[(go-to:&quot;Gameshow Win&quot;)]
\(set:$options to (a:&quot;Eleven&quot;,&quot;Nine&quot;,&quot;Thirteen&quot;,&quot;Fifteen&quot;))
\(set:$curQ to (shuffled:...$options))
\(set: _i to 0)
\(for: each _item, ...$curQ)[(set:_i to it + 1)(if:_item is $options&#39;s 1st)[(set:$correct to _i)]]
\(if:$questionNum is 1)[(cond:$prevAnswer is &quot;yes&quot;,&#39;&quot;That\&#39;s the spirit!&quot; the host exclaims. &quot;&#39;,&#39;&quot;Too bad, we\&#39;re starting anyway!&quot; the host exclaims. &quot;&#39;)](else:)[&quot;That&#39;s correct, (either:&quot;good job&quot;,&quot;congrats&quot;,&quot;good on ya&quot;,&quot;keep it going&quot;,&quot;well done&quot;)! ](print: ($questionNum) of $qwords) How many toilets are there in Webster Groves?
\(set:$questionNum to it + 1)

(link-reveal-goto: $curQ&#39;s 1st,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 1)]
(link-reveal-goto: $curQ&#39;s 2nd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 2)]
(link-reveal-goto: $curQ&#39;s 3rd,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 3)]
(link-reveal-goto: $curQ&#39;s 4th,&quot;Question &quot; + (str:$questionNum of $questions))[(set:$prevAnswer to 4)]</tw-passagedata><tw-passagedata pid="226" name="Construction Area" tags="" position="4900,1700" size="100,200">(if: $STATS&#39;s 9th &lt; 7)[
\(if:$wearing is &quot;icloak&quot;)[
\Jed walks up to the construction zone. Due to his invisibility cloak, no one was able to see him and give him a warning. Jed almost got hit by the crane of an excavator.

Jed, you might want to get out of this area. It&#39;s dangerous to just walk around construction equipment like this. It&#39;s an //invisibility// cloak after not, not an //invincibility// cloak.]
\(else:)[
\(set:$constructionDialogue to (a:&quot;&quot;,&quot;&quot;,&quot;in 4 days&quot;,&quot;in 3 days&quot;,&quot;in a couple days&quot;,&quot;tomorrow&quot;))
\Jed walks up to the construction zone.

&quot;Careful, stranger,&quot; warns the foreman, &quot;don&#39;t get too close!&quot;

&quot;What are you guys doing here?&quot; Jed asks.

&quot;We&#39;re working on something. Come back (print:($STATS&#39;s 9th) of $constructionDialogue) and you&#39;ll see.]]
\(else:)[
\Jed walks up to the construction zone and noticed that all of the workers were gone. What could it mean? The construction was supposed to be finished by now.

Looking around, Jed noticed a poster hung up nearby.]

(unless: $STATS&#39;s 9th &lt; 7)[[[Look at Poster-&gt;Construction Poster]]
]
\(if:$campPassed)[[[Finish the Job-&gt;Construction Finish]]
]
\(if:$toiletEnding)[(if:$visitsPortAPotty is 0)[[[Bathroom-&gt;Porta-Potty]]](else:)[[[Porta-Potty-&gt;Porta-Potty]]]
]
\[[Exit-&gt;Town Square]]</tw-passagedata><tw-passagedata pid="227" name="Hardware Bald" tags="" position="4225,2275" size="100,100">(set:$INV to it + (a:&quot;bald card&quot;))
\(set:$visitsHardwareBald to it + 1)
\&quot;Hey buddy, before you go,&quot; the clerk says, &quot;I swear I&#39;ve seen you before with hair. That a new look?&quot;

&quot;Yeah,&quot; Jed replies. &quot;I&#39;m bald now.&quot;

&quot;Well then, you might wanna take a look at this.&quot; The clerk then hands you a small business card. The front reads &quot;Webster Groves Secret Bald Society.&quot; 

Jed flipped over the card and see some text on the back: &quot;//Greg and Ron//.&quot; Jed put the card in his pocket and walked out of the hardware store.

[[Continue-&gt;Town Square]] </tw-passagedata><tw-passagedata pid="228" name="Book 5" tags="" position="1250,2550" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[Greg and Ron]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by Sharmaine Henning]

&lt;==
---
(font:&quot;Trebuchet MS&quot;)[
\It was time for Greg to get a haircut. He wanted to try something new.

&quot;I&#39;m going to shave off all my hair!&quot; he said.

&quot;Are you sure you want to do that?&quot; asked Ron.

&quot;Yes!&quot; said Greg. &quot;I want to do it. But I&#39;m scared.&quot;

&quot;Don&#39;t worry,&quot; said Ron, &quot;I will go to the barber shop with you.&quot;

Greg and Ron went to the barbershop together. Greg went up to the counter and checked in. He was sat down by a barber named Peter. &quot;What are we wanting today?&quot;

&quot;I want to shave it all off!&quot; Greg said.

&quot;Yeah!&quot; Ron said. &quot;He wants to shave it all!&quot;

&quot;Okay,&quot; Peter said. He then began to shave Ron&#39;s head until his hair was all gone!]

You flip to the next page, but the pages are all ripped out for some reason.

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="229" name="Pull the Book" tags="" position="1250,2400" size="100,100">You pull out //Greg and Ron// and start to flip through the pages. When you get to the end, you notice a small slot in the back cover. You realize that the card the hardware store clerk gave you fits perfectly into it.

You place the card in the slot, then place the book back in the bookshelf. The bookshelf then moves to the left, revealing a secret passage behind it.

[[Continue-&gt;Library Basement]]</tw-passagedata><tw-passagedata pid="230" name="Find Cash Stash" tags="" position="2200,3000" size="100,100">(set:$INV to it + (a:&quot;cash stash&quot;))(set:$MONEY to it + 50)
\Jed looked around the room for his cash stash. Normally he keeps it in a lockbox in his cabinet, but seeing as he ate it this morning, he had to look around his room. Eventually, he found the lockbox under his bed. He grabbed it and inputted the code 2845, which caused it to open up. Inside was a roll of $50. Make sure not to waste this too, Jed.

[[Continue-&gt;Jed&#39;s Bedroom]] </tw-passagedata><tw-passagedata pid="231" name="Book 6" tags="" position="1250,2700" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[The Woman and the Lilac]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by &lt;a href=&quot;https://lipamanka.gay/stories/the-woman-and-the-lilac&quot; target=&quot;_blank&quot;&gt;Seán&lt;/a&gt;]

&lt;==
---
(font:&quot;Trebuchet MS&quot;)[
\There was once a woman who lived in a small cottage behind a dome. She could speak to flowers. She would talk to them, and read their replies on their petals. Nobody else could to it, as far as she knew, and she kept it secret from the world.

One day, she asked a lilac a question. “Hello, ms. lilac,” she said. “Am I the only one who has spoken to you?”

“No,” replied the lilac. “We flowers may seem quick and done but we remember where we come from. Many years ago, flowers that came before me spoke to others like you. I have bloomed recently and I have not seen much, but the flowers I come from have spoken to humans before.”

The woman blinked hard. Had she been wrong? Were there others who could talk to flowers as well? She wondered. What if she put a message in a flower? What if she told a flower to bring a message to other flower-speakers? So she spoke to the lilac. “ms lilac, please tell the other humans that you speak to that I exist, and that I live in the small cottage behind the dome.”

The lilac spoke to the woman. “Yes, I will.”

Over the following eight days, every day the woman would visit the lilac. She would say, every day, “ms lilac, has anyone spoken to you besides me?”

And every day, sure enough, the lilac would say “no, not a soul.” And every day, the lilac grew older and started to wilt.

Come the ninth day, the woman woke and walked into the forest, and found that her lilac had died. She felt fire in her heart and frost in her skull, for she would never again meet this lilac again.

Seasons passed, and she wept and mourned and grew alongside them. Finally, the cycle of the year ended, someone knocked on the door to her small cottage behind the dome. She opened it and saw a hooden figure. “Hello,” they said. “I can speak to flowers too.” The two of them spoke for hours about how neither had ever met one who could talk to flowers before. They discussed the nuanced differences between their methods, and the hooded figure told the woman that they lived at the other end of the village, next to the clocktower.

The two of them swore that if they were to ever find another person who could talk to flowers, they would tell each other.]

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="232" name="Rafael Sidequest" tags="" position="2400,3000" size="100,100">(if:$rafaelQuest does not contain &quot;step1&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step1&quot;))
\&quot;Do you have a sidequest for me?&quot; you ask Rafael.

&quot;What do you mean?&quot; Rafael asks.

&quot;Well, (if:$sidequests&#39;s length is 1)[I just did one for (print:$sidequests&#39;s 1st), so I was wondering if you had anything for me.](else-if:$sidequests&#39;s length is 2)[I did one for (print:$sidequests&#39;s 1st) and one for (print:$sidequests&#39;s 2nd), so I was wondering if you had something for me.](else:)[I&#39;ve done one for (print:$sidequests&#39;s 1st), one for (print:$sidequests&#39;s 2nd), and one for (print:$sidequests&#39;s 3rd), so obviously you should have one too!]&quot;

&quot;Okay, uhh, well a couple days ago, I was getting a haircut at the barber shop and I lost a pair of rare sunglasses. They&#39;re a very unique shade of bright green. I got them from a friend a while back. Would be cool if you could find those, I guess.&quot;

Jed puts his hand on Rafael&#39;s shoulder. &quot;I will not let you down.&quot;]
\(else-if:$rafaelQuest does not contain &quot;step2&quot;)[
\&quot;Do you want a progress update on the sidequest?&quot; you ask Rafael.

&quot;Uh, sure.&quot;

&quot;I haven&#39;t done anything yet.&quot;

&quot;Haha, okay Jed. You got me!&quot;]
\(else-if:$rafaelQuest does not contain &quot;step3&quot;)[
\&quot;Do you want a progress update on the sidequest?&quot; you ask Rafael.

&quot;Uh, sure.&quot;

&quot;So the barber found your sunglasses but he gave them to the clothing shop owner because they looked so cool.&quot;

&quot;Oh, that&#39;s pretty cool actually. Wait, why did you come all the way back to East Side then?&quot;

&quot;Sorry, no time to explain, gotta go finish your quest!&quot;]
\(else-if:$rafaelQuest does not contain &quot;step4&quot;)[
\&quot;Do you want a progress update on the sidequest?&quot; you ask Rafael.

&quot;Uh, sure.&quot;

&quot;So the barber gave your glasses to the clothing shop clerk, who sent them over to the hardware store owner because they seemed like something he would wear.&quot;

&quot;Hmm, that&#39;s quite the jumble. Wait, why did you come back to East Side instead of going to Town Square?&quot;

&quot;Sorry, no time to explain, gotta go finish your quest!&quot;]
\(else-if:$rafaelQuest does not contain &quot;step5&quot;)[
\&quot;Do you want a progress update on the sidequest?&quot; you ask Rafael.

&quot;Uh, sure.&quot;

&quot;So your glasses went from the barber shop to the clothing store to the hardware store to the library.&quot;

&quot;Interesting. Who&#39;s moving around my glasses so much?&quot;

&quot;They&#39;re trying to figure out who owns them but they keep making assumptions about who the owner is.&quot;

&quot;Well, you know what they say about assumptions. Don&#39;t do it.&quot;]
\(else:)[
\&quot;Do you want a progress update on the sidequest?&quot; you ask Rafael.

&quot;Uh, sure.&quot;

&quot;So your glasses went from the barber shop to the clothing store to the hardware store to the library to the supermarket.&quot;

&quot;Interesting. Who&#39;s moving around my glasses so much?&quot;

&quot;They&#39;re trying to figure out who owns them but they keep making assumptions about who the owner is.&quot;

&quot;Well, you know what they say about assumptions. Don&#39;t do it.&quot;]

[[Continue-&gt;Rafael&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="233" name="Sunglasses Ending" tags="" position="2350,3300" size="200,100">You start to walk away from Rafael, content you have completed his sidequest.

Rafael turns around to walk into his apartment. However, he trips and falls, breaking his sunglasses. Suddenly, they start glowing and beeping.

&quot;What&#39;s happening?&quot; you ask.

&quot;Uhhh, I have no i-&quot;

The sunglasses then explode, causing an absolutely gigantic amount of destruction. The explosion was so massive, in fact, that Webster Groves ceased to exist. The entire town has been wiped off the face of the Earth.
\(unless:$ENDINGS contains &quot;Sunglasses&quot;)[(set:$ENDINGS to it + (a:&quot;Sunglasses&quot;))]
\(set:$JOURNAL to it + (a:&quot;Sunglasses&quot;))

[[The End-&gt;Waiting Room Entrance]]</tw-passagedata><tw-passagedata pid="234" name="Rafael Sunglasses" tags="" position="2400,3150" size="100,100">You pull out the bright green sunglasses you found in the trash at Bosco&#39;s. &quot;Are these it?&quot; you ask Rafael.

&quot;Yes, they are!&quot; he shouts. &quot;Where were they?&quot;

&quot;At Bosco&#39;s. I found them in the tr- the lost and found!&quot;

&quot;Awesome, thank you, Jed!&quot;

[[Continue-&gt;Sunglasses Ending]] </tw-passagedata><tw-passagedata pid="235" name="Barber Shop Sunglasses" tags="" position="5900,2250" size="100,100">(if:$rafaelQuest does not contain &quot;step2&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step2&quot;))
\You walk up to the barber at the front desk. &quot;Have you seen a pair of light green sunglasses around?&quot; you ask. &quot;My friend lost a pair here a few days ago.&quot;

&quot;You know what,&quot; the barber says, &quot;I actually did!&quot;

&quot;Really?&quot; Jed exclaims. &quot;Awesome!&quot;

&quot;However, I thought they belonged to Tactical Bold&#39;s owner, the clothing store, &#39;cause they looked like something he would wear. I think he&#39;s still holding on to them.&quot;

&quot;Oh, okay. I&#39;ll go check over there real quick, thanks.&quot;]
\(else:)[
\You ask the barber to remind you where Rafael&#39;s sunglasses went.

&quot;They should be at Tactical Bold, I sent them over there.&quot;]

[[Continue-&gt;Barber Shop]]</tw-passagedata><tw-passagedata pid="236" name="Clothing Store Sunglasses" tags="" position="6200,2400" size="100,100">(if:$rafaelQuest does not contain &quot;step3&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step3&quot;))
\You walk up to the clothing store clerk. &quot;I was looking for a pair of bright green sunglasses that one of my friends lost at the barber shop, and the barber says that he gave them to you.&quot;

&quot;Ah yes,&quot; the clerk recalls, &quot;what a fabulous pair of sunglasses! Your friend is very lucky to own a pair such as those.&quot;

&quot;Great, do you still have them?&quot; you ask.

&quot;No, sorry. I thought they belonged to the hardware store clerk, so I gave them to him.&quot;

&quot;Oh, okay. Thanks anyway.&quot;]
\(else:)[
\You ask the clerk to remind you where Rafael&#39;s sunglasses went.

&quot;I sent them over to the Town Square Hardware Store.&quot;]

[[Continue-&gt;Clothing Store]] </tw-passagedata><tw-passagedata pid="237" name="Hardware Store Sunglasses" tags="" position="4235,2416" size="100,100">(if:$rafaelQuest does not contain &quot;step4&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step4&quot;))
\You walk up to the hardware store clerk. &quot;I was looking for a pair of bright green sunglasses that one of my friends lost, the clothing store guy says he sent them your way.&quot;

&quot;Sunglasses, you say?&quot; the clerk asks. &quot;What did they look like again?&quot;

&quot;Bright green.&quot;

&quot;Okay, yeah I did see a pair like that.&quot;

&quot;Great!&quot;

&quot;But I thought they belonged to the librarian back in East Side. Sorry.&quot;

&quot;Hmm, I think I&#39;m sensing a pattern here.&quot;]
\(else:)[
\You ask the clerk to remind you where Rafael&#39;s sunglasses went.

&quot;I sent them over to the East Side library.&quot;

&quot;Has the librarian even worn sunglasses at all in her life?&quot;

&quot;I mean, I dunno. But if she ever did it would be those! Haha...&quot;]

[[Continue-&gt;Hardware Store]] </tw-passagedata><tw-passagedata pid="238" name="Library Sunglasses" tags="" position="1250,1950" size="100,100">(if:$rafaelQuest does not contain &quot;step5&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step5&quot;))
\You walk up to the librarian. &quot;I was looking for a pair of bright green sunglasses that one of my friends lost, the hardware store clerk says he sent it over here.&quot;

&quot;So, the funny thing is,&quot; the librarian explains, &quot;I have no idea why he sent them to me. I just gave them to the cashiers over at Bosco&#39;s since they have a lost and found.&quot;

&quot;Okay, I can actually respect that. Thank you!&quot;

&quot;You&#39;re welcome, I guess. It was just common sense.&quot;

&quot;Yeah, long story.&quot;]
\(else:)[
\You ask the librarian to remind you where Rafael&#39;s sunglasses went.

&quot;I gave them to the cashiers over at Bosco&#39;s.&quot;]

[[Continue-&gt;Library]] </tw-passagedata><tw-passagedata pid="239" name="Bosco&#39;s Sunglasses" tags="" position="850,2100" size="100,100">(if:$rafaelQuest does not contain &quot;step6&quot;)[
\(set:$rafaelQuest to it + (a:&quot;step6&quot;))(set:$INV to it + (a:&quot;bombglasses&quot;))
\You walk up to the customer service desk. &quot;I was looking for a pair of bright green sunglasses that one of my friends lost, the librarian said she brought them here.&quot;

&quot;Yes sir,&quot; the manager says, &quot;I can go double check our lost and found and see if we have it! Be right back.&quot;

The manager walks around the corner to check some spot out of sight. You look down at the trash can next to you. Inside it, you see a pair of bright green sunglasses. You pick them up, and you see a small radioactive symbol on both sides. These might be Rafael&#39;s...]
\(else:)[
\&quot;Sorry sir,&quot; the manager says, &quot;I didn&#39;t find what you were describing in our lost and found.&quot;]

[[Continue-&gt;Bosco&#39;s Family Food Store]] </tw-passagedata><tw-passagedata pid="240" name="Gas Station" tags="" position="6500,1700" size="100,200">You walk into Gasology, the West Side gas station. It feels a little wet in here...

(if:$wearing is &quot;icloak&quot;)[(link-goto:&quot;Checkout&quot;,&quot;Ghost Purchase&quot;)](else:)[[[Checkout-&gt;Gas Station Checkout]]]
[[Lottery Machine-&gt;Lotto Machine]]
\(if:$toiletEnding)[
[[Bathroom-&gt;Gas Station Bathroom]]]
[[Exit-&gt;West Side of Town]] </tw-passagedata><tw-passagedata pid="241" name="Lotto Machine" tags="" position="6500,2100" size="100,100">You walk up to the lotto machine. Here you can print off scratch tickets that you can cash out at the register. Next to the lotto machine is a framed photograph of a man.

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

[[Look at Photo-&gt;Lotto Photo]]
(if:$MONEY &gt;= 1)[[[$1 Ticket-&gt;Ticket 1]]](else:)[[[$1 Ticket-&gt;Too Poor]]]
(if:$MONEY &gt;= 5)[[[$5 Ticket-&gt;Ticket 5]]](else:)[[[$5 Ticket-&gt;Too Poor]]]
(if:$MONEY &gt;= 10)[[[$10 Ticket-&gt;Ticket 10]]](else:)[[[$10 Ticket-&gt;Too Poor]]]
(if:$MONEY &gt;= 30)[[[$30 Ticket-&gt;Ticket 30]]](else:)[[[$30 Ticket-&gt;Too Poor]]]

[[Exit-&gt;Gas Station]] </tw-passagedata><tw-passagedata pid="242" name="Gas Station Bathroom" tags="" position="6500,2250" size="100,100">(if:$gasStationPurchase)[
\You go into the gas station&#39;s bathroom, and...

There&#39;s no toilet in here. There&#39;s just a hole in the ground where the toilet should be. 

Was the toilet stolen? If it was, how are the police going to find the culprit? It doesn&#39;t look like they have anything to go on.

Right, I&#39;ll see myself out. Sorry.]
\(else:)[
\You start to walk towards the gas station bathroom but the cashier shouts at you.

&quot;Hey, can&#39;t you read?&quot; she nags. &quot;Paying customers only!&quot;]

[[Continue-&gt;Gas Station]] </tw-passagedata><tw-passagedata pid="243" name="Gas Station Checkout" tags="" position="6500,1950" size="100,100">&quot;How ya doin&#39;, Jed?&quot; the cashier greets.

Current funds: $(if:$MONEY &gt; 999)[(digit-format:&quot;###,###&quot;,$MONEY)](else:)[$MONEY]

(if:$winningTickets &gt; 0)[[[Cash Lotto Tickets-&gt;Cash Tickets]]
]
\(if:$seenSteve and $ENDINGS does not contain &quot;WACKY STEVE&quot;)[(if:$INV does not contain &quot;WS7&quot; and $MONEY &gt;= 18)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &#39;RIGHT LEG OF WACKY STEVE - $18&#39;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;WS7&quot;))(set:$MONEY to it - 18)(set:$STATS&#39;s 3rd to it + 18)]](else:)[(if:$INV contains &quot;WS7&quot;)[RIGHT LEG OF WACKY STEVE - Sold Out](else:)[[[RIGHT LEG OF WACKY STEVE - $18-&gt;Too Poor]]]]
]\
(if:$MONEY &gt;= 3)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Chips - $3&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;chips&quot;))(set:$MONEY to it - 3)(set:$STATS&#39;s 3rd to it + 3)(set:$gasStationPurchase to true)]](else:)[[[Chips - $3-&gt;Too Poor]]]
(if:(current-date:) contains &quot;Oct&quot;)[(if:$MONEY &gt;= 2)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Halloween Candy - $2&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;candy&quot;))(set:$MONEY to it - 2)(set:$STATS&#39;s 3rd to it + 2)(set:$gasStationPurchase to true)]](else:)[[[Halloween Candy - $2-&gt;Too Poor]]]](else:)[(if:$MONEY &gt;= 1)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Candy - $1&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;candy&quot;))(set:$MONEY to it - 1)(set:$STATS&#39;s 3rd to it + 1)(set:$gasStationPurchase to true)]](else:)[[[Candy - $1-&gt;Too Poor]]]]
(if:$MONEY &gt;= 3)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Soda Bottle - $3&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;soda&quot;))(set:$MONEY to it - 3)(set:$STATS&#39;s 3rd to it + 3)(set:$gasStationPurchase to true)]](else:)[[[Soda Bottle - $3-&gt;Too Poor]]]
(if:$MONEY &gt;= 5)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Coffee - $5&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;coffee&quot;))(set:$MONEY to it - 5)(set:$STATS&#39;s 3rd to it + 5)(set:$gasStationPurchase to true)]](else:)[[[Coffee - $5-&gt;Too Poor]]]
(if:$MONEY &gt;= 7)[(t8n-arrive: &quot;instant&quot;)+(t8n-depart: &quot;instant&quot;)+(link-reveal-goto: &quot;Big Slushie - $7&quot;,&quot;Gas Station Checkout&quot;)[(set:$INV to it + (a:&quot;slushie&quot;))(set:$MONEY to it - 7)(set:$STATS&#39;s 3rd to it + 7)(set:$gasStationPurchase to true)]](else:)[[[Big Slushie - $7-&gt;Too Poor]]]

[[Exit-&gt;Gas Station]] </tw-passagedata><tw-passagedata pid="244" name="Lotto Photo" tags="" position="6650,2250" size="100,100">You look at the photo framed next to the lottery machine. It&#39;s a picture of a man, but he looks like he was photographed unwillingly. Underneath, it says &quot;WG&#39;s Biggest Gambler: $150.&quot;

[[Continue-&gt;Lotto Machine]] </tw-passagedata><tw-passagedata pid="245" name="Ticket 1" tags="" position="6500,2400" size="100,100">(set:$ticketCost to 1)
\(set:$winned to (a:))
\(set:$MONEY to it - $ticketCost)
\(set:$STATS&#39;s 3rd to it + $ticketCost)
\(set:$lottoSpendings to it + $ticketCost)
\(set:$scratches to 0)
\(set:$winning to (shuffled:...(range:1,30)))
\(set:$winning to its 1stto3rd)
\(set:$lottoNum to (shuffled:...(range:1,30)))
\(set:$lottoNum to its 1stto6th)
\(if:$lottoSpendings &gt; 150)[(goto:&quot;Lotto Intervention&quot;)]
\You purchase a $$ticketCost ticket from the machine. Getting one match gets your money back, two gives you triple back, and three gives you tenfold! 

The three numbers to get are (print:$winning&#39;s 1st), (print:$winning&#39;s 2nd), and (print:$winning&#39;s 3rd).

(live:0.01s)[
\(if:$scratches is 0)[Your numbers are...]
\(else-if:$scratches is 1)[Your numbers are: (print:$lottoNum&#39;s 1st)]
\(else-if:$scratches is 2)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd)]
\(else-if:$scratches is 3)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd)]
\(else-if:$scratches is 4)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th)]
\(else-if:$scratches is 5)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th)]
\(else-if:$scratches is 6)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th), and (print:$lottoNum&#39;s 6th).]
\]

|scratch&gt;[(link-repeat:&quot;Scratch&quot;)[(set:$scratches to it + 1)(if:$scratches is 6)[(replace:?scratch)[
\(if:$lottoNum contains $winning&#39;s 1st)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 2nd)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 3rd)[(set:$winned to it + (a:&quot;yes&quot;))]
\(if:$winned&#39;s length is 0)[
\Sorry Jed, looks like you didn&#39;t win any money...]
\(if:$winned&#39;s length is 1)[
\You got one match, which means you get your money back!
\(set:$winningTickets to it + $ticketCost)
\(set:$STATS&#39;s 11th to it + $ticketCost)]
\(if:$winned&#39;s length is 2)[
\Congratulations, you got two matches so you get $(print:$ticketCost * 3) back!
\(set:$winningTickets to it + ($ticketCost * 3))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 3))]
\(if:$winned&#39;s length is 3)[
\Wow, you got all three so you hit the jackpot! You get $(print:$ticketCost * 10) back!
\(set:$winningTickets to it + ($ticketCost * 10))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 10))]

[[Continue-&gt;Lotto Machine]]]]]]</tw-passagedata><tw-passagedata pid="246" name="Ticket 5" tags="" position="6650,2400" size="100,100">(set:$ticketCost to 5)
\(set:$winned to (a:))
\(set:$MONEY to it - $ticketCost)
\(set:$STATS&#39;s 3rd to it + $ticketCost)
\(set:$lottoSpendings to it + $ticketCost)
\(set:$scratches to 0)
\(set:$winning to (shuffled:...(range:1,30)))
\(set:$winning to its 1stto3rd)
\(set:$lottoNum to (shuffled:...(range:1,30)))
\(set:$lottoNum to its 1stto6th)
\(if:$lottoSpendings &gt; 150)[(goto:&quot;Lotto Intervention&quot;)]
\You purchase a $$ticketCost ticket from the machine. Getting one match gets your money back, two gives you triple back, and three gives you tenfold! 

The three numbers to get are (print:$winning&#39;s 1st), (print:$winning&#39;s 2nd), and (print:$winning&#39;s 3rd).

(live:0.01s)[
\(if:$scratches is 0)[Your numbers are...]
\(else-if:$scratches is 1)[Your numbers are: (print:$lottoNum&#39;s 1st)]
\(else-if:$scratches is 2)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd)]
\(else-if:$scratches is 3)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd)]
\(else-if:$scratches is 4)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th)]
\(else-if:$scratches is 5)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th)]
\(else-if:$scratches is 6)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th), and (print:$lottoNum&#39;s 6th).]
\]

|scratch&gt;[(link-repeat:&quot;Scratch&quot;)[(set:$scratches to it + 1)(if:$scratches is 6)[(replace:?scratch)[
\(if:$lottoNum contains $winning&#39;s 1st)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 2nd)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 3rd)[(set:$winned to it + (a:&quot;yes&quot;))]
\(if:$winned&#39;s length is 0)[
\Sorry Jed, looks like you didn&#39;t win any money...]
\(if:$winned&#39;s length is 1)[
\You got one match, which means you get your money back!
\(set:$winningTickets to it + $ticketCost)
\(set:$STATS&#39;s 11th to it + $ticketCost)]
\(if:$winned&#39;s length is 2)[
\Congratulations, you got two matches so you get $(print:$ticketCost * 3) back!
\(set:$winningTickets to it + ($ticketCost * 3))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 3))]
\(if:$winned&#39;s length is 3)[
\Wow, you got all three so you hit the jackpot! You get $(print:$ticketCost * 10) back!
\(set:$winningTickets to it + ($ticketCost * 10))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 10))]

[[Continue-&gt;Lotto Machine]]]]]]</tw-passagedata><tw-passagedata pid="247" name="Ticket 10" tags="" position="6500,2550" size="100,100">(set:$ticketCost to 10)
\(set:$winned to (a:))
\(set:$MONEY to it - $ticketCost)
\(set:$STATS&#39;s 3rd to it + $ticketCost)
\(set:$lottoSpendings to it + $ticketCost)
\(set:$scratches to 0)
\(set:$winning to (shuffled:...(range:1,30)))
\(set:$winning to its 1stto3rd)
\(set:$lottoNum to (shuffled:...(range:1,30)))
\(set:$lottoNum to its 1stto6th)
\(if:$lottoSpendings &gt; 150)[(goto:&quot;Lotto Intervention&quot;)]
\You purchase a $$ticketCost ticket from the machine. Getting one match gets your money back, two gives you triple back, and three gives you tenfold! 

The three numbers to get are (print:$winning&#39;s 1st), (print:$winning&#39;s 2nd), and (print:$winning&#39;s 3rd).

(live:0.01s)[
\(if:$scratches is 0)[Your numbers are...]
\(else-if:$scratches is 1)[Your numbers are: (print:$lottoNum&#39;s 1st)]
\(else-if:$scratches is 2)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd)]
\(else-if:$scratches is 3)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd)]
\(else-if:$scratches is 4)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th)]
\(else-if:$scratches is 5)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th)]
\(else-if:$scratches is 6)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th), and (print:$lottoNum&#39;s 6th).]
\]

|scratch&gt;[(link-repeat:&quot;Scratch&quot;)[(set:$scratches to it + 1)(if:$scratches is 6)[(replace:?scratch)[
\(if:$lottoNum contains $winning&#39;s 1st)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 2nd)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 3rd)[(set:$winned to it + (a:&quot;yes&quot;))]
\(if:$winned&#39;s length is 0)[
\Sorry Jed, looks like you didn&#39;t win any money...]
\(if:$winned&#39;s length is 1)[
\You got one match, which means you get your money back!
\(set:$winningTickets to it + $ticketCost)
\(set:$STATS&#39;s 11th to it + $ticketCost)]
\(if:$winned&#39;s length is 2)[
\Congratulations, you got two matches so you get $(print:$ticketCost * 3) back!
\(set:$winningTickets to it + ($ticketCost * 3))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 3))]
\(if:$winned&#39;s length is 3)[
\Wow, you got all three so you hit the jackpot! You get $(print:$ticketCost * 10) back!
\(set:$winningTickets to it + ($ticketCost * 10))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 10))]

[[Continue-&gt;Lotto Machine]]]]]]</tw-passagedata><tw-passagedata pid="248" name="Ticket 30" tags="" position="6650,2550" size="100,100">(set:$ticketCost to 30)
\(set:$winned to (a:))
\(set:$MONEY to it - $ticketCost)
\(set:$STATS&#39;s 3rd to it + $ticketCost)
\(set:$lottoSpendings to it + $ticketCost)
\(set:$scratches to 0)
\(set:$winning to (shuffled:...(range:1,30)))
\(set:$winning to its 1stto3rd)
\(set:$lottoNum to (shuffled:...(range:1,30)))
\(set:$lottoNum to its 1stto6th)
\(if:$lottoSpendings &gt; 150)[(goto:&quot;Lotto Intervention&quot;)]
\You purchase a $$ticketCost ticket from the machine. Getting one match gets your money back, two gives you triple back, and three gives you tenfold! 

The three numbers to get are (print:$winning&#39;s 1st), (print:$winning&#39;s 2nd), and (print:$winning&#39;s 3rd).

(live:0.01s)[
\(if:$scratches is 0)[Your numbers are...]
\(else-if:$scratches is 1)[Your numbers are: (print:$lottoNum&#39;s 1st)]
\(else-if:$scratches is 2)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd)]
\(else-if:$scratches is 3)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd)]
\(else-if:$scratches is 4)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th)]
\(else-if:$scratches is 5)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th)]
\(else-if:$scratches is 6)[Your numbers are: (print:$lottoNum&#39;s 1st), (print:$lottoNum&#39;s 2nd), (print:$lottoNum&#39;s 3rd), (print:$lottoNum&#39;s 4th), (print:$lottoNum&#39;s 5th), and (print:$lottoNum&#39;s 6th).]
\]

|scratch&gt;[(link-repeat:&quot;Scratch&quot;)[(set:$scratches to it + 1)(if:$scratches is 6)[(replace:?scratch)[
\(if:$lottoNum contains $winning&#39;s 1st)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 2nd)[(set:$winned to it + (a:&quot;yes&quot;))](if:$lottoNum contains $winning&#39;s 3rd)[(set:$winned to it + (a:&quot;yes&quot;))]
\(if:$winned&#39;s length is 0)[
\Sorry Jed, looks like you didn&#39;t win any money...]
\(if:$winned&#39;s length is 1)[
\You got one match, which means you get your money back!
\(set:$winningTickets to it + $ticketCost)
\(set:$STATS&#39;s 11th to it + $ticketCost)]
\(if:$winned&#39;s length is 2)[
\Congratulations, you got two matches so you get $(print:$ticketCost * 3) back!
\(set:$winningTickets to it + ($ticketCost * 3))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 3))]
\(if:$winned&#39;s length is 3)[
\Wow, you got all three so you hit the jackpot! You get $(print:$ticketCost * 10) back!
\(set:$winningTickets to it + ($ticketCost * 10))
\(set:$STATS&#39;s 11th to it + ($ticketCost * 10))]

[[Continue-&gt;Lotto Machine]]]]]]</tw-passagedata><tw-passagedata pid="249" name="Lotto Intervention" tags="" position="6500,2700" size="100,100">As you try to purchase the lottery ticket, an alarm pops out of the top of the lotto machine and goes off.

&quot;What&#39;s happening?&quot; Jed cries out.

&quot;Woah woah woah,&quot; the cashier says, &quot;how much money did you put into that machine?&quot;

&quot;$$lottoSpendings...&quot;

&quot;Oh no. Okay, follow me.&quot;

The cashier walks out of the counter and turns off the lottery machine alarm. She then walks you towards the employee backroom.

[[Continue-&gt;Lotto Backroom]]</tw-passagedata><tw-passagedata pid="250" name="Cash Tickets" tags="" position="6650,1950" size="100,100">(set:$visitsTickets to it + 1)
\(if:$visitsTickets is 1)[&quot;Never really took you for a gambling man, Jed,&quot; the cashier says. 

She scans all of your winning tickets. &quot;Looks like your total came to $$winningTickets. Hope you didn&#39;t spend any more than that!&quot;]
\(else:)[&quot;(either:&quot;Just can&#39;t get enough, can you?&quot;,&quot;Back for more, eh?&quot;,&quot;Got any big winners this time?&quot;,&quot;You sure are having fun, ain&#39;tcha?&quot;)&quot; the cashier asks. 

She scans all of your winning tickets. &quot;Looks like your total came to $$winningTickets. Hope you didn&#39;t spend any more than that!&quot;]
\(set:$MONEY to it + $winningTickets)(set:$winningTickets to 0)

[[Continue-&gt;Gas Station Checkout]] </tw-passagedata><tw-passagedata pid="251" name="Lotto Backroom" tags="" position="6650,2700" size="100,100">(set:$peopleHere to (a:&quot;Rafael&quot;,&quot;Josefine&quot;))
\(if:$STANLEY)[(set:$peopleHere to it + (a:&quot;Stanley&quot;))]
\(if:$BUSTER)[(set:$peopleHere to it + (a:&quot;Buster&quot;))]
\(set:$peopleHere to (shuffled:...it))
\(if:$peopleHere&#39;s length is 2)[You walk into the backroom and see (print:$peopleHere&#39;s 1st) and (print:$peopleHere&#39;s 2nd) standing in the room.]
\(if:$peopleHere&#39;s length is 3)[You walk into the backroom and see (print:$peopleHere&#39;s 1st), (print:$peopleHere&#39;s 2nd), and (print:$peopleHere&#39;s 3rd) standing in the room.]
\(if:$peopleHere&#39;s length is 4)[You walk into the backroom and see (print:$peopleHere&#39;s 1st), (print:$peopleHere&#39;s 2nd), (print:$peopleHere&#39;s 3rd), and (print:$peopleHere&#39;s 4th) standing in the room.]

&quot;Hey Jed,&quot; Rafael explains, &quot;don&#39;t worry. We&#39;re here to help you.&quot;

&quot;We know it&#39;s not your fault,&quot; Josefine says, &quot;we&#39;re just concerned about you and your financial security.&quot;
\(if:$STANLEY)[

(font:&quot;HKNova&quot;)[&quot;Yes,&quot; said Stanley, &quot;it can be easy to be sucked into the magic of gambling. However, gambling is very, very bad.&quot;]]
\(if:$BUSTER)[

&quot;This isn&#39;t a safe lifestyle for us,&quot; Buster explains. &quot;How can I trust you if you&#39;re going to waste our money on things like this?&quot;]

&quot;Jed, you done messed up,&quot; the cashier says, &quot;now //you&#39;re// Webster Groves&#39; biggest gambler.&quot; She pulls out her phone and takes a picture of you.

[[Continue-&gt;Gambling Ending]]</tw-passagedata><tw-passagedata pid="252" name="Gambling Ending" tags="" position="6500,2850" size="200,100">(unless:$ENDINGS contains &quot;Gambling&quot;)[(set:$ENDINGS to it + (a:&quot;Gambling&quot;))]
\(set:$JOURNAL to it + (a:&quot;Gambling&quot;))
\A group of guards runs into the employee backroom. &quot;You&#39;re coming with us, sir!&quot; they shout. They pull up your arms and drag you out of the gas station into a helicopter.

&quot;Where am I going? Where are you taking me?&quot; you cry out.

&quot;Don&#39;t worry sir,&quot; one of the guards explains, &quot;you&#39;re going to the best gambling correctional facility the United States has to offer.&quot;

&quot;HELP!!!&quot; you scream. &quot;(if:$BUSTER)[BUSTER!] JOSEFINE! RAFAEL!(if:$STANLEY)[ STANLEY!] ANYBODY!&quot;

The helicopter lifts off the ground and takes flight... Goodbye, Jed...

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="253" name="Alleyway Bathroom" tags="" position="6800,2100" size="100,100">(set:$alleywayBathroom to false)
\What? &quot;Bathroom?&quot; What do you mean &quot;bathroom?&quot;

Jed, did you seriously think there would be a bathroom here in this alleyway? Of course there isn&#39;t. Why would there be? This &quot;toilet ending&quot; is not good for you.

[[Continue-&gt;Dark Alleyway]] </tw-passagedata><tw-passagedata pid="254" name="Porta-Potty" tags="" position="4900,1950" size="100,100">(set:$visitsPortAPotty to it + 1)
\(if:$visitsPortAPotty is 1)[Alright, well, they don&#39;t really have a bathroom here per say, but they do have a porta-potty. It&#39;d be gross to go in there, so let&#39;s just g-

(if:$STATS&#39;s 9th &lt; 7)[&quot;Do you guys mind if I use your porta-potty?&quot; you ask the foreman.

&quot;Knock yourself out, bub,&quot; the foreman says.

Jed... I don&#39;t even know what to say.]
\(else:)[Jed, where are you going? Oh my goodness, are you going to the porta-potty? I.. I don&#39;t even know what to say.]

You walk into the porta-potty. It&#39;s just a normal porta-potty, i.e. there is no flushing.]
\(else:)[You go back into the porta-potty. Nope, still no flushing.]

[[Continue-&gt;Construction Area]] </tw-passagedata><tw-passagedata pid="255" name="Button Bathroom" tags="" position="400,2250" size="100,100">(set: $buttonBathroom to false)
\You try to look around for a bathroom. However, there is none, only the plaque and the colored buttons.

What bad design. Good thing we&#39;re fictional characters inside a text adventure and therefore don&#39;t have bladders!

[[Continue-&gt;Button Area]] </tw-passagedata><tw-passagedata pid="256" name="Store Card" tags="" position="1500,2250" size="100,100">(if:$storeCardQuest does not contain &quot;ask&quot;)[
\(set:$storeCardQuest to it + (a:&quot;ask&quot;))
\&quot;How is anyone supposed to afford any of this?&quot; you ask the clerk. &quot;Usually stores like this have some sort of deferment plan or something like that.&quot;

&quot;Oh, but we do!&quot; the clerk exclaims. &quot;We have a store card system that lets you accrue up to five thousand in debt for you to pay off later at the low, low interest rate of 9.23!&quot;

&quot;Oh okay, what do I need to do to sign up for one?&quot;

&quot;Well, we&#39;re going to need a couple documents, including your bank statements, pay stub, birth certificate, and social security card. Once we do all that there&#39;s just one or two papers you gotta sign and we&#39;ll be done!&quot;

&quot;Wow, sounds like a very secure process!&quot;

[[Continue-&gt;Electronics Store]]]
\(else-if:$storeCardQuest does not contain &quot;documents&quot; and $INV does not contain &quot;documents&quot;)[
\You asked the clerk to remind you what you need to do to sign up for a store card.

&quot;We just need a couple of documents: one or two bank statements, your pay stub, your birth certificate, and your social security card.&quot;

[[Continue-&gt;Electronics Store]]]
\(else-if:$storeCardQuest does not contain &quot;documents&quot; and $INV contains &quot;documents&quot;)[
\&quot;Okay,&quot; Jed says, &quot;I think I have all the documents you need.&quot;

&quot;Perfect!&quot; the clerk shouts. &quot;I&#39;ll just take those from you...&quot; the clerk snatches the documents out of your hands. &quot;Now, I just need you to sign your signature real quick. This is to prove that you actually got our store card.&quot;

(link: &quot;Sign Document&quot;)[The clerk hands you another document. &quot;This one is to automatically charge the interest to your bank account.&quot;

(link: &quot;Sign Document&quot;)[The clerk hands you a third document. &quot;This is our NDA. Don&#39;t worry about what it means, just sign it.&quot;

(link: &quot;Sign Document&quot;)[The clerk hands you yet another document. &quot;This is to sign up for our hourly newsletter! Don&#39;t check &#39;no,&#39; if you say &#39;no&#39; we can&#39;t get you the store card.&quot;

(link: &quot;Sign Document&quot;)[The clerk hands you one more document. &quot;Okay, last one, I promise! This is just to sign away your soul.&quot;

(link: &quot;Sign Away Your Soul&quot;)[The clerk takes all the documents and straightens them out. &quot;Alright, that&#39;s all I need from you! Thank you, Jed, enjoy your new store card! Don&#39;t forget the maximum amount of debt you can accrue on your account is $5,000.&quot;
\(set:$storeCard to 5000)
\(set:$storeCardQuest to it + (a:&quot;documents&quot;))

[[Continue-&gt;Electronics Store]]]]]]]]</tw-passagedata><tw-passagedata pid="257" name="Search Documents" tags="" position="1900,3000" size="100,100">(if:$previousPassage is &quot;Jed&#39;s Bathroom&quot;)[
\(set:$INV to it + (a:&quot;documents&quot;))
\You walk into the bathroom and search for your documents. You remember that your mirror is one of those fancy &quot;pull open&quot; ones, so you look behind it. You accidentally pull it so hard that it flings open and smashes onto the wall. Oh well, that&#39;s a tomorrow problem. You notice all the documents you need inside the mirror.

[[Continue-&gt;Jed&#39;s Bathroom]]]
\(else-if:$previousPassage is &quot;Fridge&quot;)[
\You search inside your fridge for your documents. Doesn&#39;t look like they&#39;re in here.

[[Continue-&gt;Jed&#39;s Kitchen]]]
\(else-if:$previousPassage is &quot;Trash Can&quot;)[
\Jed, what are you doing? Are you searching your trash can for your documents? They&#39;re not gonna be in here. If they were, I wouldn&#39;t let you hear the end of it.

[[Continue-&gt;Jed&#39;s Kitchen]]]
\(else-if:$previousPassage is &quot;Coffee Maker&quot;)[
\You pick up your coffee maker, looking for your documents. However, expectedly, they are not here.

[[Continue-&gt;Jed&#39;s Kitchen]]]
\(else-if:$previousPassage is &quot;Grab Ticket&quot;)[
\You search your bedside cabinet for your important documents. Probably the most sensible place for your documents to be, but unfortunately they aren&#39;t in here.

[[Continue-&gt;Jed&#39;s Bedroom]]]
\(else-if:$previousPassage is &quot;Closet&quot;)[
\You search around in your closet for your documents. They aren&#39;t in here, but you did find a rotten apple. Gross.

[[Continue-&gt;Jed&#39;s Bedroom]]]
\(else-if:$previousPassage is &quot;Sleep&quot;)[
\You search under your bed for your important documents. It took a few minutes because of how much stuff ends up here after you &quot;clean&quot; your room. After some time of scrutiny, you give up, assuming that they aren&#39;t here.

[[Continue-&gt;Jed&#39;s Bedroom]]]
\(else-if:$previousPassage is &quot;Dream Journal&quot;)[
\You flip through your dream journal for your important documents. Rather than simply flipping through the pages, you grab it by its spine and shake it to try and get the documents out quicker. After much hassle, you give up, realizing they aren&#39;t here.

[[Continue-&gt;Jed&#39;s Bedroom]]]</tw-passagedata><tw-passagedata pid="258" name="Set Up Toaster" tags="" position="1700,3000" size="100,100">You set up the toaster you bought from the electronics store. You plug it in and (cond:$INV contains &quot;bread&quot;,&quot;put in some bread that you bought at Bosco&#39;s earlier to test it out&quot;,&quot;try to find something to test it out. You eventually find some frozen waffles in the fridge&quot;). You pull down the handle and...

Nothing. Nothing happens. Wow, you went $4,999 in debt for this? What an outrage! You slap the toaster to try and take out your frustration.

However, slapping the toaster seemed to make it work. It started to shake, and after a few seconds, the (cond:$INV contains &quot;bread&quot;,&quot;bread&quot;,&quot;waffles&quot;) popped out. Then some more... and then some more... oh my goodness, it doesn&#39;t stop!

You smile with glee... you know exactly what to do now...

[[Continue-&gt;Give Away Food]]</tw-passagedata><tw-passagedata pid="259" name="Give Away Food" tags="" position="1700,3150" size="100,100">Jed quickly set up a small stand in Town Square to give away food that he made using his toaster. Once he eventually got someone to realize that it was actually free food and not a trick, word started to spread and Jed was able to reach many people with his food stand.

He began to do this every morning. After a couple of days, he got picked up by the local news. Every day, Jed would bring different things that he duplicated using the toaster. It became part of his daily routine: get ready, make food, and go to Town Square.

[[Continue-&gt;Toaster Ending]]</tw-passagedata><tw-passagedata pid="260" name="Toaster Ending" tags="" position="1600,3300" size="200,100">(unless:$ENDINGS contains &quot;Toaster&quot;)[(set:$ENDINGS to it + (a:&quot;Toaster&quot;))]
\(set:$JOURNAL to it + (a:&quot;Toaster&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\On the fifth day, Jed began his routine like normal. However, no one came to his stand. In fact, he noticed that the people who usually walked past his stand weren&#39;t even here in Town Square at all. He packed up early and went home. Bored, he turned on the news.

&quot;Good afternoon, Webster Groves. You may have heard of a man giving out free food at Town Square for the past few days. When we first heard about this, we began to dig deeper into this man&#39;s ulterior motives, because why would anyone do anything they don&#39;t personally gain something from?&quot;

&quot;Eventually, we found out that he had no soul. We came to the logical conclusion that the &#39;free food&#39; shtick was all a setup to steal //your// soul. If you want to keep your soul, &#39;&#39;stay clear of this man!&#39;&#39;&quot;

Oh, goodness. All Jed wanted to do was help people. And now he got canceled. Feeling upset, Jed went to his bed to take an early nap. Jed was so sad he never noticed the sky going red and the explosions happening all over town.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="261" name="Set Up Appliance" tags="" position="1750,2100" size="100,100">Jed opened the box he got from the electronics store and... there was just a jumble of parts inside the box. Not even self-assembly, there were pieces that were completely broken. Additionally, it didn&#39;t come with any tools or even instructions on how to theoretically put it together.

Wow. What a rip-off.

[[Continue-&gt;Jed&#39;s Apartment]] </tw-passagedata><tw-passagedata pid="262" name="Activate Premium" tags="" position="4150,850" size="100,100">(set:$PREMIUM to &quot;yes&quot;)(set:$MONEY to it - 99)(set:$STATS&#39;s 3rd to it + 99)
\&quot;Alright, Jed!&quot; the ticket seller says. &quot;You&#39;re all good to go! We got your account upgraded, so you now have access to our express trains, as well as our ATM and phone. Thank you for joining our premium membership!&quot;

[[Continue-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="263" name="Train Ride Options" tags="" position="4300,450" size="100,100">&quot;Alright, where would you like to go?&quot;

(unless:$LOC is &quot;East Side&quot;)[(link-reveal-goto:&quot;East Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;East Side&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(unless:$LOC is &quot;Town Square&quot;)[(link-reveal-goto:&quot;Town Square&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;Town Square&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(unless:$LOC is &quot;West Side&quot;)[(link-reveal-goto:&quot;West Side&quot;,&quot;Train Ride&quot;)[(set:$LOC to &quot;West Side&quot;)(set:$justSoldTicket to false)(if:$INV contains &quot;train ticket&quot;)[(set:$INV to it - (a:&quot;train ticket&quot;))]]
]
\(if:$ENDINGS&#39;s length &gt; 0 and $ENDINGS does not contain &quot;Glitch&quot;)[[[&quot;Are there any trains going out of town?&quot;-&gt;Out of Town]]
]
\(if:$ENDINGS&#39;s length &gt; 6 and $ENDINGS contains &quot;Glitch&quot;)[[[Bloomhurst Lake-&gt;Out of Town]]
]
\[[&quot;Nevermind&quot;-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="264" name="Train Station Phone" tags="" position="4300,750" size="100,100">(if:$visitsPhone is 0)[Okay Jed, I&#39;ve got a great idea. What if we prank called someone? Oh, that could be fun! I don&#39;t think I&#39;ve ever prank called someone before...](else:)[Are we going to prank call someone else now?]

(if:$ENDINGS contains &quot;Supermarket&quot;)[(link-reveal-goto:&quot;Call John Bosco&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;bosco&quot;)]
]
\(link-reveal-goto:&quot;Call Josefine&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;josefine&quot;)]
\(if:(history:) contains &quot;City Hall Confrontation&quot;)[
(link-reveal-goto:&quot;Call Mayor Dixon&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;mayor&quot;)]]
(link-reveal-goto:&quot;Call Rafael&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;rafael&quot;)]
(link-reveal-goto:&quot;Call Random Number&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;random&quot;)]
\(if:$forkliftPhoneNumber and not $campPassed)[
[[Call Scotty&#39;s Construction Camp-&gt;Call Scotty]]]
\(if:$STANLEY)[
(link-reveal-goto:&quot;Call Stanley&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;stanley&quot;)]]
(link-reveal-goto:&quot;Call Ted&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;ted&quot;)]
\(if:$ENDINGS contains &quot;WACKY STEVE&quot;)[
(link-reveal-goto:&quot;Call WACKY STEVE&quot;,&quot;Choose Prank&quot;)[(set:$prankPerson to &quot;steve&quot;)]]
[[Exit-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="265" name="Train Station ATM" tags="" position="4300,900" size="100,100">(set:$visitsATM to it + 1)
\(if:$visitsATM is 1)[You walk up to the $LOC Train Station ATM. Here you can withdraw or deposit money from your bank account.

]
\Ammount in bank: $$ATM
Ammount in hand: $$MONEY

[[Exit-&gt;Train Station]]
(if:$MONEY &gt;= 10)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Deposit $10&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it - 10)(set:$ATM to it + 10)(set:$visitsATM to it - 1)]
]
\(if:$MONEY &gt;= 50)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Deposit $50&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it - 50)(set:$ATM to it + 50)(set:$visitsATM to it - 1)]
]
\(if:$MONEY &gt;= 100)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Deposit $100&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it - 100)(set:$ATM to it + 100)(set:$visitsATM to it - 1)]
]
\(if:$MONEY &gt;= 500)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Deposit $500&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it - 500)(set:$ATM to it + 500)(set:$visitsATM to it - 1)]
]
\(if:$ATM &gt;= 10)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Withdrawl $10&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it + 10)(set:$ATM to it - 10)(set:$visitsATM to it - 1)]
]
\(if:$ATM &gt;= 50)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Withdrawl $50&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it + 50)(set:$ATM to it - 50)(set:$visitsATM to it - 1)]
]
\(if:$ATM &gt;= 100)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Withdrawl $100&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it + 100)(set:$ATM to it - 100)(set:$visitsATM to it - 1)]
]
\(if:$ATM &gt;= 500)[(t8n-time:0.4s)+(link-reveal-goto: &quot;Withdrawl $500&quot;,&quot;Train Station ATM&quot;)[(set:$MONEY to it + 500)(set:$ATM to it - 500)(set:$visitsATM to it - 1)]]</tw-passagedata><tw-passagedata pid="266" name="Train Station Shop" tags="" position="4300,600" size="100,100">&quot;What do you need?(if:$FUN is 7)[ Don&#39;t forget our train passes are 75% off!]&quot;

Current funds: $$MONEY

(if:$MONEY &gt;= 10)[(link-reveal-goto: &#39;Train Ticket - $10&#39;,&quot;Train Ride Options&quot;)[(set:$INV to it + (a:&quot;train ticket&quot;))(set:$MONEY to it - 10)(set:$STATS&#39;s 3rd to it + 10)]](else:)[[[Train Ticket - $10-&gt;Too Poor]]]
(if:$FUN is 7)[(if:$MONEY &gt;= 20)[(link-reveal-goto: &#39;Train Pass - $20&#39;,&quot;Train Ride Options&quot;)[(set:$INV to it + (a:&quot;train pass new&quot;))(set:$MONEY to it - 20)(set:$STATS&#39;s 3rd to it + 20)]](else:)[[[Train Pass - $20-&gt;Too Poor]]]
\(unless:$anomalies contains &quot;pass deal&quot;)[(set:$anomalies to it + (a:&quot;pass deal&quot;))]]
\(else:)[(if:$MONEY &gt;= 80)[(link-reveal-goto: &#39;Train Pass - $80&#39;,&quot;Train Ride Options&quot;)[(set:$INV to it + (a:&quot;train pass new&quot;))(set:$MONEY to it - 80)(set:$STATS&#39;s 3rd to it + 80)]](else:)[[[Train Pass - $80-&gt;Too Poor]]]]
[[&quot;Nevermind&quot;-&gt;Train Station]]</tw-passagedata><tw-passagedata pid="267" name="Gang Empty" tags="" position="6950,1950" size="100,100">(if:($mugged) or ($ticketPowers is not &quot;unvisited&quot;))[You walk back to where the gang was, but it doesn&#39;t look like anyone is here.](else:)[You walk down the dark alleyway and... and then...

Hmm... okay usually when you go down this alleyway there&#39;s a criminal gang that attacks you, steals your money, etc. etc. I guess you got lucky?]

[[Continue-&gt;Dark Alleyway]] </tw-passagedata><tw-passagedata pid="268" name="Gang Ticket" tags="" position="6950,2100" size="100,100">&quot;Well, well, well,&quot; you hear a voice say from further down the alley, &quot;woulda look at w- wait a minute... that cape...&quot; Three people then walk out of the darkness: a short person, a tall person, and a third person.

&quot;Isn&#39;t this the guy you told us to look out for?&quot; the tall one says.

&quot;Yeah, yeah... don&#39;t worry, come back here, we got it secured.&quot; They gesture for you to follow them, which you do. You enter a secluded area between buildings. You see a table with a small ticket in the middle. &quot;Here it is! Just show this to the guy over at Burgerocity and they&#39;ll hook you right up!&quot;

&quot;It&#39;s so nice to meet you, Wacky Steve!&quot; the third one says.

[[&quot;Thank you, I will use this wisely.&quot;-&gt;Take Ticket]]
[[&quot;No, I&#39;m SuperJed!&quot;-&gt;Reject Ticket]]</tw-passagedata><tw-passagedata pid="269" name="Jed Woke Up" tags="" position="4550,2650" size="100,100">(set:$hours to 31)
\Jed woke up. He is famous.

Jed has become the most popular person in the entire tri-state area. He has grown in popularity quickly in the past few days, and the public has noticed. Most other celebrities spend their time discussing Jed and his personal details. Most videos online are clips of Jed&#39;s recent world-saving endavor.

The eye of Webster Groves is upon Jed.

Tonight, Jed has an important interview with a local talk show. This interview requires preparation.

Jed cracked his eyes open, knowing today is his last chance to prepare for the interview. He has 30 hours left. Jed must choose his actions wisely.

[[Start Preparing!-&gt;Apartment Kyle]]</tw-passagedata><tw-passagedata pid="270" name="Apartment Kyle" tags="" position="4550,2800" size="100,100">(set:$hours to it - 1)(if:$hours is -1)[(goto:&quot;Jed Hurried&quot;)]
\HOURS LEFT: $hours

[[Kitchenette-&gt;Kitchen Kyle]]
[[Bedroom-&gt;Bedroom Kyle]]
[[Bathroom-&gt;Bathroom Kyle]]</tw-passagedata><tw-passagedata pid="271" name="Kitchen Kyle" tags="" position="4400,2950" size="100,100">(set:$hours to it - 1)(if:$hours is -1)[(goto:&quot;Jed Hurried&quot;)]
\HOURS LEFT: $hours

(unless:$visitedKyle contains &#39;fridge&#39;)[[[Fridge-&gt;Fridge Kyle]]
]
\(unless:$visitedKyle contains &#39;coffee&#39;)[[[Coffee Maker-&gt;Coffee Kyle]]
]
\[[Trash Can-&gt;Trash Kyle]]
[[Exit-&gt;Apartment Kyle]]</tw-passagedata><tw-passagedata pid="272" name="Bedroom Kyle" tags="" position="4550,2950" size="100,100">(set:$hours to it - 1)(if:$hours is -1)[(goto:&quot;Jed Hurried&quot;)]
\HOURS LEFT: $hours

[[Cabinet-&gt;Cabinet Kyle]]
[[Closet-&gt;Closet Kyle]]
(unless:$visitedKyle contains &quot;bed&quot;)[[[Bed-&gt;Bed Kyle]]
]
\[[Exit-&gt;Apartment Kyle]]</tw-passagedata><tw-passagedata pid="273" name="Bathroom Kyle" tags="" position="4700,2950" size="100,100">(set:$hours to it - 1)(if:$hours is -1)[(goto:&quot;Jed Hurried&quot;)]
\HOURS LEFT: $hours

[[Flush Toilet-&gt;Toilet Kyle]]
[[Exit-&gt;Apartment Kyle]]</tw-passagedata><tw-passagedata pid="274" name="Jed Hurried" tags="" position="4700,3250" size="100,100">...

Jed hurried to the set. He got onto the train and went to Town Square, where the show was being filmed. He went inside the large soundstage. The show he was invited to is known as Stay Up Late With Kyle. Its host, Kyle, is quite well known.

Jed walked in, sat down across from the host, and shook his hand. &quot;Nice to meet you,&quot; said Jed.

&quot;Likewise,&quot; Kyle responded. (unless:$wearing is &quot;cape&quot;)[&quot;Where&#39;s your classic cape?&quot;

&quot;Oh, I thought I&#39;d switch it up a little bit. Show the world I&#39;m not trapped in my little bubble.&quot;](if:$INV contains &quot;buster&quot;)[

&quot;This is my husband, Buster. He&#39;ll be joining us today.&quot;

&quot;Wonderful. The more the merrier.&quot;]

(if:$INV contains &quot;buster&quot;)[Jed, Buster, and Kyle](else:)[Jed and Kyle] were then prompted to take their places for the broadcast.

[[Continue-&gt;Kyle Ending]]</tw-passagedata><tw-passagedata pid="275" name="Kyle Ending" tags="" position="4700,3400" size="200,100">(unless:$ENDINGS contains &quot;Kyle&quot;)[(set:$ENDINGS to it + (a:&quot;Kyle&quot;))]
\(set:$JOURNAL to it + (a:&quot;Kyle&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\A moment after seating, the studio lights brightened and the cameras clicked on. &quot;Good evening, everyone,&quot; said Kyle, &quot;looking up to the camera. &quot;Welcome back to Stay Up Late With Kyle. Tonight, I have the pleasure of interviewing Jed Winchester, who you may know better as SuperJed.&quot;

Kyle motioned to Jed, who smiled and waved to the camera. &quot;Hello!&quot;(if:$INV contains &quot;buster&quot;)[

&quot;And his husband, Buster.&quot;

Buster stared motionlessly into the camera.]

&quot;Well, I&#39;m sure we&#39;ll have a lot to discuss, so we might as well dive right in. So you&#39;re a superhero. Tell me about that.&quot;

It was then that a wall was blown off of the soundstage. It appears that aliens have attacked again. &quot;So you&#39;ve come back for seconds,&quot; Jed quipped.

&quot;Quick, do your thing!&quot; Kyle shouted. &quot;Camera 2, get on him!&quot;

Jed stood still for a few seconds. He couldn&#39;t use his powers. He hasn&#39;t tried to use them since the last invasion. It seems that they&#39;ve worn off. &quot;I can&#39;t... my powers are gone...&quot;

People start running. No one seems to want to come to Jed for help anymore. As Jed may not have known, he actually did have an opportunity to stop this alien invasion. In fact, said opportunity was given to him in the mail not too long ago but has now since passed. But of course, he had to //pretend// to be a hero instead of being a real one.

It looks like you bit off more than you can chew. (if:$FUN is 6)[I warned you about this cape. I can&#39;t believe you let it get to your head.]

(if:$ENDINGS contains all of (a:&quot;Explosion&quot;,&quot;Kyle&quot;,&quot;Ghost&quot;) and $seenSteve is false)[[[The End-&gt;WACKY STEVE Visit]]](else:)[[[The End-&gt;Waiting Room Entrance]]]</tw-passagedata><tw-passagedata pid="276" name="Fridge Kyle" tags="" position="4400,3100" size="100,100">(set:$visitedKyle to it + (a:&quot;fridge&quot;))
\Jed opened up his fridge looking for something to eat. He made a quick hodgepodge of a breakfast consisting of (either:&quot;soda&quot;,&quot;juice&quot;,&quot;milk&quot;,&quot;tea&quot;), (either:&quot;produce&quot;,&quot;eggs&quot;,&quot;yogurt&quot;,&quot;hummus&quot;), and (either:&quot;butter.&quot;,&quot;jam.&quot;,&quot;leftovers from 4 weeks ago.&quot;,&quot;ice cream. Wait. Jed, ice cream doesn&#39;t go in the fridge! You&#39;re supposed to put it in the freezer! Who raised you?&quot;)

[[Continue-&gt;Kitchen Kyle]] </tw-passagedata><tw-passagedata pid="277" name="Coffee Kyle" tags="" position="4400,3250" size="100,100">(set:$visitedKyle to it + (a:&quot;coffee&quot;))
\(set:$hours to it + 5)
\Jed made a quick cup of coffee using his coffee maker. The coffee helped reenergize him. So much so, Jed felt that he now had more time to do more things before the interview began.

[[Continue-&gt;Kitchen Kyle]] </tw-passagedata><tw-passagedata pid="278" name="Trash Kyle" tags="" position="4400,3400" size="100,100">(if:$visitedKyle contains &quot;trash&quot;)[
\Jed searched inside his trash can again. Unfortunately, he didn&#39;t find anything else of value.]
\(else:)[
\(set:$visitedKyle to it + (a:&quot;trash&quot;))
\Jed searched inside his trash can. Inside, he found a pencil.]

[[Continue-&gt;Kitchen Kyle]] </tw-passagedata><tw-passagedata pid="279" name="Cabinet Kyle" tags="" position="4550,3100" size="100,100">Jed searched inside his cabinet. Doesn&#39;t look like there&#39;s anything worth grabbing for the interview.

[[Continue-&gt;Bedroom Kyle]] </tw-passagedata><tw-passagedata pid="280" name="Closet Kyle" tags="" position="4550,3250" size="100,100">(if:$hours is -1)[(goto:&quot;Jed Hurried&quot;)]
\HOURS LEFT: $hours

(if:$CLOSET contains &quot;3d glasses&quot;)[(if:$wearing is &quot;3d glasses&quot;)[&#39;&#39;3d Glasses - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;3D Glasses&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;3d glasses&quot;)]]
]
\(if:$CLOSET contains &quot;bomber jacket&quot;)[(if:$wearing is &quot;bomber jacket&quot;)[&#39;&#39;Bomber Jacket - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Bomber Jacket&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;bomber jacket&quot;)]]
]
\(if:$wearing is &quot;none&quot;)[&#39;&#39;Everyday Clothes - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Everyday Clothes&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;none&quot;)]]
\(unless:$hatgone)[
(if:$wearing is &quot;hat&quot;)[&#39;&#39;Flamboyant Hat - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Flamboyant Hat&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;hat&quot;)]]]
\(if:$CLOSET contains &quot;ghost&quot;)[
(if:$wearing is &quot;ghost&quot;)[&#39;&#39;Ghost Costume - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Ghost Costume&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;ghost&quot;)]]]
\(if:$CLOSET contains &quot;hoodie&quot;)[
(if:$wearing is &quot;hoodie&quot;)[&#39;&#39;Green Hoodie - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Green Hoodie&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;hoodie&quot;)]]]
\(if:$CLOSET contains &quot;plumber outfit&quot;)[
(if:$wearing is &quot;plumber outfit&quot;)[&#39;&#39;Navy Blue Button-Up - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Navy Blue Button-Up&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;plumber outfit&quot;)]]]
\(if:$CLOSET contains &quot;vest&quot;)[
(if:$wearing is &quot;vest&quot;)[&#39;&#39;Purple Vest - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Purple Vest&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;vest&quot;)]]]
\(if:$CLOSET contains &quot;visor&quot;)[
(if:$wearing is &quot;visor&quot;)[&#39;&#39;Rainbow Visor - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Rainbow Visor&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;visor&quot;)]]]
\(if:$CLOSET contains &quot;ski mask&quot;)[
(if:$wearing is &quot;ski mask&quot;)[&#39;&#39;Ski Mask - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Ski Mask&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;ski mask&quot;)]]]
\(if:$CLOSET contains &quot;cape&quot;)[
(if:$wearing is &quot;cape&quot;)[&#39;&#39;Superhero Cape - Wearing&#39;&#39;](else:)[(link-reveal-goto:&quot;Superhero Cape&quot;,&quot;Closet Kyle&quot;)[(set:$hours to it - 1)(set:$wearing to &quot;cape&quot;)]]]

[[Continue-&gt;Bedroom Kyle]] </tw-passagedata><tw-passagedata pid="281" name="Bed Kyle" tags="" position="4550,3400" size="100,100">(set:$visitedKyle to it + (a:&quot;bed&quot;))(set:$hours to it - 10)(if:$hours &lt; 0)[(set:$hours to -1)] 
\Jed took a quick powernap in his bed. This lost him a good chunk of time, but he definitely woke up feeling better.

[[Continue-&gt;Bedroom Kyle]] </tw-passagedata><tw-passagedata pid="282" name="Toilet Kyle" tags="" position="4700,3100" size="100,100">(set:$visitedKyle&#39;s 1st to it + 1)(set:$STATS&#39;s 6th to it + 1)
\(if:$visitedKyle&#39;s 1st is 1)[
\Jed flushed the toilet.]
\(else-if:$visitedKyle&#39;s 1st is 2)[
\Jed flushed the toilet again.]
\(else-if:$visitedKyle&#39;s 1st is 3)[
\Jed flushed the toilet another time. Surprise surprise, nothing special happens.]
\(else:)[
\Jed flushed the toilet a(print:($visitedKyle&#39;s 1st) of (a:&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot; fourth&quot;,&quot; fifth&quot;,&quot; sixth&quot;,&quot; seventh&quot;,&quot;n eighth&quot;,&quot; ninth&quot;,&quot; tenth&quot;,&quot;n eleventh&quot;,&quot; twelfth&quot;,&quot; thirteenth&quot;,&quot; fourteenth&quot;,&quot; fifteenth&quot;,&quot; sixteenth&quot;,&quot; seventeenth&quot;,&quot;n eighteenth&quot;,&quot; nineteenth&quot;,&quot; twentieth&quot;,&quot; twenty-first&quot;,&quot; twenty-second&quot;,&quot; twenty-third&quot;,&quot; twenty-fourth&quot;,&quot; twenty-fifth&quot;,&quot; twenty-sixth&quot;,&quot; twenty-seventh&quot;,&quot; twenty-eighth&quot;,&quot; twenty-ninth&quot;,&quot; thirtieth&quot;)) time. (either:&quot;I don&#39;t understand what you get out of this.&quot;,&quot;You know this is just a waste of time, right?&quot;,&quot;You should probably go back to preparing for your interview now.&quot;,&quot;I&#39;m just going to let you do this as much as you want.&quot;,&quot;What is it with you and toilets?&quot;)]

[[Continue-&gt;Bathroom Kyle]] </tw-passagedata><tw-passagedata pid="283" name="Burgerocity Ticket" tags="" position="5600,2250" size="100,100">(set:$INV to it - (a:&quot;power ticket&quot;))(set:$ticketPowers to &quot;yes&quot;)
\&quot;Do you accept this?&quot; You pull out the ticket you were given earlier.

&quot;Ah yes,&quot; the owner says. &quot;I haven&#39;t seen one of these in a long time.&quot;

&quot;What&#39;s it for?&quot;

&quot;It&#39;s for... this.&quot; He pulls out a giant burger from underneath the counter. &quot;WACKY STEVE&#39;S GRAND BURGER.&quot;

&quot;Wow. It looks amazing. It looks... delicious.&quot; You take the burger and eat it in one bite. You feel envigorated, as if something had been awoken inside of you...

[[Continue-&gt;Burgerocity]] </tw-passagedata><tw-passagedata pid="284" name="Milk Sink" tags="" position="1900,2700" size="100,100">(set:$visitsMilk to it + 1)
\(set:_a2 to (rotated-to: where it is &quot;milk&quot;,...$INV))
\(set:$INV to _a2&#39;s 2ndtolast)
\(if:$visitsMilk is 1)[
\Jed opened up his carton of milk and began to pour it down the sink. What this achieved I have no idea. But he did it anyway.]
\(else:)[
\Jed poured some more milk down his sink. (either:&quot;I don&#39;t see what you get out of this.&quot;,&quot;Are you enjoying this new content? Is this what you wanted?&quot;,&quot;I don&#39;t understand why you have such disregard for your water lines.&quot;,&quot;Do you even realize how much money you&#39;re wasting right here?&quot;)]

[[Continue-&gt;Jed&#39;s Kitchen]] </tw-passagedata><tw-passagedata pid="285" name="Book 7" tags="" position="1250,2850" size="100,100">=&gt;&lt;=
(font:&quot;Unbounded&quot;)+(size:2)[Rulebook]
(font:&quot;Times New Roman&quot;)+(size:1.2)[by Gayle Thrush]

&lt;==
---
(font:&quot;Times New Roman&quot;)[&#39;&#39;The Game&#39;&#39; is a mind game in which the objective is avoid thinking about &#39;&#39;The Game&#39;&#39; itself. Thinking about &#39;&#39;The Game&#39;&#39; constitutes a loss, which must be announced each time it occurs. It is impossible to win most versions of &#39;&#39;The Game&#39;&#39;. Depending on the variation, it is held that the whole world, or all those who are aware of the game, are playing it all the time. Tactics have been developed to increase the number of people who are aware of &#39;&#39;The Game&#39;&#39;, and thereby increase the number of losses.

There are three commonly reported rules to &#39;&#39;The Game&#39;&#39;:

1. Everyone in the world is playing &#39;&#39;The Game&#39;&#39;.
2. Whenever one thinks about &#39;&#39;The Game&#39;&#39;, one loses.
3. Losses must be announced. This can be verbally, with a phrase such as &quot;I just lost &#39;&#39;The Game&#39;&#39;&quot;, or in any other way: for example, via social media. Some people may have ways to remind others of &#39;&#39;The Game&#39;&#39;.

The common rules do not define a point at which &#39;&#39;The Game&#39;&#39; ends. However, some players state that The Game ends when the Prime Minister of the United Kingdom announces on television that &quot;&#39;&#39;The Game&#39;&#39; is up.&quot;]

[[Continue-&gt;Bookshelves]] </tw-passagedata><tw-passagedata pid="286" name="Choose Prank" tags="" position="4450,750" size="100,100">And what are we going to prank them with?

(link-reveal-goto:&quot;Fast Food Order&quot;,&quot;Prank Call&quot;)[(set:$prankTopic to &quot;food&quot;)]
(link-reveal-goto:&quot;Refrigerator&quot;,&quot;Prank Call&quot;)[(set:$prankTopic to &quot;fridge&quot;)]
(link-reveal-goto:&quot;Telemarketing&quot;,&quot;Prank Call&quot;)[(set:$prankTopic to &quot;toilet&quot;)]
[[Nevermind-&gt;Train Station Phone]]</tw-passagedata><tw-passagedata pid="287" name="Prank Call" tags="" position="4450,900" size="100,100">(set:$visitsPhone to it + 1)
\(set:$STATS&#39;s 13th to it + 1)
\(set: $s to (text-style:&quot;expand&quot;))
\(set:$rand to (random:1,4))
\(if:$prankPerson is &quot;mayor&quot;)[The phone rings for quite some time, but it is eventually picked up. &quot;Mayor Glen Dixon, how can I help you?&quot; the mayor answers.]
\(else-if:$prankPerson is &quot;rafael&quot;)[The phone rings for a couple seconds before getting picked up. &quot;Hello?&quot; Rafael answers.]
\(else-if:$prankPerson is &quot;ted&quot;)[The phone rings and gets almost instanlty picked up. &quot;Hello,&quot; Ted greets.]
\(else-if:$prankPerson is &quot;josefine&quot;)[The phone rings for a bit before getting picked up. &quot;Hello,&quot; Josefine greets.]
\(else-if:$prankPerson is &quot;stanley&quot;)[(font:&quot;HKNova&quot;)[The phone was immediately picked up. &quot;Good morning,&quot; said Stanley. &quot;What can I do for you?&quot;]]
\(else-if:$prankPerson is &quot;bosco&quot;)[The phone rings for a few seconds before getting picked up. &quot;Bosco&#39;s Family Food Store, this is John, how can I help you?&quot; John greets.]
\(else-if:$prankPerson is &quot;steve&quot;)[The phone rings for quite some time. Eventually, it gets picked up. &quot;$s[YES, THIS IS WACKY STEVE, CEO OF WACKY STEVE&#39;S FABULOUS AND INCRARDIBLE PRODUCTS. HOW MAY I HELP YOU TODAY?]&quot;]
\(else-if:$prankPerson is &quot;random&quot;)[You type in a random number into the phone. It rings for (either:&quot;a few seconds&quot;,&quot;just a second&quot;,&quot;quite some time&quot;,&quot;about 15 seconds&quot;) before being picked up. &quot;Hello?&quot; someone answers.]

(if:$prankTopic is &quot;food&quot;)[&quot;Yes, we&#39;re just calling to confirm an order you placed with us earlier today,&quot; Jed says, trying to disguise his voice.]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;Yeah, I just wanted to ask you... if your refrigerator is running,&quot; Jed says, trying to disguise his voice.]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;Would you be interested in purchasing a toilet hat?&quot; Jed asks, trying to disguise his voice. &quot;It functions as both a toilet... and a hat!&quot;]

(if:$prankPerson is &quot;mayor&quot;)[
\(if:$prankTopic is &quot;food&quot;)[&quot;Uh, I might&#39;ve. I&#39;ve been a bit busy these past few days, planning something great for our city. What was the order?&quot;

&quot;It was (print:$rand of (a:&quot;fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;)).&quot;

&quot;Uhh... you said (print:$rand of (a:&quot;fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;))? Uh, no sorry that wasn&#39;t me. I don&#39;t eat junk food.&quot;

&quot;Oh, okay. Thank you for confirming this was your order. It will be delivered soon.&quot;

&quot;HEY WAI-&quot;

You then quickly hang up.]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;Is this some kind of prank call?&quot;

&quot;Uh.... no.&quot;

&quot;Oh, okay. Yeah, my fridge is actually messed up right now. Perfect time calling me, actually.&quot;

&quot;Great! Our billing is $750/h, plus a $200 service fee, plus since you&#39;re the mayor this adds on a $625 mayoral fee.&quot;

&quot;What a ridiculous price! $625 for a mayoral fee? Usually, that&#39;s only about $100. I won&#39;t be requiring your services, goodbye.&quot; The mayor then hangs up.]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;What? How does that even work?&quot;

&quot;Well, you wear it on your head, and when you need to go just take it off and use it.&quot;

&quot;How much are you charging for these?&quot;

&quot;(v6m:)[$25K].&quot;

&quot;Yeah, I&#39;m gonna have to pass, have a good day.&quot; The mayor then hangs up.]]
\(else-if:$prankPerson is &quot;rafael&quot;)[
\(if:$prankTopic is &quot;food&quot;)[&quot;Sorry, I don&#39;t think I ever put in an order today...&quot;

&quot;You didn&#39;t order (print:$rand of (a:&quot;the fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;))?&quot;

&quot;Uh.... no, sorry. Wasn&#39;t me.&quot;

You stay silent for a few seconds. Rafael then hangs up.]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;Uh, yes, it&#39;s working quite fine.&quot;

&quot;Then you better go catch it!&quot;

There are a few seconds of silence. &quot;Ohh, I get it! Haha, good one! Thanks for brightening up my day. Who is this by the way?&quot;

You then hang up the phone.]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;A what?&quot;

&quot;A toilet hat. It functions as both a toilet and a hat.&quot;

&quot;Uhh, no I think I&#39;m going to pass, sorry.&quot; Rafael then hangs up.]]
\(else-if:$prankPerson is &quot;ted&quot;)[
\(if:$prankTopic is &quot;food&quot;)[&quot;That definitely wasn&#39;t me. I can&#39;t remember a time I&#39;ve ever placed an order not in person.&quot;

&quot;Really? Are you sure you didn&#39;t order (print:$rand of (a:&quot;the fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;))?&quot;

&quot;I&#39;m pretty sure there is no real restaurant that sells (print:$rand of (a:&quot;&#39;turkey pizzas.&#39;&quot;,&quot;a &#39;Toilet Supreme.&#39;&quot;,&quot;giant tubs of lard.&quot;,&quot;an &#39;everything hotdog.&#39;&quot;))&quot;

&quot;You better believe we&#39;re real! Jedidediah&#39;s Trash Bin! Come on down, kids eat free on Tuesdays!&quot;

Ted then hangs up on you.]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;Yeah, nice try. That&#39;s one of the oldest tricks in the book.&quot;

&quot;No, it is not a trick. I can repair your fridge if it is not running, for only $750/h.&quot;

Ted then hangs up on you.]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;Listen buddy, have you ever heard of the National Do Not Call Registry? I&#39;m writing your number down and reporting your call to them.&quot; Ted then immediately hangs up.

Hopefully whatever this &quot;National Do Not Call Registry&quot; is isn&#39;t that important...]]
\(else-if:$prankPerson is &quot;josefine&quot;)[
\(if:$prankTopic is &quot;food&quot;)[]
\(else-if:$prankTopic is &quot;fridge&quot;)[]
\(else-if:$prankTopic is &quot;toilet&quot;)[]]
\(else-if:$prankPerson is &quot;stanley&quot;)[
\(if:$prankTopic is &quot;food&quot;)[]
\(else-if:$prankTopic is &quot;fridge&quot;)[]
\(else-if:$prankTopic is &quot;toilet&quot;)[]]
\(else-if:$prankPerson is &quot;bosco&quot;)[
\(if:$prankTopic is &quot;food&quot;)[]
\(else-if:$prankTopic is &quot;fridge&quot;)[]
\(else-if:$prankTopic is &quot;toilet&quot;)[]]
\(else-if:$prankPerson is &quot;steve&quot;)[
\(if:$prankTopic is &quot;food&quot;)[&quot;$s[SORRY, YOU MUST BE CONFUSING ME WITH SOMEONE ELSE. I DON&#39;T NEED TO EAT.]&quot;

&quot;You sure you didn&#39;t order (print:$rand of (a:&quot;the fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;))?&quot;

&quot;$s[I DID NOT ORDER THAT. THAT IS A GOOD IDEA THOUGH, I&#39;M WRITING THAT DOWN... (print:$rand of (a:&quot;TURKEY PIZZAS&quot;,&quot;TOILET SUPREME&quot;,&quot;GIANT TUB OF LARD&quot;,&quot;EVERYTHING HOTDOG&quot;))... OKAY, THANK YOU!]&quot; Wacky Steve then hangs up.]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;$s[YES, ALL OF OUR REFRIGERATORS ARE RUNNING JUST FINE, AND WE ARE NOT IN NEED OF REPAIR SERVICES AT THE MOMENT.]&quot;

&quot;Well, then you better go catch them!&quot;

&quot;$s[OH I SEE, THIS IS SOME KIND OF PRANK CALL. DO YOU MIND GIVING US YOUR NAME AND ADDRESS SO WE CAN... SEND YOU SOME MERCH?]&quot;

&quot;Sure! I live at 123 No Thank You Street.&quot; You then hang up.]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;$s[OH, PRAY TELL, HOW WOULD SUCH A DEVICE FUNCTION?]&quot;

&quot;Well, it functions both as a toilet and a hat.&quot;

&quot;$s[WELL YES, BUT I WAS HOPING YOU COULD GIVE SOME MORE DETAILS OF THIS DEVICE.]&quot;

&quot;Sorry, it&#39;s patented, can&#39;t tell you. Trade secret!&quot;

&quot;$s[DANG IT. I TRIED.]&quot; Wacky Steve then hangs up.]]
\(else-if:$prankPerson is &quot;random&quot;)[
\(if:$prankTopic is &quot;food&quot;)[&quot;(either:&quot;I did place an order earlier, who are you guys again? What did I get?&quot;,&quot;I don&#39;t think so. What was it for?&quot;,&quot;Uhh, sorry I think you have the wrong number. I didn&#39;t order the- what was it again?&quot;)&quot;

&quot;It was an order for (print:$rand of (a:&quot;fifty turkey pizzas&quot;,&quot;a Toilet Supreme&quot;,&quot;a giant tub of lard&quot;,&quot;an everything hotdog&quot;))&quot;]
\(else-if:$prankTopic is &quot;fridge&quot;)[&quot;(either:&quot;I&#39;m sorry, what did you say?&quot;,&quot;Did you really just try to do that?&quot;,&quot;Who do you think you&#39;re fooling with this?&quot;)&quot;

&quot;I just wanted to ask if your fridge was running. I&#39;m a certified refrigerator catcher.&quot;]
\(else-if:$prankTopic is &quot;toilet&quot;)[&quot;(either:&quot;Who even asked for that? What does it even do?&quot;,&quot;I&#39;m sorry, a toilet hat? How does that even work?&quot;,&quot;What? A toilet and a hat... I don&#39;t even see how that&#39;s possible.&quot;)&quot;

&quot;It&#39;s pretty self-explanatory. It functions as both a toilet and a hat.&quot;]

(if:$prankRandom)[
\&quot;(either:&quot;If this is a prank, it&#39;s not a very good one.&quot;,&quot;I&#39;m blocking your number now.&quot;,&quot;Thanks for wasting my time. I hope you have an awful day today.&quot;,&quot;Haha, very funny, did you come up with that yourself?&quot;)&quot; They then hang up on you.](else:)[
\(set:$prankRandom to true)
\&quot;Listen here, buddy. You&#39;re not gonna get me with this prank call. I&#39;m gonna find out who you are!&quot;

&quot;Yeah, okay.&quot; You hang up the phone.]]

[[Continue-&gt;Train Station Phone]]</tw-passagedata><tw-passagedata pid="288" name="Ghost Purchase" tags="" position="700,2900" size="100,100">Jed, have you forgotten? It&#39;s illegal for invisible persons to purchase items from a store. Besides the law, think about the practicality. It&#39;d be really hard for someone to sell you something if they can&#39;t see you. Come back when you&#39;re visible. 

(link-goto:&quot;Continue&quot;,$previousPassage)</tw-passagedata><tw-passagedata pid="289" name="Walk Past" tags="" position="3250,2000" size="100,100">(set:$visitsWalkPast to it + 1)
\(if:$visitsWalkPast is 1)[Jed, where are you going?](else:)[Jed, why are we doing this again? I thought you were going back up so you could do this legitimately. Way to pull on my heartstrings there...]

You walk past the secretary, who doesn&#39;t notice due to your invisibility cloak. You go down one of the hallways and see an elevator at the very end. Throughout the hallway, there are about 5-6 security guards walking around, who also have no idea you&#39;re here.

You make it to the elevator, and then wait for it to open. After about a minute or two of waiting, the doors open and some guards walk out. You then go in the elevator and ride it down.

No, Jed, this is all wrong. You were supposed to go buy a disguise and //then// you&#39;d be able to go down this elevator. This is just cheating. C&#39;mon.

[[Continue-&gt;City Hall Basement Cloak]]</tw-passagedata><tw-passagedata pid="290" name="City Hall Basement Cloak" tags="" position="3250,2150" size="100,100">You&#39;ve arrived in the basement of City Hall. It&#39;s quite dark, but there are small dim lights spread around. Pipes run around the room in no particular fashion.

[[Elevator-&gt;CH Elevator Cloak]]
[[Maintenance Room-&gt;CH Maintenance Room Cloak]]
[[Secret Room-&gt;CH Secret Room Cloak]]</tw-passagedata><tw-passagedata pid="291" name="CH Secret Room Cloak" tags="" position="3250,2300" size="100,100">(if:($FUN is 4 and $INV does not contain &quot;key&quot;) or ($FUN is not 4 and $INV does not contain &quot;letter&quot;))[You walk behind the elevator and see a door. You can just barely see a door behind it, but it&#39;s painted to match the color of the wall. You try to open it but it&#39;s locked. (if:$FUN is 4)[This is where that key was going to go to. Remember that one that you threw away earlier? Yeah, I bet you feel pretty embarrassed right now.](else:)[If only you had some way of opening it...]

[[Continue-&gt;City Hall Basement Cloak]]]
\(else:)[==
\You walk behind the elevator and see a door. You can just barely see a door behind it, but it&#39;s painted to match the color of the wall. You try to open it but it&#39;s locked.

You then remember (if:$FUN is 4)[the key you got in the mail earlier today. You take it out of your pocket and open up the door...](else:)[the letter you got earlier today. You take it out of your pocket, and there&#39;s a small silver key on the back. You take it off and open up the door...]

[[Continue-&gt;CH Confrontation Cloak]]</tw-passagedata><tw-passagedata pid="292" name="CH Maintenance Room Cloak" tags="" position="3400,2300" size="100,100">(if:$visitsMegaToilet is 9)[Oh, the whole invisibility cloak thing made me forget about the toilet ending. I thought you were going to try and cheese the story here. Oh well, here we are. The final bathroom. It&#39;s all come to this. Whatever happens, Jed, don&#39;t forget the amazing time we had together flushing all those toilets. Whatever happens next can&#39;t be better than that.](else:)[You go into the maintenance room. The wall is full of buttons, levers, and blinking lights. You don&#39;t understand any of it. Strangely enough, the room also seems to function as a bathroom.]

(if:$visitsMegaToilet is 9)[[[Flush the Toilet-&gt;The Final Flush]]](else:)[[[Flush the Toilet-&gt;CH Toilet Cloak]]]
[[Exit-&gt;City Hall Basement Cloak]] </tw-passagedata><tw-passagedata pid="293" name="CH Elevator Cloak" tags="" position="3100,2300" size="100,100">You take the elevator back up to the top of City Hall. Some of the guards were confused as to why the elevator was moving by itself, but shrugged it off.

Good, hopefully you&#39;re gonna play by the rules this time around.

[[Continue-&gt;City Hall]] </tw-passagedata><tw-passagedata pid="294" name="CH Toilet Cloak" tags="" position="3400,2450" size="100,100">(unless:$toilets contains &quot;CityHall&quot;)[
\(set:$STATS&#39;s 6th to it + 1)
\(set: $toilets to it + (a:&quot;CityHall&quot;))
\(if:$visitsJedsToilet &gt; 3)[Jed, why do you keep doing this? What&#39;s your deal with toilets?](else:)[You flush the toilet.]]
\(else:)[
\The toilet doesn&#39;t flush. Looks like we&#39;ll have to call a real plumber once this is over.

Oh wait, you won&#39;t get that joke. Because you decided to be a little cheater and cheat this whole thing. No, I&#39;m not going to explain the joke to you. Go figure it out for yourself.]

[[Continue-&gt;CH Maintenance Room Cloak]] </tw-passagedata><tw-passagedata pid="295" name="CH Confrontation Cloak" tags="" position="3250,2450" size="100,100">You enter the room and see the mayor talking with multiple security guards. &quot;Hey, why&#39;d that door open?&quot; the mayor shouts.

&quot;Dunno,&quot; one of the guards says. He goes to shut the door, and you move out of the way.

On the back wall of the room is a giant TV screen with a big panel underneath it. You can&#39;t make out what most of it says, but you can clearly see a map of Webster Groves with a dot over Burgerocity.

&quot;Anyway,&quot; the mayor says, &quot;Mei tried to come up with this little plan to stop us. She doesn&#39;t even know that I know. Sent a letter to some guy named Jed Winchester, maybe you&#39;ve heard of him. He&#39;s somewhat of a hero, good guy, town helper, etc. Well known around Webster Groves for being nice to everyone and giving a hand whenever he can.&quot;

&quot;Do you think he could&#39;ve stopped you?&quot; one of the guards asks.

The mayor scoffs. &quot;Course not. I got all of y&#39;all here, helping me keep watch in return for all that overtime pay and bonuses y&#39;all are gonna get. Now we just gotta wait for tomorrow so we can tear down that dumpster of a restaurant.&quot;

Hearing the mayor say that filled you with rage. How dare he talk about your favorite restaurant that way! Jed got an idea...

[[Continue-&gt;Ghost Ending]]</tw-passagedata><tw-passagedata pid="296" name="Ghost Ending" tags="" position="3200,2600" size="200,100">(unless:$ENDINGS contains &quot;Ghost&quot;)[(set:$ENDINGS to it + (a:&quot;Ghost&quot;))]
\(set:$JOURNAL to it + (a:&quot;Ghost&quot;))
\You notice the mayor&#39;s coffee mug next to him. You grab it and make it &quot;float&quot; for just a second, before putting it back down. 

&quot;Woah, did you guys see that!?&quot; the mayor exclaims.

&quot;See what?&quot; the guards say.

&quot;My mug was like, floating in the air for a second.&quot; Jed then finds some other object and makes it float behind the security guards, placing it back before they can turn around and notice him. &quot;BEHIND YOU&quot; the mayor shouts. But it was too late. The guards look at each other. They then walk out of the room. &quot;Where are you guys going?&quot; the mayor shouts.

&quot;How are we supposed to trust you with this whole higher power thing if you&#39;re seeing these weird hallucinations?&quot;

The mayor sits there for a second. He then grabs his mug and throws it at the giant panel. It suddenly bursts into flames, producing a large amount of smoke.

While the mayor looks around for a fire extinguisher, you run out of the room. You then take the elevator back up to the top of city hall. As you leave, you see all the guards talking to each other about the mayor, all walking towards the exit. City Hall is also filling up with smoke, so someone eventually calls the fire department.

Uh, Jed... did you just win? Did you stop the whole thing? I... well I don&#39;t know what to say. I don&#39;t know whether to congratulate you or get mad at you.

(if:$ENDINGS contains all of (a:&quot;Explosion&quot;,&quot;Kyle&quot;,&quot;Ghost&quot;) and not $seenSteve)[[[The End-&gt;WACKY STEVE Visit]]](else:)[[[The End-&gt;Waiting Room Entrance]]]</tw-passagedata><tw-passagedata pid="297" name="WACKY STEVE Visit" tags="" position="3800,3950" size="100,100">(set: $s to (text-style:&quot;expand&quot;))(set:$seenSteve to true)
\&quot;$s[JED...]&quot; you hear a voice say. &quot;$s[IS THAT YOU JED? CAN YOU HEAR ME, JED?]&quot;

&quot;Who are you? Where am I?&quot; you ask.

&quot;$s[JED, I&#39;M SORRY FOR INTERUPTING YOU. WE&#39;RE IN THE SPACE BETWEEN THE REAL WORLD AND THE GAME MENUS. THIS IS MY ONLY WAY OF TALKING TO YOU RIGHT NOW.]&quot;

&quot;Okay, but //who// are you?&quot;

&quot;$s[YOU KNOW WHO I AM! IT&#39;S ME, WACKY STEVE. YOU&#39;RE A BIG FAN OF MY PRODUCTS, AREN&#39;T YOU? YOU&#39;VE EATEN MY CEREAL, MY BURGER, AND USED MY INVISIBILITY CLOAK.(if:(history:) contains &quot;Knock Down Display&quot;)[ YOU EVEN HELPED RID THE WORLD OF THE OFFBRAND HEALTHY VERSION OF MY CEREAL.]]&quot;

&quot;Oh, yeah... big fan!&quot;

&quot;$s[YOU HAVE PROVEN YOURSELF WORTHY. I NEED YOU TO DO ME A FAVOR. GO TO EVERY STORE IN WEBSTER GROVES. YOU WILL FIND A NEW PRODUCT IN EACH OF THEM. YOU WILL NEED TO BE FRUGAL TO BE ABLE TO AFFORD THEM ALL.]&quot;

&quot;What do I do when I have them all?&quot;

&quot;$s[YOU WILL KNOW WHAT TO DO WHEN YOU HAVE THEM ALL. HERE IS SOMETHING THAT WILL HELP YOU: IN THE ARCADE, LOOK UNDER THE MASHING GAME. GOODBYE, JED. I WILL SEE YOU SOON...]&quot;

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="298" name="Masher Tickets" tags="" position="4050,2550" size="100,100">(set:$tickets to it + 500)
\Jed looked under the button-mashing game. There, he found a wad of 500 tickets with a note next to it that has the letters &quot;WS.&quot;

[[Continue-&gt;Arcade Games]] </tw-passagedata><tw-passagedata pid="299" name="WACKY STEVE Ending" tags="" position="4500,1300" size="200,100">(unless:$ENDINGS contains &quot;WACKY STEVE&quot;)[(set:$ENDINGS to it + (a:&quot;WACKY STEVE&quot;))]
\(set:$JOURNAL to it + (a:&quot;WACKY STEVE&quot;))
\(set: $s to (text-style:&quot;expand&quot;))
\For some reason, you were compelled to bring all of the items together at Town Square. You drop them all down on the plaza. You noticed how they all fit into each other, so you start putting them together.

Eventually, you build a small figurine of WACKY STEVE. The figure then abruptly grows in size, becoming as big as WACKY STEVE was when you saw him.

&quot;$s[THANK YOU, JED,]&quot; he says, &quot;$s[FOR BRINGING ME INTO THE MORTAL PLANE. WEBSTER GROVES WILL THANK YOU FOR THIS.]&quot;

Out of nowhere, a giant factory drops down onto City Hall, completely destroying it. WACKY STEVE then jumps into the air and snaps his fingers, which causes every shop in Webster Groves to explode except for Bosco&#39;s.

&quot;$s[JED, AS A THANK YOU, I&#39;M GOING TO INSTANTLY HIRE YOU FOR MY FACTORY. YOUR HELP WILL BE GREATLY APPRECIATED.]&quot;

Jed then spent the rest of his life working in the factory, making WACKY STEVE&#39;S CEREAL. It was not a happy life. Every day blended into the next. Years would pass, but since nothing out of the ordinary ever happened, in memory it would feel like only a few days. This experience was not unique to Jed, as since WACKY STEVE had a monopoly on jobs in Webster Groves, everyone would have to work at the factory to make cereal, or at the supermarket to sell cereal.

Webster Groves was doomed.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="300" name="Burgerocity Buster" tags="" position="5750,1950" size="100,100">(set:$visitsBuster to it + 1)
\(if:$visitsBuster is 1)[
\You walk up to the cardboard cutout inside Burgerocity. Its name is Buster Burgermann. He sort-of acts as the main face of Burgerocity, its mascot. You always like to see it when you enter and exit after getting food here. Sometimes you even wave to it.]
\(if:$visitsBuster is 2)[
\You walk up to the cardboard cutout again. Yup... it&#39;s still here. Still here, standing still, doing its thing.]
\(if:$visitsBuster is 3)[
\Alright, Jed, I have to admit, this whole thing is getting a little weird. You keep going up to Buster and then walking away and coming back. Surely you must know how strange this looks from the outside?]
\(if:$visitsBuster &gt; 3)[
\Back to the cardboard cutout, huh? You must really love Buster. Well, if you love him so much, why don&#39;t you marry him? Haha!]

(if:$visitsBuster &gt; 3)[[[Take Buster-&gt;Take Buster]]
]
\[[Continue-&gt;Burgerocity]] </tw-passagedata><tw-passagedata pid="301" name="Take Buster" tags="" position="5750,2100" size="100,100">(set:$INV to it + (a:&quot;busterShop&quot;))
\You pick up Buster and then run out of Burgerocity with him.

&quot;Hey!&quot; the owner shouts. &quot;What&#39;re you doin&#39; with Buster?&quot;

You ignore the owner&#39;s question and run as fast as you can.

Hey Jed, what&#39;d you do that for? Why ar- oh. Oh no. I know exactly what you&#39;re planning...

[[Continue-&gt;West Side of Town]] </tw-passagedata><tw-passagedata pid="302" name="Jump Out of Train" tags="" position="3850,700" size="100,100">You look out the train window and realize you have an opportunity. An opportunity to escape and start anew.

&quot;Hang on, Buster,&quot; you say, &quot;we&#39;re getting out of here.&quot; You hold Buster tightly to your chest and then jump out of the window of the moving train. 

&quot;What&#39;d you do that for?&quot; Buster shouts at you. The jump out of the train startled him quite a lot. He was still shaking because of it.

&quot;Buster Burgermann, I... I think I&#39;m in love with you. We should get married.&quot;

Buster blushed. &quot;Oh... Jed... I... I feel the same. Those times you would wave to me as you entered or exited Burgerocity, when no one else would? I never forgot...&quot;

Jed and Buster skipped through the forest and started preparing for their wedding.

[[Continue-&gt;Buster Wedding]]</tw-passagedata><tw-passagedata pid="303" name="Buster Wedding" tags="" position="3850,850" size="100,100">Jed and Buster put their heads together and planned a small wedding. It wasn&#39;t extravagant by any means ((cond:$MONEY &gt; 0,&quot;Jed only had $$MONEY to his name&quot;,&quot;Jed had no money to his name&quot;)), but it was good to them.

No one showed up. They forgot to tell anyone that the wedding was happening. However, it did not change the fact that they thought the wedding was amazing.

The priest began the vows. &quot;Jed Winchester, do you take Buster to be your spouse? Do you promise to be faithful to him in good times and in bad, in sickness and in health, to love him and to honor him all the days of your life?&quot;

Jed looks at Buster&#39;s beautiful, unwavering, painted eyes. &quot;I do.&quot;

&quot;Buster Burgermann, do you take Jed to be your spouse? Do you promise to be faithful to him in good times and in bad, in sickness and in health, to love him and to honor him all the days of your life?&quot;

Buster looks at Jed&#39;s warm, friendly smile. There were a few seconds of silence, but all could tell that Buster would have said &quot;I do.&quot;

&quot;Then by the power vested in me, I now pronounce you married!&quot;

Jed picked up Buster and did a big spin with him. Together, they ran off into the woods, never seen by anyone from Webster Groves ever again.

[[Continue-&gt;Marriage Ending]]</tw-passagedata><tw-passagedata pid="304" name="Marriage Ending" tags="" position="3800,1000" size="200,100">(unless:$ENDINGS contains &quot;Marriage&quot;)[(set:$ENDINGS to it + (a:&quot;Marriage&quot;))]
\(set:$JOURNAL to it + (a:&quot;Marriage&quot;))
\(set:$BUSTER to true)
\Jed and Buster Winchester found a nice house together. There, they began anew, jumping together into the abyss that is life.

Jed started a job as a customer service representative. Buster started a job as a mascot for a local restaurant. They both started the job of parents to their two adopted cats.

They always enjoyed each others&#39; company. Always finding ways to brighten the other&#39;s day. There was never a dull day in the Winchester household. 

They lived happily ever after.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="305" name="Grab Buster" tags="" position="2200,3300" size="100,100">(set:$INV to it + (a:&quot;buster&quot;))
\&quot;Good morning, Buster!&quot; Jed says. &quot;(either:&quot;Ready to go on an adventure?&quot;,&quot;Come with me, I got something to show you!&quot;,&quot;I hope you&#39;re ready to have fun today!&quot;,&quot;Let&#39;s go do some cool stuff together!&quot;)&quot;

Jed picked up Buster and began to carry him around.

[[Continue-&gt;Jed&#39;s Bedroom]] </tw-passagedata><tw-passagedata pid="306" name="Library Basement" tags="" position="1100,3150" size="100,100">You go downstairs, and at the bottom is darkness. You can barely make out about 4 or 5 hooded figures standing around the bottom of the staircase.

&quot;Hello Jed,&quot; one of the hooded figures says. &quot;So it seems you have found us...&quot;

&quot;Yeah, I just put the card in the book written on the back of the card.&quot;

&quot;Very good, you have passed the test...&quot;

&quot;Yeah, it wasn&#39;t really that ha-&quot;

&quot;Shhhhh....&quot; One of the members lights a candle so you can see them all. They then take off their hoods and reveal themselves. Among them is the hardware store clerk. Wait, how did he get here before you?

&quot;Jed Winchester, do you wish to join the Webster Groves Bald Society?&quot; the hardware clerk says.

&quot;Uhh, sure, I guess.&quot;

&quot;Very well. Here&#39;s a couple of robes for you. I am going to warn you, these are not machine dry-able. But, they&#39;re safe to put in the washer if you make sure that the water is set to cold.&quot;

&quot;Cool, thanks.&quot;

&quot;Your first challenge as member,&quot; the one in the middle says, who seems to be the leader of the group, &quot;is to help us decide what we&#39;re gonna do tomorrow. We narrowed it down to a few things but we haven&#39;t picked yet.&quot;

[[Eat a Picnic-&gt;Bald Picnic]]
[[Go to the Arcade-&gt;Bald Arcade]]
[[Go Shopping for Hats-&gt;Hats Bald]]</tw-passagedata><tw-passagedata pid="307" name="Bald Picnic" tags="" position="1100,3300" size="100,100">(set:$cultActivities to it + (a:&quot;picnic&quot;))
\&quot;Let&#39;s go have a picnic,&quot; you say.

The next day, you get together at Town Square and set up a picnic. It was a little bit like a potluck; each person brought their own thing. Jed, being the noobie, was assigned drink duty. He also brought some chips that he bought from Bosco&#39;s.

Jed mostly spent the time asking about self-care tips to help him with his new bald look. The other members talked about a variety of topics. They all seemed to be big fans of sports, which Jed didn&#39;t really know anything about. He tried to keep his mouth shut during these conversations to try not to embarrass himself.

(if:$cultActivities&#39;s length is 3)[&quot;Well, that was fun,&quot; the leader says. &quot;Jed, I think it&#39;s safe to say you&#39;re part of the group without a doubt now! Tomorrow we have our weekly tabletop game session downstairs. We&#39;re gonna be playing some Catan, Rise of the Guys, and Uno.&quot;

[[Continue-&gt;Bald Uno]]]
\(else:)[&quot;Well, that was fun,&quot; the leader says. &quot;What do we want to do tomorrow?&quot;

(unless:$cultActivities contains &quot;picnic&quot;)[[[Eat a Picnic-&gt;Bald Picnic]]
]
\(unless:$cultActivities contains &quot;arcade&quot;)[[[Go to the Arcade-&gt;Bald Arcade]]
]
\(unless:$cultActivities contains &quot;hats&quot;)[[[Go Shopping for Hats-&gt;Hats Bald]]]]</tw-passagedata><tw-passagedata pid="308" name="Bald Arcade" tags="" position="1250,3300" size="100,100">(set:$cultActivities to it + (a:&quot;arcade&quot;))
\&quot;Let&#39;s go to the arcade,&quot; you say.

The next day, you get together at the Impulse Arcade. You all pitch in money to get 500 tokens, which get evenly split between the five of you. You then separate and try to tackle one arcade game each to maximize tickets. 

At the end of the day, you all get your tickets together. However, instead of getting a big item with all the tickets, they were all spent on candy. Better not eat those all in one day, Jed.  

(if:$cultActivities&#39;s length is 3)[&quot;Well, that was fun,&quot; the leader says. &quot;Jed, I think it&#39;s safe to say you&#39;re part of the group without a doubt now! Tomorrow we have our weekly tabletop game session downstairs. We&#39;re gonna be playing some Catan, Rise of the Guys, and Uno.&quot;

[[Continue-&gt;Bald Uno]]]
\(else:)[&quot;Well, that was fun,&quot; the leader says. &quot;What do we want to do tomorrow?&quot;

(unless:$cultActivities contains &quot;picnic&quot;)[[[Eat a Picnic-&gt;Bald Picnic]]
]
\(unless:$cultActivities contains &quot;arcade&quot;)[[[Go to the Arcade-&gt;Bald Arcade]]
]
\(unless:$cultActivities contains &quot;hats&quot;)[[[Go Shopping for Hats-&gt;Hats Bald]]]]</tw-passagedata><tw-passagedata pid="309" name="Hats Bald" tags="" position="1250,3150" size="100,100">(set:$cultActivities to it + (a:&quot;hats&quot;))
\&quot;Let&#39;s go shopping for hats,&quot; you say.

The next day, you get together at Tactical Bold and look around at the hats. There were quite a few hats in the store, such as fedoras, beanies, baseball caps, you name it. Everyone tried out lots of different kinds of hats.

No one actually bought any hats. This made the store owner very angry.

(if:$cultActivities&#39;s length is 3)[&quot;Well, that was fun,&quot; the leader says. &quot;Jed, I think it&#39;s safe to say you&#39;re part of the group without a doubt now! Tomorrow we have our weekly tabletop game session downstairs. We&#39;re gonna be playing some Catan, Rise of the Guys, and Uno.&quot;

[[Continue-&gt;Bald Uno]]]
\(else:)[&quot;Well, that was fun,&quot; the leader says. &quot;What do we want to do tomorrow?&quot;

(unless:$cultActivities contains &quot;picnic&quot;)[[[Eat a Picnic-&gt;Bald Picnic]]
]
\(unless:$cultActivities contains &quot;arcade&quot;)[[[Go to the Arcade-&gt;Bald Arcade]]
]
\(unless:$cultActivities contains &quot;hats&quot;)[[[Go Shopping for Hats-&gt;Hats Bald]]]]</tw-passagedata><tw-passagedata pid="310" name="Bald Uno" tags="" position="1100,3450" size="100,100">The society got together under the library for its weekly tabletop game session. They start to play through their game collection, with the winner of each game getting to choose the next one.

During their game of Uno, they heard some loud noises coming from outside. They were rumbling sounds, accompanied by the ground shaking. &quot;Hmm,&quot; one of the members says, &quot;must be small earthquakes.&quot;

&quot;They&#39;re getting kinda annoying,&quot; another member complained, &quot;it&#39;s messing up our card piles.&quot;

Eventually, Jed was able to win the game of Uno. Since that was the last game of the session, everyone packed up and then headed upstairs.

[[Continue-&gt;Bald Ending]]</tw-passagedata><tw-passagedata pid="311" name="Bald Ending" tags="" position="1250,3450" size="200,100">(unless:$ENDINGS contains &quot;Bakd&quot;)[(set:$ENDINGS to it + (a:&quot;Bald&quot;))]
\(set:$JOURNAL to it + (a:&quot;Bald&quot;))
\(set:$STATS&#39;s 1st to it + 1)
\You and the other members go up the stairs and see an empty wasteland. The sky is red, almost every building in sight has been destroyed, and you can&#39;t see any other people around. This is no longer the Webster Groves you or anyone else knew. It was as if everything completely changed while you were in the basement.

&quot;What happened here?&quot; one of the members asks. &quot;What do we do now?&quot;

&quot;This is like some fallout-type stuff...&quot; the hardware store clerk says. 

&quot;Looks like we&#39;ll have to find some way to survive together,&quot; Jed said.

Each of the society&#39;s members knew that the only way to make it in this post-apocalyptic world was to stick together. How long would they be able to last? How long would they have to wait before conditions would get better? That they did not know, but time moved forward anyway...

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="312" name="Phone Call Fight" tags="" position="2600,1000" size="100,100">(set:$prankRandom to false)(set:$turnCounter to 1)(set:$jedHealth to 30)(set:$randoHealth to 30)(set:$attackBonus to 0)(set:$randoDefense to 0)
\As you begin to walk towards your apartment, you notice someone standing outside the complex, shouting at you. &quot;Hey! You!&quot; 

You stare at them, confused. This doesn&#39;t look like someone you recognize.

&quot;You&#39;re the one who prank called me! I wasn&#39;t lying when I told you I&#39;d find out who you are! You wanna go? Let&#39;s go! Fight me, coward!&quot;

(if:$BUSTER)[Buster heard the commotion and came outside. &quot;C&#39;mon, Jed! Let&#39;s show this rando what for!&quot;](else:)[Uh oh, Jed. This could spell trouble...]

[[Fight!-&gt;Fight Jed&#39;s Turn]]
[[&quot;No Thanks&quot;-&gt;Fight Reject]]</tw-passagedata><tw-passagedata pid="313" name="Fight Jed&#39;s Turn" tags="" position="2600,1150" size="100,100">Jed&#39;s health: $jedHealth
Random Person&#39;s health: $randoHealth
\(if:$jedHealth &lt; 1 or $randoHealth &lt; 1)[(goto:&quot;Prank Ending&quot;)]

(if:$turnCounter is 1)[(set:$displayText to &quot;The Random Person approaches you.&quot;)](else:)[(set:$displayText to &quot;What does Jed do?&quot;)]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

[[Attack-&gt;Fight Jed Attack]]
[[Act-&gt;Fight Jed Act]]
[[Items-&gt;Fight Jed Items]]</tw-passagedata><tw-passagedata pid="314" name="Fight Jed Attack" tags="" position="2450,1300" size="100,100">(set:$random to (random:1,5) + $attackBonus + $randoDefense)(set:$randoHealth to it - $random)
\(if:$randoHealth &lt; 1)[
\(set:$displayText to &quot;Jed &quot; + (either:&quot;smacks&quot;,&quot;strikes&quot;,&quot;slaps&quot;,&quot;punches&quot;,&quot;whacks&quot;) + &quot; Random Person! Dealt &quot; + (str:$random) + &quot; damage!

Random Person begins to feel weak...&quot;)](else:)[(set:$displayText to &quot;Jed &quot; + (either:&quot;smacks&quot;,&quot;strikes&quot;,&quot;slaps&quot;,&quot;punches&quot;,&quot;whacks&quot;) + &quot; Random Person! Dealt &quot; + (str:$random) + &quot; damage!&quot;)]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

(if:$BUSTER)[[[Continue-&gt;Fight Buster&#39;s Turn]]](else:)[[[Continue-&gt;Fight Rando&#39;s Turn]]]</tw-passagedata><tw-passagedata pid="315" name="Fight Jed Items" tags="" position="2750,1300" size="100,100">(set:$i to [(font:&#39;Courier New&#39;)[(print:$INV)]])
\(if:$INV&#39;s length is not 0)[(set:$displayText to &quot;Jed searched his pockets for something useful...

...but all he found was $i.&quot;)]
\(else:)[(set:$displayText to &quot;Jed searched his pockets for something useful...

...but he didn&#39;t have anything in them.&quot;)]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

[[Back-&gt;Fight Jed&#39;s Turn]] </tw-passagedata><tw-passagedata pid="316" name="Fight Jed Act" tags="" position="2600,1300" size="100,100">(set:$displayText to &quot;What does Jed do?&quot;)
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

(link-reveal-goto:&quot;Dance&quot;,&quot;Fight Action&quot;)[(set:$fightAction to &quot;dance&quot;)]
(link-reveal-goto:&quot;Stare&quot;,&quot;Fight Action&quot;)[(set:$fightAction to &quot;stare&quot;)]
(link-reveal-goto:&quot;Tell a Joke&quot;,&quot;Fight Action&quot;)[(set:$fightAction to &quot;joke&quot;)]
[[Back-&gt;Fight Jed&#39;s Turn]]</tw-passagedata><tw-passagedata pid="317" name="Fight Action" tags="" position="2600,1450" size="100,100">(if:$fightAction is &quot;dance&quot;)[(set:$displayText to &quot;Jed does a little dance.

It seems to have no effect on Random Person.&quot;)]
\(if:$fightAction is &quot;stare&quot;)[(set:$displayText to &quot;Jed stares at Random Person for several seconds.

It weirds them out! Random Person&#39;s defense lowered!&quot;)
\(set:$randoDefense to it + 1)]
\(if:$fightAction is &quot;joke&quot;)[(set:$displayText to &quot;Jed tells Random Person a joke. \&quot;&quot; + (either:&quot;What genre are national anthems? Country!&quot;,&quot;I&#39;m deathly scared of elevators. I&#39;ve started taking steps to avoid them!&quot;,&quot;What do prisoners use to call each other? Cell phones!&quot;,&quot;I recently quit my job as a can-crusher. It was soda pressing!&quot;,&quot;Where do you learn to make ice cream? Sundae school!&quot;,&quot;I once went to a restaurant on the moon. The food was great, but there was no atmosphere!&quot;,&quot;Why can&#39;t you have a nose 12 inches long? Because then it would be a foot!&quot;) + &quot;\&quot;

It seems to have no effect.&quot;)]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

(if:$BUSTER)[[[Continue-&gt;Fight Buster&#39;s Turn]]](else:)[[[Continue-&gt;Fight Rando&#39;s Turn]]]</tw-passagedata><tw-passagedata pid="318" name="Fight Rando&#39;s Turn" tags="" position="2450,1450" size="100,100">(set:$turnCounter to it + 1)
\(if:$jedHealth &lt; 1 or $randoHealth &lt; 1)[(goto:&quot;Prank Ending&quot;)]
\(set:$randoMove to (random:1,3))
\(if:$randoMove is 1)[
\(set:$displayText to (either:&quot;Random Person is scratching their head.&quot;,&quot;Random Person is cleaning their glasses.&quot;,&quot;Random Person is checking their phone.&quot;,&quot;Random Person is distracted by something happening in the distance.&quot;))]
\(else:)[
\(set:$random to (random:1,4))(set:$jedHealth to it - $random)
\(if:$jedHealth &lt; 1)[(set:$displayText to &quot;Random Person attacks! &quot; + (str:$random) + &quot; damage to Jed!

Jed is feeling weak...&quot;)](else:)[(set:$displayText to &quot;Random Person attacks! &quot; + (str:$random) + &quot; damage to Jed!&quot;)]]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

[[Continue-&gt;Fight Jed&#39;s Turn]] </tw-passagedata><tw-passagedata pid="319" name="Prank Ending" tags="" position="2750,1450" size="200,100">&quot;WHAT&#39;S GOING ON HERE?&quot; you hear a voice shout. The voice sounds familiar. You see someone walk out around the corner, and you realize that the voice belongs to none other than your landlord. &quot;What&#39;s the meaning of this?&quot;

(if:$randoHealth &lt; 1)[The other person tries to get some words out.](else:)[The other person begins to talk.] &quot;This guy was really mean to me, so I c-&quot;

&quot;I&#39;m not talking to you! I&#39;m talking to Jed Winchester!&quot;

You look at him confused. &quot;Me? I&#39;m just acting in self-defense!&quot;

The landlord pulls out your lease. &quot;Looks like I need to remind you. Under Section 23(a)(7), fighting someone as result of a prank call is grounds for immediate eviction. It&#39;s time for you to leave.&quot;

(if:$BUSTER)[Buster tried to console Jed, but nothing could change the fact that they had just been evicted. Jed went into his apartment, grabbed a few of his belongings, and tied them up in a bindle. He said goodbye to his neighbors, then went on his way. He and Buster left Webster Groves, never to return...](else:)[Jed, head hanging down, goes into his apartment and grabs a few of his belongings, and then ties them up in a bindle. He said goodbye to his neighbors and then went on his way. He then left Webster Groves, never to return...]
\(unless:$ENDINGS contains &quot;Prank&quot;)[(set:$ENDINGS to it + (a:&quot;Prank&quot;))]
\(set:$JOURNAL to it + (a:&quot;Prank&quot;))

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="320" name="Fight Buster&#39;s Turn" tags="" position="2300,1350" size="100,100">(if:$jedHealth &lt; 1 or $randoHealth &lt; 1)[(goto:&quot;Prank Ending&quot;)]
\(if:(random:1,3) is 1)[
\(set:$random to (random:1,2) + $randoDefense)(set:$randoHealth to it - $random)
\(if:$randoHealth &lt; 1)[
\(set:$displayText to &quot;Buster attacks! Dealt &quot; + (str:$random) + &quot; damage to Random Person!

Random Person begins to feel weak...&quot;)](else:)[(set:$displayText to &quot;Buster attacks! Dealt &quot; + (str:$random) + &quot; damage to Random Person!&quot;)]]
\(else:)[
\(set:$attackBonus to it + 1)
\(set:$displayText to &quot;Buster gave words of encouragent to Jed. \&quot;&quot; + (either:&quot;I believe in you!&quot;,&quot;You can do this!&quot;,&quot;I&#39;m Team Jed all the way!&quot;,&quot;Knock their teeth out!&quot;,&quot;They may be tough, but you&#39;re tougher!&quot;) + &quot;\&quot;

Buster&#39;s words empowered Jed. Jed&#39;s strength increased!&quot;)]
\(set:$displayCount to 0)(live:0s)[(set:$displayCount to it + 1)(print:(range:1,$displayCount) of $displayText)(if:$displayCount is $displayText&#39;s length)[(stop:)]]

[[Continue-&gt;Fight Rando&#39;s Turn]]</tw-passagedata><tw-passagedata pid="321" name="Gang Ticket Old" tags="" position="7150,2125" size="100,100">(if:$ticketPowers is &quot;unvisited&quot;)[
\You walk down the dark alleyway looking for someone to help. Doesn&#39;t look like anyone&#39;s here...

&quot;Psst,&quot; you hear a voice say. &quot;You wanna become a //real// superhero? I got just the thing, heheh...&quot;

|option&gt;[(link:&quot;Yes&quot;)[(replace:?option)[(set:$ticketPowers to &quot;ticket&quot;)(set:$INV to it + (a:&quot;power ticket&quot;))
\&quot;Yes!&quot; you say. &quot;Let&#39;s do it!&quot;

&quot;Take this...&quot;

You see a small ticket slowly drop down in front of you. It has a picture of a burger on the front.

[[Continue-&gt;Dark Alleyway]]]]
(link:&quot;No&quot;)[(replace:?option)[(set:$ticketPowers to &quot;no&quot;)
\&quot;No thanks,&quot; you say. &quot;I don&#39;t trust you.&quot;

&quot;That&#39;s totally fair,&quot; the voice says. &quot;I wouldn&#39;t trust a random voice in an alleyway either. Have a good day.&quot;

[[Continue-&gt;Dark Alleyway]]]]]]
\(else:)[
\You walk down the dark alleyway where you heard the voice. You try to listen for it again, but you don&#39;t hear it.

[[Continue-&gt;Dark Alleyway]]]</tw-passagedata><tw-passagedata pid="322" name="Take Ticket" tags="" position="6800,2250" size="100,100">&quot;Thank you,&quot; you say to the gang. &quot;I will use this wisely.&quot; You grab the ticket off of the table. You then, somewhat awkwardly, walk out of the dark alleyway.
\(set:$ticketPowers to &quot;ticket&quot;)(set:$INV to it + (a:&quot;power ticket&quot;))

You exit the alleyway, confused. What just happened? What were those people doing? Why did they confuse you for someone else? Despite all of the confusion, it seems that Jed stayed morbidly curious about what the ticket entailed. 

[[Continue-&gt;West Side of Town]] </tw-passagedata><tw-passagedata pid="323" name="Reject Ticket" tags="" position="6950,2250" size="100,100">&quot;No, I&#39;m SuperJed!&quot; you say. &quot;I fight the most evil of crime and help those in need! And I&#39;m about to show you guys what for, so you better g-&quot;

Jed was then knocked out by one of the gang members. When he came to, he was tied up to a chair with a light shining on him.

&quot;Who do you work for?&quot; you hear one of them shout.

(link-reveal-goto:&#39;&quot;I don\&#39;t work for anyone!&quot;&#39;,&quot;Interrogate 2&quot;)[(set:$prevAnswer to &quot;workNoone&quot;)]
(link-reveal-goto:&#39;&quot;I work for your enemy!&quot;&#39;,&quot;Interrogation Over&quot;)[(set:$prevAnswer to &quot;workEnemy&quot;)]
(link-reveal-goto:&#39;&quot;I\&#39;m currently unemployed.&quot;&#39;,&quot;Interrogate 2&quot;)[(set:$prevAnswer to &quot;workUnemployed&quot;)]</tw-passagedata><tw-passagedata pid="324" name="Trailer Secret" tags="" position="4050,2850" size="100,100">Jed, why did you score 0 points on that minigame? Do you not realize you need to click the button to win?

What? You saw a video that told you to buy those things, come here, and score 0 tickets on this machine? So that something cool would happen? 

Well, I don&#39;t know who made that video, but I must&#39;ve missed the memo that &quot;something cool&quot; was supposed to happen here. Sounds like someone just pulled a prank on you, Jed. But I mean, come on. What did you expect? The RamenCoffeeSlinkyFries Ending? 

[[Continue-&gt;Arcade Games]]</tw-passagedata><tw-passagedata pid="325" name="Fight Reject" tags="" position="2750,1150" size="100,100">(set:$fightReject to true)
\(if:$BUSTER)[
\&quot;No,&quot; you say to Buster. &quot;Violence is never the answer.&quot;]
\(else:)[
\&quot;No thanks,&quot; you say to the random person. &quot;Not in the mood.&quot;]

&quot;Oh yeah? Then how are you gonna solve this?&quot;

You walk up to the random person and hand them a note. It&#39;s an IOU for $10, with the word &quot;Sorry!&quot; written under it.

&quot;Are you trying to prank me again?&quot;

&quot;Nope. I made a mistake pranking you, and I owe you.&quot;

&quot;I better get this money...&quot; They then walk off.

[[Continue-&gt;The Apartment Complex]] </tw-passagedata><tw-passagedata pid="326" name="Construction Poster" tags="" position="4900,2100" size="100,100">Jed walked up to the poster he saw hanging up in the construction area. It reads:

&quot;Are you looking to get CERTIFIED on ALL construction vehicles? Come on down to Scotty&#39;s Construction Vehicle Camp! You&#39;ll be certified on all construction vehicles in just three days! Registration fee is $200.&quot;

At the bottom of the ad is their phone number: 555-SCV-CAMP.

(if:$PREMIUM is &quot;yes&quot;)[(set:$forkliftPhoneNumber to true)
\This sounds like a big waste of time and money. Don&#39;t forget we have a mission to finish.]
\(else:)[Good thing you don&#39;t have access to a phone. This whole thing sounds like a waste of time and money. We have a mission to solve anyway.]

[[Continue-&gt;Construction Area]] </tw-passagedata><tw-passagedata pid="327" name="Call Scotty" tags="" position="4600,450" size="100,100">You dial the number you saw on the poster in the construction area. After a few seconds, someone picks up. &quot;Yes, this is Scotty Scorch, head of Scotty&#39;s Construction Vehicle Camp! Are you interested in the camp?&quot;

&quot;Yes,&quot; you reply. &quot;I&#39;m interested!&quot;

&quot;Great! Now remember, our registration fee is $200. This covers getting you here, plus your meals during the camp. Once we get the payment I can sign you up!&quot;

(if:$MONEY &lt; 200)[&quot;Oh, sorry, it looks like I don&#39;t have enough.&quot;

&quot;That&#39;s unfortunate! If you&#39;re ever able to save up the change, come call us again!&quot; 

Alright, now that you realize how much of a waste of money this is, let&#39;s get back to what we were doing before.

[[Continue-&gt;Train Station Phone]]]
\(else:)[&quot;Yeah, I have enough! How do I pay you guys?&quot;

&quot;Well, we accept cards, but you can also shove the cash through the phone and we&#39;ll get it.&quot;

[[Join the Construction Camp - $200-&gt;Join Camp]]
[[Nevermind-&gt;Camp Nevermind]]]</tw-passagedata><tw-passagedata pid="328" name="Join Camp" tags="" position="4600,600" size="100,100">(set:$MONEY to it - 200)
\Jed shoved $200 through the phone. 

&quot;Great!&quot; said Scotty. &quot;Can I get your name?&quot;

&quot;Jed Winchester.&quot;

&quot;Okay, we&#39;ll send a bus your way to come pick you up!&quot;

Suddenly, a large bus crashes through the wall. &quot;I&#39;m here to pick up a Mr. Winchester,&quot; says the bus driver.

&quot;That&#39;d be me.&quot; You hop on the bus, which then starts to drive away.

Let&#39;s see if this camp is really worth that $200...

[[Continue-&gt;Construction Camp]]</tw-passagedata><tw-passagedata pid="329" name="Camp Nevermind" tags="" position="4600,750" size="100,100">&quot;Actually,&quot; you say, &quot;I&#39;ve changed my mind.&quot;

&quot;That&#39;s unfortunate!&quot; Scotty replies. &quot;If you ever change your mind back, just give us a call!&quot;

Glad you see how much of a waste of money this thing is. Now, let&#39;s get back to doing some prank calls and then continue the mission, okay?

[[Continue-&gt;Train Station Phone]] </tw-passagedata><tw-passagedata pid="330" name="Construction Camp" tags="" position="4600,900" size="100,100">(set:$campPassed to true)
\Jed spent the next three days at Scotty&#39;s Construction Vehicle Camp, learning the ins and outs of all the different construction vehicles. He got one-on-one lessons in the forklift, excavator, bulldozer, crane, and others.

Jed was not that good at handling the vehicles. In fact, he had to spend more time than usual to get a hang of the equipment. During one of the lessons, the teacher left early and had to be replaced by someone else.

The amenities were subpar. The food wasn&#39;t that good, and the little dorm that Jed slept in wasn&#39;t very cozy. Despite this, Jed was having fun learning to mediocrely control construction vehicles.

Eventually, the three days were up. Jed just barely passed the examination to be able to get his certifications. What exactly he&#39;s going to use these skills for, I&#39;m not entirely sure. Jed got on the bus to go back to Webster Groves.

(if:$LOC is &quot;East Side&quot;)[[[Continue-&gt;East Side of Town]]](if:$LOC is &quot;Town Square&quot;)[[[Continue-&gt;Town Square]]](if:$LOC is &quot;West Side&quot;)[[[Continue-&gt;West Side of Town]]]</tw-passagedata><tw-passagedata pid="331" name="Construction Finish" tags="" position="4900,2250" size="100,100">With his newfound skills in construction vehicles, Jed sought to finish what the other construction workers had started. It seemed to be some kind of newer apartment complex. He took a look around and got to work.

He wasn&#39;t able to find any construction plans around, so he mostly just eyeballed it. There was a very noticeable difference between what was already built and what Jed added on top of it.

One main problem is that though he knew how to operate the vehicles, he was not an architect, and did not know how to actually build things. He constantly made mistakes or did things in the wrong ways. I&#39;m sure it&#39;ll be fine...

[[Continue-&gt;Construction Ending]]</tw-passagedata><tw-passagedata pid="332" name="Construction Ending" tags="" position="4850,2400" size="200,100">(unless:$ENDINGS contains &quot;Construction&quot;)[(set:$ENDINGS to it + (a:&quot;Construction&quot;))]
\(set:$JOURNAL to it + (a:&quot;Construction&quot;))
\The end result was a sight to behold, in that it looked absolutely awful. However, it caught one tourist&#39;s eye, who somehow viewed it as a work of art.

&quot;Wow, what an interesting statement on the current state of modern construction! A very interesting piece! And a big one, too! I must tell my friends about this!&quot;

Jed&#39;s &quot;art&quot; became a big tourist attraction. The next day, Jed turned it into a museum of some kind, charging for admission and giving tours around it. After a few days, the mayor reached out to him and bought it for a large amount of money, which Jed accepted.

Webster Groves became a much more lively place. The buzz generated by Jed&#39;s construction caused a lot more visitors to the town. Some people even liked the quaint atmosphere and moved in permanently. The influx of people was also a big help to the local businesses scattered around town, which received more customers daily.

After a couple of days, the sky tu- wait what? The sky is blue like normal... Sorry, it&#39;s just that usually after a certain amount of time of ignoring the story, some catastrophe happens. Strange... Okay, I guess Webster Groves lived happily ever after, or something like that.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="333" name="Interrogate 2" tags="" position="6800,2550" size="100,100">(if:$prevAnswer is &quot;workNoone&quot;)[&quot;I don&#39;t work for anyone!&quot; you say.

&quot;Yeah, I find that hard to believe. You&#39;re telling me you&#39;re just walkin&#39; into dark alleyways with a cape on? Where&#39;d you get that cape anyway?&quot;](if:$prevAnswer is &quot;workUnemployed&quot;)[&quot;Sorry,&quot; you say, &quot;I&#39;m actually unemployed right now.&quot;

&quot;Okay, wise guy. You know that&#39;s not what I&#39;m askin&#39; ya. Who gave you that cape?&quot;]

(link-reveal-goto:&#39;&quot;It\&#39;s a family heirloom passed down generations.&quot;&#39;,&quot;Interrogate 3&quot;)[(set:$prevAnswer to &quot;capeFamily&quot;)]
(link-reveal-goto:&#39;&quot;I just got it from the clothing store.&quot;&#39;,&quot;Interrogate 3&quot;)[(set:$prevAnswer to &quot;capeStore&quot;)]
(link-reveal-goto:&#39;&quot;It\&#39;s part of my Wacky Steve costume.&quot;&#39;,&quot;Interrogation Over&quot;)[(set:$prevAnswer to &quot;capeSteve&quot;)]</tw-passagedata><tw-passagedata pid="334" name="Interrogation Over" tags="" position="6950,2700" size="100,100">(if:$prevAnswer is &quot;workEnemy&quot;)[&quot;I work for your enemy!&quot; you shout. &quot;Whoever they are.&quot;

&quot;Wow, that was easier to get out of you then I thought. You really suck at the whole &#39;interrogation&#39; thing, ha!](else-if:$prevAnswer is &quot;capeSteve&quot;)[&quot;Oh, it&#39;s just part of my totally normal Wacky Steve costume!&quot; you explain.

&quot;Yeah, there&#39;s no way you wearing a Wacky Steve costume is just a coincidence. You got insider info, no doubt about it...](else-if:$prevAnswer is &quot;walkBurger&quot;)[&quot;I just wanted to try and get that burger from you guys,&quot; you say. &quot;Sounds delicious!&quot;

&quot;Ha, so you admit it! Well, there&#39;s gonna be some big consequences from trying to get that ticket from us.](else:)[You shout a random number to try and end the interrogation.

&quot;See, that wasn&#39;t so hard, was it? Thanks for cooperating.] Okay boys, you know what to do.&quot;

One of them walks away and comes back with a large device with an antenna coming out of the middle.

&quot;What is that?&quot; you shakily ask.

&quot;Oh, don&#39;t worry about it. It&#39;s just WACKY STEVE&#39;S INCRARDIBLE MIND WIPE!&quot; There&#39;s then a blast of light, and the next thing you can remember is being back in your apartment.

[[Continue-&gt;Interrogation Ending]] </tw-passagedata><tw-passagedata pid="335" name="Interrogation Ending" tags="" position="6800,2850" size="200,100">(unless:$ENDINGS contains &quot;Interrogation&quot;)[(set:$ENDINGS to it + (a:&quot;Interrogation&quot;))]
\(set:$JOURNAL to it + (a:&quot;Interrogation&quot;))
\You&#39;re currently inside your apartment. (either:&quot;Home, sweet home.&quot;,&quot;You know what they say, you can&#39;t investigate a town scandal without proper rest!&quot;,&quot;Wow, you should probably get around to cleaning sometime soon. I mean-&quot;,&quot;It looks especially normal today, almost twice as much as yesterday.&quot;,&quot;The best place to spend a &quot; + (weekday:) + &quot; morning.&quot;,&quot;Its &quot; + $wallColor + &quot; walls bring you great comfort.&quot;) Where would you like to go?

Hello? Jed? Oh no, did you actually get mind-wiped just then? Have you really forgotten everything? Who you are and what the story is so far? Here, let me try something to jog your memory...

#You are Jed Winchester.
You are a hero. A good guy. A town helper. An eerdowell, if you will (the opposite of a neerdowell).

You&#39;re well known around Webster Groves for bei- no? Not ringing a bell? Can you at least remember anything about the burger shop? Letter in the mail? Town scandal? 

Nope. Okay, well, this is just great. Perfect. We&#39;ll have to just restart now. Now I&#39;ve got to make a whole new Jed Winchester and fill him in on everything. Do you know how long that takes? A long while, I&#39;ll tell you that. Okay player, go ahead and go to that waiting room so I can set things up.

[[The End-&gt;Waiting Room Entrance]] </tw-passagedata><tw-passagedata pid="336" name="Interrogate 3" tags="" position="6950,2550" size="100,100">(if:$prevAnswer is &quot;capeStore&quot;)[&quot;I just bought it over a Tactical Bold, the clothing store nearby,&quot; you explain.

&quot;Yeah, ok I can see that. That still doesn&#39;t explain what you were doing down in this alleyway...&quot;](if:$prevAnswer is &quot;capeFamily&quot;)[&quot;It&#39;s a cherished family heirloom,&quot; you quip, &quot;passed down from generation to generation. My father got it from his father, who got it f-&quot;

&quot;Listen buddy, the more helpful you are to us, the faster we&#39;ll get you out of here. What were you doing walking down this alleyway?&quot;]

(link-reveal-goto:&#39;&quot;I came to get that burger.&quot;&#39;,&quot;Interrogation Over&quot;)[(set:$prevAnswer to &quot;walkBurger&quot;)]
(link-reveal-goto:&#39;&quot;I\&#39;m a crime-fighting superhero!&quot;&#39;,&quot;Interrogate 4&quot;)[(set:$prevAnswer to &quot;walkCrime&quot;)]
(link-reveal-goto:&#39;&quot;I just needed to use the dumpster.&quot;&#39;,&quot;Interrogate 4&quot;)[(set:$prevAnswer to &quot;walkTrash&quot;)]</tw-passagedata><tw-passagedata pid="337" name="Interrogate 4" tags="" position="6800,2700" size="100,100">(if:$prevAnswer is &quot;walkCrime&quot;)[&quot;I&#39;m a superhero!&quot; you say. &quot;SuperJed! I fight crime! Where else would I be looking for crime?&quot;](if:$prevAnswer is &quot;walkTrash&quot;)[&quot;I just came out here to throw away some of my trash,&quot; you explain. &quot;Got a ball of lint in my pocket and I don&#39;t want to litter!&quot;]

&quot;Alright, alright, enough of that. We can just end this whole thing if you tell us the code to the 4A15-Red Database..&quot;
\(set:$randomNumbers to (a:1,2,3,4) of (shuffled:...(range:1111,9999)))

(link-goto:&#39;&quot;&#39; + (str:$randomNumbers&#39;s 1st) + &#39;&quot;&#39;,&quot;Interrogation Over&quot;)
(link-goto:&#39;&quot;&#39; + (str:$randomNumbers&#39;s 2nd) + &#39;&quot;&#39;,&quot;Interrogation Over&quot;)
(link-goto:&#39;&quot;&#39; + (str:$randomNumbers&#39;s 3rd) + &#39;&quot;&#39;,&quot;Interrogation Over&quot;)
(link-goto:&#39;&quot;&#39; + (str:$randomNumbers&#39;s 4th) + &#39;&quot;&#39;,&quot;Interrogation Over&quot;)</tw-passagedata><tw-passagedata pid="338" name="Dream Journal" tags="" position="1750,2700" size="100,100">(font:&quot;Kalam&quot;)[
\Page $currentPage
###Dear dream journal,
(if:($currentPage) of $JOURNAL is &quot;intro&quot;)[I bought this dream journal yesterday. I heard it&#39;s healthy to write down your dreams... or something like that. Hopefully, this book will let me be able to look back at all those wild adventures I have while sleeping!]
\(if:($currentPage) of $JOURNAL is &quot;NormalRoute&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;NormalRoute&quot;)[I had one of my favorite dream again. ]I helped stop a town scandal! The mayor was trying to destroy Burgerocity so I went to this secluded underground area disguised as a plumber and beat him up! And everyone clapped!]
\(if:($currentPage) of $JOURNAL is &quot;Evil&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Evil&quot;)[I had this one nightmare again.](else:)[This one was somewhat of a nightmare.] The mayor was evil, trying to get some otherworldly power from some aliens, and I somehow agreed to join him. However, instead of keeping their end of the deal, they just destroyed the whole town! Note to self: never make deals with evil people.]
\(if:($currentPage) of $JOURNAL is &quot;Trespassing&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Trespassing&quot;)[I had one of these dreams again. ]I was trying to stop some kind of weird mayor thing, but I got arrested for it. I was kept in the holding cell for days (so boring...) until suddenly, the walls exploded and the sky was red! No idea what this dream could mean...]
\(if:($currentPage) of $JOURNAL is &quot;Neglect&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Neglect&quot;)[I had one of these weird dreams again, some nightmare I think?](else:)[Don&#39;t know if this was a nightmare or not.] I got some weird letter talking about some kind of town scandal happening with the mayor or something. I threw that away and went to bed, and then when I woke up the world was ending! What could it mean...]
\(if:($currentPage) of $JOURNAL is &quot;Capitalism&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Capitalism&quot;)[I had this bad dream again. ]I finally found a way to open up my dream store, Jed&#39;s Jams! I sold music jams and actual jams. It was awesome. Well, I guess I didn&#39;t sell any, since no one came to the store. Starting to rethink this Jed&#39;s Jams idea through...]
\(if:($currentPage) of $JOURNAL is &quot;Glitch&quot;)[I tried to leave Webster Groves(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Glitch&quot;)[ again]! But since I&#39;ve really only been one or two times, I guess my brain didn&#39;t know what to put in the dream, so I just saw a bunch of weird and wild stuff!]
\(if:($currentPage) of $JOURNAL is &quot;Supermarket&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Supermarket&quot;)[I had this nightmare again.](else:)[This one&#39;s a nightmare.] I got a job at Bosco&#39;s, but it turns out that Bosco himself hated me! He banned me from his store and I starved to death! Good thing that was just a dream!]
\(if:($currentPage) of $JOURNAL is &quot;Gang&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Gang&quot;)[I had one of these dreams again. ]Some criminals tried to mug me, but I wasn&#39;t carrying any cash. They got me to do their bidding instead to keep me alive. I tried to get that toaster from the Gadget Factorie but turns out, nothing is special about it. Eventually, we all got caught by the cops.]
\(if:($currentPage) of $JOURNAL is &quot;TestFailure&quot;)[I was actually able to do some lucid dreaming (if:(range:1,$currentPage-1) of $JOURNAL contains &quot;TestFailure&quot;)[again](else:)[last night I think]! I was doing stuff around town and maybe perhaps committing some shenanigans, messing with people. But of course, I would never do any of that in real life!]
\(if:($currentPage) of $JOURNAL is &quot;SuperJed&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;SuperJed&quot;)[I had one a cool dreams again. ]I was SuperJed, one of my favorite characters to play when I was a kid. I went around town and helped people with stuff they needed help with, such as beating a game in the arcade or getting a haircut. In the end, I woke up suddenly, but I don&#39;t remember what for...]
\(if:($currentPage) of $JOURNAL is &quot;Explosion&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Explosion&quot;)[I had one of these dreams again. ]I bought some of that cereal that I&#39;ve been eyeing over at Bosco&#39;s. The WACKY STEVE one. But when I poured it out and ate it, it turns out that they were fireworks! The entire apartment complex blew up.]
\(if:($currentPage) of $JOURNAL is &quot;Toilet&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Toilet&quot;)[I had this weird dream again. ]I went all around town flushing every single toilet in Webster Groves. Eventually, when I flushed the last toilet, it started growing. Eventually, it grew so big that it completely destroyed the building it was inside. I wonder what this dream means...]
\(if:($currentPage) of $JOURNAL is &quot;Narrator&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Narrator&quot;)[I had this weird dream again. ]Someone was watching everything that I was doing and telling it as if it were some kind of story. I was able to meet up with him and ask him some questions. Whatever life my dream self is living must be pretty good if someone wants to tell stories from it for entertainment! Maybe when I get famous I can sell this dream journal.]
\(if:($currentPage) of $JOURNAL is &quot;Bald&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Bald&quot;)[I had one of these dreams again. ]There was something called the &quot;Webster Groves Bald Society,&quot; and I got in by shaving my hair off. They did normal stuff like going to the arcade, hat shopping, and playing card games. Then there was a complete change of pace, some kind of apocalypse happened and we had to find out how to survive.]
\(if:($currentPage) of $JOURNAL is &quot;Sunglasses&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Sunglasses&quot;)[I had this weird dream again. ]Rafael lost a pair of sunglasses, so I tried to go find them for him. I had to go all around town trying to find out where they ended up! When I found them, they got broken and exploded, completely destroying Webster Groves, which caused me to wake up immediately.]
\(if:($currentPage) of $JOURNAL is &quot;Toaster&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Toaster&quot;)[I had one of these dreams again. ]I bought that expensive toaster from the electronics store. I had to give away and sign a bunch of documents to get it, including my soul! I found out that it duplicates food, and tried to help people with it. But once people found out I had no soul, they avoided me, and didn&#39;t come to me for food anymore.]
\(if:($currentPage) of $JOURNAL is &quot;Kyle&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Kyle&quot;)[I had one of my favorite dreams again.](else:)[This might be one of may favorite dreams.] I was SuperJed, and I helped save the world from aliens! I became famous, and I got invited to come onto a well-known talk show. The aliens showed back up, but I can&#39;t remember what happened afterward. I must&#39;ve beaten those guys up too!]
\(if:($currentPage) of $JOURNAL is &quot;Gambling&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Bald&quot;)[I had one of these dreams again. ]I went to the gas station over in West Side and spent a lot of money on the lottery machine. The cashier had to cut me off, and my friends showed up to intervene in my gambling addiction. I got flown away to some kind of gambling rehab.]
\(if:($currentPage) of $JOURNAL is &quot;Construction&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Construction&quot;)[I had this weird dream again. ]There was some construction happening in Town Square, but all the workers disappeared. I learned how to use some construction equipment and I made a piece of modern art.]
\(if:($currentPage) of $JOURNAL is &quot;Ghost&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Ghost&quot;)[I had one of these dreams again. ]I wore an invisibility cloak and snuck into the city hall, and I found out the mayor was gonna get rid of Burgerocity! So, I used my newfound powers to haunt the mayor, which made him stop.]
\(if:($currentPage) of $JOURNAL is &quot;WACKY STEVE&quot;)[I had one of the weirdest dreams last night. Wacky Steve was there and talked about going to each store in town. I went to each store and they each sold a piece of this statue. When I put them all together, they came to life and destroyed every shop in town! Thank goodness the real Wacky Steve isn&#39;t evil!]
\(if:($currentPage) of $JOURNAL is &quot;Prank&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Prank&quot;)[I had one of these dreams again. ]I was making some prank calls on the train station&#39;s phone, but someone recognized my voice and found out who I was. They tried to fight me, which got me evicted! They start the fight and I get in trouble. What is this, kindergarten?]
\(if:($currentPage) of $JOURNAL is &quot;Interrogate&quot;)[(if:(range:1,$currentPage-1) of $JOURNAL contains &quot;Interrogate&quot;)[I had this weird dream again. ]I got beat up in the dark alleyway in West Side. They tied me up and asked me a bunch of random questions. After that, they did a mind-wipe on me or something. If they erased my memory then how do I know what happened? Dream logic makes no sense!]
\(if:($currentPage) of $JOURNAL is &quot;Marriage&quot;)[This one&#39;s more of a memory than a dream. It was the day Buster and I eloped. That was such a great day! I remember it like it was yesterday...]
\(if:($currentPage) of $JOURNAL is &quot;&quot;)[]
\]
\(set:$previousPassage to (passage:)&#39;s name)

(if:$currentPage &gt; 1)[(link-reveal-goto:&quot;Previous Page&quot;,&quot;Dream Journal&quot;)[(set:$currentPage to it - 1)]
]
\(if:$currentPage &lt; $JOURNAL&#39;s length)[(link-reveal-goto:&quot;Next Page&quot;,&quot;Dream Journal&quot;)[(set:$currentPage to it + 1)]
]
\(if:$storeCardQuest contains &quot;ask&quot; and $INV does not contain &quot;documents&quot;)[[[Search for Documents-&gt;Search Documents]]
]
\[[Back-&gt;Jed&#39;s Bedroom]]</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">(function(){"use strict";
var require,define;!function(){var e={},r={};require=function(i){var n=e[i];return n&&(r[i]=n[1].apply(void 0,n[0].map(require)),e[i]=void 0),r[i]},(define=function(r,i,n){if("function"==typeof r)return r();e[r]=[i,n]}).amd=!0}();/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.join);var A=Function.call.bind(Array.prototype.shift);var R=Math.max;var _=Math.min;var k=Math.floor;var L=Math.abs;var F=Math.exp;var D=Math.log;var z=Math.sqrt;var q=Function.call.bind(Object.prototype.hasOwnProperty);var W;var G=function(){};var H=S.Map;var V=H&&H.prototype["delete"];var B=H&&H.prototype.get;var U=H&&H.prototype.has;var $=H&&H.prototype.set;var J=S.Symbol||{};var X=J.species||"@@species";var K=Number.isNaN||function isNaN(e){return e!==e};var Z=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Y=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(K(t)){return t}return t<0?-1:1};var Q=function log1p(e){var t=Number(e);if(t<-1||K(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(D(1+t)/(1+t-1))};var ee=function isArguments(e){return g(e)==="[object Arguments]"};var te=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var re=ee(arguments)?ee:te;var ne={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var oe=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ie=typeof J==="function"&&typeof J["for"]==="function"&&ne.symbol(J());var ae=ne.symbol(J.iterator)?J.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ae="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ue=S.Reflect;var fe=String;var se=typeof document==="undefined"||!document?null:document.all;var ce=se==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==se};var le={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!le.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(ce(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===se},ToObject:function(e,t){return Object(le.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return le.IsCallable(e)},ToInt32:function(e){return le.ToNumber(e)>>0},ToUint32:function(e){return le.ToNumber(e)>>>0},ToNumber:function(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=le.ToNumber(e);if(K(t)){return 0}if(t===0||!Z(t)){return t}return(t>0?1:-1)*k(L(t))},ToLength:function(e){var t=le.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},IsIterable:function(e){return le.TypeIsObject(e)&&(typeof e[ae]!=="undefined"||re(e))},GetIterator:function(e){if(re(e)){return new W(e,"value")}var t=le.GetMethod(e,ae);if(!le.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=le.Call(t,e);if(!le.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=le.ToObject(e)[t];if(ce(r)){return void 0}if(!le.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=le.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=le.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!le.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!le.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=le.IteratorNext(e);var r=le.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ue.construct){return ue.construct(e,t,o)}var i=o.prototype;if(!le.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=le.Call(e,a,t);return le.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!le.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[X];if(ce(n)){return t}if(!le.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=le.ToString(e);var i="<"+t;if(r!==""){var a=le.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!le.TypeIsObject(e)){return false}var t=e[J.match];if(typeof t!=="undefined"){return!!t}return ne.regex(e)},ToString:function ToString(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return fe(e)}};if(s&&ie){var pe=function defineWellKnownSymbol(e){if(ne.symbol(J[e])){return J[e]}var t=J["for"]("Symbol."+e);Object.defineProperty(J,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!ne.symbol(J.search)){var ve=pe("search");var ye=String.prototype.search;h(RegExp.prototype,ve,function search(e){return le.Call(ye,e,[this])});var he=function search(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,ve);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(ye,t,[le.ToString(e)])};oe(String.prototype,"search",he)}if(!ne.symbol(J.replace)){var be=pe("replace");var ge=String.prototype.replace;h(RegExp.prototype,be,function replace(e,t){return le.Call(ge,e,[this,t])});var de=function replace(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,be);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(ge,r,[le.ToString(e),t])};oe(String.prototype,"replace",de)}if(!ne.symbol(J.split)){var me=pe("split");var Oe=String.prototype.split;h(RegExp.prototype,me,function split(e,t){return le.Call(Oe,e,[this,t])});var we=function split(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,me);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(Oe,r,[le.ToString(e),t])};oe(String.prototype,"split",we)}var je=ne.symbol(J.match);var Se=je&&function(){var e={};e[J.match]=function(){return 42};return"a".match(e)!==42}();if(!je||Se){var Te=pe("match");var Ie=String.prototype.match;h(RegExp.prototype,Te,function match(e){return le.Call(Ie,e,[this])});var Ee=function match(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,Te);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(Ie,t,[le.ToString(e)])};oe(String.prototype,"match",Ee)}}var Pe=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in G||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in G||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ce=function(){return this};var Me=function(e){if(s&&!q(e,X)){m.getter(e,X,Ce)}};var xe=function(e,t){var r=t||function iterator(){return this};h(e,ae,r);if(!e[ae]&&ne.symbol(ae)){e[ae]=r}};var Ne=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ae=function createDataPropertyOrThrow(e,t,r){Ne(e,t,r);if(!le.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Re=function(e,t,r,n){if(!le.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!le.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(q(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var _e=String.fromCodePoint;oe(String,"fromCodePoint",function fromCodePoint(e){return le.Call(_e,this,arguments)})}var ke={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!le.SameValue(r,le.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return N(t,"")},raw:function raw(e){var t=arguments.length-1;var r=le.ToObject(e,"bad template");var raw=le.ToObject(r.raw,"bad raw value");var n=raw.length;var o=le.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=le.ToString(a);s=le.ToString(raw[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=le.ToString(f);M(i,c);a+=1}return N(i,"")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){oe(String,"raw",ke.raw)}b(String,ke);var Le=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Fe=Infinity;var De={repeat:function repeat(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);if(r<0||r>=Fe){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return Le(t,r)},startsWith:function startsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=le.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=R(le.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=le.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:le.ToInteger(o);var a=_(R(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(le.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=le.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){oe(String.prototype,"includes",De.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var ze=i(function(){return"/a/".startsWith(/a/)});var qe=a(function(){return"abc".startsWith("a",Infinity)===false});if(!ze||!qe){oe(String.prototype,"startsWith",De.startsWith);oe(String.prototype,"endsWith",De.endsWith)}}if(ie){var We=a(function(){var e=/a/;e[J.match]=false;return"/a/".startsWith(e)});if(!We){oe(String.prototype,"startsWith",De.startsWith)}var Ge=a(function(){var e=/a/;e[J.match]=false;return"/a/".endsWith(e)});if(!Ge){oe(String.prototype,"endsWith",De.endsWith)}var He=a(function(){var e=/a/;e[J.match]=false;return"/a/".includes(e)});if(!He){oe(String.prototype,"includes",De.includes)}}b(String.prototype,De);var Ve=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Be=new RegExp("(^["+Ve+"]+)|(["+Ve+"]+$)","g");var Ue=function trim(){return le.ToString(le.RequireObjectCoercible(this)).replace(Be,"")};var $e=["\x85","\u200b","\ufffe"].join("");var Je=new RegExp("["+$e+"]","g");var Xe=/^[-+]0x[0-9a-f]+$/i;var Ke=$e.trim().length!==$e.length;h(String.prototype,"trim",Ue,Ke);var Ze=function(e){return{value:e,done:arguments.length===0}};var Ye=function(e){le.RequireObjectCoercible(e);this._s=le.ToString(e);this._i=0};Ye.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ze()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ze(e.substr(t,o))};xe(Ye.prototype);xe(String.prototype,function(){return new Ye(this)});var Qe={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!le.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(re(e)||le.GetMethod(e,ae))!=="undefined";var u,f,s;if(a){f=le.IsConstructor(r)?Object(new r):[];var c=le.GetIterator(e);var l,p;s=0;while(true){l=le.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){le.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=le.ToObject(e);u=le.ToLength(y.length);f=le.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ae(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!le.IsCallable(t)?new Array(e):le.Construct(t,[e]);for(var o=0;o<e;++o){Ae(n,o,arguments[o])}n.length=e;return n}};b(Array,Qe);Me(Array);W=function(e,t){this.i=0;this.array=e;this.kind=t};b(W.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof W)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=le.ToLength(t.length);if(e<r){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ze(o)}}this.array=void 0;return Ze()}});xe(W.prototype);var et=Array.of===Qe.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!et){oe(Array,"of",Qe.of)}var tt={copyWithin:function copyWithin(e,t){var r=le.ToObject(this);var n=le.ToLength(r.length);var o=le.ToInteger(e);var i=le.ToInteger(t);var a=o<0?R(n+o,0):_(o,n);var u=i<0?R(n+i,0):_(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:le.ToInteger(f);var c=s<0?R(n+s,0):_(s,n);var l=_(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=le.ToObject(this);var o=le.ToLength(n.length);t=le.ToInteger(typeof t==="undefined"?0:t);r=le.ToInteger(typeof r==="undefined"?o:r);var i=t<0?R(o+t,0):_(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new W(this,"key")},values:function values(){return new W(this,"value")},entries:function entries(){return new W(this,"entry")}};if(Array.prototype.keys&&!le.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!le.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ae]){b(Array.prototype,{values:Array.prototype[ae]});if(ne.symbol(J.unscopables)){Array.prototype[J.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var rt=Array.prototype.values;oe(Array.prototype,"values",function values(){return le.Call(rt,this,arguments)});h(Array.prototype,ae,Array.prototype.values,true)}b(Array.prototype,tt);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}xe(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){xe(Object.getPrototypeOf([].values()))}var nt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var ot=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!nt||!ot){oe(Array,"from",Qe.from)}var it=function(){return a(function(){return Array.from([0],void 0)})}();if(!it){var at=Array.from;oe(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return le.Call(at,this,arguments)}else{return t(at,this,e)}})}var ut=-(Math.pow(2,32)-1);var ft=function(e,r){var n={length:ut};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ft(Array.prototype.forEach)){var st=Array.prototype.forEach;oe(Array.prototype,"forEach",function forEach(e){return le.Call(st,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.map)){var ct=Array.prototype.map;oe(Array.prototype,"map",function map(e){return le.Call(ct,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.filter)){var lt=Array.prototype.filter;oe(Array.prototype,"filter",function filter(e){return le.Call(lt,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.some)){var pt=Array.prototype.some;oe(Array.prototype,"some",function some(e){return le.Call(pt,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.every)){var vt=Array.prototype.every;oe(Array.prototype,"every",function every(e){return le.Call(vt,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.reduce)){var yt=Array.prototype.reduce;oe(Array.prototype,"reduce",function reduce(e){return le.Call(yt,this.length>=0?this:[],arguments)})}if(!ft(Array.prototype.reduceRight,true)){var ht=Array.prototype.reduceRight;oe(Array.prototype,"reduceRight",function reduceRight(e){return le.Call(ht,this.length>=0?this:[],arguments)})}var bt=Number("0o10")!==8;var gt=Number("0b10")!==2;var dt=y($e,function(e){return Number(e+0+e)===0});if(bt||gt||dt){var mt=Number;var Ot=/^0b[01]+$/i;var wt=/^0o[0-7]+$/i;var jt=Ot.test.bind(Ot);var St=wt.test.bind(wt);var Tt=function(e,t){var r;if(typeof e.valueOf==="function"){r=e.valueOf();if(ne.primitive(r)){return r}}if(typeof e.toString==="function"){r=e.toString();if(ne.primitive(r)){return r}}throw new TypeError("No default value")};var It=Je.test.bind(Je);var Et=Xe.test.bind(Xe);var Pt=function(){var e=function Number(t){var r;if(arguments.length>0){r=ne.primitive(t)?t:Tt(t,"number")}else{r=0}if(typeof r==="string"){r=le.Call(Ue,r);if(jt(r)){r=parseInt(C(r,2),2)}else if(St(r)){r=parseInt(C(r,2),8)}else if(It(r)||Et(r)){r=NaN}}var n=this;var o=a(function(){mt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new mt(r)}return mt(r)};return e}();Pe(mt,Pt,{});b(Pt,{NaN:mt.NaN,MAX_VALUE:mt.MAX_VALUE,MIN_VALUE:mt.MIN_VALUE,NEGATIVE_INFINITY:mt.NEGATIVE_INFINITY,POSITIVE_INFINITY:mt.POSITIVE_INFINITY});Number=Pt;m.redefine(S,"Number",Pt)}var Ct=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Ct,MIN_SAFE_INTEGER:-Ct,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:Z,isInteger:function isInteger(e){return Z(e)&&le.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&L(e)<=Number.MAX_SAFE_INTEGER},isNaN:K});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){oe(Array.prototype,"find",tt.find)}if([,1].findIndex(function(){return true})!==0){oe(Array.prototype,"findIndex",tt.findIndex)}var Mt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var xt=function ensureEnumerable(e,t){if(s&&Mt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var Nt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var At=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var Rt=function(e,t){var r=n(Object(t));var o;if(le.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Mt(t))}return p(P(r,o||[]),At(t),e)};var _t={assign:function(e,t){var r=le.ToObject(e,"Cannot convert undefined or null to object");return p(le.Call(Nt,1,arguments),Rt,r)},is:function is(e,t){return le.SameValue(e,t)}};var kt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(kt){oe(Object,"assign",_t.assign)}b(Object,_t);if(s){var Lt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!le.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||le.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,Lt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Ft=!i(function(){return Object.keys("foo")});if(!Ft){var Dt=Object.keys;oe(Object,"keys",function keys(e){return Dt(le.ToObject(e))});n=Object.keys}var zt=i(function(){return Object.keys(/a/g)});if(zt){var qt=Object.keys;oe(Object,"keys",function keys(e){if(ne.regex(e)){var t=[];for(var r in e){if(q(e,r)){M(t,r)}}return t}return qt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var Wt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!Wt){var Gt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Ht=Object.getOwnPropertyNames;oe(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=le.ToObject(e);if(g(t)==="[object Window]"){try{return Ht(t)}catch(r){return P([],Gt)}}return Ht(t)})}}if(Object.getOwnPropertyDescriptor){var Vt=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Vt){var Bt=Object.getOwnPropertyDescriptor;oe(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Bt(le.ToObject(e),t)})}}if(Object.seal){var Ut=!i(function(){return Object.seal("foo")});if(!Ut){var $t=Object.seal;oe(Object,"seal",function seal(e){if(!le.TypeIsObject(e)){return e}return $t(e)})}}if(Object.isSealed){var Jt=!i(function(){return Object.isSealed("foo")});if(!Jt){var Xt=Object.isSealed;oe(Object,"isSealed",function isSealed(e){if(!le.TypeIsObject(e)){return true}return Xt(e)})}}if(Object.freeze){var Kt=!i(function(){return Object.freeze("foo")});if(!Kt){var Zt=Object.freeze;oe(Object,"freeze",function freeze(e){if(!le.TypeIsObject(e)){return e}return Zt(e)})}}if(Object.isFrozen){var Yt=!i(function(){return Object.isFrozen("foo")});if(!Yt){var Qt=Object.isFrozen;oe(Object,"isFrozen",function isFrozen(e){if(!le.TypeIsObject(e)){return true}return Qt(e)})}}if(Object.preventExtensions){var er=!i(function(){return Object.preventExtensions("foo")});if(!er){var tr=Object.preventExtensions;oe(Object,"preventExtensions",function preventExtensions(e){if(!le.TypeIsObject(e)){return e}return tr(e)})}}if(Object.isExtensible){var rr=!i(function(){return Object.isExtensible("foo")});if(!rr){var nr=Object.isExtensible;oe(Object,"isExtensible",function isExtensible(e){if(!le.TypeIsObject(e)){return false}return nr(e)})}}if(Object.getPrototypeOf){var or=!i(function(){return Object.getPrototypeOf("foo")});if(!or){var ir=Object.getPrototypeOf;oe(Object,"getPrototypeOf",function getPrototypeOf(e){return ir(le.ToObject(e))})}}var ar=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&le.IsCallable(e.get)}();if(s&&!ar){var ur=function flags(){if(!le.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ur)}var fr=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var sr=ie&&s&&function(){var e=/./;e[J.match]=false;return RegExp(e)===e}();var cr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var lr=cr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!cr||!lr){var pr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=le.RequireObjectCoercible(this);if(ne.regex(e)){return t(pr,e)}var r=fe(e.source);var n=fe(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,pr)}if(s&&(!fr||sr)){var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var yr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var hr=function(){return this.source};var br=le.IsCallable(yr.get)?yr.get:hr;var gr=RegExp;var dr=function(){return function RegExp(e,t){var r=le.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(ne.regex(e)){o=le.Call(br,e);i=typeof t==="undefined"?le.Call(vr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new gr(e,t)}}();Pe(gr,dr,{$input:true});RegExp=dr;m.redefine(S,"RegExp",dr)}if(s){var mr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(mr),function(e){if(e in RegExp&&!(mr[e]in RegExp)){m.getter(RegExp,mr[e],function get(){return RegExp[e]})}})}Me(RegExp);var Or=1/Number.EPSILON;var wr=function roundTiesToEven(e){return e+Or-Or};var jr=Math.pow(2,-23);var Sr=Math.pow(2,127)*(2-jr);var Tr=Math.pow(2,-126);var Ir=Math.E;var Er=Math.LOG2E;var Pr=Math.LOG10E;var Cr=Number.prototype.clz;delete Number.prototype.clz;var Mr={acosh:function acosh(e){var t=Number(e);if(K(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Q(t-1+z(1-r)*t)}var n=t/2;return Q(n+z(1-r)*n-1)+1/Er},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=L(t);var n=r*r;var o=Y(t);if(r<1){return o*Q(r+n/(z(n+1)+1))}return o*(Q(r/2+z(1+1/n)*r/2-1)+1/Er)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(K(t)||t<-1||t>1){return NaN}var r=L(t);return Y(t)*Q(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(D(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=le.ToUint32(t);if(r===0){return 32}return Cr?le.Call(Cr,r):31-k(D(r+.5)*Er)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(K(t)){return NaN}if(!T(t)){return Infinity}var r=F(L(t)-1);return(r+1/(r*Ir*Ir))*(Ir/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(L(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=L(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*z(r)},log2:function log2(e){return D(e)*Er},log10:function log10(e){return D(e)*Pr},log1p:Q,sign:Y,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=L(t);if(r<1){var n=Math.expm1(r);return Y(t)*n*(1+1/(n+1))/2}var o=F(r-1);return Y(t)*(o-1/(o*Ir*Ir))*(Ir/2)},tanh:function tanh(e){var t=Number(e);if(K(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-k(-t):k(t)},imul:function imul(e,t){var r=le.ToUint32(e);var n=le.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||K(t)){return t}var r=Y(t);var n=L(t);if(n<Tr){return r*wr(n/Tr/jr)*Tr*jr}var o=(1+jr/Number.EPSILON)*n;var i=o-(o-n);if(i>Sr||K(i)){return r*Infinity}return r*i}};var xr=function withinULPDistance(e,t,r){return L(1-e/t)/Number.EPSILON<(r||8)};b(Math,Mr);h(Math,"sinh",Mr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Mr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Mr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Mr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));
h(Math,"asinh",Mr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Mr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Mr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",Mr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Mr.acosh,!xr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Mr.cbrt,!xr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Mr.sinh,Math.sinh(-2e-17)!==-2e-17);var Nr=Math.expm1(10);h(Math,"expm1",Mr.expm1,Nr>22025.465794806718||Nr<22025.465794806718);h(Math,"hypot",Mr.hypot,Math.hypot(Infinity,NaN)!==Infinity);var Ar=Math.round;var Rr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var _r=Or+1;var kr=2*Or-1;var Lr=[_r,kr].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=k(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Rr||!Lr);m.preserveToString(Math.round,Ar);var Fr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Mr.imul;m.preserveToString(Math.imul,Fr)}if(Math.imul.length!==2){oe(Math,"imul",function imul(e,t){return le.Call(Fr,Math,arguments)})}var Dr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}le.IsPromise=function(e){if(!le.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!le.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(le.IsCallable(t.resolve)&&le.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&le.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=A(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=le.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(le.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!le.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!le.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!le.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Re(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=le.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=le.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(le.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!le.IsPromise(n)){throw new TypeError("not a promise")}var o=le.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=le.IsCallable(e)?e:a;var d=le.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Dr==="function"){b(S,{Promise:Dr});var zr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var qr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,G)});var Wr=i(function(){return S.Promise.call(3,G)});var Gr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,G).then(null,G)}catch(n){return true}return t===r}(S.Promise);var Hr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Vr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Vr.prototype=Promise.prototype;Vr.all=Promise.all;var Br=a(function(){return!!Vr.all([1,2])});if(!zr||!qr||!Wr||Gr||!Hr||Br){Promise=Dr;oe(S,"Promise",Dr)}if(Promise.all.length!==1){var Ur=Promise.all;oe(Promise,"all",function all(e){return le.Call(Ur,this,arguments)})}if(Promise.race.length!==1){var $r=Promise.race;oe(Promise,"race",function race(e){return le.Call($r,this,arguments)})}if(Promise.resolve.length!==1){var Jr=Promise.resolve;oe(Promise,"resolve",function resolve(e){return le.Call(Jr,this,arguments)})}if(Promise.reject.length!==1){var Xr=Promise.reject;oe(Promise,"reject",function reject(e){return le.Call(Xr,this,arguments)})}xt(Promise,"all");xt(Promise,"race");xt(Promise,"resolve");xt(Promise,"reject");Me(Promise)}var Kr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Zr=Kr(["z","a","bb"]);var Yr=Kr(["z",1,"a","3",2]);if(s){var Qr=function fastkey(e,t){if(!t&&!Zr){return null}if(ce(e)){return"^"+le.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Yr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var en=function emptyObject(){return Object.create?Object.create(null):{}};var tn=function addIterableToMap(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){if(!le.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!ce(o)){a=n.set;if(!le.IsCallable(a)){throw new TypeError("bad map")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!le.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){le.IteratorClose(i,true);throw s}}}}};var rn=function addIterableToSet(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!ce(o)){a=n.add;if(!le.IsCallable(a)){throw new TypeError("bad set")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){le.IteratorClose(i,true);throw s}}}}};var nn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!le.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+le.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ze()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ze(n)}}this.i=void 0;return Ze()}};xe(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Re(this,Map,a,{_es6map:true,_head:null,_map:H?new H:null,_size:0,_storage:en()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){tn(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Qr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=B.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Qr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return U.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(le.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Qr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(U.call(this._map,e)){B.call(this._map,e).value=t}else{a=new r(e,t);$.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(le.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Qr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!U.call(this._map,t)){return false}n=B.call(this._map,t).prev;V.call(this._map,t)}while((n=n.next)!==r){if(le.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=H?new H:null;this._size=0;this._storage=en();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});xe(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!le.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+le.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Re(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:en()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){rn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new nn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Qr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Qr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Qr(e))!==null){var n=q(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=en()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);xe(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};xe(f.prototype);return i}()};var on=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(on){S.Set=nn.Set}if(S.Map||S.Set){var an=a(function(){return new Map([[1,2]]).get(1)===2});if(!an){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){tn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(H.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var un=new Map;var fn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var sn=un.set(1,2)===un;if(!fn||!sn){oe(Map.prototype,"set",function set(e,r){t($,this,e===0?0:e,r);return this})}if(!fn){b(Map.prototype,{get:function get(e){return t(B,this,e===0?0:e)},has:function has(e){return t(U,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,B);m.preserveToString(Map.prototype.has,U)}var cn=new Set;var ln=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(cn);var pn=cn.add(1)===cn;if(!ln||!pn){var vn=Set.prototype.add;Set.prototype.add=function add(e){t(vn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,vn)}if(!ln){var yn=Set.prototype.has;Set.prototype.has=function has(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,yn);var hn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(hn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],hn)}var bn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var gn=Object.setPrototypeOf&&!bn;var dn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||gn||!dn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){tn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=H.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var mn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var On=Object.setPrototypeOf&&!mn;var wn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||On||!wn){var jn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new jn;if(arguments.length>0){rn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=jn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,jn)}var Sn=new S.Map;var Tn=!a(function(){return Sn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||Sn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof Sn.keys().next!=="function"||Tn||!bn){b(S,{Map:nn.Map,Set:nn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}xe(Object.getPrototypeOf((new S.Map).keys()));xe(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var In=S.Set.prototype.has;oe(S.Set.prototype,"has",function has(e){return t(In,this,e)})}}b(S,nn);Me(S.Map);Me(S.Set)}var En=function throwUnlessTargetIsObject(e){if(!le.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Pn={apply:function apply(){return le.Call(le.Call,null,arguments)},construct:function construct(e,t){if(!le.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!le.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return le.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){En(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){En(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Pn,{ownKeys:function ownKeys(e){En(e);var t=Object.getOwnPropertyNames(e);if(le.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Cn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Pn,{isExtensible:function isExtensible(e){En(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){En(e);return Cn(function(){return Object.preventExtensions(e)})}})}if(s){var Mn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Mn(o,t,r)}if("value"in n){return n.value}if(n.get){return le.Call(n.get,r)}return void 0};var xn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return xn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!le.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ue.defineProperty(o,r,{value:n})}else{return ue.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Pn,{defineProperty:function defineProperty(e,t,r){En(e);return Cn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){En(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){En(e);var r=arguments.length>2?arguments[2]:e;return Mn(e,t,r)},set:function set(e,t,r){En(e);var n=arguments.length>3?arguments[3]:e;return xn(e,t,r,n)}})}if(Object.getPrototypeOf){var Nn=Object.getPrototypeOf;Pn.getPrototypeOf=function getPrototypeOf(e){En(e);return Nn(e)}}if(Object.setPrototypeOf&&Pn.getPrototypeOf){var An=function(e,t){var r=t;while(r){if(e===r){return true}r=Pn.getPrototypeOf(r)}return false};Object.assign(Pn,{setPrototypeOf:function setPrototypeOf(e,t){En(e);if(t!==null&&!le.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ue.getPrototypeOf(e)){return true}if(ue.isExtensible&&!ue.isExtensible(e)){return false}if(An(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Rn=function(e,t){if(!le.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){oe(S.Reflect,e,t)}}};Object.keys(Pn).forEach(function(e){Rn(e,Pn[e])});var _n=S.Reflect.getPrototypeOf;if(c&&_n&&_n.name!=="getPrototypeOf"){oe(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(_n,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){oe(S.Reflect,"setPrototypeOf",Pn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){oe(S.Reflect,"defineProperty",Pn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){oe(S.Reflect,"construct",Pn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var kn=Date.prototype.toString;var Ln=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return le.Call(kn,this)};oe(Date.prototype,"toString",Ln)}var Fn={anchor:function anchor(e){return le.CreateHTML(this,"a","name",e)},big:function big(){return le.CreateHTML(this,"big","","")},blink:function blink(){return le.CreateHTML(this,"blink","","")},bold:function bold(){return le.CreateHTML(this,"b","","")},fixed:function fixed(){return le.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return le.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return le.CreateHTML(this,"font","size",e)},italics:function italics(){return le.CreateHTML(this,"i","","")},link:function link(e){return le.CreateHTML(this,"a","href",e)},small:function small(){return le.CreateHTML(this,"small","","")},strike:function strike(){return le.CreateHTML(this,"strike","","")},sub:function sub(){return le.CreateHTML(this,"sub","","")},sup:function sub(){return le.CreateHTML(this,"sup","","")}};l(Object.keys(Fn),function(e){var r=String.prototype[e];var n=false;if(le.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){oe(String.prototype,e,Fn[e])}});var Dn=function(){if(!ie){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e(J())!=="undefined"){return true}if(e([J()])!=="[null]"){return true}var t={a:J()};t[J()]=true;if(e(t)!=="{}"){return true}return false}();var zn=a(function(){if(!ie){return true}return JSON.stringify(Object(J()))==="{}"&&JSON.stringify([Object(J())])==="[{}]"});if(Dn||!zn){var qn=JSON.stringify;oe(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=le.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(ne.symbol(n)){return At({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return qn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}define("engine",["jquery","utils","state","section","passages"],function(C,N,P,j,R){var t,I=N.impossible,V=N.passageSelector,M=N.transitionOut,D=N.options;function F(e,t,n){var r,a,o;if(n?(n=n.get("name"),(a=R.getTree(n)).children.length&&(r={type:"include",tag:t,name:n,children:a.children,text:a.text})):r=R.getTree(t),r){for(;(o=e[e.length-1])&&("root"===o.type||"include"===o.type)&&o.children.some(function(e){return e.type.startsWith("unclosed")});)e[e.length-1]=Object.create(o),e=e[e.length-1].children=o.children.slice();e.push(r)}}function n(e){var t,n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=r.loadedGame,o=R.get(e),i=N.storyElement,s=i.parent(),c=r.stretch,r=r.transition,l=(r=void 0===r?{}:r).depart,l=void 0===l?"instant":l,u=r.arrive,u=void 0===u?"dissolve":u,p=r.departOrigin,d=r.arriveOrigin,r=r.time,f=(s.findAndFilter("tw-enchantment").each(function(e,t){var n=(t=C(t)).data("enchantedProperties");n&&i.css(n.reduce(function(e,t){return e[t]="",e},{})),t[0]===s[0]&&(s=i.unwrap().parent())}),R.hasValid(e)||I("Engine.showPassage","There's no passage with the name \""+e+'"!'),i.children(V).not(".transition-out, .transition-out *")),o=(o.get("tags")||[]).join(" "),h=(t=C("<tw-passage><tw-sidebar>"),h=t.children("tw-sidebar"),m=C('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),n=C('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),P.pastLength<=0&&m.css("visibility","hidden"),P.futureLength<=0&&n.css("visibility","hidden"),h.append(m,n),t),m=("function"==typeof p&&(p=p.call(f)),"function"==typeof d&&(d=d.call(h)),N.detachStoryElement(),h.appendTo(i).attr({tags:o}),!c&&l&&(M(f,l,r,0,0,0,p),f.css("position","absolute")),i.attr({tags:o}),j.create(h)),g=(a&&(m.loadedGame=!0),[]);if(P.pastLength<=0&&1===P.turns){var y,v=_createForOfIteratorHelper(R.getTagged("startup"));try{for(v.s();!(y=v.n()).done;)F(g,"startup",y.value)}catch(e){v.e(e)}finally{v.f()}if(D.debug){var b,w=_createForOfIteratorHelper(R.getTagged("debug-startup"));try{for(w.s();!(b=w.n()).done;)F(g,"debug-startup",b.value)}catch(e){w.e(e)}finally{w.f()}}}var k,T=_createForOfIteratorHelper(R.getTagged("header"));try{for(T.s();!(k=T.n()).done;)F(g,"header",k.value)}catch(e){T.e(e)}finally{T.f()}if(D.debug){var S,x=_createForOfIteratorHelper(R.getTagged("debug-header"));try{for(x.s();!(S=x.n()).done;)F(g,"debug-header",S.value)}catch(e){x.e(e)}finally{x.f()}}F(g,e);var _,O=_createForOfIteratorHelper(R.getTagged("footer"));try{for(O.s();!(_=O.n()).done;)F(g,"footer",_.value)}catch(e){O.e(e)}finally{O.f()}if(D.debug){var A,E=_createForOfIteratorHelper(R.getTagged("debug-footer"));try{for(E.s();!(A=E.n()).done;)F(g,"debug-footer",A.value)}catch(e){E.e(e)}finally{E.f()}}m.renderInto(g,h,{transition:u,transitionTime:r,transitionOrigin:d}),m.loadedGame=!1,N.reattachStoryElement(),scroll(0,c?h.offset().top-.05*C(window).height():i[0].getBoundingClientRect().top+document.body.scrollTop)}return Object.freeze({goBack:function(e){P.rewind()&&n(P.passage,e)},goForward:function(e){P.fastForward()&&n(P.passage,e)},goToPassage:function(e,t){P.play(e),n(e,t)},redirect:function(e,t){P.redirect(e),n(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:n,enableDebugMode:function(){t&&t()},registerDebugMode:function(e){t=t||e}})}),define("harlowe",["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","utils/jqueryplugins","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref,VarScope){var dialog=_ref.dialog;function __HarloweEval(text){eval(text+"")}function printJSError(e){var t,n=e.name+": "+e.message;return e.stack&&(t=(e=e.stack.split("\n")).findIndex(function(e){return e.includes("__HarloweEval")}),n+="\n"+e.slice(0,t).join("\n").replace(/\([^\)]+\)/g,"")),"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+n+"```</div>"}!function(o){window.onerror=function(e,t,n,r,a){window.onerror=o,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n".concat(printJSError(a),"\n(This is probably due to a bug in the Harlowe game engine.)")}).addClass("harlowe-crash")),"function"==typeof o&&o.apply(void 0,arguments)}}(window.onerror),Utils.onStartup(function(){var n,e,t,r,a=$("tw-storydata");0!==a.length&&(Utils.options.ifid=a.attr("ifid"),(a.attr("options")||"").split(/\s/).forEach(function(e){e&&(Utils.options[e]=!0),"debug"===e&&DebugMode()}),a=(a=a.attr("startnode"))||[].reduce.call($("tw-passagedata"),function(e,t){t=t.getAttribute("pid");return t<e?t:e},1/0),a=$("tw-passagedata[pid='"+a+"']").attr("name"),$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),n=!1,$("[role=script]").each(function(t){try{__HarloweEval($(this).html())}catch(e){n||(n=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(t+1)+" script:\n\n"+printJSError(e)}))}}),$("[role=stylesheet]").each(function(e,t){$(document.head).append("<style data-title=\"Story stylesheet '".concat(e+1,"'\">").concat($(t).html()))}),(e=Section.create()).stack=[{tempVariables:Object.create(VarScope)}],(r=Passages.loadMetadata(e)).length&&(t=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"}),r.forEach(function(e){return t.find("p").append(e.render())})),(r=!Utils.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session"))&&!0===State.deserialise(e,r)?Engine.showPassage(State.passage):Engine.goToPassage(a))})}),define("macros",["utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/twineerror"],function(g,e,t,o,r,y,v,p,b){var w=e.insensitiveName,k=e.nth,T=e.andList,S=t.objectName,x=t.typeName,d=t.toSource,_=Array.isArray,i={};function O(e){return e===s.TypeSignature.Any||(_(e.innerType)?e.innerType.some(O):!!e.innerType&&O(e.innerType))}function a(e,t,n,r){var a,o,i,s,c,l,u,p,d=t.fn,f=t.typeSignature,h=t.returnType,m=(r=function(e){for(var t,n,r,a=[],o=0;o<e.length;o+=1)o in e&&(!0===(null==(t=e[o])?void 0:t.spreader)?(n=t.value,(r=b.containsError(n))?a.push(r):_(n)||"string"==typeof n?a.push.apply(a,_toConsumableArray(n)):n instanceof Set?a.push.apply(a,_toConsumableArray(Array.from(n).sort(g("en")))):a.push(b.create("operation","I can't spread out "+S(n)+", because it is not a string, dataset, or array."))):a.push(t));return a}(r),"string"!=typeof e&&(a=e,e=""),a?"":"("+(_(e)&&1<e.length?e[0]:e)+":)");for(e=a?a.TwineScript_KnownName?"the custom macro, ".concat(a.TwineScript_KnownName):"an unnamed custom macro":"the ".concat(m," macro"),o=0<f.length?1===f.length&&O(f[0])?1===r.length?"That value can't be given to macros as-is.":"Give only a single value to this macro.":e+" must only be given "+T(f.map(x))+(1<f.length?", in that order":"."):e+" must not be given any data."+(a?"":" Just write "+m),s=0,c=Math.max(r.length,f.length);s<c;s+=1){if(p=f[s],l=r[s],b.containsError(l))return l;if(s>=f.length&&!i)return b.create("datatype",r.length-f.length+" too many values were given to "+e+".",o);if(!(p=p||i).innerType||"rest"!==p.pattern&&"zero or more"!==p.pattern||(i=p.innerType,"rest"===p.pattern&&(p=p.innerType)),!function e(t,n){if(null===n)return void 0===t;var r=_typeof(t);if("function"!=typeof n&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern){for(var a=0;a<n.innerType.length;a+=1)if(e(t,n.innerType[a]))return!0;return!1}if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")===("where"in t||"each"in t)&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(w(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?"string"===r:n===Boolean?"boolean"===r:n===parseInt?"number"===r&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?"number"===r&&!Number.isNaN(t):n===Array?_(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))}(l,p))return void 0===l?(u=f.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length,b.create("datatype","".concat(e," was given ").concat(r.length?T(r.map(S)):"nothing",", but needs ").concat(u-s," more value").concat(1<u-s?"s":"","."),o)):null!=(u=l)&&u.TwineScript_Unstorable&&O(p)?b.create("datatype",e+"'s "+k(s+1)+" value, "+S(l)+", is not valid data for this macro.",o):v.isPrototypeOf(l)&&"Changer"===h?b.create("syntax","Please put this hook outside the parentheses of "+e+", not inside it.","Hooks should appear after a macro"+(a?".":": "+m+"[Some text]")):l&&y.isPrototypeOf(l)&&"lambda"===p.pattern?b.create("datatype",e+"'s "+k(s+1)+" value (a lambda) should have "+T(["where","when","making","via","with"].filter(function(e){return p.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+T(["where","when","making","via","with"].filter(function(e){return e in l}).map(function(e){return"a '"+e+"' clause"}))+"."):"insensitive set"===p.pattern?b.create("datatype",S(l)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+T(p.innerType)+"."):b.create("datatype","".concat(e,"'s ").concat(k(s+1)," value is ").concat(S(l),", but should be ").concat(x(p),"."),p.message||o)}return d.apply(null,[n].concat(r))}function f(e,t,n,r){var a={fn:n,typeSignature:r=[].concat(r||[]),returnType:t};Object.freeze(a),[].concat(e).forEach(function(e){return Object.defineProperty(i,w(e),{value:a})})}var s={has:function(e){return e=w(e),hasOwnProperty.call(i,e)},get:function(e){return e=w(e),hasOwnProperty.call(i,e)&&i[e]},add:function e(t,n,r,a){return f(t,n,r,a),e},addChanger:function e(t,n,r,a){return f(t,"Changer",n,a),o.register(_(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a){var s,c,l,u,o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=[].concat(t)[0];return f(t,"Command",(s=i,c=n,l=r,u=o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=c.apply(void 0,n);if(a)return a;var o=p.create(),i=Object.assign({TwineScript_TypeID:"command",TwineScript_ObjectName:"a (".concat(s,":) command"),TwineScript_TypeName:"a (".concat(s,":) command"),TwineScript_Print:function(){return"`[A (".concat(s,":) command]`")},TwineScript_ToSource:function(){return"(".concat(s,":").concat(n.map(d),")")},TwineScript_is:function(e){return d(this)===d(e)}},u?{TwineScript_Attach:function(e,t){return o.section=e,t.run(o),i},TwineScript_Run:function(e){e=l.apply(void 0,[o,e].concat(n));return o=p.create(),e}}:{TwineScript_Run:function(e){return l.apply(void 0,[e].concat(n))}});return i}),a),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:t,max:n,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&t<=e&&e<=n}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&0<=e&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&1<=e&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t,n){return s.has(e)?a(e,s.get(e),t,n):b.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t,n){return r.isPrototypeOf(e)?a(e,e,t,n):b.containsError(e)?e:b.create("macrocall","I can't call ".concat(S(e)," because it isn't a custom macro."))}};return Object.assign(s.TypeSignature,{positiveNumber:s.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:s.TypeSignature.numberRange(0,1/0),percent:s.TypeSignature.numberRange(0,1)}),Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","internaltypes/twineerror"],function(t,s,e,i,c){var l=e.insensitiveName,a=e.unescape,n=e.onStartup,o=e.impossible,u=Object.assign,p=RegExp(i.Patterns.macroFront+i.Patterns.macroName,"ig");function r(e){var t=e.attr("name"),n=a(e.html()),r=function(e,t){var r=["metadata","storylet","exclusivity","urgency"];if(!(e.match(p)||[]).some(function(t){return r.some(function(e){return l(t.slice(1,-1))===e})}))return{};var a=!1,o={};return i.lex(e,t).children.forEach(function e(t){if("macro"===t.type){var n=l(t.name);if(r.some(function(e){return n===e})){if(c.isPrototypeOf(o[n]))return;if(a)return void(o[n]=c.create("syntax","The (".concat(t.name,":) macro can't appear after non-metadata macros.")));if(o[n])return void(o[n]=c.create("syntax","There is more than one (".concat(t.name,":) macro.")));o[n]=t}else a=!0;t.children.forEach(function e(t){var n=l(t.name);"macro"===t.type&&r.some(function(e){return n===e})?o[n]=c.create("syntax","The (".concat(t.name,":) macro can't be inside another macro.")):t.children.forEach(e)})}else t.children.forEach(e)}),o}(n,t);return u(new Map([["source",n],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",t]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:r,tree:null})}var d=Object.create(null),f=[],h=null,m=u(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(n){if(d[n])return d[n];var e=s("en",function(e){return e.get("name")}),r=[];return this.forEach(function(e){var t=e instanceof Map&&e.get("tags");Array.isArray(t)&&t.includes(n)&&r.push(e)}),r.sort(e),d[n]=r},clearTagCache:function(){d=Object.create(null)},clear:function(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete:function(){var e;(e=Map.prototype.delete).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree:function(e){if(!this.has(e))return o("Passages.getTree","No passage name?"),[];var t=this.get(e),n=t.get("tags");if(n.includes("header")||n.includes("footer")||n.includes("debug-header")||n.includes("debug-footer"))return t.tree||(t.tree=i.lex(t.get("source"),e)),t.tree;for(var r,a=0;a<f.length;a+=1)if(f[a]&&f[a].place===e)return r=f.splice(a,1)[0],f.unshift(r),r;n=i.lex(t.get("source"),e);return f.unshift(n),16<f.length&&f.pop(),n},clearTreeCache:function(){f=[]},getStorylets:function(r,e){e=e?e.filter(r,_toConsumableArray(m.values())):_toConsumableArray(m.values());if(c.containsError(e))return e;var a=[],o=-1/0,e=e.reduce(function(e,t){if(e)return e;e=t.get("storylet");if(e){var n=r.speculate(e,t.get("name"),"a (storylet:) macro");if(c.containsError(n))return n.message="There's an error in the storylet passage \""+t.get("name")+'":\n'+n.message,n.source=e.TwineScript_ToSource(),n;n&&(e=t.get("exclusivity"),o=Math.max(o,"number"==typeof e?e:0),a.push(t))}},void 0);if(e)return e;var i=s("en");return a.filter(function(e){e=e.get("exclusivity");return(e="number"==typeof e?e:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:i(e.get("name"),t.get("name"))})},allStorylets:function(){return h=h||_toConsumableArray(m.values()).filter(function(e){return e.get("storylet")})},clearStoryletCache:function(){h=null},loadMetadata:function(i){var s=[];return m.forEach(function(o){o.metadata&&Object.keys(o.metadata).forEach(function(e){var t,n,r;{if(!c.containsError(o.metadata[e]))return t=o.metadata[e],n=i.speculate(t,o.get("name"),"a ("+e+":) macro"),r='In "'+o.get("name")+'":\n',c.containsError(n)?(n.message=r+n.message,n.source=t.text,void s.push(n)):void(n instanceof Map?n.forEach(function(e,t){return a(t,e)}):a(e,n));s.push(o.metadata[e])}function a(e,t){o.has(e)?s.push(c.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):o.set(e,t)}}),o.metadata=void 0}),s},hasValid:function(e){e=this.get(e);return e&&e instanceof Map&&e.has("source")},create:r});return n(function(){t("tw-storydata > tw-passagedata").get().forEach(function(e){e=t(e),m.set(e.attr("name"),new r(e))})}),m}),define("renderer",["jquery","utils","markup","internaltypes/twineerror"],function(a,e,T,S){var x=e.escape,_=e.insensitiveName,O=e.options;function A(e,t,n){n=2<arguments.length&&void 0!==n?n:"";return"<"+t+(n?" "+n:"")+">"+e+"</"+t+">"}var E="text-align: center; max-width:50%; ";function C(m,g){function y(e,t,n){e=C(e.children,g);return e&&A(e,t,n)}var v="",b=[];if(m)for(var w=(m=Array.isArray(m)?m:[m]).length,k=0;k<w;k+=1){var e=function(r){var n=m[r];switch(n.type){case"include":v+=y(n,"tw-"+n.type,'type="'.concat(n.tag,'" name="').concat(n.name,'"'));break;case"error":v+=S.create("syntax",n.message,n.explanation).render(x(n.text))[0].outerHTML;break;case"numbered":case"bulleted":for(var e="numbered"===n.type?"ol":"ul",t=(v+="<"+e+">",1);r<w&&m[r];){if("br"===m[r].type){if(v+="</li>",!m[r+1]||m[r+1].type!==n.type)break}else m[r].type===n.type?(v=(v+=("<"+e+">").repeat(Math.max(0,m[r].depth-t)))+("</"+e+">").repeat(Math.max(0,t-m[r].depth))+"<li>",t=m[r].depth):v+=C([m[r]],g);r+=1}v+=("</"+e+">").repeat(t+1);break;case"align":for(;n&&"align"===n.type;){var a=n.align,o=r+=1;if("left"===a){--r;break}for(;r<w&&m[r]&&"align"!==m[r].type;)r+=1;var o=C(m.slice(o,r),g),i="";switch(a){case"center":i+=E+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":i+="text-align: "+a+";";break;default:+a&&(i+=E+"margin-left: "+a+"%;")}v+="<tw-align "+(i?'style="'+i+'"':"")+">"+o+"</tw-align>\n",n=m[r]}break;case"column":for(var s,c=[];n&&"column"===n.type;){var l=n.column,u=r+=1;if("none"===l){--r;break}for(;r<w&&m[r]&&"column"!==m[r].type;)r+=1;c.push({text:n.text,type:l,body:C(m.slice(u,r),g),width:n.width,marginLeft:n.marginLeft,marginRight:n.marginRight}),n=m[r]}c.length&&(s=c.reduce(function(e,t){return e+t.width},0),v+="<tw-columns>"+c.map(function(e){return"<tw-column type=".concat(e.type," ",' style="width:').concat(e.width/s*100,"%; margin-left: ").concat(e.marginLeft,"em; margin-right: ").concat(e.marginRight,'em;">').concat(e.body,"</tw-column>\n")}).join("")+"</tw-columns>");break;case"heading":for(v+="<h"+n.depth+">";++r<w&&m[r];){if("br"===m[r].type){v+="</h"+n.depth+">";break}v+=C([m[r]],g)}break;case"br":if(!b.length||/td|th/.test(b[0])){v+="<br>";for(var p=m[r+1];p&&("br"===p.type||"tag"===p.type&&/^<br\b/i.test(p.text));)v+="<tw-consecutive-br"+("tag"===p.type?" data-raw":"")+"></tw-consecutive-br>",p=m[(r+=1)+1]}break;case"hr":v+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":v+='<a class="link" href="'+x(n.text)+'">'+n.text+"</a>";break;case"scriptStyleTag":case"tag":var d=n.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\b/.test(d)&&!n.text.endsWith("/>")&&b[n.text.startsWith("</")?"shift":"unshift"](d),v+=n.text.startsWith("</")?n.text:n.text.replace(/(\/)?>$/,function(e,t){return" data-raw".concat(t?"></".concat(n.text.match(/[\w-]+/)):"",">")});break;case"sub":case"sup":case"strong":case"em":v+=y(n,n.type);break;case"strike":v+=y(n,"s");break;case"bold":v+=y(n,"b");break;case"italic":v+=y(n,"i");break;case"twineLink":d=_slicedToArray(T.lex("(link-goto:"+JSON.stringify(n.innerText)+","+JSON.stringify(n.passage)+")").children,1)[0];v+='<tw-expression type="macro" name="link-goto"'+(O.debug?' title="'+x(n.text)+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(d);break;case"hook":v+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+_(n.name)+'"':"")+(O.debug&&n.name?' title="Hook: ?'+n.name+'"':"")+' source="'+g.source.length+'"></tw-hook>',g.source.push(n.children);break;case"unclosedHook":return v+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+_(n.name)+'"':"")+'source="'+g.source.length+'"></tw-hook>',g.source.push(m.slice(r+1,w)),k=r,{v:v};case"verbatim":v+=A(x(n.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":v+=y(n,"tw-collapsed");break;case"unclosedCollapsed":return v+="<tw-collapsed>"+C(m.slice(r+1,w),g)+"</tw-collapsed>",k=r,{v:v};case"variable":case"tempVariable":case"macro":var f=[],h=[];if("macro"===n.type&&!function e(t){"string"!==t.type&&"hook"!==t.type&&t.children.every(e);var n=_(t.name);if("macro"!==t.type||"prompt"!==n&&"confirm"!==n){if("hook"===t.type&&!t.everyLeaf(function(e){return"error"===e.type?(h.push(e),k=r,!1):(k=r,!0)}))return k=r,!1}else f.push(t);return k=r,!0}(n),h.length)return k=r,{v:S.create("syntax","This code hook's markup contained "+h.length+" error"+(h.length?"s":"")+":<br>\u2014"+h.map(function(e){return e.message}).join("<br>\u2014")).render(x(n.text))[0].outerHTML};d=f.map(function(e){return e.blockerTree=g.blockers.length,g.blockers.push(e),k=r,e.blockerTree});v+='<tw-expression type="'+n.type+'" name="'+x(n.name||n.text)+'"'+(O.debug?' title="'+x(n.text)+'"':"")+(d.length?' blockers="'+d+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(n);break;default:v+=n.children&&n.children.length?C(n.children,g):n.text}k=r}(k);if("object"===_typeof(e))return e.v}return v}return Object.freeze({exec:function(e){var r={code:[],blockers:[],source:[]},e=C(e="string"==typeof e?T.lex(e).children:e,r),e=a(a.parseHTML(e,document,!0));return e.findAndFilter("script:not([src])").each(function(e,t){var n=t.getAttribute("type");n&&"text/javascript"!==n.toLowerCase()||t.setAttribute("type","application/x-harlowe")}),r.blockers=r.blockers.map(function(e){e.blockedValue=!0;e=Object.create(e);return e.blockedValue=!1,e}),e.findAndFilter("tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])").each(function(e,t){var n;(t=a(t)).attr("blockers")&&(n=t.popAttr("blockers").split(",").map(function(e){return r.blockers[e]}),t.data("blockers",n)),t.attr("source")&&t.data("source",r.source[t.popAttr("source")]),t.attr("code")&&t.data("code",r.code[t.popAttr("code")])}),e}})}),define("repl",["utils","markup","section"],function(e,t,n){e.onStartup(function(){return setTimeout(function(){e.options.debug&&(window.REPL=function(e){e=n.create().eval(t.lex("(print:"+e+")"));return e.TwineScript_Run?e.TwineScript_Run().source:e},window.LEX=function(e){e=t.lex(e);return 1===e.length?e[0]:e})})})}),define("section",["jquery","utils","twinescript/runner","twinescript/operations","state","utils/operationutils","utils/renderutils","utils/scripttag","datatypes/changercommand","datatypes/colour","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(p,f,a,u,r,e,t,i,d,h,o,m,g,y,v,b){var w=e.printBuiltinValue,k=e.objectName,T=e.typeID,S=e.isObject,s=t.collapse,x=Object.assign,_=Object.create,O=Object.keys;function A(e,t,n){if(t&&"object"===_typeof(t)&&d.isPrototypeOf(t)){var r=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),a=(null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),n.data("originalSource",r),g.create({target:n,source:r,section:this,append:"append"})),o=t.run(a);if(v.containsError(o)&&e.replaceWith(o.render(e.attr("title"))),!this.renderInto(r,null,a))return o=f.insensitiveName(e.attr("name")),["if","elseif","unless","else","testfalse"].includes(o)&&(e.addClass("false"),"elseif"!==o&&(this.stackTop.lastHookShown=!1)),n.data("live")&&function(t,n,r){function a(e){p&&(d-=(e-p)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)),p=e,0<d?requestAnimationFrame(a):(d=s,o())}var o,i=this,e=r.data("live"),s=e.delay,c=e.event,l=((n=x({},n,{append:"replace",transitionDeferred:!1,enabled:!0})).data=x({},n.data,{live:void 0}),r.data("originalSource")||""),u=this.stackTop.tempVariables,p=null,d=s;o=this.whenUnblocked.bind(this,function(){var e;i.inDOM()&&(e=null==c?void 0:c.filter(i,[!0],u),v.containsError(e)?e.render(i,t.attr("title")).replaceAll(t):c&&!e[0]?requestAnimationFrame(a):(i.renderInto(l,r,n,u),e||r.find("tw-expression[name='stop']").length||i.inDOM()&&requestAnimationFrame(a)))}),requestAnimationFrame(a)}.call(this,e,a,n),!0}else{if(!1===t)return o=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),o&&(n.cachedData&&(n.cachedData.source=void 0),n.data("originalSource",o),n.data("hidden",!0)),e.addClass("false"),!(this.stackTop.lastHookShown=!1);if(!0!==t)return!1}return this.stackTop.lastHookShown=!0}function E(e){var t,n,e=(e instanceof p?e[0]:e).nextSibling;return e&&(e instanceof Text&&!e.textContent.trim()||["br","tw-consecutive-br"].includes((e.tagName||"").toLowerCase()))?(t=(n=E(e)).whitespace,n=n.nextElem,{whitespace:p(e).add(t),nextElem:n}):{whitespace:p(),nextElem:p(e)}}function C(e){if(null!=e&&e.length)return p("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)}function c(e,t){var n=this.eval(t);e.append(C(this.evalReplay)),e.append(function(e,t){if(/a \((go-to|undo|redirect|restart):\) command/.exec(null==t?void 0:t.TwineScript_TypeName))return p("<tw-open-button goto label='GO'>").data("goto",{section:e,command:t})}(this,n)),this.stackTop.evaluateOnly&&n&&(d.isPrototypeOf(n)||"function"==typeof n.TwineScript_Run)&&(n=v.create("syntax","I can't work out what ".concat(this.stackTop.evaluateOnly," should evaluate to, because it contains a ").concat(d.isPrototypeOf(n)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var r=p();for(i=e;d.isPrototypeOf(n);){var a=E(i),o=a.whitespace;if((i=a.nextElem)[0]&&i[0].nodeType===Node.TEXT_NODE&&"+"===i[0].textContent.trim()){var i,a=i,s=E(a),c=s.whitespace;if((i=s.nextElem).is("tw-expression")){var s=i.popData("code")||(null==(s=i[0])||null==(s=s.cachedData)?void 0:s.code),l=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(s));if(v.containsError(l)){n=l;break}s=u["+"](n,l);p(o).add(a).add(c).remove(),n=v.containsError(s)?v.create("operation","I can't combine "+k(n)+" with "+k(l)+".","function"==typeof l.TwineScript_Run?"If you want to attach this changer to ".concat(k(l),", remove the + between them."):"Changers can only be added to other changers."):s;continue}}if(i.is("tw-expression")){l=i.popData("code")||(null==(a=i[0])||null==(c=a.cachedData)?void 0:c.code),a=(null!=(s=i[0])&&s.cachedData&&(i[0].cachedData.code=void 0),this.eval(l));if(i.append(C(this.evalReplay)),v.containsError(a)){n=a;break}if(a&&"object"===_typeof(a)&&"function"==typeof a.TwineScript_Attach){n=a.TwineScript_Attach(this,n);break}return d.isPrototypeOf(a)?void e.replaceWith(v.create("operation","Changers like (".concat(n.macroName,":) need to be combined using + between them."),"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(e.attr("title"))):void e.replaceWith(v.create("operation","".concat(k(a)," can't have changers like (").concat(n.macroName,":) attached."),"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(e.attr("title")))}if(i.is("tw-hook")){o.remove(),r=i;break}n.macroName||f.impossible("Section.runExpression","changer has no macroName");a=e.attr("title")||"("+n.macroName+": ...)";return void e.replaceWith(v.create("syntax","The (".concat(n.macroName,":) changer should be stored in a variable or attached to a hook."),"Macros like this should appear before a hook: ".concat(a,"[Some text]")).render(e.attr("title")))}e.attr("return",T(n)),r=r.length?r:E(e).nextElem.filter("tw-hook"),(t=v.containsError(n))?e.replaceWith(t.render(e.attr("title")).append(C(this.evalReplay))):b.isPrototypeOf(n)?e.append(n.render()):n&&"function"==typeof n.TwineScript_Run?(n=n.TwineScript_Run(this),v.containsError(n)?e.replaceWith(n.render(e.attr("title"))):g.isPrototypeOf(n)?null!=(t=n.data)&&t.live?e.replaceWith(v.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(e.attr("title"))):(n.section=this,n.target=i,this.renderInto("",i,n)):S(n)&&n.blocked?(this.stackTop.blocked=n.blocked,e.data("code",{type:"macro",blockedValue:!0,text:e.attr("title")||"",start:0,end:(e.attr("title")||"").length})):n&&f.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor ".concat(_typeof(n),': "').concat(n,'"'))):r.length&&A.call(this,e,n,r)||("string"==typeof n||"number"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||h.isPrototypeOf(n)||m.isPrototypeOf(n)||n&&"function"==typeof n.TwineScript_Print&&!d.isPrototypeOf(n)?(n=w(n),v.containsError(n)?e.replaceWith(n.render(e.attr("title"))):"string"==typeof n||Array.isArray(n)?this.renderInto(n,e):f.impossible("printBuiltinValue() produced a non-string non-array ".concat(_typeof(n)))):d.isPrototypeOf(n)||"boolean"==typeof n||f.impossible("Section.runExpression","The expression evaluated to an unknown value: ".concat(n)))}var l={add:[],remove:[]};return Object.preventExtensions({create:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.storyElement,n=x(_(this),{timestamp:Date.now(),dom:e,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?v.create("operation","'time' can't be used in ".concat(n.stackTop.evaluateOnly,".")):(Date.now()-n.timestamp)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)},get turns(){return r.turns},get turn(){return r.turns},get visits(){var t=n.stackTop.speculativePassage;return r.history().filter(function(e){return e===(t||r.passage)}).length+(!t||t===r.passage)},get visit(){return n.Identifiers.visits},get exits(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?v.create("operation","'exit' and 'exits' can't be used in ".concat(n.stackTop.evaluateOnly,".")):n.dom.find("tw-enchantment, tw-link").filter(function(e,t){return(t=p(t)).data("enchantmentEvent")||t.parent().data("linkPassageName")||t.parent().data("clickEvent")}).length},get exit(){return n.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:v.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}}});return n},eval:function(t){var e,n;f.options.debug&&f.options.evalReplay&&(n=Array.isArray(t)?t.reduce(function(e,t){return e+t.text},""):t.text||"",this.evalReplay=[{code:n,fromCode:n,basis:(Array.isArray(t)?t[0]:t).start,start:0,end:n.length,diff:0}]);try{e=a(this,t)}catch(e){return null!=(n=window.console)&&n.error(e),this.evalReplay=null,v.create("","An internal error occurred while trying to run ".concat([].concat(t).map(function(e){return e.text}).join(""),"."),'The error was "'.concat(e.message,'".\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).'))}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),e},get stackTop(){return this.stack[0]},inDOM:function(){return 0<f.storyElement.find(this.dom).length},evaluateTwineMarkup:function(e,t){var n=p("<p>");return this.stack.unshift({desc:g.create({target:n,source:e,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:t,finalIter:!0}),this.execute(),0<(e=n.find("tw-error")).length?e:n},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:x(_(y),{TwineScript_VariableStore:{type:"temp",name:n}}),speculativePassage:t});var r,n=this.evalReplay;return this.evalReplay=null,o.isPrototypeOf(e)?r=e.apply(this,{fail:!1,pass:!0}):e&&(r=a(this,e)),this.stack.shift(),this.evalReplay=n,r},renderInto:function(e,a,t){var o=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=g.create({target:a,source:e,section:this,append:"append"});if(t)if(d.isPrototypeOf(t)){var e=t.run(i);if(v.containsError(e))return e.render(a.attr("title")).replaceAll(a),!1}else x(i,t);if((a=i.target,50<=this.stack.length)&&50<=this.stack.reduce(function(e,t){return e+!!t.finalIter},0))return v.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(a.attr("title")).replaceAll(a),!1;function s(e,t,n){var r=a instanceof p&&a.is("tw-hook")&&0<a.parents("tw-collapsed,[collapsing=true]").length;o.stack.unshift({desc:e,finalIter:n,tempVariables:t,collapses:r,evaluateOnly:o.stackTop&&o.stackTop.evaluateOnly})}r=r||_(this.stack.length?this.stackTop.tempVariables:y),hasOwnProperty.call(r,"TwineScript_VariableStore")||(t=null==(e=a)?void 0:e.tag(),r.TwineScript_VariableStore={type:"temp",name:"tw-hook"===t?a.attr("name")?"?"+a.attr("name"):"an unnamed hook":"tw-expression"===t?"a "+a.attr("type")+" expression":"tw-passage"===t?"this passage":"an unknown scope"}),t=null==(e=this.stackTop)?void 0:e.blocked;if(O(i.loopVars).length){var c=x({},i.loopVars),l=Math.min.apply(Math,_toConsumableArray(O(c).map(function(e){return c[e].length})));if(b.create(l+" loop"+(1!==l?"s":"")).render().prependTo(a),l){for(var n=l-1;0<=n;--n)!function(n){s(i,O(c).reduce(function(e,t){return e[t]=c[t][n],e},_(r),n===l-1))}(n);for(var u=l-1;0<=u&&!o.stackTop.blocked;--u)o.execute()}}else s(i,r,!0),this.execute();return(0===this.stack.length||!t&&null!=(e=this.stackTop)&&e.blocked)&&this.updateEnchantments(),i.enabled},execute:function(){var a=this,e=this.stackTop,t=e.desc,n=e.dom,r=e.collapses,o=e.evaluateOnly;t&&!n&&(n=t.render(),this.stackTop.dom=n,this.stackTop.desc=void 0),n.findAndFilter('tw-hook,tw-expression,script[type="application/x-harlowe"]').each(function(e,t){var n=p(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}}).each(function(e,t){if(a.stackTop.blocked)return!1;var n=t.cachedData;switch(n&&(t.cachedData=void 0),(t=p(t)).tag()){case"tw-hook":var r=t.popData("source")||(null==n?void 0:n.source);if(r&&t.data("originalSource",r),t.data("tempVariables",a.stackTop.tempVariables),t.popAttr("hidden")){t.data("hidden",!0);break}r&&a.renderInto(r,t);break;case"tw-expression":var r=t.data("blockers")||(null==n?void 0:n.blockers);if(r){if(o)return void t.removeData("blockers").removeData("code").replaceWith(v.create("syntax","I can't use a macro like (prompt:) or (confirm:) in ".concat(o,"."),"Please rewrite this without putting such macros here.").render(t.attr("title"),t));if(r.length)return a.stackTop.blocked=!0,r=a.eval(r.shift()),v.containsError(r)&&(a.stackTop.blocked=!1,t.removeData("blockers").replaceWith(r.render(t.attr("title"),t))),!1;t.removeData("blockers")}r=t.popData("code")||(null==n?void 0:n.code);r&&c.call(a,t,r);break;case"script":if(f.reattachStoryElement(),!t.text())break;try{i(t.text(),a.stackTop.tempVariables)}catch(e){v.isPrototypeOf(e)?t.replaceWith(e.render(t.text(),t)):(null!=(r=window.console)&&r.error(e),t.replaceWith(v.create("","A Javascript error occurred while running this <script> element.",'The error was "'.concat(e,'". Check the browser console for more details.')).render(t.text(),t)))}}}),this.stackTop.blocked||(n.length&&r&&s(n),n.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){s(p(this))}),setTimeout(function(){return n.find("input, textarea").first().focus()},100),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return l[e].push(t),this},addEnchantment:function(t){var n=this;this.enchantments.push(t),l.add.forEach(function(e){return e(n,t)})},removeEnchantment:function(t){var n=this,e=this.enchantments.indexOf(t);this.enchantments.splice(e,1),t.disenchant(),l.remove.forEach(function(e){return e(n,t)})},unblock:function(e){for(this.stack.length||f.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;0<this.unblockCallbacks.length;){var t;if(this.unblockCallbacks.shift()(),null!=(t=this.stackTop)&&t.blocked)return}},whenUnblocked:function(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue:function(){var e=this.stackTop;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():(f.impossible("Section.blockedValue","blockedValues is missing or empty"),0):(f.impossible("Section.blockedValue","stack is empty"),0)}})}),define("state",["jquery","utils","passages","datatypes/customcommand","utils/operationutils","markup"],function(n,y,v,b,e,t){var i,w,E=e.toSource,C=e.is,k=t.lex,o=Object.assign,h=Object.create,e=Object.defineProperty,N=Array.isArray,s=Math.imul,t=(e(Map.prototype,"toJSON",{value:void 0}),e(Set.prototype,"toJSON",{value:void 0}),["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}));function T(e,t){var n=0<arguments.length&&void 0!==e?e:String.fromCodePoint(Date.now()%1114112),e=1<arguments.length&&void 0!==t?t:0;i.seedIter=e,i.seed=n;for(var r,a=0,o=2166136261;a<n.length;a+=1)r=s(n.charCodeAt(a),3432918353),o^=s(r<<15|r>>>17,461845907),o=s(o=o<<13|o>>>19,5)+3864292196|0;return o^=n.length,o=s(o^=o>>>16,2246822507),o=s(o^=o>>>13,3266489909),o=((o^=o>>>16)>>>0)+1831565813*e,function(){i.seedIter+=1;var e=o+=1831565813,e=s(e^e>>>15,1|e);return(((e^=e+s(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}function r(e,t){for(var n,r=t.variables,a=h(null),o=e.length-1;0<=o;--o){for(var i,s,c=e[o],l=0,u=["mockVisits","mockTurns","seed","seedIter"];l<u.length;l++){var p=u[l];hasOwnProperty.call(c,p)&&!hasOwnProperty.call(t,p)&&(t[p]=c[p])}for(i in c.forgetVisits&&(t.forgetVisits=Math.max(t.forgetVisits||0,c.forgetVisits)),void 0!==c.turns&&(t.turns=(t.turns||0)+c.turns),t.pastVisits||(t.pastVisits=[]),o!==e.length-1&&(void 0!==e[o+1].visits&&Array.isArray(t.pastVisits[0])?t.pastVisits[0]:t.pastVisits).unshift(c.passage),void 0!==c.pastVisits&&t.pastVisits.unshift(c.pastVisits),void 0!==c.visits&&t.pastVisits.unshift(c.visits),c.variables)if("TwineScript_TypeDefs"===i)for(var d in r[i]||(r[i]=h(null)),c.variables[i])r[i][d]||(r[i][d]=c.variables[i][d]);else i.startsWith("TwineScript_")||i in r||(null===c.variables[i]&&(a[i]=!0),a[i]||(r[i]=c.variables[i],!(s=c.valueRefs[i])||"via"in s||t.valueRefs[i]||(t.valueRefs[i]=s)))}for(n in t.valueRefs){var f=t.valueRefs[n];f&&"via"in f&&delete t.valueRefs[n]}}var a,c={passage:"",variables:h(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create:function(e){var t=h(c);return t.passage=e||"",t.variables=h(null),t.valueRefs=h(null),t}},l={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]},u=[],p=-1,d=c.create(),f="";function m(){i.history=i.pastVisits.slice(i.forgetVisits).reduce(function(e,t){return e.concat(t)},[]),i.mockVisits&&(i.history=i.mockVisits.concat(i.history))}function g(){var e=c.create();e.pastVisits=[],o(e.variables,{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:h(null),TwineScript_VariableStore:{type:"global",name:"this story's variables"},TwineScript_Delete:function(e){delete this[e],d.variables[e]=null,delete d.valueRefs[e]},TwineScript_Set:function(e,t,n){if(this[e]=t,d.variables[e]=t,n)d.valueRefs[e]=n;else if(N(t)||t instanceof Map||t instanceof Set||"string"==typeof t)for(var r=p;0<=r;--r){var a=u[r].variables[e];if(void 0!==a){a=function e(t,n,r){var a="it"===r?"its":r+"'s",o="";if(N(n)&&N(t)&&n.length){for(var i=n.length===t.length,o="(a:",s=0;s<n.length;s+=1){var c,l,u,p=n[s];C(p,t[s])?(c=E(p),l="".concat(a," ").concat(s+1,"th"),o+=(c.length<l.length?c:l)+","):(i=!1,-1<(c=t.indexOf(p))?(l=E(p),u="".concat(a," ").concat(c+1,"th"),o+=(l.length<u.length?l:u)+","):o+=e(t[s],p,"".concat(a," ").concat(s+1,"th"))+",")}o=i?r:o.slice(0,-1)+")"}else if(n instanceof Map&&t instanceof Map&&n.size){var d,f=n.size===t.size,h=(o="(dm:",_createForOfIteratorHelper(n.entries()));try{for(h.s();!(d=h.n()).done;){var m,g,y=_slicedToArray(d.value,2),v=y[0],b=y[1];o+="".concat(E(v),","),C(b,t.get(v))?(m=E(b),g="".concat(a," (").concat(E(v),")"),o+=(m.length<g.length?m:g)+","):(f=!1,o+=e(t.get(v),b,"".concat(a," (").concat(E(v),")"))+",")}}catch(e){h.e(e)}finally{h.f()}o=f?r:o.slice(0,-1)+")"}else if(n instanceof Set&&t instanceof Set&&n.size){var w,k=new Set,T=new Set,S=_createForOfIteratorHelper(t);try{for(S.s();!(w=S.n()).done;){var x=w.value;n.has(x)||k.add(x)}}catch(e){S.e(e)}finally{S.f()}var _,O=_createForOfIteratorHelper(n);try{for(O.s();!(_=O.n()).done;){var A=_.value;t.has(A)||T.add(A)}}catch(e){O.e(e)}finally{O.f()}k.size||T.size||(o=r),o=k.size+T.size>n.size?E(n):r+(T.size?"+"+E(T):"")+(k.size?"-"+E(k):"")}else"string"==typeof n&&"string"==typeof t&&n&&(n.startsWith(t)?o=r+"+"+E(n.slice(t.length)):n.endsWith(t)&&(o=E(n.slice(0,n.length-t.length))+"+"+r));return o?"it"===r?{via:o}:o:"it"===r?void 0:E(n)}(a,t,"it");a&&("it"===a.via?delete d.variables[e]:d.valueRefs[e]=a);break}}},TwineScript_GetProperty:function(e){return this[e]},TwineScript_DefineType:function(e,t){this.TwineScript_TypeDefs[e]=t,hasOwnProperty.call(d.variables,"TwineScript_TypeDefs")||(d.variables.TwineScript_TypeDefs=h(null)),d.variables.TwineScript_TypeDefs[e]=t}}),r(u.slice(0,p+1),e),i=e,m(),w=T(e.seed,e.seedIter)}function S(e){d=c.create(e);e=a.serialise(!0),f=e.past,e=e.pastAndPresent;if(a.hasSessionStorage&&"string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){return}}function x(e,t,n,r){for(var a in r)if(hasOwnProperty.call(r,a)&&!a.startsWith("TwineScript_"))if("object"===_typeof(r[a]))if(hasOwnProperty.call(r[a],"at")){n.valueRefs[a]=r[a];var o=r[a],i=o.at,s=o.from,c=o.to,l=o.hash,u=o.seed,p=o.seedIter,o=o.blockedValues;if(!v.has(i))throw Error('The data refers to a passage named `"'.concat(n.passage,"\"`, but it isn't in this story."));var d=v.get(i).get("source"),f=d.slice(s,c);if(void 0!==l)for(var h=0,m=c-s;y.hash(f).toString(16)!==l;){if(h+m>=d.length)throw Error("The value (or type) of the variable `$".concat(a,"` couldn't be found in the passage `\"").concat(i,'"`.'));(h+=1)===s&&(h+=1),f=d.slice(h,h+m)}c=k(f,"","macro");void 0!==u&&void 0!==p&&(w=T(u,p)),void 0!==o&&(e.stackTop.blockedValues=o,c.forEach(function e(t){var n;"string"!==t.type&&"hook"!==t.type&&t.children.every(e),"macro"!==t.type||"prompt"!==(n=y.insensitiveName(t.name))&&"confirm"!==n||(t.blockedValue=!0)})),r[a]=e.eval(c)}else if(hasOwnProperty.call(r[a],"via")){for(var g=t.length-1;0<=g;--g)if(hasOwnProperty.call(t[g].variables,a)){e.Identifiers.it=t[g].variables[a];break}r[a]=e.eval(k(r[a].via,"","macro")),e.Identifiers.it=0}else hasOwnProperty.call(r[a],"changer")&&(r[a].changer=e.eval(k(r[a].changer,"","macro")),r[a].hook=e.eval(k(r[a].hook,"","macro")),x(e,t,n,r[a].variables),r[a]=b.create(r[a]));else r[a]=e.eval(k(r[a],"","macro"));else"TwineScript_MockVisits"===a&&(n.mockVisits=r[a])}return g(),d.seed=i.seed,d.seedIter=0,(a={get passage(){return d.passage},get variables(){return i.variables},get pastLength(){return p},get turns(){return p+1+(i.turns||0)+(i.mockTurns||0)},get futureLength(){return u.length-1-p},get mockVisits(){return i.mockVisits||[]},set mockVisits(e){i.mockVisits=e,d.mockVisits=e,m()},get mockTurns(){return i.mockTurns||0},set mockTurns(e){i.mockTurns=e,d.mockTurns=e},history:function(){return i.history},forgetUndos:function(e){e<0&&(e=u.length+e);var t,e=u.splice(0,Math.min(u.length-1,e));e.length&&(p=u.length-1,t=u[0],r(e,t),t.pastVisits.push(e[e.length-1].passage),t.turns=(t.turns||0)+e.length,i.turns=(i.turns||0)+e.length,t.forgetVisits&&(t.pastVisits=t.pastVisits.slice(t.forgetVisits-t.turns),t.forgetVisits-=t.turns),f="",0===p&&n("tw-link[undo], tw-icon[alt='Undo']",y.storyElement).each(function(e,t){(n(t).closest("tw-expression, tw-hook").data("forgetUndosEvent")||Object)(t)}),l.forgetUndos.forEach(function(e){return e()}))},forgetVisits:function(e){(e=e<0?u.length+e:e)>p+i.turns&&(e=p+i.turns),d.forgetVisits=i.forgetVisits=Math.max(i.forgetVisits||0,e),m()},passageNameVisited:function(e){var t=0;if(!v.get(e))return 0;for(var n=0;n<i.history.length;n++)t+=+(e===i.history[n]);return t},get timeline(){return u},play:function(t){var e;d||y.impossible("State.play","present is undefined!"),l.beforeForward.forEach(function(e){return e()}),d.passage&&((null!=(e=d.visits)&&e.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1]:i.pastVisits).push(d.passage),i.history.push(d.passage)),d.passage=t,u=u.slice(0,p+1).concat(d),p+=1,S(t),l.forward.forEach(function(e){return e(t)})},redirect:function(e){var t;d||y.impossible("State.redirect","present is undefined!"),d.passage&&(null!=(t=d.visits)&&t.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1].push(d.passage):i.pastVisits.push([d.passage]),i.history.push(d.passage)),d.visits=(d.visits||[]).concat(e),d.passage=e},rewind:function(e){for(var t=void 0!==e?e:1,n=!1;0<t&&0<p;t--)n=!0,--p;return n&&(l.beforeBack.forEach(function(e){return e()}),f="",S(u[p].passage),g(),l.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);0<t&&0<u.length;t--)n=!0,p+=1;return n&&(l.beforeForward.forEach(function(e){return e()}),S(u[p].passage),g(),l.forward.forEach(function(e){return e(u[p].passage,"fastForward")})),n},on:function(e,t){if(e in l)return"function"!=typeof t||l[e].includes(t)||l[e].push(t),a;y.impossible("State.on","invalid event name")},reset:function(){l.beforeLoad.forEach(function(e){return e()}),u=[],p=-1,g(),(d=c.create()).seed=i.seed,d.seedIter=0,f="",w=T(),l.load.forEach(function(e){return e(u)})},hasStorage:t[0],hasSessionStorage:t[1],setSeed:function(e){w=T(e),d.seed=i.seed,d.seedIter=0},get seed(){return i.seed},get seedIter(){return i.seedIter},random:function(){var e=w();return d.seedIter=i.seedIter,e},shuffled:function(){for(var a=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(e,t,n){var r=a.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[]);return d.seedIter=i.seedIter,r}}).serialise=function(e){function o(e,t){if("TwineScript_TypeDefs"!==t)return null===e[t]?null:e[t]&&hasOwnProperty.call(e[t],"TwineScript_CustomCommand")?(r=e[t].TwineScript_CustomCommand(),{changer:E(r.changer),toSource:r.toSource,hook:E(r.hook),variables:Object.keys(r.variables).reduce(function(e,t){return e[t]=o(r.variables,t),e},{})}):E(e[t]);var n,r,a={};for(n in e[t])a[n]=E(e[t][n]);return a}function t(e,t){if(c.isPrototypeOf(t)&&void 0===t.visits&&void 0===t.turns&&void 0===t.mockVisits&&void 0===t.forgetVisits&&void 0===t.pastVisits&&void 0===t.mockTurns&&void 0===t.seed&&void 0===t.seedIter&&Object.keys(t.variables).every(function(e){return e.startsWith("TwineScript_")}))return t.passage;if(!c.isPrototypeOf(this)||"valueRefs"!==e){if(c.isPrototypeOf(this)&&"variables"===e){var n,r={};for(n in this.variables)this.valueRefs[n]?r[n]=this.valueRefs[n]:r[n]=o(this.variables,n);return r}return t}}var e=u.slice(f?e?p-1:p:0,p+1),n=e.slice(0,-1),r=f;try{return{past:r=n.length?(r?r.slice(0,-1)+",":"[")+JSON.stringify(n,t).slice(1):r,pastAndPresent:r.slice(0,-1)+(r?",":"[")+JSON.stringify(e.slice(-1),t).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},a.deserialise=function(e,t){var n;try{n=JSON.parse(t)}catch(e){return Error("The save data is unintelligible.")}if(!N(n))return Error("The save data isn't a sequence of past turns.");for(var r=0;r<n.length;r+=1){var a=n[r];if("string"==typeof a)a={passage:a,variables:{}};else if("object"!==_typeof(a)||!hasOwnProperty.call(a,"variables")){n.splice(r--,1);continue}if(a.valueRefs=h(null),a.variables=o(h(null),a.variables),!v.hasValid(a.passage))return Error('The data refers to a passage named `"'.concat(a.passage,"\"`, but it isn't in this story."));if(hasOwnProperty.call(a.variables,"TwineScript_TypeDefs"))try{x(e,n.slice(0,r),a,a.variables.TwineScript_TypeDefs)}catch(e){return Error("The variable types on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}try{x(e,n.slice(0,r),a,a.variables)}catch(e){return Error("The variables on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}n[r]=o(h(c),a)}return p=(u=n).length-1,l.load.forEach(function(e){return e(u)}),f="",g(),S(u[p].passage),!0},Object.seal(c),Object.freeze(a)}),define("utils",["jquery","markup","utils/polyfills"],function(d){var r=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),a="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),f=["audio"],e=_slicedToArray([function(e){return r(e)!==r(e).toLowerCase()},function(e){return r(e)!==r(e).toUpperCase()},function(e){return r(e).toLowerCase()!==r(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,t,n){return e===n[t-1]+1&&e===n[t+1]-1?"-":r(e)}).join("").replace(/\-+/g,"-")+"]"}),3),t=e[0],o=e[1],e=e[2];function s(e){return"instant"===e?0:800}var i,c,l=[],u={},p=0,h={},m=0,g={};function y(n,r,e,a,o){var i=null,s=0,c=r+e;function l(e){var t;1&n[0].compareDocumentPosition(document)&&(c=0),i&&(c-=t=e-i),i=e,0<a&&0<p+m&&n.data("expediteAnim")(a),c<=r&&(s+=t||0,"paused"===n.css("animation-play-state")&&n.css({visibility:"","animation-play-state":"running"})),c<=0?(n.removeData("expediteAnim"),o()):requestAnimationFrame(l)}n.data("expediteAnim",function(e){var t;c-=e=void 0===e?s:e,"running"===n.css("animation-play-state")&&n.css("animation-delay",(("ms"===(t=(t=n.css("animation-delay")).toLowerCase()).slice(-2)?+t.slice(0,-2)||0:"s"===t.slice(-1)&&1e3*+t.slice(0,-1)||0)||0)-e+"ms")}),c?requestAnimationFrame(l):l()}d(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,e=e.type.includes("down"),r=t?u:h,n=t&&b.insensitiveName(t)||n;r[n]&&!e?t?p=Math.max(p-1,0):m=Math.max(m-1,0):!r[n]&&e&&(t?p+=1:m+=1),r[n]=e}).on("mousemove",function(e){var t=e.pageX,e=e.pageY;g.x=t,g.y=e});var v=/-|_/g,b={hash:function(e){for(var t=9,n=e.length;0<n;)--n,t=Math.imul(t^e.charCodeAt(n),Math.pow(9,9));return(t^t>>>9)>>>0},permutations:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r,a,o=t.length,i=[[].concat(t)],s=Array(o).fill(0),c=1;c<o;)s[c]<c?(r=c%2&&s[c],a=t[c],t[c]=t[r],t[r]=a,++s[c],c=1,i.push([].concat(t))):(s[c]=0,++c);return i},nth:function(e){var t=(+e+"").slice(-1);return e+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")},plural:function(e,t,n){return e+" "+(1!==Math.abs(e)?n||t+"s":t)},andList:function(e){return e.length<=1?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:t,anyLowercase:o,anyCasedLetter:e,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(v,"")},allKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return u[e]})},someKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return u[e]})},buttonsDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return h[e]})},anyInputDown:function(){return 0<p+m},mouseCoords:g,parentColours:function(e){for(var t,n={colour:null,backgroundColour:null},r=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent())if(n.backgroundColour||((t=e.css("background-color")).match(r)||(n.backgroundColour=t)),n.colour||((t=e.css("color")).match(r)||(n.colour=t)),n.colour&&n.backgroundColour)return n;return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){if(!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))){if(n.includes(e.tagName.toLowerCase())||/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style")))return!1;a.includes(e.tagName.toLowerCase())||t.push(e)}return!0})&&t.every(function(e){return/inline|none/.test(window.getComputedStyle(e).display)})},transitionOut:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||s(t),!(1<e.length)&&b.childrenProbablyInline(e)&&["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag())||(e=e.wrapAll("<tw-transition-container>").parent()),i&&e.css("transform-origin",i),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":"".concat(n,"ms"),"animation-delay":"".concat(-o,"ms"),"animation-play-state":"paused"}),requestAnimationFrame(function(){b.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),y(e,n,r-o,a,function(){e.remove()}))},transitionIn:function(u,e,t){var p,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==u.length&&(t=t||s(e),(p=1<u.length||!b.childrenProbablyInline(u)||!["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(u.tag()))&&(u=u.wrapAll("<tw-transition-container>").parent()),o&&u.css("transform-origin",o),u.attr("data-t8n",e).addClass("transition-in").css(Object.assign({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-a,"ms")},n-a?{visibility:"hidden","animation-play-state":"paused"}:{})),requestAnimationFrame(function(){b.childrenProbablyInline(u)?u.css("display","inline"):u.parent().is("tw-backdrop,tw-story")||u[0].setAttribute("style",u[0].getAttribute("style")+"display:block !important;width:100%")}),y(u,t,n-a,r,function(){var e=0===u.filter(f.join(",")).length;if(p&&e){u.find("tw-transition-container, .transition-in, .transition-out").each(function(e,t){((t=d(t)).data("expediteAnim")||Object)()});for(var t=[],n=u.find("*"),r=0;r<n.length;r+=1){var a=n[r];0===a.scrollTop&&0===a.scrollLeft||t.push([a,a.scrollLeft,a.scrollTop])}e=u.find(document.activeElement);u.contents().unwrap();for(var o=0,i=t;o<i.length;o++){var s=_slicedToArray(i[o],3),c=s[0],l=s[1],s=s[2];c.scrollLeft=l,c.scrollTop=s}e.length&&e[0].focus()}else u.removeClass("transition-in").removeAttr("data-t8n")}))},debounce:function(e){function t(){300<Date.now()-l||s<=u?(u=n=0,p=!i,o?(e(c),c=[]):e.apply(void 0,_toConsumableArray(c)),p=!1):n=requestAnimationFrame(t)}var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=r.batch,o=void 0!==a&&a,a=r.recur,i=void 0!==a&&a,a=r.maxWait,s=void 0===a?1/0:a,c=[],l=0,u=0,p=!1;return function(){var e;p||(e=Date.now(),u+=e-l,l=e,o?c.push(arguments):c=arguments,n&&cancelAnimationFrame(n),n=requestAnimationFrame(t))}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},onStartup:function(e){l?l.push(e):e()},get storyElement(){return i},detachStoryElement:function(){document.documentElement.contains(i[0])&&(c=i.parent(),i.detach())},reattachStoryElement:function(){document.documentElement.contains(i[0])||(c||d(document.body)).append(i.parents().length?i.parents().last():i)},options:{speedMultiplier:1}};return d(function(){i=d("tw-story"),l.forEach(function(e){return e()}),l=null}),Object.freeze(b)}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,y,v,b,w){var k=e.objectName,T=e.matches,t=e.toSource;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ObjectName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ToSource:function(){return"into"===this.operator?"".concat(t(this.src)," ").concat(this.operator," ").concat(t(this.dest)):"".concat(t(this.dest)," ").concat(this.operator," ").concat(t(this.src))},TwineScript_Unstorable:!0,set:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=[],r=function e(t,n,r){var a=!(2<arguments.length&&void 0!==r)||r,o=[],i=n&&b.isPrototypeOf(n)?n.get():n;if(w.containsError(i))return i;if(Array.isArray(i)&&Array.isArray(t)){for(var s=0,c=0;s<t.length&&c<i.length;){var l=t[s],u=i[c];if(y.isPrototypeOf(l)&&l.datatype.rest||v.isPrototypeOf(l)&&l.rest){for(var p=c;c<i.length&&T(l,u);)u=i[c+=1];y.isPrototypeOf(l)?l.datatype=[l.datatype]:v.isPrototypeOf(l)&&(l=v.create("array")),o=o.concat(e(l,b.isPrototypeOf(n)?b.create(n,{first:p+1,last:c+1}):i.slice(p,c)))}else o=o.concat(e(l,b.isPrototypeOf(n)?b.create(n,c+1):u)),c+=1;s+=1}return s<t.length?a&&w.create("operation","I can't unpack this array because it needs ".concat(t.length-s," more value").concat(0<t.length-s?"s":"",".")):o}if(t instanceof Map&&i instanceof Map){var d,f=_createForOfIteratorHelper(t.entries());try{for(f.s();!(d=f.n()).done;){var h=_slicedToArray(d.value,2),m=h[0],g=h[1];if(!i.has(m))return a&&w.create("operation","I can't unpack this datamap because it needs a '"+m+"' data name.");o=o.concat(e(g,b.isPrototypeOf(n)?b.create(n,m):i.get(m)))}}catch(e){f.e(e)}finally{f.f()}return o}if(y.isPrototypeOf(t)){if("function"==typeof t.datatype.destructure)return[{dest:t,value:i,src:n}].concat(t.datatype.destructure(i));if(!T(i,t.datatype))return a&&w.create("operation","I can't put ".concat(k(i)," into ").concat(t.varRef.TwineScript_ToSource()," because it doesn't match ").concat(t.varRef.TwineScript_ToSource(),"'s datatype, ").concat(k(t.datatype),"."));o=o.concat(e(t.datatype,i))}return b.isPrototypeOf(t)||y.isPrototypeOf(t)?o.concat({dest:t,value:i,src:n}):"function"==typeof t.destructure?o.concat(t.destructure(i)):T(i,t)?o:a&&w.create("operation","I tried to unpack, but "+k(t)+" in the pattern didn't match "+k(i)+".")}(this.dest,this.src);if(e=w.containsError(r))return e;if(!r.length)return w.create("operation","I can't store a new value inside "+k(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var a,o=_createForOfIteratorHelper(r.reverse());try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.dest,c=i.value,l=i.src;if(y.isPrototypeOf(s)){if(e=w.containsError(s.defineType()))return e;s=s.varRef}if(e=s.set(c,this.srcRef),w.isPrototypeOf(e))return e;t&&l&&l.delete(),n.shift(k(s)+" is now "+k(c))}}catch(e){o.e(e)}finally{o.f()}return n.join("; ")},create:function(e,t,n,r){return w.containsError(e)?e:w.containsError(t)?t:Object.assign(Object.create(this),{dest:e,src:t,operator:n,srcRef:r})}})}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var i=e.plural,a=e.impossible,o=t.is,s=t.toSource,c={},l={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(s))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},get TwineScript_ObjectName(){1===this.params.length&&36<(e=s(this.params[0])).length&&(e=void 0);for(var e,t="a (".concat(this.macroName,":").concat(e||"",") changer"),n=this.next,r=(n&&(t+=" combined with "),0);n&&t.length<48;){var a="(".concat(n.macroName,":)");t+=(0<r&&!n.next?" and ":"")+a+(n.next?", ":""),n=n.next,r+=1}for(var o=0;n&&o<99;)n=n.next,o+=1;return 0<o&&(t+="".concat(0<r?" and ":"").concat(i(o,"other changer"))),t},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return Array.isArray(t)||a("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,canEnchant:r})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t},TwineScript_is:function(e){if(l.isPrototypeOf(e))return this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next)},TwineScript_Clone:function(){for(var e=l.create(this.macroName,this.params,this.next),t=e;t.next;)t=t.next=t.next.TwineScript_Clone();return e.canEnchant=this.canEnchant,e},run:function(e,t){var n="output"===this.macroName?[t||this]:this.params,n=c[this.macroName].apply(c,[e].concat(_toConsumableArray(n)));if(r.containsError(n))return n;this.next&&this.next.run(e,t||this)},register:function(e,t){c[e]=t}};return Object.freeze(l)}),define("datatypes/codehook",[],function(){var t=Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_ToSource:function(){return this.source},TwineScript_Print:function(){return this.code},TwineScript_toString:function(){return this.source},TwineScript_is:function(e){return t.isPrototypeOf(e)&&this.source===e.source},TwineScript_Clone:function(){return t.create(this.code,this.source)},create:function(e,t){return Object.assign(Object.create(this),{code:e,source:t})}});return t}),define("datatypes/colour",["jquery"],function(n){var l=Math.max,u=Math.min,a=Math.sin,o=Math.cos,i=Math.pow,p=Math.round,c=Math.floor,s=Math.atan2,d=Math.cbrt,f=Math.sqrt,h=Math.PI,m=Object.assign,t=Object.create,r=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,g=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,y=t(null);function v(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(0<r.length)return v.apply(void 0,[v(e,t)].concat(r));if(!t)return e;for(var o=[],i=0;i<e.length;i++){o[i]=[];for(var s=0;s<t[0].length;s++){for(var c=0,l=0;l<e[0].length;l++)c+=e[i][l]*t[l][s];o[i][s]=c}}return o}function b(e){var t,n=e.r,r=e.g,a=e.b,e=e.a,o=l(n/=255,r/=255,a/=255),i=u(n,r,a),s=(o+i)/2,c=o-i;if(o===i)return{h:0,s:0,l:s};switch(o){case n:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-n)/c+2;break;case a:t=(n-r)/c+4}return{h:t=p(60*t),s:.5<s?c/(2-o-i):c/(o+i),l:s,a:e}}var w=[.9642956764295677,1,.8251046025104602],k=24389/27,T=216/24389,S=function(e){return e.map(function(e){return[e]})},x=function(e){return e.map(function(e){return e[0]})};function _(e){var t=e.l,n=e.c,r=e.h,e=e.a,n=[t*=100,n*o(r*h/180),n*a(r*h/180)],r=[];r[1]=(n[0]+16)/116,r[0]=n[1]/500+r[1],r[2]=r[1]-n[2]/200;n=[i(r[0],3)>T?i(r[0],3):(116*r[0]-16)/k,k*T<t?i((16+t)/116,3):t/k,i(r[2],3)>T?i(r[2],3):(116*r[2]-16)/k].map(function(e,t){return e*w[t]}),t=_slicedToArray(x(v([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],v([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],S(n)))).map(function(e){return u(255,l(0,255*(.0031308<(e=e)?1.055*i(e,1/2.4)-.055:12.92*e)))}),3);return{r:t[0],g:t[1],b:t[2],a:e}}function e(e){function t(e){return 1e-5<=n[e]&&n[e]<=255-1e-5}var n=_(e);if(Object.keys(n).every(t))return n;var r=(e=m({},e)).c,a=0;for(e.c/=2;1e-5<r-a;)n=_(e),Object.keys(n).every(t)?a=e.c:r=e.c,e.c=(r+a)/2;return _(e)}var O=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),e=e.toRGBA();return O.create({r:u(p(.6*(t.r+e.r)),255),g:u(p(.6*(t.g+e.g)),255),b:u(p(.6*(t.b+e.b)),255),a:(t.a+e.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){if(!O.isPrototypeOf(e))return!1;if(e.lcha&&this.lcha)return e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a;var t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},TwineScript_Clone:function(){return O.create(this)},toRGBAString:function(){var e=this.toRGBA(),t=e.r,n=e.g,r=e.b,e=e.a;return"rgba(".concat(t,", ").concat(n,", ").concat(r,", ").concat(e,")")},toHSLA:function(){return b(this.toRGBA())},toRGBA:function(){return this.lch?e(m({a:this.a},this.lch)):this},toLCHA:function(){return this.lch?m({a:this.a},this.lch):(t=(e=this).r,n=e.g,r=e.b,e=e.a,n=[116*(t=x(v([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],v([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],S([t/255,n/255,r/255].map(function(e){return e<.04045?e/12.92:i((e+.055)/1.055,2.4)}))))).map(function(e,t){return e/w[t]}).map(function(e){return T<e?d(e):(k*e+16)/116}))[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])],r=180*s(n[2],n[1])/h,{l:n[0]/100,c:f(i(n[1],2)+i(n[2],2)),h:0<=r?r:360+r,a:e});var e,t,n,r},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,O.create(t)},TwineScript_GetProperty:function(e){if("lch"===e)return t=this.toLCHA(),new Map([["l",t.l],["c",t.c],["h",t.h]]);var t=this.toRGBA();return"h"===e||"s"===e||"l"===e?b(t)[e]:"r"===e||"g"===e||"b"===e||"a"===e?t[e]:void 0},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){if(0===this.a)return"transparent";var e=!this.lch&&b(this);if(1===e.l&&!e.h&&!e.s)return"white";if(0===e.l&&!e.h&&!e.s)return"black";if(.5<=e.l&&e.l<.5334&&0===e.s)return"gray";if(.5===e.l&&.8<=e.s&&e.s<.804){var t={0:"red",30:"orange",60:"yellow",90:"lime",120:"green",180:"cyan",210:"blue",240:"navy",270:"purple",300:"magenta"}[e.h];if(t)return t}return"(".concat(this.lch?"lch":"hsl",":").concat(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l]).concat(1!==this.a?","+this.a:"",")")},create:function(e){return"string"==typeof e?this.create((O.isHexString(e)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(r,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(e){if(e in y)return y[e];var t="transparent"===(t=n("<p>").css("background-color",e).css("background-color"))?{r:0,g:0,b:0,a:0}:t.startsWith("rgb")?t.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192};return y[e]=t})(e)):!("h"in e&&"s"in e&&"l"in e)||"r"in e||"g"in e||"b"in e?("a"in e&&"number"==typeof e.a||(e.a=1),"h"in e&&"c"in e&&!("s"in e)&&"l"in e?m(t(this),{a:e.a,lch:{l:e.l,c:e.c,h:e.h}}):m(t(this),e)):this.create(function(e){var t,n=e.h,r=e.s,a=e.l,e=e.a;if(0===r)return{r:t=c(255*a),g:t,b:t};var o=a<.5?a*(1+r):a+r-a*r,i=2*a-o;function s(e){return e<0&&(e+=1),1<e&&--e,e<1/6?i+6*(o-i)*e:e<.5?o:e<2/3?i+(o-i)*(2/3-e)*6:i}return{r:c(255*s((n/=360)+1/3)),g:c(255*s(n)),b:c(255*s(n-1/3)),a:e}}(e))},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(r)||e.slice(1).match(g))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?%?\s*,\s*\d+(?:\.\d+)?%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return O}),define("datatypes/customcommand",["internaltypes/changedescriptor","internaltypes/twineerror"],function(l,u){var p=Object.assign,d=Object.create;return Object.seal({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},create:function(e){var t,n=e.toSource,r=e.changer,a=e.hook,o=e.variables,i={};for(t in o)i[t]=[o[t]];var s=l.create({source:a,loopVars:i},r);if(u.containsError(s))return s;var c=p(d(this),{TwineScript_Attach:function(e,t){s.section=e;e=t.run(s);return u.containsError(e)?e:c},TwineScript_Run:function(e){s.section=e;e=s;return s=l.create({source:a,loopVars:i},r),e},TwineScript_ToSource:function(){return n},TwineScript_CustomCommand:function(){return e}});return c}})}),define("datatypes/custommacro",["jquery","utils","renderer","utils/operationutils","datatypes/customcommand","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(b,e,w,t,k,T,S,x,_){function n(v){return function(e){v.called+=1;for(var t=v.varNames,n=v.params,r=v.body,a=E(C(S),{TwineScript_VariableStore:{type:"temp",name:v.TwineScript_ObjectName+" call #"+v.called},TwineScript_TypeDefs:C(null)}),o=[],i=0,s=arguments.length,c=new Array(1<s?s-1:0),l=1;l<s;l++)c[l-1]=arguments[l];for(var u=0;u<c.length;u+=1){var p=c[u],d=t[i],f=(a.TwineScript_TypeDefs[d]=n[i].datatype.rest?n[i].datatype.create("array"):n[i].datatype,T.create(a,d));if(x.containsError(f))return f;if(n[i].datatype.rest){var h=(a[d]||[]).concat([p]);if(u<c.length-1){a[d]=h;continue}f.set(h)}else f.set(p),i+=1;o.push(_.create(O(f)+" is now "+O(a[d])))}if(c.length&&(i+=1),null!=(m=n[i])&&m.datatype.rest){var m=T.create(a,t[i]);if(x.containsError(m))return m;m.set([]),a.TwineScript_TypeDefs[name]=n[i].datatype.create("array")}var g,m=b("<p>").append(w.exec(r.code)),y=e.stack.length,r=(e.stack.unshift({tempVariables:a,dom:m,output:function(e){g=e}}),e.evalReplay);for(e.evalReplay=null,e.execute();e.stack.length>y;)e.stack.shift();e.evalReplay=r;r=m.find("tw-error");return r.length?(m.prepend(o.map(function(e){return e.render()}),"<br>"),x.create("propagated","".concat(r.length," error").concat(1<r.length?"s":""," occurred when running ").concat(v.TwineScript_ObjectName,"."),void 0,m)):void 0===g?x.create("custommacro","".concat(v.TwineScript_ObjectName," didn't output any data or hooks using (output:) or (output-data:).")):"object"===_typeof(g)&&"changer"in g?k.create(E(g,{toSource:"(".concat(v.TwineScript_KnownName||"unnamed",":").concat(c.map(A),")")})):g}}var r=e.andList,O=t.objectName,a=t.typeName,o=t.matches,A=t.toSource,E=Object.assign,C=Object.create,i=Object.seal({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",TwineScript_GetProperty:function(e){if("params"===e)return _toConsumableArray(this.params)},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){var e=E(C(i),this);return e.fn=n(e),e},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},createFromFn:function(e,t,n,r){return E(C(i),{params:[],fn:e,typeSignature:r,TwineScript_ObjectName:t,TwineScript_ToSource:n,TwineScript_KnownName:""})},create:function(e,t){t=E(C(i),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(t){var e=t.datatype.toTypeSignatureObject?t.datatype.toTypeSignatureObject({rest:t.rest}):{pattern:"range",range:function(e){return o(t.datatype,e)},name:a(t.datatype)};return t.rest?{pattern:"zero or more",innerType:e}:e}),body:t,TwineScript_KnownName:"",TwineScript_ObjectName:"a custom macro (with ".concat(e.length?r(e.map(A)):"no params",")")});return t.fn=n(t),t}});return i}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","datatypes/codehook","internaltypes/twineerror"],function(e,t,n,r,a,o,i,s,c){var l=e.realWhitespace,u=e.anyRealLetter,p=e.anyCasedLetter,d=e.anyNewline,f=t.objectName,e=Object.assign,t=Object.seal,h=Object.keys,m=Math.floor,g=Math.abs,y={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return y.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!b[t]&&b[t](e,n)},toTypeSignatureObject:function(){var e=this.name,e={pattern:"range",range:b[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=(e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e,Object.create(this));return n.name=e,n.rest=t,n},from:function(t){var e=h(v).find(function(e){return v[e](t)});return e?y.create(e):c.create("datatype",f(t)+" doesn't correspond to a datatype value.")}},v={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return y.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return a.isPrototypeOf(e)},lambda:function(e){return o.isPrototypeOf(e)},macro:function(e){return i.isPrototypeOf(e)},codehook:function(e){return s.isPrototypeOf(e)},command:function(e){return e&&"command"===e.TwineScript_TypeID},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},b=e({},v,{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e)&&!e.length},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+d+"$")},any:function(){return!0},const:function(){return!0}});return t(y)}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var r=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,t){var n=e.colour,e=e.stop;return r.stops[t].stop===e&&r.stops[t].colour.TwineScript_is(n)})},TwineScript_Clone:function(){return n.create(this.angle,_toConsumableArray(this.stops))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(t){return n.create(this.angle,this.stops.map(function(e){return{colour:e.colour,stop:e.stop*t}}))},toLinearGradientString:function(){var r=this;return(this.repeating?"repeating-":"")+"linear-gradient(".concat(this.angle,"deg, ").concat(this.stops.reduce(function(e,t){var n=t.colour,t=t.stop;return e+n.toRGBAString()+" "+t*(r.repeating?1:100)+(r.repeating?"px,":"%,")},"").slice(0,-1),")")}});return n}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(g,s,e,t){var y=e.textNodeToChars,v=e.realWhitespace,c=e.findTextInNodes,r=t.toSource;function l(e){function t(n,e){if(Array.isArray(e))return e.reduce(function(e,t){return e.add(n.get(t))},g());if(e&&"object"===_typeof(e)&&"first"in e&&"last"in e){for(var t=e.first,r=e.last,a=n.length,o=(t<0&&(t+=a),r<0&&(r+=a),[n.get(t)]);t!==r;)t+=Math.sign(r-t),o.push(n.get(t));return g(o)}if("string"==typeof e){if("chars"===e){var i,s=[],c=_createForOfIteratorHelper(n.textNodes(m));try{for(c.s();!(i=c.n()).done;){var l,u=i.value,p=_createForOfIteratorHelper(y(u));try{for(p.s();!(l=p.n()).done;){var d=l.value;d.textContent.match(v)||s.push(d)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){c.e(e)}finally{c.f()}return g(s)}if("links"===e)return n.findAndFilter("tw-link, .enchantment-link");if("visited"===e)return n.findAndFilter("tw-link.visited");var f,h;if("lines"===e)return f=n.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),h=[[]],n.contents().each(function e(t,n){var r=(n.tagName||"").toLowerCase();if("tw-sidebar"!==r)if("tw-passage"===r||"tw-transition-container"===r)g(n).contents().each(e);else{if(f.length){if(n===f[0])return f.shift(),void h.push([]);if(16&n.compareDocumentPosition(f[0]))return h.push([]),g(n).contents().each(e),void h.push([])}h[h.length-1].push(n)}}),g(h.map(function(e){return!!e.length&&g(e).wrapAll("<tw-pseudo-hook>").parent()[0]}).filter(Boolean))}return g(n.get(e))}var n,r,a=e.dom,m=":not(tw-error, tw-error *)",o=g();this.next&&(o=o.add(l.call(this.next,e)));if(this.selector){if("string"===this.selector.type)i=this.selector.data,n=c((n=a).textNodes(),i),r=g(),n.forEach(function(e){r=r.add(g(e).wrapAll("<tw-pseudo-hook>").parent())}),i=r;else{if("base"===this.selector.type)return o.add(t(l.call(this.selector.data,e),this.property));n=this.selector.data,e='tw-hook[name="'+(n=s.insensitiveName(n).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+n+'"]';var e=e+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[n]||"",i=a.findAndFilter(e).add(a.parentsUntil(s.storyElement.parent())).filter(e)}o=this.property?o.add(t(i,this.property)):o.add(i)}return o=o.get().reduce(function(e,t){return t=g(t),e.add(t.is("tw-enchantment")&&t.contents().length<=1?t.contents():t)},g())}function a(e){if(!e)return[];var t=e.selector,n=e.property,e=e.next;return[JSON.stringify(["base"===t.type?a(t.data):s.insensitiveName(t.data),n])].concat(_toConsumableArray(a(e))).sort()}var o=Object.freeze({forEach:function(e,n){var t=l.call(this,e).each(function(e,t){return n(g(t),e)});return e.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),t},hooks:function(e){return l.call(this,e)},get TwineScript_ObjectName(){return"the hook name ".concat(this.TwineScript_ToSource())},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",t=this.selector,n=t.type,t=t.data;return"name"===n?t.match(RegExp("^"+s.anyRealLetter+"+$"))?e+="?"+t:e+="(hooks-named:"+JSON.stringify(t)+")":"string"===n?e+=JSON.stringify(t):"base"===n&&(e+=t.TwineScript_ToSource()+"'s "+r(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return a(this)+""==a(e)+""},TwineScript_GetProperty:function(e){return o.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return o.create(this.selector,this.property,this.next)},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||o),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return o.isPrototypeOf(e)||"string"==typeof e||s.impossible("HookSet.from() was given a non-HookSet non-string."),o.isPrototypeOf(e)?e:o.create({type:"string",data:e})}});return o}),define("datatypes/lambda",["utils","utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,t,m,s,g){e.nth;var y=t.objectName;var c=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("each"in this?"each ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:c,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(c),this)},create:function(e,t,n,r){var a,o="temp variable, or typed temp variable";function i(e){e=e&&e.varRef?e.varRef:e;return void 0===e||e&&s.isPrototypeOf(e)&&m.isPrototypeOf(e.object)&&1===e.propertyChain.length}if(g.containsError(n))return n;if("making"===t&&!i(n))return g.create("syntax","I need a "+o+", to the right of '"+t+"', not "+y(n)+".");if(g.containsError(e))return e;if(c.isPrototypeOf(e)){if("when"===t||"when"in e)return g.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+t+"'.");if(t in e)return g.create("syntax","This lambda has two '"+t+"' clauses.");a=e}else{if("when"===t&&void 0!==e)return g.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!i(e))return g.create("syntax","This lambda needs to start with a single "+o+", not "+y(e)+".");(a=Object.create(this)).loop=e||""}return a.source=r.trim(),a[t]=n,a.making&&a.making.getName()===(a.loop&&a.loop.getName())?g.create("syntax","This lambda has two variables named '"+a.loop.getName()+"'.","Lambdas should have all-unique parameter names."):a},apply:function(e,t){var n=t.loop,r=t.pos,a=t.making,o=t.ignoreVia;function i(e,t){if(e){if("datatype"in e&&"varRef"in e){var n=e.varRef.create(s,e.varRef.propertyChain);if(g.containsError(n))return n;var r=n.defineType(e.datatype);return g.containsError(r)?r:(r=n.set(t),g.containsError(r)?r:void 0)}s[e.getName()]=t}}var s=(s=t.tempVariables)||Object.create(e.stack.length?e.stackTop.tempVariables:m),t=i(this.loop,n)||i(this.making,a);if(g.containsError(t))return t;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:s,lambdaPos:this.when?void 0:r})),!n||this.making||this.when?e.Identifiers.it=g.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName):e.Identifiers.it=n;var c,l,u,p,d,f,t=!o&&this.via,o="where"in this||"when"in this,h=e.evalReplay;return e.evalReplay=h?[]:null,o?(c=e.eval(this.where||this.when),l=e.evalReplay,e.evalReplay=l&&t?[]:null,!n||this.making||this.when||(e.Identifiers.it=n),u=c,f=!t||e.eval(t),p=null,d=(d=g.containsError(u))?d:"boolean"!=typeof u?g.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+y(u)+"."):u?f:p):c=d=!t||e.eval(t),u=t?e.evalReplay:null,e.stack.shift(),(e.evalReplay=h)&&(o||t)&&(((f=h[h.length-1])||{}).lambda&&f.lambda.obj===this||((f={lambda:{obj:this,loops:[]},code:(h[h.length-1]||{}).code||""}).fromCode=f.code,h.push(f)),f.lambda.loops.push(Object.assign({it:n,pos:r},void 0!==a&&{making:a},t&&{viaReplay:u,viaResult:d},o&&{whereReplay:l,whereResult:null!==c&&c}))),d},filter:function(r,e){var a,o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=e.reduce(function(e,t,n){if(a=g.containsError(e))return a;n=o.apply(r,{loop:t,pos:n+1,ignoreVia:!0,tempVariables:i});return(a=g.containsError(n))?a:e.concat(n?[t]:[])},[]);return(a=g.containsError(e))?a:e}});return c}),define("datatypes/typedvar",["utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,a,o){var i=e.typeName,t=e.matches,n=e.toSource,s=e.unstorableValue,e=Object.freeze,c=Object.assign,l=Object.create,u=e({TwineScript_TypeName:"a TypedVar (typed variable name)",get TwineScript_ObjectName(){var e=n(this.datatype);return"the ".concat(e.length<24?e+"-":"","typed variable name, ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return c(l(u),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return n(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return t(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){if(n=o.containsError(t)||o.containsError(e)||t.error)return n;if(!a.isPrototypeOf(t))return o.create("syntax","The -type syntax must have a variable to its right.");var n=t.object,r=t.compiledPropertyChain;if(!n||!n.TwineScript_VariableStore||1!==r.length||!n.TwineScript_TypeDefs)return o.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.");r=s(e);return r&&!u.isPrototypeOf(r)?o.create("syntax","The -type syntax can't have "+i(r)+" to its left."):c(l(this),{datatype:e,varRef:t})}});return u}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(o,e,t,n,r){var a=t.objectName;return n.on("set",function(r,a){r.TwineScript_VariableStore&&e.storyElement.find("[data-2bind]").each(function(e,t){var n=(t=o(t)).data("twoWayBindEvent");"function"==typeof n&&n(t,r,a)})}),Object.freeze({TwineScript_TypeName:"a VarBind (bound variable name)",get TwineScript_ObjectName(){return"a ".concat(this.bind," bind to ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A bound variable name]`"},TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var e=this.varRef.set(e);if(e=r.containsError(e))return e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"one way";return r.containsError(e)?e:n.isPrototypeOf(e)?e.error||Object.assign(Object.create(this),{varRef:e,bind:t}):r.create("operation","I can only 'bind' a variable, not "+a(e)+".")}})}),define("debugmode/highlight",["jquery","utils","utils/typecolours","macros","lexer"],function(u,e,t,p,n){var d=e.insensitiveName,f=t.versionClass,h=n.lex;return function(e,t,n,r){if(9999<e.length)return[u("<span>").text(e)];for(var a=h(e,"",t||"macro"),o=[],i="",s=a,c=a.start;c<a.end;c+=1){var l=a.pathAt(c);l[0]!==s[0]&&(o.length&&(o[o.length-1].textContent=i),i="",s=l,o.push(u("<".concat(r&&n<=c&&c<r?"mark":"span",' class="').concat(function(e){for(var t={},n="",r=0;r<e.length;r+=1){var a=e[r],o=a.type,i=a.text,s=("verbatim"!==o&&"comment"!==o||(n=""),f+o);switch(t[s]=(t[s]||0)+1,1<t[s]&&(s+="-"+t[s]),o){case"text":i.trim()&&e.slice(r+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(s+=" ".concat(f,"error"));break;case"macroName":var c=e[r].text[0];if("_"===c||"$"===c){s+=" ".concat(f,"customMacro ").concat(f+("_"===c?"tempV":"v"),"ariable");break}c=d(e[r].text.slice(0,-1));p.has(c)?s+="-"+p.get(c).returnType.toLowerCase():s+=" ".concat(f,"error")}n+=s+" "}return n}(s),'">'))[0])),i+=a.text[c-a.start]}return o.length&&(o[o.length-1].textContent=i),o}}),define("debugmode/mode",["jquery","utils","utils/naturalsort","state","engine","internaltypes/varref","internaltypes/twineerror","utils/operationutils","utils/renderutils","passages","section","debugmode/panel","debugmode/highlight","utils/typecolours"],function(I,V,M,D,F,L,H,e,t,z,q,W,B,n){var $=e.objectName,U=e.isObject,G=e.toSource,Y=e.typeID,J=t.dialog,X=n.CSS,K=function(e,t){var f=V.escape,i=V.nth,n=V.debounce,r=I(document.documentElement),a=M(),o={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(D.hasStorage)try{var s=localStorage.getItem("(Debug Options "+V.options.ifid+")");s&&(o=JSON.parse(s))}catch(e){}function c(){if(D.hasStorage)try{localStorage.setItem("(Debug Options "+V.options.ifid+")",JSON.stringify(o))}catch(e){}}W.defaultMaxHeight=o.maxHeight;function l(e){return n(function(){if(V.options.debug)return e.apply(this,arguments)},{maxWait:2e3})}var h=I('<tw-debugger class="'.concat([o.darkMode?"theme-dark":"",o.fadePanel?"fade-panel":""].join(" "),'" style="').concat(o.width?"width:"+o.width+"px":"","\">\n<div class='panel panel-errors' hidden><table></table></div>\n<div class='tabs'></div>\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\n<button class='show-invisibles'>\ud83d\udd0d Debug View</button>\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\n<button class='close'>\u2716</button>\n<div class='resizer-h'>\n</tw-debugger>")),s=h.find(".tabs"),u=h.find(".show-dom"),p=h.find(".show-invisibles"),d=h.find(".close"),m=h.find(".turns");I(document.documentElement).on("click","tw-expression, tw-error, tw-eval-explanation",n(function(e){var r,a,o,i,l,u,p,d,t=I(e.target).data("evalReplay");function n(){var e,s,c=r[a],t=o.find("tw-eval-explanation").empty(),n=o.find("tw-eval-code");c.toCode||c.toDesc||c.error||c.lambda?(o.find("tw-eval-code").empty().append(B(c.code,"macro",0<a&&c.start,0<a&&c.end+c.diff)),t.append(c.lambda?"":"<code class='".concat(56<c.fromCode.length?"from-block":"from-inline","'></code>"),c.error?"<span> caused an error: </span>":c.lambda?"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>":"<span> became".concat(c.ToDesc?"\u2026":""," </span>").concat(c.toDesc?"<span class='to-desc'>".concat(f(c.toDesc),".</span>"):"<code class='to-code'></code>")),c.error?t.append(c.error):c.lambda?(s=function(e,t){return I("<".concat(e,"><code></").concat(e,">")).find("code").append(B(t,"macro")).end()},t.find(".to-lambda").append(B(c.lambda.obj.source,"macro")).end().append((e=I("<table>")).append.apply(e,[I("<tr>").append(s("th","pos"),c.lambda.obj.loop?s("th","_"+c.lambda.obj.loop.getName()).append(" / ",I("<code>").append(B("it","macro"))):s("th","it"),c.lambda.obj.making&&s("th","_"+c.lambda.obj.making.getName()),c.lambda.obj.where&&s("th","where").append(" result"),c.lambda.obj.via&&s("th","via").append(" result"))].concat(_toConsumableArray(c.lambda.loops.map(function(e){var t=e.it,n=e.pos,r=e.making,a=e.whereResult,o=e.whereReplay,i=e.viaResult,e=e.viaReplay;return I("<tr>").append(s("td",G(n)),s("td",G(t)),void 0!==r&&s("td",G(r)),null!=a&&(H.containsError(a)?I("<td>").append(a.render(c.lambda.obj.source,!0)):s("td",G(a))).append(o&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",o)),null!=i&&(H.containsError(i)?I("<td>").append(i.render(c.lambda.obj.source,!0)):s("td",G(i))).append(e&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)))})))))):c.toDesc||t.find(".to-code").append(B(c.toCode,"macro")),t.next().html(c.itIdentifier?'(The <code class="cm-harlowe-3-identifier">it</code> identifier now refers to '.concat(f(c.itIdentifier),".)"):"").next().text(c.reason||"")):(n.html(B(c.code,"macro")),t.html("<center>First, there was <code></code>.</center>").next().empty().next().empty()),c.lambda||t.find("code").first().append(B(c.fromCode,"macro")),o.find("mark").each(function(e,t){t.scrollIntoView()}),i.css("visibility",a<=9?"hidden":"visible"),l.css("visibility",a<=0?"hidden":"visible"),p.css("visibility",a>=r.length-1?"hidden":"visible"),d.css("visibility",a>=r.length-10?"hidden":"visible"),u.html("( ".concat(a+1,"/").concat(r.length," )"))}t&&(r=t,t=J({buttons:[{name:"Understood",confirm:!(a=0),callback:function(){return!h.find("tw-backdrop").length&&h.removeClass("show-dialog")}}]}).addClass("eval-replay"),o=I("<tw-eval-replay>".concat(1===r.length?"":"<tw-eval-code></tw-eval-code>","<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>").concat(1===r.length?"":"<tw-dialog-links><tw-link style='visibility:hidden'>\u2190 10</tw-link><tw-link style='visibility:hidden'>\u2190 \u2190</tw-link><b></b><tw-link>\u2192 \u2192</tw-link><tw-link>10 \u2192</tw-link></tw-dialog-links>","</tw-eval-replay>")),t.find("tw-dialog").css({width:"75vw","max-width":"75vw"}).prepend(o),i=o.find("tw-link:first-of-type"),l=i.next(),u=l.next(),p=u.next(),d=p.next(),n(),i.on("click",function(){a=Math.max(0,a-10),n()}),l.on("click",function(){a=Math.max(0,a-1),n()}),p.on("click",function(){a=Math.min(r.length-1,a+1),n()}),d.on("click",function(){a=Math.min(r.length-1,a+10),n()}),h.find("tw-backdrop").length?h.find("tw-backdrop").before(t):h.addClass("show-dialog").append(t));var s,t=I(e.target).data("goto");t&&(s=V.options.ignoreGotos,V.options.ignoreGotos=!1,t.command.TwineScript_Run(t.section),V.options.ignoreGotos=s),e.stopPropagation()})),h.find(".resizer-h").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=h.width();r.on("mousemove.debugger-resizer-h",function(e){e=e.pageX;h.width("".concat(n+t-e|0,"px"))}).on("mouseup.debugger-resizer-h",function(){r.off(".debugger-resizer-h"),o.width=h.width(),c()})}),h.on("mousedown",".resizer-v",function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageY,n=I(e.target.parentNode).height();r.on("mousemove.debugger-resizer-v",function(e){e=e.pageY;h.find(".panel").css("maxHeight","".concat(n+t-(0|e),"px"))}).on("mouseup.debugger-resizer-v",function(){r.off(".debugger-resizer-v"),o.maxHeight=h.find(".panel").css("maxHeight"),c()})}),p.click(function(){r.toggleClass("debug-mode").removeClass("dom-debug-mode"),p.toggleClass("enabled"),u.removeClass("enabled")}),u.click(function(){r.toggleClass("dom-debug-mode").removeClass("debug-mode"),u.toggleClass("enabled"),p.removeClass("enabled")}),d.click(function(){r.removeClass("debug-mode dom-debug-mode"),h.detach(),Object.assign(V.options,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})});function g(e){(e=e.parents(".variable-row, .enchantment-row, .source-row")).next(".panel-row-source").find("td").empty().append(B(e.data("value")||G(e.data("enchantment").changer),e.is("source-row")?"markup":"macro"))}function y(){return k=new Set}function v(){I(document.body).append(h),V.options.debug=!0,V.options.evalReplay=o.evalReplay,V.options.speedMultiplier=1,V.options.ignoreClickEvents=!1,V.options.ignoreGotos=!1,R()}var b,w=l(function(){var r=m.children().get(),e=D.timeline,a=0;e.forEach(function(e,t){var n=e.turns,e=e.passage,n=(a+=1+(void 0===n?0:n))+": "+e;r[t]?r[t].textContent=n:m.append("<option value='".concat(t,"'>").concat(n,"</option>"))}),e.length<r.length&&I(r.slice(e.length)).remove(),m[1<=e.length?"removeAttr":"attr"]("disabled"),m.val(D.pastLength)}),k=(m.change(function(e){e=e.target.value-D.pastLength;0!=e&&(D[e<0?"rewind":"fastForward"](Math.abs(e)),F.showPassage(D.passage))}),w(),D.on("forward",w).on("load",w).on("forgetUndos",function(){return w}).on("back",function(){D.pastLength<=1&&m.attr("disabled"),m.find("[selected]").removeAttr("selected"),m.val(D.pastLength)}),new Set),T=W.create({className:"variables",tabName:"Variable",rowWrite:function(e,t){var n=e.name,r=e.dataset,a=e.path,o=e.value,i=e.tempScope,e=e.type,s=o&&48<o.length&&!o.TwineScript_DebugName,c=U(o)&&o.TwineScript_DebugName?o.TwineScript_DebugName():f($(o)),l="",r=(a.length&&(l=a.reduce(function(e,t){return e+t+"'s "},"")),r&&(n="???"),e?G(e):""),e="object"===_typeof(o)||s;return t?(t.find(".variable-type").html(r||""),l&&t.find(".variable-path").html((i?"_":"$")+f(l)),t.find(".variable-name").contents().last().replaceWith(I.parseHTML((l?"":i?"_":"$")+f(n+""))),t.find(".temporary-variable-scope").html(i||""),t.find(".variable-value").html(c),t.find("tw-folddown")[e?"show":"hide"](),(s=t.next(".panel-row-source")).is(":visible")&&s.find("td").empty().append(B(G(o))),t.data("value",G(o)),t.add(s)):I('<div class="variable-row">').attr("data-name",n).attr("data-path",a+"").attr("data-scope",i||"").css("padding-left",Math.min(5,a.length)+"em").append("<td class='variable-type'>".concat(r||"","</td>"),"<td class='variable-name cm-harlowe-3-"+(i?"tempV":"v")+"ariable'><span class='variable-path'>"+(l?(i?"_":"$")+f(l):"")+"</span> "+(l?"":i?"_":"$")+f(n+"")+"</td>","<td class='temporary-variable-scope'>".concat(i||"","</td>"),"<td class='variable-value cm-harlowe-3-macroName-"+Y(o)+"'>"+c+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(e?"visible":"none")+"'>(source:) </tw-folddown></td>").data("value",G(o)).find("tw-folddown").data("folddown",g).end().add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>")},rowCheck:function(e,t){var n=e.name,r=e.path,e=e.tempScope;return t.attr("data-name")===n&&t.attr("data-path")===r+""&&t.attr("data-scope")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="variable-type">Type</th><th data-col="variable-name">Name</th><th data-col="temporary-variable-scope">Scope</th><th data-col="variable-value">Value</th></tr>'},rowSort:function(e,t,n){if("variable-value"===e)return a(t.attr("class"),n.attr("class"))||a(t.parent().data("value"),n.parent().data("value"))}}),S=l(function(){var e,t,o=[],n=D.variables,r=o.length;for(e in n)e.startsWith("TwineScript")||(r+=1,function n(e){var r,t,a;500<o.length||(o.push(e),r=e.path.concat(e.name),t=e.value,a=e.tempScope,r.length<=4&&(Array.isArray(t)?t.forEach(function(e,t){return n({name:i(t+1),path:r,value:e,tempScope:a})}):t instanceof Map?_toConsumableArray(t).forEach(function(e){var t=(e=_slicedToArray(e,2))[0],e=e[1];return n({name:t,path:r,value:e,tempScope:a})}):t instanceof Set&&_toConsumableArray(t).forEach(function(e,t){return n({name:t,dataset:!0,path:r,value:e,tempScope:a})})))}({name:e,path:[],value:n[e],tempScope:"",type:null==(t=n.TwineScript_TypeDefs)?void 0:t[e]}));o.push.apply(o,_toConsumableArray(k)),r+=k.size,T.update(o,r),T.panel.toggleClass("panel-variables-empty",r)}),x=(L.on("set",function(e,t,n){var r,a;e===D.variables||"temp"!==(null==(a=e.TwineScript_VariableStore)?void 0:a.type)||null!=(a=e.TwineScript_VariableStore)&&a.name.match(/#\d+$/)||(r=null==(a=e.TwineScript_VariableStore)?void 0:a.name,e=null==(a=e.TwineScript_TypeDefs)?void 0:a[t],(a=_toConsumableArray(k).find(function(e){return e.name===t&&e.tempScope===r}))?a.value=n:k.add({name:t,path:[],value:n,tempScope:r,type:e})),S(),b()}).on("delete",function(){S(),b()}),T.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),T.tab.addClass("enabled"),T.panel.find(".clipboard")),_=(r.on("click",".panel-variables-copy",function(){var e,t=[];for(e in D.variables)e.startsWith("TwineScript")||t.push("$"+e+" to "+G(D.variables[e]));x.val("(set:"+t+")")[0].select(),document.execCommand("copy")}),W.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(e,t){var n=e.scope,r=e.changer,a=e.lambda,o=e.name,i=e.localHook,a=r?f($(r)):a?f(G(a)):"<em>enchanted with ("+o+":)</em>";return t||I('<div class="enchantment-row">').data("enchantment",e).append("<td><span class='enchantment-name'>"+G(n)+(i?"</span><span class='enchantment-local cm-harlowe-3-hookName'>"+("function"==typeof i.TwineScript_ToSource?i.TwineScript_ToSource():i.attr("name")?"?"+i.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value cm-harlowe-3-macroName-"+(r?"changer":"command")+" '>"+a+"</td>"+(r?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).find("tw-folddown").data("folddown",g).end().add(r?I("<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>"):"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="enchantment-name">Scope</th><th data-col="enchantment-value">Value</th></div>'}})),d=l(function(e){_.update(e.enchantments,e.enchantments.length)}),O=(q.on("add",d).on("remove",d),q.create()),A=W.create({className:"storylets",tabName:"Storylet",rowWrite:function(e,t){var n=e.name,r=e.active,a=e.storyletSource,o=e.exclusive,e=e.urgent;if(t)return t.toggleClass("storylet-closed",!r),t.find(".storylet-open").text(r?"\u2713":""),t;t=I('<tr class="storylet-row '.concat(r?"":"storylet-closed",'">')).attr("data-name",n).append("<td class='storylet-open'>"+(r?"\u2713":"")+"</td><td class='storylet-name'>"+n+"</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>"+o+"</td><td class='storylet-urgent'>"+e+"</td>");return t.find(".storylet-lambda").append(B(a.replace(/^when\s+/i,""))),t},rowCheck:function(e,t){e=e.name;return t.attr("data-name")===f(e+"")},columnHead:function(){return'<tr class="panel-head"><th data-col="storylet-open" data-order="desc">Open</th><th data-col="storylet-name">Name</th><th data-col="storylet-lambda">Condition</th><th data-col="storylet-exclusive" class=\'storylet-exclusive\'>Exclusivity</th><th data-col="storylet-urgent" class=\'storylet-urgent\'>Urgency</th></tr>'}}),E=(A.tab.hide(),b=l(function(){var r,a,o=z.getStorylets(O),i=H.containsError(o),e=z.allStorylets();A.update(e.map(function(t){var e="number"==typeof t.get("exclusivity")?t.get("exclusivity"):0,n="number"==typeof t.get("urgency")?t.get("urgency"):0;return r=r||e,a=a||e,{name:t.get("name"),storyletSource:t.get("storylet").TwineScript_ToSource(),active:!i&&o.some(function(e){return e.get("name")===t.get("name")}),exclusive:e,urgent:n}}),i?0:o.length),A.panel.toggleClass("storylet-error",i),A.panel.toggleClass("panel-exclusive",r),A.panel.toggleClass("panel-urgent",a),e.length&&A.tab.show()}),W.create({className:"source",tabName:"Source",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.tag;if(t)return t.add(t.next(".panel-row-source"));t=z.get(n).get("source");return I('<div class="source-row" data-tag="'.concat(e,'">')).data("value",t).append('<td class="source-name">'.concat(n,'</td><td class="source-tags">').concat(e,"</td><td class='panel-row-buttons'><tw-folddown class='").concat(e?"":"open","' tabindex=0></tw-folddown></td>")).find("tw-folddown").data("folddown",g).end().add(I("<tr class='panel-row-source' style='".concat(e?"display:none":"","'><td colspan='3'></td></tr>")).find("td").append(!e&&B(t,"markup")).end())},rowCheck:function(e,t){e=e.name;return t.find(".source-name").text()===f(e+"")},tabUpdate:I.noop,columnHead:I.noop})),C=["debug-startup","startup","header","debug-header","footer","debug-footer"].reduce(function(e,t){return e.concat(z.getTagged(t).map(function(e){return{name:e.get("name"),tag:t}}))},[]),N=W.create({className:"errors",tabName:"Error",rowWrite:I.noop,rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return N.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text("".concat(e," Error").concat(1!==e?"s":""))}}),d=n(function(e){var t;V.options.debug&&(N.panelRows.append(e.reduce(function(e,t){var t=_slicedToArray(t,2),n=t[0],t=t[1];return"propagated"===n.type?e:e+'<tr class="error-row"><td class="error-passage">'+D.passage+'</td><td class="error-message" title="'+f(t)+'">'+n.message+"</td></tr>"},"")),500<(t=(e=N.panelRows.children()).length)&&I(Array.prototype.slice.call(N.panelRows[0].childNodes,0,t-500)).remove(),N.tabUpdate(Math.min(500,e.length)))},{batch:!0}),P=(H.on(d),N.panel.append("<div class='panel-errors-bottom'>\n\t\t\t<button class='panel-errors-clean'>\ud83e\uddf9 Clear this panel</button>\n\t\t</div>"),r.on("click",".panel-errors-clean",function(){N.panelRows.empty(),N.tabUpdate(0)}),W.create({className:"tools",tabName:"Tools",tabNameCounter:!1,rowWrite:function(e,t){var n=e.id,r=e.type,a=e.label,o=e.dropdownItems,i=e.dropdownValue;return"checkbox"===r?t?t.find("input").prop("checked",!1):I('<span><input id="debug-'.concat(n,'" type="checkbox"></input><label for="debug-').concat(n,'">').concat(a,"</label></span>")):"dropdown"===r?t?t.find("input").prop("checked",!1):I("<span>".concat(a,'<select style="width:3em" data-default="').concat(i,'" id="debug-').concat(n,'"></span>')).find("select").append(o.map(function(e){return"<option value='".concat(e,"' ").concat(e===i?"selected":"",">").concat(e,"x</option>")})).end():void 0},rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return P.tab.css({background:e?"hsla(210, 72%, 65%, .3)":""})}})),j=(r.on("click, change",'.panel-tools [type="checkbox"], .panel-tools select',function(e){var e=e.target,t=(e=I(e)).attr("id"),n=e.is(":checked")||e.is("select")&&e.val()!==+e.attr("data-default");"debug-peekBehindDialogs"===t&&r.toggleClass("debug-dialogs",n),"debug-ignoreClickEvents"===t&&(V.options.ignoreClickEvents=n),"debug-ignoreGotos"===t&&(V.options.ignoreGotos=n),"debug-speedMultiplier"===t&&(V.options.speedMultiplier=+e.val()),P.tabUpdate(n)}),P.update([{id:"peekBehindDialogs",type:"checkbox",label:"See through and click through <code>(dialog:)</code> boxes"},{id:"ignoreClickEvents",type:"checkbox",label:"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating"},{id:"ignoreGotos",type:"checkbox",label:"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>"},{id:"speedMultiplier",label:"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): ",type:"dropdown",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]),W.create({className:"options",tabName:"\u2699\ufe0f",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.label,r={darkMode:o.darkMode,fadePanel:o.fadePanel,evalReplay:o.evalReplay}[n];return t?t.find("input").prop("checked",r):I('<span><input id="debug-'.concat(n,'" type="checkbox" ').concat(r?"checked":"",'></input><label for="debug-').concat(n,'">').concat(e,"</label></span>"))},rowCheck:I.noop,tabUpdate:I.noop,columnHead:I.noop})),R=(r.on("click",'.panel-options [type="checkbox"]',function(e){var e=e.target,t=(e=I(e)).attr("id"),e=e.is(":checked");"debug-darkMode"===t&&(o.darkMode=e,h.toggleClass("theme-dark",e)),"debug-fadePanel"===t&&(o.fadePanel=e,h.toggleClass("fade-panel",e)),"debug-evalReplay"===t&&(V.options.evalReplay=o.evalReplay=e),c()}),j.update([{name:"darkMode",label:"Debug panel is dark"},{name:"fadePanel",label:"Debug panel is transparent unless the cursor is over it"},{name:"evalReplay",label:"Record expression replays (viewable via \ud83d\udd0d buttons in Debug View; slower)"}]),h.prepend(T.panel,_.panel,N.panel,A.panel,E.panel,P.panel,j.panel),s.prepend(T.tab,_.tab,N.tab,A.tab,E.tab,P.tab,j.tab),D.on("beforeForward",y).on("beforeBack",y).on("beforeLoad",y),l(function(){S(),b(),_.panelRows.empty(),_.tabUpdate(0),D.passage&&z.get(D.passage)&&(E.update(C.concat({name:D.passage,tag:""})),E.panel.find('[data-tag=""], [data-tag=""] + .panel-row-source').insertBefore(E.panel.find('[data-tag="footer"]').first()))}));D.on("forward",R).on("back",R).on("load",R);K=v,I(document.head).append(I("<style>").html(X)),v(),e&&d(e,t)};return F.registerDebugMode(function(e,t){return!V.options.debug&&K(e,t)}),K}),define("debugmode/panel",["jquery","utils/naturalsort"],function(d,e){var i=e();return Object.seal({create:function(e){var n,t=e.className,r=e.rowWrite,a=e.rowCheck,o=e.rowSort,i=e.columnHead,s=e.tabName,c=e.tabNameCounter,l=void 0===c||c,c=e.tabUpdate,u=d("<div class='panel panel-".concat(t,"' style='").concat(this.defaultMaxHeight?"max-height:"+this.defaultMaxHeight+"px":"","' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>")),p=d("<button class='tab tab-".concat(t,"'>").concat(l?"0 ".concat(s,"s"):s,"</button>"));return p.click(function(){p.toggleClass("enabled"),p.parent().siblings(".panel").attr("hidden",""),p.is(".enabled")&&(p.siblings(".tab:not(.tab-"+t+")").removeClass("enabled"),u.removeAttr("hidden"))}),u.on("click","th",function(e){var e=e.target,t="desc"===(e=d(e)).attr("data-order")?"asc":"desc";n.sort(e.attr("data-col"),t),u.find("th[data-order]").removeAttr("data-order"),e.attr("data-order",t)}),c=c||function(e){return p.text(l?"".concat(e," ").concat(s).concat(1!==e?"s":""):s)},n=Object.assign(Object.create(this),{tabName:s,tab:p,panel:u,panelRows:u.find(".panel-rows"),rowWrite:r,rowSort:o,rowCheck:a,columnHead:i,tabUpdate:c})},sort:function(r,a){var o=this;this.panelRows.children(":not(.panel-head, .panel-row-source)").get().sort(function(e,t){var n;return"desc"===a&&(e=(n=[t,e])[0],t=n[1]),e=e.querySelector("."+r),t=t.querySelector("."+r),o.rowSort&&o.rowSort(r,d(e),d(t))||i(e.textContent,t.textContent)}).forEach(function(e){var t=d(e).next(".panel-row-source").get();o.panelRows.append(e,t)})},update:function(e,t){var r=this.rowCheck,a=this.rowWrite,o=this.panelRows,n=this.columnHead,i=this.panel,s=[],c=o.children(),e=(e.forEach(function(n){var e=c.filter(function(e,t){return r(n,d(t))}),t=a(n,e.length&&e);e.length||o.append(t),s.push.apply(s,_toConsumableArray(t.get()))}),c.filter(function(e,t){return!s.includes(t)&&!t.className.includes("panel-head")}).remove(),this.tabUpdate(t),0<t&&!o.find(".panel-head").length?o.prepend(n()):0===t&&o.find(".panel-head").remove(),i.find("th[data-order]"));e.length&&this.sort(e.attr("data-col"),e.attr("data-order"))},defaultMaxHeight:300})}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset","internaltypes/twineerror"],function(v,e,t,b,n){function w(e){return("string"==typeof e?e:e.map(function(e){return e.text}).join("")).split(/\n/g).reduce(function(e,t,n,r){r=r.length;return e.concat(document.createTextNode(t),n!==r-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])}var k=e.impossible,T=e.transitionIn,S=t.exec,x=Object.assign,p=Object.keys,r=Object.create,e=Object.seal,_=Array.isArray,O={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,output:!1,summary:function(){var t=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers","output"].filter(function(e){return hasOwnProperty.call(t,e)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",p(this.loopVars).length&&"loopVars",p(this.data).length&&"data"].filter(Boolean))},create:function(e,t){e=x(r(this),{attr:this.attr?this.attr.slice():[],styles:this.styles?this.styles.slice():[],loopVars:this.loopVars||{},data:this.data||{}},e);if(t){t=t.run(e);if(n.containsError(t))return t}return e},update:function(){function e(t){var e,n,r;_(a.styles)&&0<a.styles.length&&(n=(e=_slicedToArray(a.styles.reduce(function(n,r){return p(r).forEach(function(e){var t=r[e];n[+("function"==typeof t)].push(_defineProperty({},e,t))}),n},[[],[]]),2))[0],r=e[1],n.forEach(function(e){return t.css(e)}),setTimeout(function(){r.forEach(function(e){return t.css(e)})})),a.attr&&a.attr.forEach(function(e){return t.attr(e)}),a.data&&t.data(a.data)}var a=this,t=this.section,n=this.newTargets,r=this.transition,o=this.transitionDeferred,i=this.append,s=this.target;"function"==typeof s&&(s=s());if(_(n)&&n.length&&(s=n.map(function(e){return e.target})),_(s))for(var c=0;c<s.length;c+=1)b.isPrototypeOf(s[c])?s[c].forEach(t,e):e(s[c]);else b.isPrototypeOf(s)?s.forEach(t,e):e(s);if(r&&!o&&!i){for(var l,u=s;(l=u.data("timestamp"))||(u=u.parent()),!l&&u.length;);T(s,r,this.transitionTime,this.transitionDelay,this.transitionSkip,l?Date.now()-l:0,this.transitionOrigin)}},render:function(){var e,r=this,t=this.source,n=this.transition,a=this.transitionTime,o=this.transitionDeferred,i=this.enabled,s=this.enablers,c=this.data,l=this.section,u=this.newTargets,p=this.innerEnchantments,d=this.appendSource,f=this.output,h=this.target,m=this.target,g=this.append;if("function"==typeof h&&(h=h()),!g)return k("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),v();if(f)return v();if(null!=s&&s.length)return s=(f=s[0]).descriptor,f=f.changer,s=s.render(),f&&(e=O.create({section:l,target:s}),f.run(e),e.update()),s;if(!i||void 0!==h.attr("hidden"))return O.create({target:h,attr:this.attr.filter(function(e){return!("style"in e)}),data:x({},c,{originalSource:t,hidden:!0})}).update(),v();if(!(h=_(u)&&u.length?u:h))return k("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),v();var y=v();if([].concat(h).filter(function(e){return!e.jquery}).map(function(e){var t,n,r=g;return e.target&&e.append&&(r=(t=e).append,n=t.before,e=e.target),{elements:e.hooks(l,m).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(m[0]))}),append:r}},[]).forEach(function(e){var t=e.elements,n=e.append;t.each(function(e,t){t=v(t),y=y.add(r.create({target:t,append:n,newTargets:null}).render()),t.filter("tw-pseudo-hook").contents().unwrap()})}),!(y.length||_(h)||b.isPrototypeOf(h))){f=g;if(!(f in h)){if("replace"!==f)return k("ChangeDescriptor.render","The target doesn't have a '"+f+"' method."),v();f=h[0]instanceof Text?"replaceWith":(h.empty(),"append")}h[0]instanceof Text&&"prepend"===(f="append"===f?"after":f)&&(f="before"),y=v(t&&(this.verbatim?w:S)(t)),_(d)&&d.forEach(function(e){var t=e.source,e=e.append,t=v((r.verbatim?w:S)(t));y="append"===e?y.add(t):"prepend"===e?t.add(y):t}),h[f](y.length?y:void 0),h.data("timestamp",Date.now()),this.update(),n&&!o&&T("replace"===g?h:y,n,a,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),p&&p.map(function(e){return e(h)}).forEach(function(e){return l.addEnchantment(e)})}return y}};return e(O)}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(g,y,v,b,e,w,t){var k=e.objectName,T=e.toSource,S=t.collapse;return Object.freeze({create:function(e){return Object.assign(Object.create(this),{enchantments:g()},e)},enchantScope:function(){var i=this,s=this.attr,c=this.data,l=this.functions,u=this.section,p=this.scope,d=this.localHook,f=this.lambda,h=[],m=0;p.forEach(u,function(e,t){if(d){d=d.jquery?d:d.hooks(u);var n=e.find(d);if(n.length)e=n;else if(!d.has(e[0]).length)return}var r,a,o;(!e.is(":empty")||e.data("source")&&e.data("source").length)&&(m+=1,f?(o=f.apply(u,{loop:p.TwineScript_GetProperty(t),pos:m}),w.containsError(o)?(e.replaceWith(o.render()),f=o=null):b.isPrototypeOf(o)?o.canEnchant||(e.replaceWith(w.create("macrocall",'The lambda "'.concat(T(f),"\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")).render()),f=o=null):(e.replaceWith(w.create("macrocall",'The lambda "'.concat(T(f),'" must return a changer, not ').concat(k(o),".")).render()),f=o=null)):o=i.changer,n=!s&&!c&&(!o||o.summary().every(function(e){return e.startsWith("transition")})),r=n?e:e.wrap("<tw-enchantment>").parent(),s&&r.attr(s),c&&r.data(c),l&&l.forEach(function(e){return e(r)}),o&&(t=v.create({section:u,target:r}),o.run(t),t.update(),e.is(y.storyElement)?(a=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(t.styles)))),e.css(a.reduce(function(e,t){return"background-color"===t||"background-image"===t?(e["background-color"]="transparent",e["background-image"]="none",a.push("background-".concat("background-color"===t?"image":"color"))):e[t]="inherit",e},{})),r.data({enchantedProperties:a})):e.is("tw-passage")&&t.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})&&(o="padding-right",y.storyElement.css(t="padding-left","0px").css(o,"0px"),r.data({enchantedProperties:[t,o]}))),e.is(y.storyElement)&&r.css({"min-width":"100%","min-height":"100%"}),"true"===r.attr("collapsing")&&(r.find("[collapsing=false]").each(function(){g(this).removeAttr("collapsing")}),S(r)),n||h.push(r))}),this.enchantments=g(h)},disenchant:function(){this.enchantments.each(function(e,t){(t=g(t)).contents().unwrap();t=t.data("enchantedProperties");t&&y.storyElement.css(t.reduce(function(e,t){return e[t]="",e},{}))})}})}),define("internaltypes/twineerror",["jquery","utils"],function(i,s){var a=s.impossible,c=s.escape,l=(i(document.documentElement).on("click","tw-folddown",function(e){var t=e.target,e=((t=i(t)).toggleClass("open"),t.popData("folddown"));for("function"==typeof e&&e(t);t&&!t.next().length;)t=t.parent();null!=(e=t)&&e.next().toggle()}),{syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true.",debugonly:"This macro is not meant to be used outside of debugging your story."}),u=[],n={TwineError:!0,create:function(e,t,n,r){return t&&"string"==typeof t||a("TwineError.create","has a bad message string"),n||e in l||a("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})},containsError:function(){for(var e=0;e<arguments.length;e+=1){var t=arguments[e];if(n.isPrototypeOf(t))return t;if(Array.isArray(t)){t=n.containsError.apply(n,t);if(t)return t}}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=(t="string"==typeof t?t:this.source||"",i("<tw-error class='"+(this.warning?"warning":"error")+"' title='"+c(t)+"'>"+c(this.message+(this.appendTitleText?" "+t:""))+"</tw-error>")),a=i("<tw-error-explanation>").text(this.explanation||l[this.type]).hide(),o=i("<tw-folddown tabindex=0>");return this.innerDOM&&i("<tw-open-button label='Open'>").on("click",function(){var e=i("<tw-backdrop><tw-dialog></tw-backdrop>");e.find("tw-dialog").prepend(n.innerDOM,i("<tw-link tabindex=0>OK</tw-link>").on("click",function(){n.innerDOM.detach(),e.remove()}).wrap("<tw-dialog-links>").parent()),s.storyElement.prepend(e)}).appendTo(r),r.append(o).append(a),r.data("TwineError",this),e||u.forEach(function(e){return e(n,t)}),r},on:function(e){return"function"!=typeof e||u.includes(e)||u.push(e),n}};return Object.preventExtensions(n)}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return Object.preventExtensions(r)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(u,p,e,t,i){var c,n=e.impossible,s=e.andList,r=e.nth,o=t.is,d=t.isObject,f=t.toSource,h=t.isSequential,m=t.objectName,l=t.typeName,g=t.clone,y=t.isValidDatamapName,v=t.subset,b=t.collectionType,w=t.unstorableValue,a=t.matches,k=Array.isArray,T={set:[],delete:[]},S="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), ",x="You can't access the '0th' or '0thlast' position of ";function _(e,t){if(p.containsError(t))return n;if(e instanceof Map&&(n=p.containsError(y(e,t))))return n;if(h(e))if("number"==typeof t){if(0===t)return p.create("property","You can't access elements at position 0 of ".concat(m(e),"."),"Only positive and negative position values exist.");0<t&&--t}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)last$/i.exec(t))){if("0"===r[1])return p.create("property",x+m(e)+".");t=-r[1]}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)$/i.exec(t))){if("0"===r[1])return p.create("property",x+m(e)+".");t=r[1]-1}else if("string"==typeof t&&(r=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){var n=_slicedToArray(r,5),r=n[1],r=void 0===r?0:r,a=n[2],o=n[3],o=void 0===o?0:o;t={last:o=n[4]?-o:o-1,first:r=a?-r:r-1}}else if("last"===t)t=-1;else if("random"===t){if(!e.length)return p.create("property","I can't get a random value from ".concat(m(e),", because it's empty."));t=u.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(t))return p.create("property","".concat(S+s(i.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if(!["length","some","any","all","start","end","random"].includes(t)&&!i.isPrototypeOf(e))return p.create("property","".concat(S,"'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."))}else if(e instanceof Set){if(!["length","some","any","all"].includes(t))return p.create("property","".concat(S,"'length', 'some', 'any', and 'all' of ").concat(m(e),"."),"You can't access specific individual data values from datasets.");"length"===t&&(t="size")}else{if(k(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(t))return p.create("property","You can only get the ".concat(s(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if("number"==typeof e||"boolean"==typeof e)return p.create("property","You can't get any data values, let alone ".concat(m(t),", from ").concat(m(e)))}return t}function O(e,t){return+t<0&&Math.abs(t)<=e.length?e.length+ +t:t}var A=/[^\x0000-\xFFFF]/,E=new Map;function C(e,t){if(void 0===e)return e;if(e instanceof Map)return e.get(t);if(("some"===t||"any"===t||"all"===t||"start"===t||"end"===t)&&!e.TwineScript_VariableStore)return n=e,r=t,a='"'.concat(r," value").concat("any"===r?"":"s",'" of '),{determiner:r,determined:n,array:_toConsumableArray(n),string:"string"==typeof n&&n,TwineScript_ObjectName:a+m(n),TwineScript_ToSource:function(){return"".concat(r," of ").concat(f(n))},TwineScript_TypeName:a+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}};var n,r,a;if("string"==typeof e&&(E.has(e)?e=E.get(e):A.test(e)?(a=_toConsumableArray(e),E.set(e,a),e=a):E.set(e,e)),h(e)&&Number.isFinite(t)&&(t=O(e,t)),e.TwineScript_GetProperty)return e.TwineScript_GetProperty(t);e=e[t];return"function"!=typeof e?e:void 0}function N(e){var t;return e.computed?(t=e.value,"string"==typeof(t=c.isPrototypeOf(t)?t.get():t)?"('"+t+"')":"("+t+")"):"number"==typeof e?r(e):"'"+e+"'"}function P(t,e,n){if(t.TwineScript_VariableStore){if(t.TwineScript_TypeDefs&&e in t.TwineScript_TypeDefs){var r=t.TwineScript_TypeDefs[e];if("const"===r.name){if(void 0!==t[e])return p.create("operation","I can't alter ".concat(t===u.variables?"$":"_").concat(e," because it's been restricted to a constant value."),"This variable can't be changed for the rest of the story.")}else if(!a(r,n))return p.create("operation","I can't set ".concat(t===u.variables?"$":"_").concat(e," to ").concat(l(n)," because it's been restricted to ").concat(f(r),"-type data."),"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return k(e)?e.map(function(e){return P(t,e)}):t instanceof Map?"string"==typeof e||p.create("operation","".concat(m(t)," can only have string data names, not ").concat(m(e),".")):h(t)?["length","random","some","any","all","start","end"].includes(e)?p.create("operation","I can't forcibly alter the '"+e+"' of "+m(t)+".","start"===e||"end"===e?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+e+"'.":void 0):+e==(0|e)||p.create("property",m(t)+" can only have position keys ('3rd', '1st', (5), etc.), not "+N(e)+"."):t.TwineScript_Identifiers&&e in t?p.create("keyword","I can't alter the value of the '"+e+"' identifier.","You can only alter data in variables, not fixed identifiers."):p.create("operation","I can't modify "+m(t),t instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":i.isPrototypeOf(t)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function j(t,e,n,r){var a=e;t instanceof Map?t.set(e,n):(h(t)&&(e=O(t,e)),t.TwineScript_Set?t.TwineScript_Set(e,n,r):t[e]=n),T.set.forEach(function(e){return e(t,a,n)})}function R(t,e){var n=e;h(t)&&(e=O(t,e)),k(t)&&/^(?:[1-9]\d*|0)$/.exec(e)?t.splice(e,1):t instanceof Map||t instanceof Set?t.delete(e):t.TwineScript_Delete?t.TwineScript_Delete(e):delete t[e],T.delete.forEach(function(e){return e(t,n)})}function I(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(e&&"object"===_typeof(e)&&"last"in e&&"first"in e){if(i.isPrototypeOf(t))return t.TwineScript_GetProperty(e);var a=e.first,o=e.last;return v(t,a+(0<=a),o+(0<=o))}if(k(e))return i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):e.map(function(e){return I(t,e,e)})["string"==typeof t?"join":"valueOf"]("");a=C(t,e);if(void 0!==a||r)return a;if(t===u.variables)return 0;if("temp"===(null==(o=t.TwineScript_VariableStore)?void 0:o.type))return p.create("property","There isn't a temp variable named _".concat(n," in this place."),"Temp variables only exist inside the same passage, hook, or lambda in which they're created.");if(k(t)&&"number"==typeof e)return p.create("property","This array of ".concat(t.length," elements doesn't have a ").concat(N(n+("number"==typeof n?1:""))," element."),t.length?"It contains: ".concat(s(t.map(m)),"."):"The array is empty.");r=Array.from("function"==typeof t.keys&&t.keys());return p.create("property","I can't find a ".concat(N(n)," data name in ").concat(m(t)),t instanceof Map&&r.length?"Its names include: ".concat(s(r),"."):void 0)}function V(e,t){var r=this,e=this.compiledPropertyChain.reduce(function(e,t){var n=0===e.length?r.object:I.apply(void 0,_toConsumableArray(e[e.length-1]));return e.push([n,t])&&e},[]).reduceRight(e,t);return p.containsError(e)?e:void 0}return c=Object.freeze({get:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=I(e,this.compiledPropertyChain[t]),p.containsError(e))return e;return I(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(void 0===(e=I(e,this.compiledPropertyChain[t],void 0,!0))||p.containsError(e))return!1;return void 0!==I(e,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set:function(e,c){var l=this;return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?V.call(this,function(n,e,t){var e=_slicedToArray(e,2),r=e[0],a=e[1];if(e=p.containsError(n,r,a)||p.containsError(P(r,a,n)))return e;if(e=w(n))return p.create("operation","".concat(m(n)," can't be stored").concat(!n.TwineScript_Unstorable&&b(n)?" because it holds ".concat(m(e)):"","."));if(0<t)r=g(r);else if("temp"===(null==(e=r.TwineScript_VariableStore)?void 0:e.type)&&r!==u.variables){for(var o=r;"temp"===(null==(i=o.TwineScript_VariableStore)?void 0:i.type)&&!hasOwnProperty.call(o,a);)var i,o=Object.getPrototypeOf(o);"temp"===(null==(t=o.TwineScript_VariableStore)?void 0:t.type)&&(r=o)}if("string"==typeof r){if("string"!=typeof n)return p.create("datatype","I can't put this non-string value, ".concat(m(n),", in a string."));if(n.length!==(k(a)?a.length:1))return p.create("datatype","".concat(m(n),"is not the right length to fit into this string location."));var r=_toConsumableArray(r),s=_toConsumableArray(n);[].concat(a).forEach(function(e){0+e<0&&(e=r.length+(0+e)),r=[].concat(_toConsumableArray(r.slice(0,e)),[s.shift()],_toConsumableArray(r.slice(e+1)))}),r=r.join("")}else d(r)&&(void 0!==n.TwineScript_KnownName&&((n=""!==n.TwineScript_KnownName?g(n):n).TwineScript_KnownName=f(l)),k(a)&&h(n)?("string"==typeof n&&(n=_toConsumableArray(n)),a.map(function(e,t){return[e,n[t]]}).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return j(r,t,e,c)})):j(r,a,n,c));return r},e):p.create("macrocall","I can't (set:) ".concat(m(this),", if the ").concat((m(this.object).match(/ (.+$)/)||["","value"])[1]," isn't stored in a variable."),"Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return V.call(this,function(e,t,n){var r,t=_slicedToArray(t,2),a=t[0],t=t[1];return(r=p.containsError(e,a,t)||p.containsError(P(a,t)))?r:(0<n&&(a=g(a)),null===e?((r="string"==typeof a)&&(a=_toConsumableArray(a)),k(t)?(h(a)&&(t=_toConsumableArray(new Set(t))).sort(function(e,t){return O(a,t)-O(a,e)}),t.forEach(function(e){return R(a,e)})):R(a,t),r&&(a=a.join(""))):j(a,t,e,!1),a)},null)},defineType:function(e){var t=this.object,n=this.compiledPropertyChain[0],r=(hasOwnProperty.call(t,"TwineScript_TypeDefs")||(t.TwineScript_TypeDefs=Object.create(t.TwineScript_TypeDefs||null)),t.TwineScript_TypeDefs),a=r[n];if(a&&!o(a,e))return p.create("operation","I can't redefine the type of "+m(this)+" to "+(e.TwineScript_ObjectName||l(e))+", as it is already "+(a.TwineScript_ObjectName||l(a))+".");t.TwineScript_DefineType?t.TwineScript_DefineType(n,e):r[n]=e,"const"===e.name&&(t[n]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,t){var n;if(n=p.containsError(e))return n;Array.isArray(t)||(t=[].concat(t)),c.isPrototypeOf(e)&&(t=e.propertyChain.concat(t),e=e.object);var r=function(e,t){for(var n,r=[],a=0;a<t.length;a+=1){var o=t[a];if(o.computed&&(o=o.value),c.isPrototypeOf(o)&&(o=o.get()),k(o)){for(var i=[],s=0;s<o.length;s+=1)i[s]=_(e,o[s]);o=i}else o=_(e,o);if(n=p.containsError(o))return n;a<t.length-1&&(e=I(e,o)),r.push(o)}return r}(e,t);return(n=p.containsError(r))?n:Object.assign(Object.create(c),{object:e,propertyChain:t,compiledPropertyChain:r})},TwineScript_ToSource:function(){function r(e,t){return!t&&n.object.TwineScript_VariableStore?e:N(e)}var e,n=this;return(this.object===u.variables?"$":"temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?r(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+r(t,n)}))},get TwineScript_ObjectName(){var e;return this.object.TwineScript_VariableStore?"the ".concat("temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"temp ":"","variable ").concat(this.TwineScript_ToSource()):m(this.object)+"'s "+(1===this.propertyChain.length?N(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+N(t)}))},on:function(e,t){if(e in T)return"function"!=typeof t||T[e].includes(t)||T[e].push(t),c;n("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:{type:"temp",name:"an unknown scope"},TwineScript_TypeDefs:Object.create(null)})}),define("macrolib/commands",["jquery","macros","utils","state","passages","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(u,n,y,c,l,a,v,M,e,o,t,p,d,i,s,b,r,f){var h=r.printBuiltinValue,m=r.objectName,g=r.clone,w=r.toSource,k=f.dialog,T=f.geomParse,D=f.geomStringRegExp,r=n.TypeSignature,f=r.Any,F=r.Everything,S=r.rest,x=r.either,_=r.optional,O=r.zeroOrMore,L=r.percent,H=r.nonNegativeInteger,A=r.positiveInteger,r=r.positiveNumber,E=Object.assign,C=Math.floor,N=Math.ceil,P=Math.abs,z=Math.max,q=Math.min,j=u.noop;function R(e){return"(".concat(e," ").concat(y.options.ifid,") ")}["set","put","unpack"].forEach(function(r){return n.add(r,"Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"===n.operator&&"set"===r)return v.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===n.operator&&"set"!==r)return v.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((i.isPrototypeOf(n.dest)||s.isPrototypeOf(n.dest))===("unpack"===r))return v.create("macrocall","unpack"===r?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the (".concat(r,":) macro with just single variables and typed variables to the ").concat("set"===r?"left of 'to'.":"right of 'into'."),"You may wish to change this to the (".concat("unpack"!==r?"unpack":"to"===n.operator?"set":"put",":) macro."));n=n.set();if(v.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (".concat(r,":) operation"),TwineScript_ObjectName:"a (".concat(r,":) operation"),TwineScript_Unstorable:!0,TwineScript_Print:function(){return y.options.debug,""}}},[S(e)])}),n.add("move","Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return v.create("macrocall","Please say 'into' when using the (move:) macro.");n=n.set(!0);if(v.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return y.options.debug,""}}},[S(e)]),n.addCommand("display",function(e){if(!l.hasValid(e))return v.create("macrocall","I can't (display:) the passage '".concat(e,"' because it doesn't exist."))},function(e,t,n){return e.source=l.getTree(n),e},[String])("print",j,function(e,t,n){return E(e,{source:h(n)})},[f])(["verbatim-print","v6m-print"],j,function(e,t,n){return E(e,{verbatim:!0,source:h(n)})},[f])(["verbatim-source","v6m-source"],function(e){if("command"===(null==e?void 0:e.TwineScript_TypeID)&&!e.TwineScript_ToSource)return v.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return E(e,{verbatim:!0,source:h(w(n))})},[f])("go-to",function(e){if(!l.hasValid(e))return v.create("macrocall","I can't (go-to:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!y.options.ignoreGotos)return requestAnimationFrame(function(){return a.goToPassage(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("redirect",function(e){if(!l.hasValid(e))return v.create("macrocall","I can't (redirect:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!y.options.ignoreGotos)return requestAnimationFrame(function(){return a.redirect(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",j,function(e,t,n){return c.pastLength<1?E(e,{source:n}):y.options.ignoreGotos?void 0:(requestAnimationFrame(function(){return a.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[_(String)])("debug",j,a.enableDebugMode,[],!1),y.onStartup(function(){return y.storyElement.on("click.icon","tw-icon",function(e){var t=u(this),n=t.data("clickEvent"),r=t.attr("alt");n&&n(t),"Undo"===r&&(e.stopPropagation(),a.goBack()),"Redo"===r&&(e.stopPropagation(),a.goForward()),"Fullscreen"===r&&(e.stopPropagation(),a.toggleFullscreen()),"Restart"===r&&(c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return 0<c.pastLength}],["Redo","&#8631;",function(){return 0<c.futureLength}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var e=_slicedToArray(e,3),o=e[0],i=e[1],s=e[2];n.addCommand("icon-".concat(o.toLowerCase()),function(e,t){if("string"==typeof e&&"string"==typeof t)return e=_toConsumableArray(e).length,t=_toConsumableArray(t).length,1<e&&1<t?v.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 1 character long, for its icon.")):1===e&&1===t?v.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 2 or more characters long, for its label.")):void 0},function(t,e,n,r){var a;return("string"==typeof r&&1===_toConsumableArray(r).length||"string"==typeof n&&1<_toConsumableArray(n).length)&&(n=(a=[r,n])[0],r=a[1]),"Undo"===o&&(t.data.forgetUndosEvent=function(e){t.section.whenUnblocked(function(){return u(e).css("visibility","hidden")})}),E(t,{source:'<tw-icon tabindex=0 alt="'.concat(o,'" ').concat(r?'data-label="'.concat(r.replace('"',"&quot;"),'"'):"",' title="').concat(o,'" ').concat(s()?"":'style="visibility:hidden"',">").concat(n||i,"</tw-icon>")})},[_(String),_(String)])}),n.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:v.create("datatype","The 2nd "+r):v.create("datatype","The 1st "+r)},function(r,e,a,o,i){r.attr.push({"data-2bind":!0}),r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&r.target.children("tw-icon").text((0<t?C:N)(t)).attr("data-label",1!==P(t)&&void 0!==i?i:o)};var t=a.varRef.get();return"number"!=typeof t?v.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):E(r,{source:'<tw-icon data-label="'.concat(y.escape(1!==P(t)&&void 0!==i?i:o),'">').concat((0<t?C:N)(t),"</tw-icon>")})},[b,String,_(String)]),n.addCommand("meter",function(e,t,n,r){return"two way"===e.bind?v.create("datatype","(meter:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".'):"string"!=typeof r||r.trim()?-1===n.search(D)||!n.includes("=")&&1<n.length?v.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:v.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(r,e,a,n,t,o,i){o&&"string"!=typeof o&&(i=o,o=void 0),i=i||p.create({h:0,s:0,l:.5,a:.5}),p.isPrototypeOf(i)&&(i=d.create(90,[{colour:i,stop:0},{colour:i,stop:1}]));function s(e){var t=z(0,q(1,e/n)),e=i.repeating?i:i.multiply(n/e);return"height:100%;background-repeat:no-repeat;background-image:".concat((l?E(e,e.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+E(e,e.repeating?{}:{angle:l||0===c?90:270}).toLinearGradientString(),";background-size:").concat(l?Array(2).fill(50*t+"%"):100*t+"%",";background-position-x:").concat(l?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===c?"left":"right",";text-align:").concat(l?"center":0===c?"left":"right")}var t=T(t),c=t.marginLeft,t=t.size,l=0<c&&Math.ceil(c+t)<100,u=(r.styles.push({"margin-left":c+"%",width:t+"%",height:"1.5em",display:"block"}),r.attr.push({"data-2bind":!0}),o&&e.stackTop.tempVariables),t=(r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&((n=r.target.children("tw-meter")).attr("style",s(t)),o&&r.section.renderInto("",null,{source:o,target:n,append:"replace",transitionDeferred:!1},u))},a.varRef.get());return"number"!=typeof t?v.create("datatype","(meter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):E(r,{source:'<tw-meter style="'.concat(s(t),'">').concat(o||"","</tw-meter>")})},[b,r,String,_(x(String,p,d)),_(x(p,d))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(t,u){return n.addCommand(t,function(){return""===(arguments.length<=0?void 0:arguments[0])?v.create("datatype","The first string in a ("+t[0]+":) can't be empty."):arguments.length<=(b.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?v.create("datatype","I need two or more strings to "+(u?"sequence":"cycle")+" through, not just '"+((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e])+"'."):void 0;var e},function(a,e){for(var o,t=arguments.length,i=new Array(2<t?t-2:0),n=2;n<t;n++)i[n-2]=arguments[n];b.isPrototypeOf(i[0])&&(o=i.shift());var s=0,c=("two way"===(null==(l=o)?void 0:l.bind)&&(a.attr.push({"data-2bind":!0}),-1<(l=i.indexOf(o.varRef.get()))&&(s=l)),e.stackTop.tempVariables);function r(e,t){var n=s>=i.length-1&&u,r=""===i[s]?"":n?i[s]:"<tw-link>".concat(i[s],"</tw-link>");if(n&&(a.data.clickEvent=void 0),o&&!t){n=o.set(i[s]);if(v.containsError(n))return void e.replaceWith(n.render(i[s]))}t=E({},a,{source:r,transitionDeferred:!1});a.section.renderInto("",null,t,c)}i[s]&&(a.data.clickEvent=function(e){s=(s+1)%i.length,r(e,!1)})&&(a.data.twoWayBindEvent=function(e,t,n){o.varRef.matches(t,n)&&(t=o.varRef.get(),-1<(n=i.indexOf(t))&&n!==s&&(s=n,r(e,!0)))});var l="<tw-link>".concat(i[s],"</tw-link>");if(o){e=o.set(i[s]);if(v.containsError(e))return e}return E(a,{source:l,append:"replace",transitionDeferred:!0})},[x(b,String),S(String)])}),y.onStartup(function(){return y.storyElement.on("change.dropdown-macro","select",function(){var e=u(this),t=e.closest("tw-expression, tw-hook").data("dropdownEvent");t&&t(e)})}),n.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===((t=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=t?void 0:arguments[t])?v.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?v.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(e,t,r){for(var n=arguments.length,a=new Array(3<n?n-3:0),o=3;o<n;o++)a[o-3]=arguments[o];var i=0,s=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),-1<(c=a.indexOf(r.varRef.get()))&&(i=c)),Math.max.apply(Math,_toConsumableArray(a.map(function(e){return _toConsumableArray(e).length})))),c="<select>"+a.map(function(e,t){return"<option".concat(t===i?" selected":"").concat(""===e?" disabled":"",">").concat(y.escape(e||"\u2500".repeat(s)),"</option>")}).join("\n")+"</select>",l=(e.data.dropdownEvent=function(e){var t=e.val(),n=r.set(t);v.containsError(n)&&e.replaceWith(n.render(t))},e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&(t=r.varRef.get(),-1<(n=a.indexOf(t))&&n!==i&&(e.find("select").val(t),i=n))},e.styles.push({"background-color":function(){return y.parentColours(u(this)).backgroundColour}}),r.set(a[i]));return v.containsError(l)?l:E(e,{source:c,append:"replace"})},[b,String,S(String)]),y.onStartup(function(){return y.storyElement.on("input.checkbox-macro","input[type=checkbox]",function(){var e=u(this),t=e.closest("tw-expression").data("checkboxEvent");t&&t(e)})});function I(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]}var V=1;n.addCommand("checkbox",function(){},function(e,t,r,n){var a=!1,o="checkbox-"+ ++V,i=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),"boolean"==typeof(i=r.varRef.get())&&(a=i),e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&"boolean"==typeof(t=r.varRef.get())&&e.children("input[type=checkbox]").prop("checked",t)}),e.data.checkboxEvent=function(e){var t=e.is(":checked"),t=r.set(t);v.containsError(t)&&e.replaceWith(t.render(""))},r.set(a));return v.containsError(i)?i:E(e,{source:'<input id="'.concat(o,'" type="checkbox" ').concat(a?"checked":"",'><label for="').concat(o,'">').concat(n,"</label>"),append:"replace"})},[b,String]),y.onStartup(function(){return u(document).on("fullscreenchange",function(){u("input[type=checkbox][id^=fullscreen]",y.storyElement).each(function(e,t){(u(t).closest("tw-expression").data("fullscreenEvent")||Object)(t)})})}),n.addCommand("checkbox-fullscreen",function(){},function(e,t,n){var r="fullscreenCheckbox-"+ ++V;return e.data.fullscreenEvent=function(e){return u(e).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},e.data.checkboxEvent=function(){return a.toggleFullscreen()},E(e,{source:'<input id="'.concat(r,'" type="checkbox" ').concat(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ").concat(document.fullscreenElement||document.msFullscreenElement?"checked":"",'><label for="').concat(r,'">').concat(n,"</label>"),append:"replace"})},[String]),y.onStartup(function(){return y.storyElement.on("input.input-box-macro","textarea, input[type=text]",function(){var e=u(this),t=e.closest("tw-expression").data("inputBoxEvent");t&&t(e)})}),["input","force-input","input-box","force-input-box"].forEach(function(g){return n.addCommand(g,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=g.endsWith("box"),a=b.isPrototypeOf(t[0]),o="string"==typeof t[+a],r=r&&"number"==typeof t[o+a],i=o?t[+a]:t[a+r],s=0<T(i).size,o=s?t[a+r+o]:i;return g.startsWith("force")&&"string"!=typeof o?v.create("datatype","The (".concat(g,":) macro requires a string of text to forcibly input.")):t.length>a+r+s+("string"==typeof o)?v.create("datatype","An incorrect combination of values was given to this (".concat(g,":) macro.")):void 0},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o=g.startsWith("force"),i=g.endsWith("box"),s=b.isPrototypeOf(r[0]),c="string"==typeof r[+s],l=i&&"number"==typeof r[c+s],u=s&&r[0],p=l?r[1+s]:3,d=c?T(r[+s]):{},f=d.marginLeft,d=d.size,h=(d?r[s+l+c]:c&&r[+s])||"",l=o?"":h,c=!1;if("two way"===u.bind){e.attr.push({"data-2bind":!0});s=u.varRef.get();if("string"==typeof s){l=o?h.slice(0,s.length):s,s=u.set(l),c=!0;if(v.containsError(s))return s}e.data.twoWayBindEvent=function(e,t,n){u.varRef.matches(t,n)&&"string"==typeof(t=u.varRef.get())&&e.find(i?"textarea":"input").val(o?h.slice(0,t.length):t)}}if(u&&!c){s=u.set(o?"":h);if(v.containsError(s))return s}!o&&u&&(e.data.inputBoxEvent=function(e){var t=e.val(),t=u.set(t);v.containsError(t)&&e.replaceWith(t.render(""))});var m,c="<".concat(i?"textarea":"input type=text",' style="width:100%" ').concat(i?"rows=".concat(p,">"):'value="').concat(y.escape(l)).concat(i?"</textarea>":'">');return o&&(m=Array.from(h),e.data.inputBoxEvent=function(e){var t=e.val().length,t=m.slice(0,t).join("");return e.val(t),u&&(t=u.set(t),v.containsError(t)&&e.replaceWith(t.render(""))),!0}),e.styles.push({display:"block","margin-left":d?f+"%":void 0,width:d?d+"%":"100%","border-style":function(){return this.style.borderStyle||"solid"}}),E(e,{source:c,append:"replace"})},g.endsWith("box")?[x(b,String),_(x(A,String)),_(x(A,String)),_(String)]:[_(x(b,String)),_(String),_(String)])}),["show","rerun"].forEach(function(s){return n.addCommand(s,function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=v.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(o,i){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return t.forEach(function(e){return e.forEach(i,function(e){var t,n,r,a=e.data("hidden");void 0!==a!=("rerun"===s)&&(e.removeData("hidden"),a instanceof u?e.empty().append(a):(a=e.data("tempVariables"),n=(t="tw-passage"===e.tag())?l.getTree(c.passage):e.data("originalSource")||"",t&&(r=e.find("tw-sidebar").detach()),i.renderInto("",null,E({},o,{append:"replace",source:n,target:e}),a&&Object.create(a)),r&&e.prepend(r)))})}),o},[S(o)])});n.addCommand("hide",function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=v.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,o=n;a<o.length;a++)o[a].forEach(e,function(e){Boolean(e.data("hidden"))||e.data("hidden",e.contents().detach())})},[S(o)],!1)("scroll",j,function(h,e,m){var g="number"==typeof m&&m;requestAnimationFrame(function(){e.forEach(h,function(e){if(!1!==g){var t,n;null!=(t=(n=(e=e[0]===y.storyElement[0]&&e[0].scrollHeight===e[0].clientHeight?[document.body]:e)[0]).scrollTo)&&t.call(n,0,(e[0].scrollHeight-e[0].clientHeight)*g)}else{var r,a=_createForOfIteratorHelper(m.hooks(h).get());try{for(a.s();!(r=a.n()).done;){var o=r.value;if(e.find(o)){for(var i=[],s=e[0];(s=s.parentNode)&&s!==document.body;)i.push([s,s.scrollLeft,s.scrollTop]);o.scrollIntoView();for(var c=0,l=i;c<l.length;c++){var u=_slicedToArray(l[c],3),p=u[0],d=u[1],f=u[2];p.scrollLeft=d,p.scrollTop=f}break}}}catch(e){a.e(e)}finally{a.f()}}})})},[o,x(L,o)],!1)("stop",j,j,[],!1)("load-game",j,function(e,t){if(e.loadedGame)return v.create("infinite","I can't use (load-game:) immediately after loading a game.");var n,r=localStorage.getItem(R("Saved Game")+t);return r?(r=c.deserialise(e,r))instanceof Error?{blocked:n=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+r.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===n.find("input").last().val()&&localStorage.removeItem(R("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]})}:void requestAnimationFrame(a.showPassage.bind(a,c.passage,{loadedGame:!0})):v.create("saving","I can't find a save slot named '"+t+"'!")},[String],!1)("forget-undos",j,function(e,t){c.futureLength||c.forgetUndos(t)},[parseInt],!1)("forget-visits",j,function(e,t){c.forgetVisits(t)},[parseInt],!1)("mock-visits",function(){if(!y.options.debug)return v.create("debugonly","(mock-visits:) cannot be used outside of debug mode.");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return!l.hasValid(e)});return r?v.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c.mockVisits=g(n)},[S(String)],!1)("mock-turns",function(){if(!y.options.debug)return v.create("debugonly","(mock-turns:) cannot be used outside of debug mode.")},function(e,t){c.mockTurns=t},[H],!1)("seed",j,function(e,t){c.setSeed(t)},[String],!1)(["dialog","alert"],function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(b.isPrototypeOf(e)){if("two way"===e.bind)return v.create("datatype","(dialog:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".');if(void 0===t)return v.create("datatype","(dialog:) needs a message string or codehook to display.")}else void 0!==t&&r.unshift(t);e=r.findIndex(function(e){return""===e});if(-1<e)return v.create("datatype","(dialog:)'s ".concat(y.nth(e+1)," link text shouldn't be an empty string."))},function(e,n,r,t){for(var a=arguments.length,o=new Array(4<a?a-4:0),i=4;i<a;i++)o[i-4]=arguments[i];return b.isPrototypeOf(r)||(void 0!==t&&o.unshift(t),t=r,r=void 0),o.length||(o=["OK"]),{blocked:k({section:n,message:t,cd:e,buttons:o.map(function(t){return{name:t,callback:function(){var e;n.unblock((null==(e=r)?void 0:e.set(t))||"")}}})})}},[x(b,String,t),_(x(t,String)),O(String)])("open-url",j,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],j,function(){if(!y.options.ignoreGotos){if(c.turns<=1)return v.create("infinite","I mustn't (restart:) the story in the starting passage.");c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()}},[],!1)("goto-url",j,function(e,t){window.location.assign(t)},[String],!1)("ignore",j,j,[O(F)])("assert-exists",function(e){if(""===e)return v.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?o.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:v.create("assertion","I didn't see any ".concat("string"==typeof n?"text occurrences of":"hooks matching"," ").concat(w(n)," in this passage."))},[x(o,String)]),n.add("assert","Instant",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:E(v.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game","Boolean",function(e,t,n){if(n=n||"",!c.hasStorage)return!1;var r=c.serialise(!1).pastAndPresent;if(v.containsError(r))return r;if(!1===r)return!1;try{return localStorage.setItem(R("Saved Game")+t,r),localStorage.setItem(R("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,_(String)])("prompt","String",function(e,t,n,r,a){var o;if(null!=(o=e.stackTop)&&o.evaluateOnly)return v.create.apply(v,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly))));if(""===a)return v.create("datatype","The text for (prompt:)'s confirm link can't be blank.");var i=k({section:e,message:t,defaultValue:n,buttons:[{name:a||"OK",confirm:!0,callback:function(){return e.unblock(i.find("input").last().val())}}].concat(""===r?[]:{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}})});return e.stackTop.blocked=i,0},[x(String,t),String,_(String),_(String)])("confirm","Boolean",function(e,t,n,r){if(null!=(a=e.stackTop)&&a.evaluateOnly)return v.create.apply(v,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly))));if(""===r)return v.create("datatype","The text for (confirm:)'s confirm link can't be blank.");var a=k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}})});return e.stackTop.blocked=a,0},[x(String,t),_(String),_(String)])("page-url","String",function(){return window.location.href},[])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(c,l,u,e,t,p,n,d,f){function s(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return f.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")}var h=e.objectName,m=e.toSource,e=l.add,r=l.addChanger,a=l.addCommand,o=l.TypeSignature,i=o.rest,g=o.either,y=o.Any,v=o.Everything,o=o.zeroOrMore;e("macro","CustomMacro",function(e){for(var t,n=[],r=arguments.length,a=new Array(1<r?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(t=0;t<a.length;t+=1){var i=t===a.length-1;if(d.isPrototypeOf(a[t])===i)return f.create("datatype","The "+(i?"":c.nth(a.length-t+1)+"-")+"last value given to (macro:) should be a "+(i?"code hook":"datatyped variable")+", not "+h(a[t]));if(!i){i="A custom macro";if(a[t].varRef.object===u.variables)return f.create("datatype",i+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(1<a[t].varRef.propertyChain.length)return f.create("datatype",i+"'s typed variables can't be properties inside a data structure.");if(a[t].datatype.rest&&t!==a.length-2)return f.create("datatype",i+" can only have one spread variable, and it must be its last variable.");var s=a[t].varRef.propertyChain[0];if(n.includes(s))return f.create("datatype",i+"'s typed variables can't both be named '"+s+"'.");n.push(s)}}return p.create(a.slice(0,-1),a[a.length-1])},[i(g(d,n))]);a(["output-data","out-data"],function(){},function(e,t){e=e.stack;return s("output-data",e,t)||{blocked:!0}},[y],!1),r(["output","out"],function(){return Object.assign(t.create("output",[]))},function(e,t){if(e.section){var n,r=e.section,a=r.stack,o=r.stackTop,i={};for(n in o.tempVariables)n.startsWith("TwineScript_")||(i[n]=o.tempVariables[n]);s("output",a,{changer:t,variables:i,hook:Array.isArray(e.source)?"["+e.source.map(function(e){return e.text}).join("")+"]":e.source}),e.output=!0,o.blocked=!0}},[]),a("error",function(e){if(!e)return f.create("datatype","This (error:) macro was given an empty string.")},function(e,t){e=e.stack;return s("error",e,f.create("user",t))||{blocked:!0}},[String],!1),e("partial","CustomMacro",function(e,a){for(var t=arguments.length,o=new Array(2<t?t-2:0),n=2;n<t;n++)o[n-2]=arguments[n];var r="string"!=typeof a&&a,i=!r&&a;if(!r){if(!l.has(i))return f.create("macrocall",'The macro name given to (partial:), "'.concat(a,"\", isn't the name of a built-in macro."));if("Metadata"===l.get(i).returnType)return f.create("macrocall","(partial:) can't be used with metadata macros such as (".concat(a,":)"))}var s="(partial:".concat(m(a),",").concat(o.map(function(e){return m(e)}),")"),c=p.createFromFn(function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=l["string"==typeof a?"run":"runCustom"](a,e,o.concat(n));return f.containsError(e)&&(e.message="An error occurred while running the (partial:)-created macro, ".concat(c.TwineScript_ObjectName,":\n")+e.message),e},"a (partial:) custom macro of ".concat(i||r.TwineScript_KnownName?"(".concat(i||r.TwineScript_KnownName,":").concat(o.map(function(e){return m(e)}),")"):"another unnamed custom macro"),function(){return s},(i?l.get(i):r).typeSignature.filter(function(e,t){return t>=o.length||"rest"===e.pattern||"zero or more"===e.pattern}));return c},[g(String,p),o(v)])}),define("macrolib/datastructures",["utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/typedvar","internaltypes/twineerror"],function(e,i,t,n,s,r,a,c,o,l){var u=e.permutations,p=e.options,d=n.objectName,f=n.subset,h=n.collectionType,m=n.isValidDatamapName,g=n.is,y=n.unique,v=n.clone,b=n.range,e=t.TypeSignature,n=e.optional,w=e.rest,k=e.either,T=e.zeroOrMore,S=e.Any,e=e.nonNegativeInteger,x=i("en");t.add(["a","array"],"Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},T(k(o,S)))("range","Array",function(e,t,n){return b(t,n)},[parseInt,parseInt])("subarray","Array",function(e,t,n,r){return f(t,n,r)},[Array,parseInt,parseInt])("reversed","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(v)},T(S))("shuffled","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.shuffled.apply(s,n).map(v)},[T(S)])("sorted","Array",function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(!c.isPrototypeOf(r[0]))return(t=r.filter(function(e){return"string"!=typeof e&&"number"!=typeof e}))&&t.length?1===t.length&&Array.isArray(t[0])?l.create("macrocall","Please give multiple numbers or strings to (sorted:), not a single array.","You can use the spread ... syntax to spread out the array's values into (sorted:)."):l.create("datatype","If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ".concat(d(t[0]),".")):r.sort(x);var o=r.shift();if("making"in o||"where"in o||"when"in o||!("via"in o))return l.create("datatype","The optional lambda given to (sorted:) must be a 'via' lambda, not ".concat(d(o),"."));for(var i=0;i<r.length;i+=1){var s=o.apply(e,{loop:r[i],pos:i+1});if(l.containsError(s))return s;if("string"!=typeof s&&"number"!=typeof s)return l.create("datatype",'The "via" lambda given to (sorted:) couldn\'t convert '.concat(d(r[i])," into a string or number."));r[i]=[r[i],s]}return r.sort(function(e,t){return x(e[1],t[1])}).map(function(e){return e[0]})},[T(S)])("rotated","Array",function(e,t){if(0===t)return l.create("macrocall","I can't rotate these values by 0 positions.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=-1*(t=Math.abs(t)%r.length*Math.sign(t));return r.slice(t).concat(r.slice(0,t)).map(v)},[parseInt,T(S)])("rotated-to","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);if(l.containsError(t))return t;if(!t.length)return l.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.");e=r.indexOf(t[0]);return r.slice(e).concat(r.slice(0,e)).map(v)},[c.TypeSignature("where"),w(S)])("repeated","Array",function(e,t){for(var n=[],r=arguments.length,a=new Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(!a.length)return n;for(;0<t--;)n.push.apply(n,a);return n.map(v)},[e,w(S)])("interlaced","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),o=[],i=0;i<a;i+=1)for(var s=0;s<n.length;s+=1)o.push(v(n[s][i]));return o},[Array,w(Array)])("permutations","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?u.apply(void 0,n):[]},[T(S)])("unique","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.filter(y)},[T(S)])("altered","Array",function(n,r){for(var e=arguments.length,t=new Array(2<e?e-2:0),a=2;a<e;a++)t[a-2]=arguments[a];return t.map(function(e,t){t=r.apply(n,{loop:e,pos:t+1});return null===t?e:t})},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),T(S)])("find","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.filter(e,r)},[c.TypeSignature("where"),T(S)])(["all-pass","pass"],"Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||t.length===r.length},[c.TypeSignature("where"),T(S)])("some-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0<t.length},[c.TypeSignature("where"),T(S)])("none-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0===t.length},[c.TypeSignature("where"),T(S)])("folded","Any",function(r,a){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return"where"in a&&(t=a.filter(r,t)),l.containsError(t)||t.reduce(function(e,t,n){return a.apply(r,{making:e,loop:t,pos:n+1})})},[k(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),w(S)])(["dm-names","datamap-names","datanames"],"Array",function(e,t){return Array.from(t.keys()).sort(i("en"))},[Map])(["dm-values","datamap-values","datavalues"],"Array",function(e,t){return Array.from(t.entries()).sort(i("en",function(e){return String(e[0])})).map(function(e){return v(e[1])})},[Map])(["dm-entries","datamap-entries","dataentries"],"Array",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",v(e[1])]])})},[Map])(["dm-altered","datamap-altered"],"Datamap",function(a,o,e){return Array.from(e.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).reduce(function(e,t,n){if(!l.containsError(e)){var r=new Map([["name",t[0]],["value",v(t[1])]]),r=o.apply(a,{loop:r,pos:n+1});if(l.containsError(r))return r;e.set(t[0],null===r?t[1]:r)}return e},new Map)},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),Map])("history","Array",function(e,t){var n=s.history();if(!t)return n;t=t.filter(e,n.map(function(e){return a.get(e)}));return l.containsError(t)?t:t.map(function(e){return e.get("name")})},[n(c.TypeSignature("where"))])("visited","Boolean",function(e,t){if("string"==typeof t)return a.has(t)?0<s.passageNameVisited(t)||s.passage===t:l.create("macrocall","There's no passage named '"+t+"' in this story.");var n=s.history(),n=t.filter(e,n.concat(s.passage).map(function(e){return a.get(e)}));return l.containsError(n)?n:0<n.length},[k(String,c.TypeSignature("where"))])("passage","Datamap",function(e,t){return v(a.get(t||s.passage))||l.create("macrocall","There's no passage named '"+t+"' in this story.")},[n(String)])("passages","Array",function(e,t){var n=i("en"),r=_toConsumableArray(a.values()).map(function(e){return v(e)}),t=t?t.filter(e,r):r,e=l.containsError(t);return e||t.sort(function(e,t){return n(e.get("name"),t.get("name"))})},[n(c.TypeSignature("where"))])("open-storylets","Array",function(e,t){if(e.stackTop.evaluateOnly)return l.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+".");e=a.getStorylets(e,t),t=l.containsError(e);return t||e.map(v)},[n(c.TypeSignature("where"))])("savedgames","Datamap",function(){function e(e){return"("+e+" "+p.ifid+") "}var t,n,r=0,a=new Map;do{if(!s.hasStorage)break;t=localStorage.key(r),r+=1;var o=e("Saved Game")}while(null!=(n=t)&&n.startsWith(o)&&(t=t.slice(o.length),a.set(t,localStorage.getItem(e("Saved Game Filename")+t))),t);return a},[])(["datamap","dm"],"Datamap",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!l.containsError(e))if(void 0===r)r=t;else{if(n=l.containsError(m(a,r)))return n;if(a.has(r))return l.create("macrocall","You used the same data name ("+d(r)+") twice in the same (datamap:) call.");a.set(r,v(t)),r=void 0}return e},!0);return l.containsError(i)?i:void 0!==r?l.create("macrocall","This datamap has a data name without a value."):a},T(k(o,S)))(["dataset","ds"],"Dataset",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(y).map(v))},T(S))("count","Number",function t(n,r){for(var e,a,o=arguments.length,i=new Array(2<o?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];if(1<i.length)return a=i.map(function(e){return t(n,r,e)}),(e=l.containsError(a))?e:a.reduce(function(e,t){return e+t},0);var c=i[0];switch(h(r)){case"dataset":case"datamap":return l.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof c?l.create("macrocall",d(r)+" can't contain  "+d(c)+" because it isn't also a string."):c?r.split(c).length-1:0;case"array":return r.reduce(function(e,t){return e+g(t,c)},0);default:return l.create("macrocall",d(r)+" can't contain values, let alone "+d(c)+".")}},[S,w(S)])}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/codehook","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(c,r,e,l,s,n,u,p,a,d,t,i,f,h){var m=e.is,e=u.TypeSignature,g=e.either,y=e.rest,o=e.optional,v=Object.assign;function b(e,t){if(d.isPrototypeOf(t)&&!t.canEnchant)return h.create("datatype","The changer given to (".concat(e,":) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."))}["enchant","change"].forEach(function(o){u.addCommand(o,function(e,t){t=b(o,t);if(t)return t},function(t,n,e){n=p.from(n);var r,a=[];return d.isPrototypeOf(e)&&(r=i.create({section:t}),e.run(r),0<(r.innerEnchantments||[]).length&&(r=r.innerEnchantments.map(function(e){return e(n)}),a.push.apply(a,_toConsumableArray(r)))),a.push(f.create((_defineProperty(r={scope:n},d.isPrototypeOf(e)?"changer":"lambda",e),_defineProperty(r,"section",t),r))),a.forEach(function(e){"enchant"===o?(t.addEnchantment(e),t.updateEnchantments()):e.enchantScope()}),""},[g(p,String),g(d,t.TypeSignature("via"))],!1)}),u.addChanger("enchant-in",function(e,t,n){var r=b("enchant-in",n);return r||d.create("enchant-in",[t,n])},function(t,n,r){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create((_defineProperty(e={scope:p.from(n),localHook:e},d.isPrototypeOf(r)?"changer":"lambda",r),_defineProperty(e,"section",t.section),e))}),t},[g(p,String),g(d,t.TypeSignature("via"))]),[["link-style",p.create({type:"name",data:"link"})],["line-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"lines",void 0)],["char-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var e=_slicedToArray(e,2),r=e[0],a=e[1];u.addChanger(r,function(e,t){var n=b(r,t);return n||d.create(r,[t])},function(t,n){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create((_defineProperty(e={scope:a,localHook:e},d.isPrototypeOf(n)?"changer":"lambda",n),_defineProperty(e,"section",t.section),e))}),t},[g(d,t.TypeSignature("via"))])});e=["replace","append","prepend"];function w(i,s){return r.onStartup(function(){var e=i.classList.replace(/ /g,"."),t=i.blockClassList?i.blockClassList.replace(/ /g,"."):"",n="."+e+(t?",."+t:"");r.storyElement.on(i.event.map(function(e){return e+".enchantment"}).join(" "),n,function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents(n).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})}),[function(e,t,n){if(!t)return h.create("datatype","A string given to this ("+s+":) macro was empty.");if(n){var r=b(s,n);if(r)return r}return d.create(s,[p.from(t)].concat(n?[n]:[]))},function(t,e,n){t.enabled=!1,t.transitionDeferred=!0,i.rerender&&(t.newTargets=(t.newTargets||[]).concat({target:e,append:i.rerender}));var r,a=null!=(r=t.section)&&r.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=f.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.children().css("display"))?i.blockClassList:i.classList),e.attr({tabIndex:"0"})}],data:{enchantmentEvent:function(){var e;null!=(e=t.section.stackTop)&&e.blocked||(i.once&&t.section.removeEnchantment(o),i.goto?l.goToPassage(i.goto,{transition:i.transition}):i.undo?l.goBack({transition:i.transition}):t.section.renderInto(t.source,null,v({},t,{append:i.once?"append":"replace",enabled:!0,transitionDeferred:!1}),a))}},scope:e,section:t.section,name:s},d.isPrototypeOf(n)?"changer":"lambda",n));return t.section&&(t.section.addEnchantment(o),o.enchantScope()),t},[g(p,String),o(g(d,t.TypeSignature("via")))]]}e.forEach(function(o){u.addChanger(o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.every(Boolean)?d.create(o,n.map(p.from),null,!1):h.create("datatype","A string given to this (".concat(o,":) macro was empty."))},function(e){var t;0<c(e.target).parents().filter("tw-collapsed,[collapsing=true]").length||e.attr.some(function(e){return e.collapsing})||(e.attr=[].concat(_toConsumableArray(e.attr),[{collapsing:!1}])),e.newTargets=e.newTargets||[];for(var n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=e.newTargets).push.apply(t,_toConsumableArray(r.filter(function(n){return!e.newTargets.some(function(e){var t=e.target,e=e.append;return m(n,t)&&o===e})}).map(function(e){return{target:e,append:o,before:!0}}))),e},y(g(p,String)))(o+"-with",function(e,t){return d.create(o+"-with",[t],null,!1)},function(e,t){return a.isPrototypeOf(t)&&(t=t.code),e.appendSource=(e.appendSource||[]).concat({source:t,append:o}),e},g(a,String))});var k="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,T=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}},{name:"doubleclick",enchantDesc:{event:["dblclick"],once:!0,rerender:"",classList:"link enchantment-dblclick",blockClassList:"enchantment-dblclickblock"}}];T.forEach(function(e){"doubleclick"!==e.name&&(u.addChanger.apply(u,[e.name].concat(_toConsumableArray(w(e.enchantDesc,e.name)))),"click"===e.name&&u.addChanger.apply(u,[e.name+"-rerun"].concat(_toConsumableArray(w(v({},e.enchantDesc,{once:!1}),e.name+"-rerun")))))}),r.onStartup(function(){T.forEach(function(e){var n=e.enchantDesc;n.blockClassList&&r.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents("."+n.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})})}),e.forEach(function(n){T.forEach(function(e){var t;"doubleclick"!==e&&(t=v({},e.enchantDesc,{rerender:n}),e=e.name+"-"+n,u.addChanger.apply(u,[e].concat(_toConsumableArray(w(t,e)))))})}),T.forEach(function(i){"doubleclick"!==i&&["goto","undo"].forEach(function(a){var o=i.name+"-"+a;u.addCommand(o,function(e,t){return!e||!t&&"goto"===a?h.create("datatype","A string given to this ("+o+":) macro was empty."):"goto"!==a||n.hasValid(t)?void 0:h.create("macrocall","I can't ("+o+":) the passage '"+t+"' because it doesn't exist.")},function(e,t,n,r){return"undo"===a&&s.pastLength<1?h.create("macrocall","I can't (undo:) on the first turn."):((0,_slicedToArray(w(v({},i.enchantDesc,{transition:e.data.passageT8n},"undo"===a?{undo:!0}:{goto:r}),o),2)[1])({section:t},p.from(n)),v(e,{source:""}))},[g(p,String)].concat("undo"===a?[]:String))})})}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(i,e,c,l,u,p,a,d,t,f,h){var n=e.TypeSignature,r=n.optional,o=n.rest,n=n.either,m=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],g=Object.assign;function s(e,t,n){n=n||t;var r,a=u.hasValid(t)&&t===n,e=e.evaluateTwineMarkup(c.unescape(n),"a link's passage name");return a?t=(a=0<e.children().length?"`".repeat((n.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"")+"\0".repeat(!!a)+t+"\0".repeat(!!a)+a:(e.findAndFilter("tw-error").length&&(r=e.findAndFilter("tw-error").data("TwineError")),n=e.text()),{text:t,passage:n,error:r}}c.onStartup(function(){var e="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;function t(e){var n,t=i(this),r=t.closest("tw-expression"),a=t.closest("tw-expression, tw-hook"),o=a.data("clickEvent"),a=a.data("section");if((!c.options.debug||!c.options.ignoreClickEvents||t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *"))&&!t.is("tw-open-button")&&(null==a||!a.stackTop||!a.stackTop.blocked||a.stackTop.blocked instanceof i&&a.stackTop.blocked.find(t).length)){if(!o)return a=r.data("linkPassageName"),n=Object.assign({},r.data("passageT8n")||{}),r.find("tw-enchantment").each(function(e,t){Object.assign(n,i(t).data("passageT8n")||{})}),a?(e.stopPropagation(),void p.goToPassage(a,{transition:n})):t.is("[undo]")?(e.stopPropagation(),void p.goBack({transition:n})):void(t.is("[fullscreen]")&&(e.stopPropagation(),p.toggleFullscreen()));0<t.find("tw-error").length||(e.stopPropagation(),o(t))}}c.storyElement.on("click.passage-link","tw-link"+(e?"":":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)"),t).on("mouseover.passage-link","tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link",t).on("mouseout.passage-link","tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link",t).on("dblclick.passage-link","tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link",t),i(document).on("fullscreenchange",function(){i("tw-link[fullscreen]",c.storyElement).each(function(e,t){(i(t).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(t)})})}),[["link","link-replace"],["link-reveal","link-append"],["link-repeat"],["link-rerun"]].forEach(function(s){return e.addChanger(s,function(e,t,n){return t?n&&!n.canEnchant?h.create("datatype","The changer given to (".concat(s[0],":) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")):a.create(s[0],[t].concat(n||[]),null,!0):h.create("datatype",m[0])},function(r,e,t){var n,a=s[0],o=null!=(n=r.section)&&n.stackTop?r.section.stackTop.tempVariables:Object.create(null),i=d.create({source:"<tw-link tabindex=0>"+e+"</tw-link>",target:function(){return r.target},append:"replace",data:{section:r.section,clickEvent:function(e){r.enablers=r.enablers.filter(function(e){return e.descriptor!==i}),"link-reveal"===a&&e.contents().unwrap();var t,n=e.parentsUntil(":not(tw-enchantment)").parent();n.length||(n=e.parent()),"link-rerun"===a&&(t=e.parentsUntil(":not(tw-enchantment)"),e.detach(),t.remove()),"link"!==a&&"link-rerun"!==a||n.empty(),r.section.renderInto("",null,r,o),"link-rerun"===a&&n.prepend(e)}}});return r.enablers=(r.enablers||[]).concat({descriptor:i,changer:t}),r},[String,r(a)])}),e.addCommand("link-goto",function(e){if(!e)return h.create.apply(h,["datatype"].concat(m))},function(e,t,n,r){var a,o=s(t,n,r);return n=o.text,r=o.passage,(o=o.error)?o:e.transition?h.create("datatype","Please attach ("+(o="transition")+"-depart:) or ("+o+"-arrive:) to a passage link, not ("+o+":)."):(a=(a=u.hasValid(r)?a:'<tw-broken-link passage-name="'+c.escape(r)+'">'+n+"</tw-broken-link>")||"<tw-link tabindex=0 "+(0<l.passageNameVisited(r)?'class="visited" ':"")+">"+n+"</tw-link>",e.data.linkPassageName=r,e.data.section=t,g(e,{source:a,transitionDeferred:!0}))},[String,r(String)])("link-storylet",function(){var e=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1)<0||arguments.length<=e?void 0:arguments[e];if(!e||"string"==typeof e)return h.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n=(n=2+(1==(arguments.length<=2?0:arguments.length-2)?0:3==(arguments.length<=2?0:arguments.length-2)||"string"==typeof(arguments.length<=2?void 0:arguments[2])?1:2))<2||arguments.length<=n?void 0:arguments[n],r="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),a=((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a])!==n&&((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a]);if(e.transition)return h.create("datatype","Please attach ("+(o="transition")+"-depart:) or ("+o+"-arrive:) to (link-storylet:), not ("+o+":).");var o=f.isPrototypeOf(n),i=u.getStorylets(t,o&&n),s=h.containsError(i);if(s)return s;var c,s=i[o?0:n<0?i.length+n:n-1];if(s)s=s.get("name"),r=r||s,c=c||"<tw-link tabindex=0 "+(0<l.passageNameVisited(s)?'class="visited" ':"")+">"+r+"</tw-link>",e.data.linkPassageName=s,e.data.section=t;else{if(!a)return e;c=a}return g(e,{source:c,transitionDeferred:!0})},[n(parseInt,String,f.TypeSignature("where")),r(n(parseInt,String,f.TypeSignature("where"))),r(String)])("link-undo",function(e){if(!e)return h.create("datatype",m[0])},function(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";if(l.pastLength<1)return g(t,{source:r});var a=(t.data.section=e).stackTop.tempVariables;return t.data.forgetUndosEvent=function(){return t.data.section.whenUnblocked(function(){var e=g({},t,{append:"replace",source:r,transitionDeferred:!1});t.section.renderInto("",null,e,a)})},g(t,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0})},[String,r(String)])("link-show",function(e){if(!e)return h.create("datatype",m[0])},function(r,a,e){for(var t=arguments.length,n=new Array(3<t?t-3:0),o=3;o<t;o++)n[o-3]=arguments[o];return r.data.section=a,r.data.clickEvent=function(e){e.contents().unwrap(),n.forEach(function(e){return e.forEach(a,function(e){var t=e.data("originalSource")||"",n=e.data("hidden");n&&(e.removeData("hidden"),n instanceof i?e.empty().append(n):(n=e.data("tempVariables"),a.renderInto("",null,g({},r,{source:t,target:e,transitionDeferred:!1}),n&&Object.create(n))))})})},g(r,{source:"<tw-link tabindex=0>"+e+"</tw-link>",transitionDeferred:!0})},[String,o(t)])("link-fullscreen",function(e,t){if(!e||!t)return h.create("datatype",m[0])},function(t,e,n,r){function a(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""}var o=e.stackTop.tempVariables;return t.data.section=e,t.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&t.data.section.whenUnblocked(function(){var e=g({},t,{append:"replace",source:a(),transitionDeferred:!1});t.section.renderInto("",null,e,o)})},g(t,{source:a(),transitionDeferred:!0})},[String,String,r(String)]),e.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return h.create.apply(h,["datatype"].concat(m));if(a.isPrototypeOf(n)){if(a.isPrototypeOf(r))return h.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}if(r&&!r.canEnchant)return h.create("datatype","The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).");var e=s(e,t,n);return t=e.text,n=e.passage,(e=e.error)?e:a.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}),null,!1)},function(t,e,n,r){var a,o,i,s;{if(u.hasValid(n))return o=l.passageNameVisited(n),i=null!=(a=t.section)&&a.stackTop?t.section.stackTop.tempVariables:Object.create(null),s=d.create({source:"<tw-link tabindex=0 "+(0<o?'class="visited" ':"")+">"+e+"</tw-link>",target:t.target,append:"replace",data:{section:t.section,append:"replace",clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==s}),e.contents().unwrap(),t.section.renderInto("",null,t,i),t.section.whenUnblocked(function(){return p.goToPassage(n,{transition:t.data.passageT8n})})}}}),t.enablers=(t.enablers||[]).concat({descriptor:s,changer:r}),t;t.source='<tw-broken-link passage-name="'+c.escape(n)+'">'+e+"</tw-broken-link>"}},[String,r(n(a,String)),r(a)])}),define("macrolib/metadata",["macros","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(t,e,n,s){function c(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}}var l=e.clone,u=e.objectName,p=e.isValidDatamapName,e=t.TypeSignature,r=e.zeroOrMore,e=e.Any;[["storylet",n.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(e){var e=_slicedToArray(e,2),n=e[0],e=e[1];t.add(n,"Metadata",function(e,t){return e.stackTop.speculativePassage?t:c(n)},e)}),t.add("metadata","Metadata",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!s.containsError(e))if(void 0===r)r=t;else{if(n=s.containsError(p(a,r)))return n;if(a.has(r))return s.create("macrocall","You used the same data name ("+u(r)+") twice in the same (metadata:) call.");a.set(r,l(t)),r=void 0}return e},!0);return s.containsError(i)?i:void 0!==r?s.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?a:c("metadata")},r(e))}),define("macrolib/patterns",["macros","utils","utils/operationutils","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror","internaltypes/varscope"],function(e,t,n,y,v,h,b,w){function k(e){var a=e.name,t=e.fullArgs,n=e.args,r=e.makeRegExpString,o=void 0===r?function(e){return e.join("")}:r,i=void 0!==(r=e.insensitive)&&r,s=void 0===(r=e.canContainTypedVars)||r,c=void 0===(r=e.canBeUsedAlone)||r,l=void 0===(r=e.canContainTypedGlobals)||r,u=n||t,p=C(null),e=u.map(function e(t){if(h.isPrototypeOf(t)){var n=t.varRef;if(!s)return b.create("operation","Optional string patterns, like (".concat(a,":)").concat("p-many"===a?" with a minimum of 0 matches":"",", can't have typed variables inside them."));if(!l&&!w.isPrototypeOf(n.object))return b.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"));n=n.getName();if(n in p)return b.create("operation","There's already a typed temp variable named _".concat(n," inside this (").concat(a,":) call."));p[n]=!0;n=e(t.datatype);return b.containsError(n)?n:"("+n+")"}if(v.isPrototypeOf(t)){if(!(s&&l||"function"!=typeof t.typedVars)){n=t.typedVars();if(!s&&n.length)return b.create("operation","(".concat(a,":) can't have typed variables inside its pattern."));if(!l&&n.some(function(e){return!w.isPrototypeOf(e.varRef.object)}))return b.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"))}if(t.regExp)return(t.rest?"(?:":"")+(i?t.insensitive():t).regExp+(t.rest?")*":"");var n=t.name,r=t.rest?"*":"";return"alnum"===n?m+r:"whitespace"===n?x+r:"uppercase"===n?(i?S:g)+r:"lowercase"===n?(i?S:T)+r:"anycase"===n?S+r:"digit"===n?"\\d"+r:"linebreak"===n?"(?:\\r|\\n|\\r\\n)"+r:"str"===n?".*?":["even","odd","int","num"].includes(n)?b.create("datatype","Please use string datatypes like 'digit' in (".concat(a,":) instead of number datatypes.")):b.create("datatype","The (".concat(a,":) macro must only be given string-related datatypes, not ").concat(O(t),"."))}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),i?t.replace(RegExp("(".concat(g,"|").concat(T,")"),"g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"}):t):(_("createPattern","mapper() was given a non-string non-datatype "+t),"")});if(r=b.containsError(e))return r;var d=o(e),f=E(C(v),{name:a,regExp:d,insensitive:function(){return i?f:k({name:a,fullArgs:t,args:u.map(function(e){return v.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:o,insensitive:!0,canContainTypedVars:s,canBeUsedAlone:c})},typedVars:function(){return u.reduce(function(e,t){return h.isPrototypeOf(t)&&(e=e.concat(i?h.create(k({name:"p-ins",fullArgs:[t.datatype],insensitive:!0}),t.varRef):t),t=t.datatype),e=v.isPrototypeOf(t)&&"function"==typeof t.typedVars?e.concat(t.typedVars()):e},[])},destructure:function(e){if("string"!=typeof e)return[b.create("operation","I can't put ".concat(O(e)," into ").concat(this.TwineScript_ToSource()," because it isn't a string."))];var n=this.typedVars();if(!n.length)return[];var t=(RegExp("^"+(this.rest?"(?:":"")+d+(this.rest?")*":"")+"$").exec(e)||[]).slice(1);return t.length?t.map(function(e,t){t=n[t];if(t)return t.datatype.rest&&!t.datatype.regExp&&((t=t.TwineScript_Clone()).datatype=k({name:"p",fullArgs:[t.datatype]})),{dest:t,value:e||"",src:void 0}}).filter(Boolean):[b.create("operation","I can't put ".concat(O(e)," because it doesn't match the pattern ").concat(this.TwineScript_ToSource(),"."))]},TwineScript_IsTypeOf:function(e){return c?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+d+(this.rest?")*":"")+"$"):b.create("operation","A (".concat(a,":) datatype must only be used with a (p:) macro."))},TwineScript_toTypeSignatureObject:function(){var t=this;return{pattern:"range",name:a,range:function(e){return t.TwineScript_IsTypeOf(e)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+a+":"+t.map(A)+")"}});return Object.defineProperty(f,"TwineScript_ObjectName",{get:function(){return"a (".concat(a,":) datatype")}}),f}var m=t.anyRealLetter,g=t.anyUppercase,T=t.anyLowercase,S=t.anyCasedLetter,x=t.realWhitespace,_=t.impossible,O=n.objectName,A=n.toSource,t=e.TypeSignature,n=t.rest,r=t.either,a=t.optional,t=t.nonNegativeInteger,E=Object.assign,C=Object.create,o=n(r(String,v,h));e.add(["p","pattern"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p",fullArgs:n})},o)(["p-either","pattern-either"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},o)(["p-opt","pattern-opt","p-optional","pattern-optional"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},o)(["p-not","pattern-not"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==_toConsumableArray(e).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?b.create("datatype","(p-not:) should only be given single characters, or datatypes that match single characters"):k({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},o)(["p-not-before","pattern-not-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-not-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?!"+e.join("")+")"}})},o)(["p-before","pattern-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?="+e.join("")+")"}})},o)(["p-start","pattern-start"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-start",fullArgs:n,makeRegExpString:function(e){return"^(?:"+e.join("")+")"}})},o)(["p-end","pattern-end"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-end",fullArgs:n,makeRegExpString:function(e){return"(?:"+e.join("")+")$"}})},o)(["p-many","pattern-many"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i=n.slice();if("number"==typeof n[0]&&(a=n.shift(),o="number"==typeof n[0]?n.shift():1/0),void 0!==o&&o<a)return b.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");if(!n.length)return b.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");var s=n.find(function(e){return"string"!=typeof e&&!v.isPrototypeOf(e)&&!h.isPrototypeOf(e)});return s?b.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+O(s)+"."):k({name:"p-many",args:n,fullArgs:i,canContainTypedVars:0<a,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==a?"{"+a+(o===1/0?",":o!==a?","+o:"")+"}":"+")}})},[n(r(t,String,v,h))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-ins",fullArgs:n,insensitive:!0})},o)(["split","splitted"],"Array",function(e,t,n){if(t=k({name:"split",fullArgs:[t],canContainTypedVars:!1}),b.containsError(t))return t;if(!n)return[""];if(!t.regExp)return _toConsumableArray(n);for(var r,a=RegExp(t.regExp),o=[];n&&(r=a.exec(n));){if(r.index+r[0].length===0)return o;o.push(n.slice(0,r.index)),n=n.slice(r.index+r[0].length)}return o.concat(n||[])},[r(String,v),String])("trimmed","String",function(e,t,n){return void 0===n||v.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=k({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),b.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[r(String,v),a(String)])(["str-find","string-find"],"String",function(e,t,n){if(t=k({name:"str-find",fullArgs:[t],canContainTypedGlobals:!1}),b.containsError(t))return t;for(var r,a=t.typedVars(),o=RegExp(t.regExp,"g"),i=[],s=o.lastIndex;(r=o.exec(n))&&s!==o.lastIndex;)if(s=o.lastIndex,a.length){for(var c=new Map,l=0;l<a.length;l+=1){if("match"===a[l].varRef.getName())return b.create("macrocall","There was a typed temp variable named _match in the pattern given to (str-find:)","The variable _match is reserved, and can't be used inside (str-find:)'s pattern.");c.set(a[l].varRef.getName(),r[l+1]),c.set("match",r[0])}i.push(c)}else i.push(r[0]);return i},[v,String])(["str-replaced","string-replaced","replaced"],"String",function(e,t,n,r,a){if("number"!=typeof t){if(void 0!==a)return b.create("macrocall","1 too many values were given to (str-replaced:).","If this is given 5 values, the first value must be a number of replacements.");a=r,r=n,n=t,t=1/0}else if(void 0===a)return b.create("macrocall","The (str-replaced:) macro needs 1 more value.","The final string seems to be missing.");if(v.isPrototypeOf(r))return b.create("datatype","The replacement value for (str-replaced:) must be a string or lambda, not ".concat(O(r)));if(y.isPrototypeOf(a)||y.isPrototypeOf(n))return b.create("datatype","The ".concat(y.isPrototypeOf(a)?"final string":"search pattern"," given to (str-replaced:) can't be a lambda."),"Only the replacement value (after the search pattern) can be a 'via' lambda.");if(n=k({name:"str-replaced",fullArgs:[n],canContainTypedGlobals:!1}),b.containsError(n))return n;if(!n.regExp)return a;for(var o,i=RegExp(n.regExp,"g"),s=y.isPrototypeOf(r)?n.typedVars():[],c=1,l=0,u="",p=i.lastIndex;a&&(o=i.exec(a))&&0<t&&p!==i.lastIndex;){for(var p=i.lastIndex,d=Object.create(e.stack.length?e.stackTop.tempVariables:w),f=0;f<s.length;f+=1){var h=s[f],m=h.varRef.create(d,h.varRef.propertyChain);if(b.containsError(m))return m;h=m.defineType(h.datatype);if(b.containsError(h))return h;m.set(o[f+1])}var g=y.isPrototypeOf(r)?r.apply(e,{loop:o[0],pos:c,tempVariables:d}):r;if(b.containsError(g))return g;if("string"!=typeof g)return b.create("datatype","(str-replaced:)'s lambda must produce a string, but it produced ".concat(O(g),' when given "').concat(o[0],'".'));u+=a.slice(l,o.index)+g,c+=1,--t,l=o.index+o[0].length}return u+=a.slice(l)},[r(t,String,v),r(v,String,y.TypeSignature("via")),r(String,y.TypeSignature("via")),a(String)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(s,e,c,t,a,n,r,o,i,l,u){var p,d,f=t.geomParse,h=t.geomStringRegExp,m=Object.assign,t=e.TypeSignature,g=t.either,y=t.wrapped,v=t.optional,b=t.Any,w=t.Everything,k=t.zeroOrMore,T=t.rest,S=t.insensitiveSet,x=t.positiveNumber,_=t.positiveInteger,O=t.nonNegativeNumber,t=t.percent,y=[y(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')],A=(c.onStartup(function(){return c.storyElement.on("mouseenter.hover-macro","[hover=false]",function(){var e=s(this),t=e.data("hoverChanger");c.options.debug&&c.options.ignoreClickEvents&&!e.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||(e.data({mouseoutStyle:e.attr("style")||""}),l.create({target:e},t).update(),e.attr("hover",!0))}).on("mouseleave.hover-macro","[hover=true]",function(){var e=s(this),t=e.data("mouseoutStyle");e.attr("style",t).removeData("mouseoutStyle").attr("hover",!1)})}),u.on(function(){s("tw-expression, tw-hook",c.storyElement).each(function(e,t){((t=s(t)).data("errorEvent")||Object)(t)})}),S("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur")),E=S("dotted","dashed","solid","double","groove","ridge","inset","outset","none");e.addChanger("if",function(e,t){return o.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},y)("unless",function(e,t){return o.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},y)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?o.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):u.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},y)("else",function(e){return"lastHookShown"in e.stack[0]?o.create("else",[!1===e.stack[0].lastHookShown]):u.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return o.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return o.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return o.create("live",t?[t]:[])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}},v(Number))("event",function(e,t){return o.create("event",[t])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}},i.TypeSignature("when"))("more",function(){return o.create("more")},function(e){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return 0!==e.Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return o.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,n){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return c.anyInputDown()&&n&&(t-=n),e.Identifiers.time>t?[!0]:[]}}}},[x,v(O)])("after-error",function(){return o.create("after-error",[])},function(n){n.enabled=!1,n.transitionDeferred=!0;var r=n.section.stackTop.tempVariables;n.data.errorEvent=function(e){e.removeData("errorEvent");var t=m({},n,{enabled:!0,transitionDeferred:!1});t.data&&(t.data.errorEvent=void 0),n.section.whenUnblocked(function(){return n.section.renderInto("",null,t,r)})}},[])("hook",function(e,t){if(!t)return u.create("datatype","The string given to (hook:) was empty.");var n=c.insensitiveName(t);return n?o.create("hook",[n]):u.create("datatype",'The string given to (hook:), "'.concat(t,'", contained only dashes and underscores.'))},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){if(!t.loop)return u.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return o.create("for",[t].concat(r))},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o,i=t.filter(e.section,r);if(o=u.containsError(i))return o;e.loopVars[t.loop.getName()]=i||[]},[i.TypeSignature("where"),k(b)])(["transition","t8n"],function(e,t){return o.create("transition",[c.insensitiveName(t)])},function(e,t){return"zoom"===(e.transition=t)&&(e.transitionOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-time","t8n-time"],function(e,t){return o.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=m(e.data.passageT8n||{},{time:t}),e},[x])(["transition-delay","t8n-delay"],function(e,t){return o.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return o.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[x])(["transition-depart","t8n-depart"],function(e,t){return o.create("transition-depart",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{depart:t}),"zoom"===t&&(e.data.passageT8n.departOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-arrive","t8n-arrive"],function(e,t){return o.create("transition-arrive",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{arrive:t}),"zoom"===t&&(e.data.passageT8n.arriveOrigin=function(){var e=s(this),t=e.offset(),n=t.left,t=t.top,r=e.height();return{"transform-origin":100*(c.mouseCoords.x-n)/e.width()+"% "+100*(c.mouseCoords.y-t)/r+"%",height:r+"px"}}),e},[A])("button",function(e,t){return void 0===t||f(t).size?o.create("button",t?[t]:[]):u.create("datatype",'The string given to (button:) should be a sizing line ("==X==", "==X", "=XXXX=" etc.), not '.concat(JSON.stringify(t),"."))},function(e,t){var t=f(t),n=t.marginLeft,t=t.size;return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(0<this.className.length)+"enchantment-button")}}),e.styles.push({"margin-left":t?n+"%":void 0,width:t?t+"%":"100%"}),e},[v(String)]).apply(void 0,_toConsumableArray((d={click:{className:"enchantment-link",blockClassName:"enchantment-clickblock"},doubleclick:{className:"enchantment-dblclick",blockClassName:"enchantment-dblclickblock"},mouseover:{className:"enchantment-mouseover",blockClassName:"enchantment-mouseoverblock"},mouseout:{className:"enchantment-mouseout",blockClassName:"enchantment-mouseoutblock"}},["action",function(e,t){return o.create("action",[c.insensitiveName(t)])},function(e,t){return e.attr.push({class:function(){var e=function e(t){return(t=s(t)).is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(t.css("display"))||t.children().get().some(e)}(this);return Array.from(this.classList).filter(function(t){return!Object.keys(d).some(function(e){return d[e].className===t||d[e].blockClassName===t})}).concat(d[t][e?"blockClassName":"className"]).join(" ")}}),e},[S.apply(void 0,_toConsumableArray(Object.keys(d)))]])))(["border","b4r"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({display:function(){var e=s(this).css("display");return n.every(function(e){return"none"===e})||!e.includes("inline")?e:"inline-block"},"border-style":n.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),e},[E].concat(_toConsumableArray(Array(3).fill(v(E)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-size",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(v(O)))))("corner-radius",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("corner-radius",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(v(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-colour",n.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[g(String,a)].concat(_toConsumableArray(Array(3).fill(v(g(String,a))))))("opacity",function(e,t){return o.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[t])("font",function(e,t){return o.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=t.indexOf("><");return/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?((n=~n?(n=Math.round(n/(t.length-2)*50),m({"text-align":"center","max-width":"50%"},25===n?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":n+"%"})):"<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"}).display="inline-block",o.create("align",[n])):u.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"')},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return o.create("text-colour",[t])},function(e,t){return a.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[g(String,a)])(["text-size","size"],function(e,t){return o.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return o.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return o.create("text-rotate-z",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" rotate("+t+"deg)"}}),e},[Number])("text-rotate-y",function(e,t){return o.create("text-rotate-y",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateY("+t+"deg)"}}),e},[Number])("text-rotate-x",function(e,t){return o.create("text-rotate-x",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateX("+t+"deg)"}}),e},[Number])(["background","bg"],function(e,t){return o.create("background",[t])},function(e,t){return a.isPrototypeOf(t)?t=t.toRGBAString():r.isPrototypeOf(t)&&(t=t.toLinearGradientString()),t=a.isHexString(t)||a.isCSS3Function(t)?{"background-color":t}:t.startsWith("linear-gradient(")||t.startsWith("repeating-linear-gradient(")?{"background-image":t}:{"background-size":"cover","background-image":"url(".concat(t,")"),"background-attachment":"fixed"},e.styles.push(t,{display:function(){var e=s(this);return!e.children().length||c.childrenProbablyInline(e)?s(this).css("display"):"block"}}),e},[g(String,a,r)]).apply(void 0,_toConsumableArray((y={color:function(){return"transparent"}},p=m(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var e=s(this).css("color");return"-1px -1px 0 "+e+", 1px -1px 0 "+e+",-1px  1px 0 "+e+", 1px  1px 0 "+e}},{color:function(){return c.parentColours(s(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+s(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+s(this).css("color")}},smear:[{"text-shadow":function(){var e=s(this).css("color");return"0em   0em 0.02em "+e+",-0.2em 0em  0.5em "+e+", 0.2em 0em  0.5em "+e}},y],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+s(this).css("color")}},y],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+s(this).css("color")},"user-select":"none"},y],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},tall:{display:"inline-block",transform:"scaleY(1.5) translateY(-0.25ex)"},flat:{display:"inline-block",transform:"scaleY(0.5) translateY(0.25ex)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("text-style",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=1)"none"===n[a]?e.styles=[]:e.styles=e.styles.concat(p[n[a]]);return e},[T(S.apply(void 0,_toConsumableArray(Object.keys(p))))]])))("collapse",function(){return o.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=l.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?o.create("hover-style",[t]):u.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[o])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),o.create("css",[t])},function(e,t){return e.attr.push({style:function(){return(s(this).attr("style")||"")+t}}),e},[String])("test-true",function(){return o.create("test-true",[])},function(e){return e.enabled=!0},k(w))("test-false",function(){return o.create("test-false",[])},function(e){return e.enabled=!1},k(w)),e.addCommand("animate",s.noop,function(r,e,t,a,o){t.forEach(e,function(e){var t,n;"zoom"===name&&(n=(t=e.offset()).left,t=t.top,n=c.mouseCoords.x-n+"px "+(c.mouseCoords.y-t)+"px"),c.transitionIn(e,a,r.transitionTime||o,r.transitionDelay,r.transitionSkip,0,n)})},[T(n),S.apply(void 0,_toConsumableArray(A.innerType.filter(function(e){return"instant"!==e}))),v(x)]),["box","float-box"].forEach(function(i){return e.addChanger(i,function(e,t,n){var r=-1===t.search(h)||1<t.length&&!t.includes("="),a="float-box"===i&&(-1===n.search(h)||1<n.length&&!n.includes("="));return r||a?u.create("datatype","The ("+i+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(r?t:n)+'".'):o.create(i,[t,n].filter(function(e){return void 0!==e}))},function(e,t,n){var r,t=f(t),a=t.marginLeft,t=t.size,o=("float-box"===i&&(r=(o=f(n)).marginLeft,n=o.size),"box"===i?"%":"vw"),a=(_defineProperty(t={display:"block",width:t+o,"max-width":t+o},"box"===i?"margin-left":"left",a+o),_defineProperty(t,"box-sizing","content-box"),_defineProperty(t,"overflow-y","auto"),_defineProperty(t,"padding",function(){var e=s(this).css("padding");return e&&"0px"!==e?e:"1em"}),t);return void 0!==n&&(a.height=n+("box"===i?"em":"vh")),"float-box"===i&&m(a,{position:"fixed",top:r+"vh","background-color":function(){return c.parentColours(s(this)).backgroundColour}}),e.styles.push(a),e},[String,"box"===i?v(_):String])})}),define("macrolib/values",["macros","state","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","datatypes/codehook","internaltypes/twineerror"],function(t,r,e,n,l,c,a,o,i,f){var s=e.realWhitespace,u=e.nth,p=e.anyRealLetter,d=e.plural,h=n.subset,m=n.objectName,g=n.clone,y=n.toSource,e=t.TypeSignature,n=e.rest,v=e.zeroOrMore,b=e.either,w=e.optional,k=e.insensitiveSet,T=e.numberRange,S=e.percent,x=e.nonNegativeInteger,_=e.positiveInteger,e=e.Any,O=Math.max,A=Math.min,E=Math.round,C=Math.floor,N=Math.ceil;function P(t){return function(){var e=t.apply(void 0,arguments);return"number"!=typeof e||isNaN(e)?f.create("macrocall","This mathematical expression doesn't compute!"):e}}t.add(["str","string","text"],"String",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.map(function(e){return i.isPrototypeOf(e)?e.source:e}).join("")},[v(t.TypeSignature.either(String,Number,Boolean,Array,i))])("source","String",function(e,t){return"command"!==(null==t?void 0:t.TwineScript_TypeID)||t.TwineScript_ToSource?y(t):f.create("datatype","I can't construct the source code of a command created by a custom macro.")},[e])("substring","String",function(e,t,n,r){return h(t,n,r)},[String,parseInt,parseInt])("lowercase","String",function(e,t){return t.toLowerCase()},[String])("uppercase","String",function(e,t){return t.toUpperCase()},[String])("lowerfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words","Array",function(e,t){return t.split(RegExp(s+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],"String",function(e,t,n){return 0===n.length?f.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[x,String])(["str-reversed","string-reversed"],"String",function(e,t){return _toConsumableArray(t).reverse().join("")},[String])("joined","String",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.join(t)},[n(String)])("plural","String",function(e,t,n,r){return n&&""!==r?d(t,n,r):f.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,w(String)])(["str-nth","string-nth"],"String",function(e,t){return u(t)},[parseInt])("digit-format","String",function(e,t,n){if(1e21<=Math.abs(n))return f.create("macrocall","The number given to (digit-format:) is too big.");for(var r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1],i=(t=_toConsumableArray(t)).length,s=(a&&(","!==a||o&&","!==o)&&(i=r.lastIndex-1),Math.abs(n).toFixed(16).replace(/(\.\d*?)0+$/,function(e,t){return t}).replace(/^0+/,"")),c=s.includes(".")?s.indexOf("."):s.length,l=0,u="",p=t.length-1;0<=p;--p){var d=t[p];"0"===d||"#"===d?u=(s[c-i+p+l]||("0"===d?"0":""))+u:p<t.length-1&&0<p&&(u=d+u,l+=p===i?0:1)}return(n<0?"-":"")+u},[String,Number])(["num","number"],"Number",function(e,t){return Number.isNaN(+t)?f.create("macrocall","I couldn't convert "+m(t)+" to a number."):+t},[String])("datatype","Datatype",function(e,t){return a.from(t)},[e])("datapattern","Any",function(e,t){return function n(e){var r;return Array.isArray(e)?r=e.map(n):e instanceof Map?(r=new Map,_toConsumableArray(e).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return r.set(t,n(e))})):r=a.from(e),(e=f.containsError(r))?e:r}(t)},[e])(["rgb","rgba"],"Colour",function(e){return l.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[T(0,255),T(0,255),T(0,255),w(S)])(["hsl","hsla"],"Colour",function(e,t,n,r,a){return(t=E(t)%360)<0&&(t+=360),l.create({h:t,s:n,l:r,a:a})},[Number,S,S,w(S)])(["lch","lcha"],"Colour",function(e,t,n,r,a){return(r=E(r)%360)<0&&(r+=360),l.create({l:t,c:n,h:r,a:a})},[S,T(0,132),Number,w(S)])("complement","Colour",function(e,t){return t.LCHRotate(180)},[l])("mix","Colour",function(e,t,n,r,a){n=n.toLCHA(),a=a.toLCHA();var o=1,i=(t+r!==1&&(t+r<1&&(o=t+r),t=(i=[t/(t+r),r/(t+r)])[0],r=i[1]),n.c<2||n.l<.01||.99<n.l?n.h=a.h:(a.c<2||a.l<.01||.99<a.l)&&(a.h=n.h),n.l*=n.a,n.c*=n.a,a.l*=a.a,a.c*=a.a,180<a.h-n.h?n.h+=360:a.h-n.h<-180&&(a.h+=360),n.a*t+a.a*r),s=(n.l*t+a.l*r)/i,c=(n.c*t+a.c*r)/i,n=(n.h*t+a.h*r)/i;return l.create({l:s,c:c,h:n,a:i*o})},[S,l,S,l])("palette","Array",function(e,t,n){var r,a=n.toLCHA(),o=a.l,a={l:o<=.75?.75+o/3:.75-3*(1-o),c:80,h:a.h,a:1},i=l.create(a);return a.l+=o<=.75?-.1:.1,a.l<.5&&(a.l*=.5/a.l),r=l.create(a),a.l+=o<=.85?.15:-.15,o=l.create(a),"adjacent"===t?(r=(i=i.LCHRotate(-30)).LCHRotate(30),o=i.LCHRotate(60)):"triad"===t&&(o=i.LCHRotate(180),r=i.LCHRotate(140),i=i.LCHRotate(-140)),[n,i,r,o]},[k("mono","adjacent","triad"),l])("gradient","Gradient",function(e,t){(t=E(t)%360)<0&&(t+=360);for(var n,r=arguments.length,a=new Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(a.length<4)return f.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.");var i=[],s=a.reduce(function(e,t){if(!f.containsError(e))if(void 0===n)n=t;else{if("number"!=typeof n||!l.isPrototypeOf(t))return f.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");i.push({stop:n,colour:g(t)}),n=void 0}return e},!0);return f.containsError(s)?s:void 0!==n?f.create("macrocall","This gradient has a colour-stop percent without a colour."):c.create(t,i)},[Number,n(b(S,l))])("stripes","Gradient",function(e,t,n){(t=E(t)%360)<0&&(t+=360);for(var r=0,a=[],o=arguments.length,i=new Array(3<o?o-3:0),s=3;s<o;s++)i[s-3]=arguments[s];return i.forEach(function(e){a.push({stop:r,colour:g(e)}),r+=n,a.push({stop:r,colour:g(e)})}),c.create(t,a,!0)},[Number,_,l,n(l)])("hooks-named","HookName",function(e,t){return t?o.create({type:"name",data:t}):f.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond","Any",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=2){var o=n[a];if(a===n.length-1||f.containsError(o))return o;if("boolean"!=typeof o)return f.create("datatype","(cond:)'s "+u(a+1)+" value is "+m(o)+", but should be a boolean.");if(o)return n[a+1]}return f.create("macrocall","An odd number of values must be given to (cond:), not "+n.length,"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,e,n(e)]);({weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,n(Number)],max:[O,n(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[C,Number],round:[E,Number],trunc:[function(e){return(0<e?C:N)(e)},Number],ceil:[N,Number],pow:[P(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[P(Math.sqrt),Number],log:[P(Math.log),Number],log10:[P(Math.log10),Number],log2:[P(Math.log2),Number],random:[function(e,t){var n,t=t?(n=A(e,t),O(e,t)):(n=0,e);return t+=1,~~(r.random()*(t-n))+n},[parseInt,t.TypeSignature.optional(parseInt)]],"":function(){for(var e in this)e&&hasOwnProperty.call(this,e)&&t.add(e,"Number",function(a){return function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a.apply(void 0,n)}}(this[e][0]),this[e][1])}})[""](),t.add("either","Any",function(e){var t=1+~~(r.random()*(arguments.length<=1?0:arguments.length-1));return t<1||arguments.length<=t?void 0:arguments[t]},n(e))("nth","Any",function(e,t){return t<=0?f.create("datatype","(nth:)'s first value should be a positive whole number, not "+t):(t=(t-1)%(arguments.length<=2?0:arguments.length-2)+2)<2||arguments.length<=t?void 0:arguments[t]},[parseInt,n(e)])}),!function(){var a,k={};function o(e){for(var t in e)this[t]=e[t]}function i(e,t){for(var n,r,a=e.innerText,o=null,i=0,s=i,c=a.length,l=null;i<c;){for(var u=a.slice(i),p=(o&&o.length?o[0]:e).innerMode,d=0,f=p.length;d<f;d+=1){var h=k[p[d]];if(!(h.constraint&&!h.constraint(l)||h.cannotFollowText&&("text"===(null==(w=l)?void 0:w.type)||s<i))&&(h.plainCompare?u.startsWith(h.pattern):h.pattern.test(u))){var m=h.fn(h.plainCompare?h.pattern:h.pattern.exec(u)),g=!1,y=0;if(m.matches){for(;o&&y<o.length;y+=1){var v=o[y],b=v.type,v=v.aka;if(b in m.matches){g=!0;break}v&&(b=v),-1<(null==(v=m.cannotCross)?void 0:v.indexOf(b))&&(y=o.length-1)}if((!o||y>=o.length)&&!m.isFront)continue}s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:p});var s=i+=(l=e.addChild(m)).text.length,w=!1;g&&(t&&T(e,l,o[y]),o=o.slice(y+1),w=!0),!w&&l.isFront&&(o?o.unshift(l):o=[l]);break}}d===f&&(i+=1,null===l&&(l={type:"text"}))}for(s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:(null!=(n=o)&&n.length?o[0]:e).innerMode});0<(null==(r=o)?void 0:r.length);)o.shift().demote();return e}function T(e,t,n){var r=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,r-(a+1)),t.type=t.matches[n.type],t.innerText="";for(var o,i=0,s=t.children.length;i<s;i++)t.innerText+=t.children[i].text;for(o in t.start=n.start,t.text=n.text+t.innerText+t.text,n)hasOwnProperty.call(n,o)&&!hasOwnProperty.call(t,o)&&(t[o]=n[o]);t.isFront&&(t.isFront=!1),e.children.splice(a,1)}o.prototype={constructor:o,addChild:function(e){var t=this.lastChildEnd(),n=new o(e);return n.start=t,n.end=e.text&&t+e.text.length,n.place=this.place,n.children=[],n.innerText&&i(n),this.children.push(n),n},lastChildEnd:function(){var e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(var t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){var r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(n){return n<this.start||n>=this.end?null:this.children?this.children.reduce(function(e,t){return e||(n>=t.start&&n<t.end?t:null)},null):this},everyLeaf:function(n){return this.children&&0!==this.children.length?this.children.reduce(function(e,t){return e&&t.everyLeaf(n)},!0):!!n(this)},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&0<this.children.length&&(e+="["+this.children+"]"),e},copy:function(){var e=new o(this);return e.children=e.children.slice(),e},foldChildren:function(){for(var e=[],t=this.children.slice(),n=0;n<t.length;n+=1){var r=t[n],a=!1;if(r.matches)for(var o=0;o<e.length;o+=1)e[o].type in r.matches&&(T(this,r,e[o]),e=e.slice(o+1),a=!0);!a&&r.isFront&&e.unshift(r)}}},a={lex:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"start",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return i(new o({type:"root",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:a.modes[n]}),!r)},rules:k,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=a:"function"==typeof define&&define.amd?define("lexer",[],function(){return a}):this&&null!=this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=a):this.Lexer=a}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var m,g=Object.keys,y=Object.assign;function t(e){function t(n){return n=n||"innerText",function(e){var e=e.reduceRight(function(e,t,n){return e||(n?t:"")},""),t={};return t[n]=e,t}}function n(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var r=Object.bind(0,null);function a(a,e){return Object.keys(e).forEach(function(n){var r=e[n].fn;e[n].fn=function(e){var t=r(e);return t.text||(t.text="string"==typeof e?e:e[0]),t.type||(t.type=n),t.innerMode||(t.innerMode=a),t}}),e}function o(e){switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1}var i=[],s=[],c=[],l=a(i,{hr:{fn:r},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t,e=e[1],n=e.indexOf("><");return~n?25===(t=Math.round(n/(e.length-2)*50))&&(t="center"):"<"===e[0]&&">"===e.slice(-1)?t="justify":-1<e.indexOf(">")?t="right":-1<e.indexOf("<")&&(t="left"),{align:t}}},column:{fn:function(e){var t,e=e[1],n=e.indexOf("|");return n&&n<e.length-1?t="center":"|"===e[0]&&"|"===e.slice(-1)?t="none":n===e.length-1?t="right":n||(t="left"),{column:t,width:/\|+/.exec(e)[0].length,marginLeft:/^=*/.exec(e)[0].length,marginRight:/=*$/.exec(e)[0].length}}}}),u=(g(l).forEach(function(e){l[e].constraint=o,l[e].cannotFollowText=!0}),a(i,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:n("boldOpener","bold")},italicOpener:{fn:n("italicOpener","italic")},strikeOpener:{fn:n("strikeOpener","strike")},supOpener:{fn:n("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:r},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var e=e[0].length,t={};return{type:(t["verbatim"+e]="verbatim")+e,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:r},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:i}}},br:{fn:r}})),p=y(a(s,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",e=e[3]||"";return{type:"twineLink",innerText:n?e:t,passage:t?e:n,innerMode:i}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:i}}},variable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")},tempVariable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),d=a(s,y({commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},macroName:{constraint:function(e){return e&&"macroFront"===e.type},fn:t("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:t("name"),constraint:function(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t("name")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t("name")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t("name")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:c}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:c}}},hookName:{fn:t("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollowText:!0,fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollowText:!0,fn:function(e){var e=e[0].toLowerCase(),t={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"},t=hasOwnProperty.call(t,e)?"#"+t[e]:e;return{colour:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:-1<e[1].indexOf("not")}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:t("name"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:r,cannotFollowText:!0},e},{}),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:r},e},{}))),f=a(c,{singleStringCloser:d.singleStringOpener,doubleStringCloser:d.doubleStringOpener,escapedStringChar:d.escapedStringChar}),h=(i.push.apply(i,_toConsumableArray(g(l)).concat(_toConsumableArray(g(p)),_toConsumableArray(g(u)))),s.push.apply(s,_toConsumableArray(g(p)).concat(_toConsumableArray(g(d)))),c.push.apply(c,_toConsumableArray(g(f))),y({},l,u,p,d,f)),u=(g(h).forEach(function(e){m.PlainCompare[e]?(h[e].pattern=m.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp("^(?:"+m[e]+")","i")}),y(e.rules,h),e.modes);return u.start=u.markup=i,u.macro=s,u.string=c,e}function n(e){return Object.freeze({lex:t(e).lex,Patterns:m})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(m=require("./patterns"),module.exports=n(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(e,t){return m=t,n(e)}):this&&this.loaded&&this.modules?(m=this.modules.Patterns,this.modules.Markup=n(this.modules.Lexer)):(m=this.Patterns,this.Markup=n(this.Lexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){var e;function n(t){return t&&"object"===_typeof(t)?(Object.keys(t).forEach(function(e){t[e]=n(t[e])}),t):(t+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function t(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=t("?:"),a=t("?!"),o=t("?="),i="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=i.replace("*","+"),c="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",u=l.replace("\\-",""),p=r("\\n","$"),d=i+"(\\*+)"+s,f=i+"((?:0\\.)+)"+s,h=i+"-{3,}"+i+p,m=i+"(==+>|<=+|=+><=+|<==+>)"+i+p,p=i+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+i+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(n).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+a("\\]"))+"+)"},y=u+"*"+u.replace("\\w","a-zA-Z")+u+"*",v="\\$("+y+")",b="_("+y+")",w="'s"+s+"("+y+")",k="("+y+")"+s+"of"+c+a("it\\b"),T="'s"+s,S=r("it","time","turns?","visits?","exits?","pos")+c,x="its"+s+"("+y+")",_="("+y+")"+s+"of"+s+"it"+c,O="of"+s+"it"+c,A={opener:"\\(",name:"("+r("\\$","_")+"?"+l+"+):"+a("\\/"),closer:"\\)"},E=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),C="[a-zA-Z][\\w\\-]*",N="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",P="\\|("+l+"+)(>|\\))",j="(<|\\()("+l+"+)\\|",R="((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)"+a("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:u,whitespace:s.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:"<\\/?"+C+N+">",scriptStyleTag:"<("+r("script","style","textarea")+")"+N+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:m,column:p,bulleted:d,numbered:f,verbatimOpener:"`+",hookAppendedFront:"\\["+a("=+"),hookPrependedFront:P+"\\["+a("=+"),hookFront:"\\["+a("=+"),hookBack:"\\]"+a(j),hookAppendedBack:"\\]"+j,unclosedHook:"\\[=+",unclosedHookPrepended:P+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+o(A.name),macroName:A.name,groupingFront:"\\("+a(A.name),twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:T,belongingOperator:"of\\b",itsOperator:"its\\b",belongingItOperator:O,variable:v,tempVariable:b,hookName:"\\?("+l+"+)\\b",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+a("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:R,boolean:r("true","false")+c,identifier:S,itsProperty:x,belongingItProperty:_,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+a(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+a(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+i+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:n("+")+a("="),subtraction:n("-")+a("=","type"),multiplication:n("*")+a("="),division:r("/","%")+a("="),spread:"\\.\\.\\."+a("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:n("-type")+c,incorrectOperator:E,PlainCompare:{comma:",",commentFront:"\x3c!--",commentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),define("twinescript/operations",["utils","utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,m){var a=e.plural,o=t.isObject,i=t.collectionType,s=t.is,c=t.isA,l=t.clone,u=t.unique,p=t.contains,e=t.matches,g=t.objectName,d=t.toSource;function f(r,a,o,i){return o=o||"do this to",function(e,t){var n;return 1===a.length&&(t=e),(n=m.containsError(e,t))?n:_typeof(e)!==r||_typeof(t)!==r?m.create("operation","I can only ".concat(o," ").concat(r,"s, not ").concat(g(_typeof(e)!==r?e:t),"."),i):a(e,t)}}function h(a){return function(e,t){var n,r;return(n=m.containsError(e,t))?n:_typeof(e)!==_typeof(t)||o(e)&&"TwineScript_TypeName"in e&&o(t)&&"TwineScript_TypeName"in t&&e.TwineScript_TypeName!==t.TwineScript_TypeName||i(e)!==i(t)?(n="".concat(g(e)," isn't the same type of data as ").concat(g(t)),_typeof(e)+_typeof(t)!=="stringnumber"&&_typeof(e)+_typeof(t)!=="numberstring"||(r="You might want to convert one side to a number using (num:), or to a string using (str:)."),m.create("operation",n[0].toUpperCase()+n.slice(1),r)):a(e,t)}}function y(d,f,e){var h=2<arguments.length&&void 0!==e&&e;return function r(a,o){var e;if(e=m.containsError(a,o))return e;var t=_slicedToArray(a.determiner?[a,o]:o.determiner?[o,a]:[],2),i=t[0],t=t[1];if(i){var n=i,s=n.determiner,n=n.determined;if("start"===s||"end"===s){if(f)return m.create("operation","I can't use '".concat(f,"' with the 'start' or 'end' of ").concat(g(n),"."));if(t.determiner){if("start"===t.determiner||"end"===t.determiner)return m.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");n=[t,i],i=n[0],t=n[1]}for(var c=i.string||i.array,l=0;l<c.length+1;l+=1){var u=l?"end"===s?c.slice(-l):c.slice(0,l):c.constructor(),u=i===a?r(u,o):r(a,u);if(e=m.containsError(u))return e;if(u!==h)return u}return h}var p="all"===s;return i.array.reduce(function(e,t){var n,t=i===a?r(t,o):r(a,t);return(n=m.containsError(e,t))?n:p?e&&t:e||t},p)}return d(a,o)}}function v(n,e){return y(function(e,t){e=n(e,t);return m.containsError(e)?e:!e},e,!0)}t="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.",t={and:f("boolean",h(function(e,t){return e&&t}),"use 'and' to join",t),or:f("boolean",h(function(e,t){return e||t}),"use 'or' to join",t),not:f("boolean",function(e){return!e},"use 'not' to invert",t),"+":h(function(e,t){return Array.isArray(e)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(u).map(l)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(_typeof(e))?e+t:m.create("operation","I can't use + on ".concat(g(e),"."));var n}),"-":h(function(e,n){return Array.isArray(e)?e.filter(function(t){return!n.some(function(e){return s(t,e)})}):e instanceof Set?(r=_toConsumableArray(n),new Set(_toConsumableArray(e).filter(function(t){return!r.some(function(e){return s(t,e)})}))):"string"==typeof e?e.split(n).join(""):"number"==typeof e?e-n:m.create("operation","I can't use - on ".concat(g(e),"."));var r}),"*":f("number",h(function(e,t){return e*t}),"multiply"),"/":f("number",h(function(e,t){return 0===t?m.create("operation","I can't divide ".concat(g(e)," by zero.")):e/t}),"divide"),"%":f("number",h(function(e,t){return 0===t?m.create("operation","I can't modulo ".concat(g(e)," by zero.")):e%t}),"modulus"),"<":y(f("number",h(function(e,t){return e<t}),"do < to"),"<"),">":y(f("number",h(function(e,t){return t<e}),"do > to"),">"),"<=":y(f("number",h(function(e,t){return e<=t}),"do <= to"),"<="),">=":y(f("number",h(function(e,t){return t<=e}),"do >= to"),">="),is:y(s),isNot:v(s),contains:y(p,"contains"),doesNotContain:v(p,"does not contain"),isIn:y(function(e,t){return p(t,e)},"is in"),isNotIn:v(function(e,t){return p(t,e)},"is not in"),isA:y(c,"is a"),isNotA:v(c,"is not a"),typifies:y(function(e,t){return c(t,e)}),untypifies:v(function(e,t){return c(t,e)}),matches:y(e),doesNotMatch:v(e),makeSpreader:function(e){return m.containsError(e)?e:n.isPrototypeOf(e)||r.isPrototypeOf(e)?(t=l(e),(n.isPrototypeOf(e)?t.datatype:t).rest=!0,t):{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:a("string"==typeof e||Array.isArray(e)?_toConsumableArray(e).length:1,"spreaded '...' value"),TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return""+_toConsumableArray(e).map(d)}};var t}};return Object.freeze(t)}),define("twinescript/runner",["macros","state","utils","utils/operationutils","twinescript/operations","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","datatypes/assignmentrequest","internaltypes/varref","internaltypes/twineerror"],function(Macros,State,_ref128,_ref129,Operations,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,AssignmentRequest,VarRef,TwineError){var insensitiveName=_ref128.insensitiveName,impossible=_ref128.impossible,hash=_ref128.hash,toSource=_ref129.toSource,typeName=_ref129.typeName,objectName=_ref129.objectName;function addFreeVariable(e,t){var n,r=e.freeVariables;"macro"===t.type?"current-time"===(n=insensitiveName(t.name))||"current-date"===n||"monthday"===n||"weekday"===n||"history"===n||"visited"===n||"passage"===n?e.freeVariables=!0:t.blockedValue&&!r.blockedValues?r.blockedValues=e.stackTop.blockedValues.concat():"random"!==n&&"either"!==n&&"shuffled"!==n||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"identifier"===t.type?"time"!==(n=insensitiveName(t.text))&&"exits"!==n&&"it"!==n&&"visits"!==n&&"turns"!==n||(e.freeVariables=!0):"property"===t.type||"belongingProperty"===t.type?"random"!==insensitiveName(t.name)||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"variable"!==t.type&&"tempVariable"!==t.type||(e.freeVariables=!0)}var precedenceTable=[["error","text"],["comma"],["to","into"],["where","when","via","making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink","macro","identifier","variable","tempVariable","hookName","number","cssTime","boolean","string","hook","colour","datatype","root"],["grouping"]];function precedentToken(e,t){var n,r,a,o=[];if(e.length)for("most"===t?(n=precedenceTable.length-1,r=a=-1):(n=0,r=precedenceTable.length,a=1);n!==r;n+=a){var i=precedenceTable[n],s=NaN;if(i.rightAssociative){for(var c=0;c<e.length;c+=1)if(i.rightAssociative.includes(e[c].type)){s=c;break}}else for(var l=e.length-1;0<=l;--l)if(i.includes(e[l].type)){s=l;break}if(!Number.isNaN(s)&&-1<s){o=[e[s],s];break}}return o}var comparisonOpTypes=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"],inequalityNegator={">":"<=","<":">=",">=":"<","<=":">"};function compileComparisonOperator(e){return"inequality"===e.type?e.negate?inequalityNegator[e.operator]:e.operator:e.type}var comparisonReverser={">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"};function reverseComparisonOperator(e){e=compileComparisonOperator(e);return comparisonReverser[e]||e}var tokenSides={error:"neither",identifier:"neither",variable:"neither",tempVariable:"neither",hookName:"neither",number:"neither",boolean:"neither",string:"neither",hook:"neither",colour:"neither",datatype:"neither",root:"neither",twineLink:"neither",macro:"neither",grouping:"neither",itsProperty:"neither",belongingItProperty:"neither",to:"both",into:"both",typeSignature:"both",augmentedAssign:"both",and:"both",or:"both",belongingOperator:"both",possessiveOperator:"both",multiplication:"both",division:"both",spread:"after",bind:"after",not:"after",belongingProperty:"after",each:"after",itsOperator:"after",positive:"after",negative:"after",belongingItOperator:"before",property:"before"};function missingSideError(e,t,n){return TwineError.create("syntax","I need usable code to be ".concat(e?"left ":"").concat(e&&t?"and ":"").concat(t?"right ":"","of ").concat(n.text,"."))}function wrongSideError(e,t,n){return TwineError.create("syntax","There can't be a ".concat(e&&t?e.map(function(e){return e.text}).join("")+" or "+t.map(function(e){return e.text}).join(""):(e||t).map(function(e){return e.text}).join("")," to the ").concat(e?"left ":"").concat(e&&t?"or ":"").concat(t?"right ":"","of ").concat(n.text,"."),"There could be a comma missing between them.")}function makeEvalReplayFrame(e,t){var n=t.val,r=t.fromCode,a=t.toCode,o=t.toDesc,i=t.reason,s=t.it,c=t.tokens,t=t.i;if(!(200<=e.length)){var l=c[t],u=c.slice(0,t),t=c.slice(t+1);if(1===c.length&&(u=t=!1,l=c[0]),!e[e.length-1].error){var p,d,c=TwineError.containsError(n),f=e[e.length-1].code,h=e[0].basis,m=(null!=(p=u)&&p.length&&null!=(p=t)&&p.length&&u[0].start>t[0].start&&(u=(p=[t,u])[0],t=p[1]),p=a||"".concat(null!=(p=u)&&p.length&&"whitespace"===u[u.length-1].type?" ":"").concat(c?" \ud83d\udc1e ":(n&&!n.TwineScript_ToSource&&n.TwineScript_Unstorable?objectName:toSource)(n)).concat(null==(p=t)||!p.length||"whitespace"!==t[0].type&&"addition"!==l.type&&"subtraction"!==l.type?"":" "),(u.length?u[0]:l).start-h),g=(t.length?t[t.length-1]:l).end-h,y=_createForOfIteratorHelper(e);try{for(y.s();!(d=y.n()).done;){var v=d.value;v.start<m?(m+=v.diff,g+=v.diff):v.start<g&&(g+=v.diff)}}catch(e){y.e(e)}finally{y.f()}!r&&(r=f.slice(m,g),a&&a.trim()===r.trim())||(u=p.length-(g-m),e.push({code:f.slice(0,m)+p+f.slice(g),fromCode:r,toCode:!c&&a,toDesc:!c&&!a&&(o||objectName(n)),start:m,end:g,diff:u,reason:i,itIdentifier:void 0!==s&&objectName(s),error:c&&c.render(f.slice(m,g),!0)}))}}}function setIt(e,t){return(VarRef.isPrototypeOf(t)||TypedVar.isPrototypeOf(t))&&(e.Identifiers.it=t.get()),t}return function run(section,tokens){var isVarRef=2<arguments.length&&void 0!==arguments[2]&&arguments[2],isTypedVar=3<arguments.length&&void 0!==arguments[3]&&arguments[3],evalReplay=section.evalReplay,hasEvalReplay=null==evalReplay?void 0:evalReplay.length,evalReplayReason,evalReplaySkip=!1,evalReplayIt,ops=Operations,token,ret,i,before,after,_precedentToken,_precedentToken2,token,i,before,after;if(Array.isArray(tokens)||(tokens=[tokens]),!tokens.length||!tokens[0])return impossible("Runner.run","No tokens to run!"),0;1===tokens.length?token=tokens[0]:(_precedentToken=precedentToken(tokens,"least"),_precedentToken2=_slicedToArray(_precedentToken,2),token=_precedentToken2[0],i=_precedentToken2[1],before=tokens.slice(0,i),after=tokens.slice(i+1),before.length&&(1!==before.length||"whitespace"!==before[0].type)||(before=!1),after.length&&(1!==after.length||"whitespace"!==after[0].type)||(after=!1));var type=token.type;if(!type)return impossible("Runner.run","Token has no type!"),0;var sides=tokenSides[type]||"",VARREF=("both"!==sides||before&&after?"neither"===sides&&(before||after)?ret=wrongSideError(before,after,token):"before"===sides?before?after&&(ret=wrongSideError(null,after,token)):ret=missingSideError(!0,!1,token):"after"===sides&&(after?before&&(ret=wrongSideError(before,null,token)):ret=missingSideError(!1,!0,token)):ret=missingSideError(!before,!after,token),section.freeVariables&&"object"===_typeof(section.freeVariables)&&addFreeVariable(section,token),!0),TYPEDVAR=!0,_ret4,val,evalReplayReason,ret,source,_source4,_value4,msg;if(!ret){if("comma"===type)return impossible("Section.run","a comma token was run() somehow."),0;if("root"===type)ret=run(section,token.children);else if("identifier"===type)ret=isVarRef?VarRef.create(section.Identifiers,token.text.toLowerCase()):section.Identifiers[token.text.toLowerCase()];else if("variable"===type||"tempVariable"===type){ret=VarRef.create("tempVariable"===type?section.stackTop.tempVariables:State.variables,token.name),isTypedVar?(ret=TypedVar.create(Datatype.create("any"),ret),evalReplayReason=hasEvalReplay&&"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value."):isVarRef||TwineError.containsError(ret)?evalReplaySkip=!0:(val=ret.get(),evalReplayReason=hasEvalReplay&&((null==(_ret4=ret)?void 0:_ret4.object)!==State.variables||hasOwnProperty.call(ret.object,ret.compiledPropertyChain[0])?"":"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist."),ret=val)}else if("hookName"===type)ret=HookSet.create({type:"name",data:token.name}),evalReplaySkip=!0;else if("number"===type||"cssTime"===type)ret=token.value,evalReplayReason=hasEvalReplay&&"cssTime"===type&&(token.text.endsWith("ms")?"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.":"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000)."),evalReplaySkip=!evalReplayReason;else if("boolean"===type)ret="true"===token.text.toLowerCase(),evalReplaySkip=!0;else if("string"===type){var t=token.text.replace(/(.?)\n/g,function(e,t){return("\\"===t?"\\\\":"\n"===t?"\\n":t)+"\\n"}).replace(/(\\*)\\0/g,function(e,t){return(t?"\\".repeat(2*t.length):"")+"0"});ret=eval(t),evalReplaySkip=!0}else if("hook"===type)ret=CodeHook.create(token.children,token.text),evalReplaySkip=!0;else if("colour"===type)ret=Colour.create(token.colour),evalReplaySkip=!0;else if("datatype"===type)ret=Datatype.create(token.name),evalReplaySkip=!0;else if("spread"===type)ret=ops.makeSpreader(run(section,after,!1,isTypedVar));else if("bind"===type)ret=VarBind.create(run(section,after,VARREF),token.text.startsWith("2")?"two way":""),evalReplaySkip=!0;else if("to"===type||"into"===type){var dest="to"===type?setIt(section,run(section,before,VARREF,TYPEDVAR)):run(section,after,VARREF,TYPEDVAR);if(TwineError.containsError(dest))ret=dest;else{(VarRef.isPrototypeOf(dest)&&dest.propertyChain.length<=1||TypedVar.isPrototypeOf(dest)&&dest.varRef.propertyChain.length<=1)&&(section.freeVariables=Object.create(null));var src="to"===type?run(section,after,VARREF):setIt(section,run(section,before,VARREF));if(TwineError.containsError(src))return src;var freeVariables=section.freeVariables,srcRef;section.freeVariables=null,token.place&&freeVariables&&"object"===_typeof(freeVariables)&&"boolean"!=typeof src&&"number"!=typeof src&&(srcRef=freeVariables,srcRef.at=token.place,srcRef.from=after[0].start,srcRef.to=after[after.length-1].end,srcRef.hash=hash(after.reduce(function(e,t){return e+t.text},"")).toString(16),JSON.stringify(srcRef).length>=toSource(src).length&&(srcRef=void 0)),ret=AssignmentRequest.create(dest,src,type,srcRef),evalReplaySkip=!0,evalReplayIt=section.Identifiers.it}}else if("typeSignature"===type){var datatype=run(section,before),free=section.freeVariables,variable=(section.freeVariables=null,run(section,after,VARREF));section.freeVariables=free,ret=TypedVar.create(datatype,variable),evalReplaySkip=!0}else if("where"===type||"when"===type||"via"===type){after?(source=tokens.map(function(e){return e.text}).join(""),ret=Lambda.create(before?run(section,before,VARREF):void 0,token.type,after,source),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("making"===type||"each"===type){after?(_source4=[].concat(tokens).map(function(e){return e.text}).join(""),ret="each"===type?Lambda.create(run(section,after,VARREF),"each",null,_source4):Lambda.create(before?run(section,before,VARREF):void 0,token.type,run(section,after,VARREF),_source4),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("augmentedAssign"===type)ret=ops.makeAssignmentRequest(run(section,before,VARREF),ops[token.operator](run(section,before),run(section,after)),token.operator),evalReplaySkip=!0;else if("and"===type||"or"===type){var isComparisonOp=function e(t){var n=_slicedToArray(precedentToken(t,"least"),2),r=n[0],n=n[1];if(r&&"whitespace"!==r.type)return comparisonOpTypes.includes(r.type)?r:r.type===type?e(t.slice(0,n))||e(t.slice(n+1)):void 0},leftIsComparison=isComparisonOp(before),rightIsComparison=isComparisonOp(after),ambiguityError=TwineError.create("operation",'This use of "is not" and "'.concat(type,'" is grammatically ambiguous.'),'Maybe try rewriting this as "__ is not __ '.concat(type,' __ is not __"')),operator,getElisionOperands=function e(t){var n=_slicedToArray(precedentToken(t,"least"),2),r=n[0],n=n[1];if(!r||"whitespace"===r.type)return[];if(r.type===type)return[].concat(_toConsumableArray(e(t.slice(0,n))),_toConsumableArray(e(t.slice(n+1))));var a,r=run(section,t);return hasEvalReplay&&"boolean"!=typeof r&&(a=operator.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),makeEvalReplayFrame(evalReplay,{toCode:" it ".concat(a," ").concat(toSource(r)," "),reason:"A missing 'it ".concat(a,"' was inferred to correct the '").concat(type,"' operation."),tokens:t,i:n}),makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it)," ").concat(a," ").concat(toSource(r)," "),tokens:t,i:n})),[{val:r,tokens:t,i:n}]},elidedComparisonOperator=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){var n=t.val,r=t.tokens,t=t.i;if("boolean"==typeof n)return n;e=Operations[token.type](e,Operations[operator](section.Identifiers.it,n));return hasEvalReplay&&makeEvalReplayFrame(evalReplay,{val:e,tokens:r,i:t}),e},"and"===token.type)},leftSide,evalBefore,operator,rightSide,rightIndex,swappedSides,evalAfter;ret=leftIsComparison&&!rightIsComparison?(leftSide=leftIsComparison,operator=compileComparisonOperator(leftSide),"isNot"===leftSide.type||"isNotA"===leftSide.type||"untypifies"===leftSide.type?ambiguityError:(evalBefore=run(section,before),ops[type](evalBefore,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(after)))))):!leftIsComparison&&rightIsComparison?(rightSide=rightIsComparison,rightIndex=tokens.indexOf(rightSide),operator=reverseComparisonOperator(rightSide),"isNot"===rightSide.type||"isNotA"===rightSide.type||"untypifies"===rightSide.type?ambiguityError:(swappedSides=[].concat(_toConsumableArray(tokens.slice(rightIndex+1)),[Object.assign(Object.create(rightSide),_defineProperty({},"inequality"===rightSide.type?"operator":"type",reverseComparisonOperator(rightSide)))],_toConsumableArray(tokens.slice(i+1,rightIndex))),evalAfter=run(section,swappedSides),ops[type](evalAfter,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(before)))))):ops[type](run(section,before),run(section,after))}else if(comparisonOpTypes.includes(type)){after||missingSideError(!1,!0,token);var leftOp=before?run(section,before):section.Identifiers.it;ret=ops[compileComparisonOperator(token)](leftOp,run(section,after)),section.Identifiers.it=leftOp,evalReplayIt=leftOp,evalReplayReason=hasEvalReplay&&!before&&"A missing 'it' was inferred to complete the operation."}else if("addition"===type||"subtraction"===type){after||missingSideError(!1,!0,token);var convert=!before,_precedentToken7,_precedentToken8,previousPrecedentToken,_i42,_sides,pType,convert;before&&(_precedentToken7=precedentToken(before,"least"),_precedentToken8=_slicedToArray(_precedentToken7,2),previousPrecedentToken=_precedentToken8[0],_i42=_precedentToken8[1],_sides=tokenSides[previousPrecedentToken.type],pType=previousPrecedentToken.type,convert=("both"===_sides||"after"===_sides||"addition"===pType||"subtraction"===pType)&&(_i42===before.length-1||_i42===before.length-2&&"whitespace"===before[before.length-1].type)),convert?(token.type="addition"===type?"positive":"negative",ret=run(section,tokens),token.type=type,evalReplaySkip=!0):ret=ops[token.text](run(section,before),run(section,after))}else if("multiplication"===type||"division"===type)ret=ops[token.text](run(section,before),run(section,after));else if("positive"===type||"negative"===type)ret=ops["*"]("negative"===type?-1:1,run(section,after)),evalReplaySkip=!0;else if("not"===type)ret=ops.not(run(section,after));else if("belongingProperty"===type){var container=run(section,after,isVarRef),isRef=(ret=VarRef.create(container,token.name),isVarRef||TwineError.containsError(ret));ret=isRef?ret:ret.get(),isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&!isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(token.name," of ").concat(toSource(VarRef.isPrototypeOf(container)?container.get():container)," "),tokens:tokens,i:i}):isRef||(evalReplayReason="The value to the right of 'of', ".concat(typeName(container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("belongingOperator"===type||"belongingItOperator"===type){var value=run(section,before);"random"===value&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("belongingItOperator"===type?section.Identifiers.it:run(section,after,isVarRef),{computed:!0,value:value}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"belongingItOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(value)," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i})}else if("property"===type){var _container=run(section,before,VARREF),_isRef=(ret=VarRef.create(_container,token.name),isVarRef||TwineError.containsError(ret));ret=_isRef?ret:ret.get(),_isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&VarRef.isPrototypeOf(_container)&&!_isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(_container.get()),"'s ").concat(token.name," "),tokens:tokens,i:i}):_isRef||(evalReplayReason="The value to the left of 's, ".concat(typeName(_container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("itsProperty"===type||"belongingItProperty"===type)ret=VarRef.create(section.Identifiers.it,token.name),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:"itsProperty"===type?" ".concat(toSource(section.Identifiers.it),"'s ").concat(token.name," "):" ".concat(token.name," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i});else if("possessiveOperator"===type||"itsOperator"===type){!after||!before&&"itsOperator"!==token.type?ret=missingSideError(!before,!after,token):(_value4=run(section,after),"random"===_value4&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("itsOperator"===token.type?section.Identifiers.it:run(section,before,isVarRef),{computed:!0,value:_value4}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"itsOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it),"'s ").concat(toSource(_value4)," "),tokens:tokens,i:i}))}else if("twineLink"===type)ret=Macros.run("link-goto",section,[token.innerText,token.passage]),evalReplayReason=hasEvalReplay&&"Passage links are the same as (link-goto:) macro calls.";else if("macro"===type)if(token.blockedValue&&!section.blocked){if(ret=section.blockedValue(),void 0===ret)return impossible("Runner.run","section.blockedValue() returned undefined"),0}else{var macroNameToken=token.children[0],variableCall="$"===macroNameToken.text[0]||"_"===macroNameToken.text[0],macroRef;if("macroName"!==macroNameToken.type&&!variableCall)return impossible("Runner.run","macro token had no macroName child token"),0;variableCall?(macroRef=VarRef.create("_"===macroNameToken.text[0]?section.stackTop.tempVariables:State.variables,macroNameToken.text.trim().slice(1,-1)),TwineError.containsError(macroRef)||(macroRef=macroRef.get())):macroRef=token.name,ret=Macros[variableCall?"runCustom":"run"](macroRef,section,token.children.slice(1).reduce(function(e,t){return"comma"===t.type?e.push([]):e[e.length-1].push(t),e},[[]]).filter(function(e){return e.length&&(1<e.length||"whitespace"!==e[0].type)}).map(function(e){return run(section,e,!1,isTypedVar)})),evalReplayReason=hasEvalReplay&&variableCall&&"I called ".concat(objectName(macroRef),".")}else if("grouping"===type)ret=run(section,token.children,isVarRef),evalReplaySkip=!0;else if("error"===type)ret=TwineError.create("syntax",token.message,token.explanation||"");else{if("text"!==type)return impossible("Section.run","unknown syntax token type: ".concat(type,"!!")),0;token.text.trim().match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(msg='Position data names like "'.concat(token.text,'" need to be either left of "of" or right of "\'s".')),ret=TwineError.create("syntax",msg||'"'.concat(token.text,"\" isn't valid Harlowe syntax for the inside of a macro call."),"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.")}}return void 0===ret?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced undefined")),0):ret===section?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced the section")),0):(hasEvalReplay&&!evalReplaySkip&&makeEvalReplayFrame(evalReplay,{val:ret,reason:evalReplayReason,it:evalReplayIt,tokens:tokens,i:i}),ret)}}),define("utils/jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return(null==e?void 0:e.nodeType)===Node.TEXT_NODE&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){var t=this.find(e),e=this.filter(e);return e.length?t.add(e):t}})}),define("utils/naturalsort",[],function(){return function(h){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:String;return function(e,t){var n,r,a,o,i=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,l=/^0/,e=m(e).trim(),t=m(t).trim(),u=e.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=t.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),i=parseInt(e.match(c))||1!==u.length&&e.match(s)&&Date.parse(e),e=parseInt(t.match(c))||i&&t.match(s)&&Date.parse(t)||null;if(h&&window.Intl&&window.Intl.Collator&&(a=window.Intl.Collator(h)),e){if(i<e)return-1;if(e<i)return 1}for(var d=0,f=Math.max(u.length,p.length);d<f;d++){if(n=!(u[d]||"").match(l)&&parseFloat(u[d])||u[d]||0,r=!(p[d]||"").match(l)&&parseFloat(p[d])||p[d]||0,isNaN(n)!==isNaN(r))return isNaN(n)?1:-1;if(_typeof(n)!==_typeof(r))n+="",r+="";else if("string"==typeof n&&a&&0!==(o=a.compare(n,r)))return o;if(n<r)return-1;if(r<n)return 1}return 0}}}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(f,e,h,t){var m=e.impossible,g=e.nth,u=e.permutations,s=e.plural,y=t.validPropertyName,r="object",n="boolean",v="string",b="number",w="function";function a(e){return!!e&&(_typeof(e)===r||_typeof(e)===w)}var k=Array.isArray;function T(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function o(e){return k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":_typeof(e)===v?v:e&&_typeof(e)===r?r:""}function i(e){if(a(e)){if(_typeof(e.TwineScript_Clone)===w)return e.TwineScript_Clone();if(k(e))return _toConsumableArray(e);if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_typeof(e)===w)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}m("OperationUtils.clone","The value "+e+" cannot be cloned!")}return e}function c(e,t,n,r){for(var a="",o=0;a.length<=t&&o<e.length;){var i=r(e[o]);if(!(i.length+a.length<=t)){a+=(0<o?" and ":"")+s(e.length-o,(0<o?"other ":"")+n);break}a+=(0<o&&o===e.length-1?" and ":"")+i+(o<e.length-1?", ":""),o+=1}return a}function l(e){if(a(e)&&"TwineScript_ObjectName"in e)return e.TwineScript_ObjectName;if(k(e))return 0===e.length?"an empty array":"an array (with "+c(e,48,"item",l)+")";if(e instanceof Map)return 0===e.size?"an empty datamap":"a datamap (with "+c(_toConsumableArray(e.keys()),48,"dataname",x)+")";if(e instanceof Set)return 0===e.size?"an empty dataset":"a dataset (with "+c(_toConsumableArray(e.values()),48,"item",l)+")";if(_typeof(e)!==v)return _typeof(e)===n?"the boolean value '"+e+"'":_typeof(e)===b?"the number "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is";if(0===e.length)return"an empty string";var t=_toConsumableArray(e);return 48<t.length?"a ".concat(t.length,"-character string starting with ").concat(JSON.stringify(t.slice(0,48).join(""))):"the string ".concat(JSON.stringify(e))}function S(e,t){return[e[0],t[0]].sort(f("en"))[0]===e[0]?-1:1}function x(e,t){var n=h.containsError(e);if(n&&m("toSource","received a TwineError: "+n.message),_typeof(e.TwineScript_ToSource)===w)return e.TwineScript_ToSource();if(T(e)&&"first"in e&&"last"in e)return(e.first<0?(-1!==e.first?g(-e.first):"")+"last":g(e.first+1))+"to"+(e.last<0?(-1!==e.last?g(-e.last):"")+"last":g(e.last+1));if(k(e)){var r,a="",o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;)var i=r.value,a=(a+=a?",":"(a:")+("property"===t?i+(0<i):x(i))}catch(e){o.e(e)}finally{o.f()}return a+(a?")":"(a:)")}if(e instanceof Map){var s,c="",l=_createForOfIteratorHelper(Array.from(e.entries()).sort(S));try{for(l.s();!(s=l.n()).done;){var u=_slicedToArray(s.value,2),p=u[0],d=u[1];c+=(c?",":"(dm:")+x(p)+","+x(d)}}catch(e){l.e(e)}finally{l.f()}return c+(c?")":"(dm:)")}return e instanceof Set?"(ds:"+Array.from(e).sort(f("en")).map(x)+")":_typeof(e)===b&&"property"===t?e<0?-1===e?"last":g(-e)+"last":g(e+1):_typeof(e)===v&&"property"===t?RegExp(y).test(e)?e:"("+JSON.stringify(e)+")":JSON.stringify(e)}function p(t,n){return _typeof(t)!==r&&_typeof(n)!==r?t===n:k(t)&&k(n)?t.length===n.length&&t.every(function(e,t){return p(n[t],e)}):t instanceof Map&&n instanceof Map?p(Array.from(t.entries()).sort(),Array.from(n.entries()).sort()):t instanceof Set&&n instanceof Set?p(_toConsumableArray(t),_toConsumableArray(n)):t&&_typeof(t.TwineScript_is)===w?t.TwineScript_is(n):t&&_typeof(t)===r&&n&&_typeof(n)===r&&T(t)&&T(n)?p(Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]}),Object.getOwnPropertyNames(n).map(function(e){return[e,n[e]]})):Object.is(t,n)}return Object.freeze({isObject:a,isValidDatamapName:function(e,t){if(e instanceof Map||m("isValidDatamapName","called with non-Map"),h.containsError(t))return t;if(_typeof(t)!==v&&_typeof(t)!==b)return h.create("property","Only strings and numbers can be used as data names for "+l(e)+", not "+l(t)+".");var n=_typeof(t)===v?+t:""+t;return!(!Number.isNaN(n)&&e.has(n))||h.create("property","You mustn't use both "+l(t)+" and "+l(n)+" as data names in the same datamap.")},collectionType:o,isSequential:function(e){return _typeof(e)===v||k(e)||_typeof(e.hooks)===w},unstorableValue:function e(t){return(null==t?void 0:t.TwineScript_Unstorable)&&t||k(t)&&t.find(e)||t instanceof Map&&_toConsumableArray(t.values()).find(e)||t instanceof Set&&_toConsumableArray(t).find(e)},isHarloweJSValue:function e(t){return _typeof(t)===v||_typeof(t)===n||_typeof(t)===b&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(e)||t instanceof Set&&_toConsumableArray(t).every(e)||t instanceof Map&&_toConsumableArray(t.values()).every(e)&&_toConsumableArray(t.keys()).every(function(e){return _typeof(e)===v})},clone:i,objectName:l,typeName:function e(t){var n=T(t);if(n&&t.innerType)return t.typeName||("insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(k(t.innerType)||m("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType));if(n&&"range"===t.pattern){if(t.name)return t.name;var n=t.min,r=t.max;return"a"+(0<n?" positive":"")+(t.integer?" whole":"")+" number"+(0===n?" between 0 and "+r:r<1/0?" up to "+r:"")}return t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":a(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:l(t)},typeID:function(e){var t=_typeof(e);return[n,v,b].includes(t)?t:k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:x,is:p,contains:function(e,t){if(e||""===e){if(_typeof(e)===v)return _typeof(t)!==v?h.create("operation",l(e)+" can only contain strings, not "+l(t)+"."):e.includes(t);if(k(e))return e.some(function(e){return p(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return p(e,t)})}return h.create("operation",l(e)+" cannot contain any values, let alone "+l(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===w?t.TwineScript_IsTypeOf(e):h.create("operation",'"is a" should only be used to compare type names, not '+l(t)+".")},matches:function t(n,e){var r=!1;if(n&&_typeof(n.TwineScript_IsTypeOf)===w){var a=n.TwineScript_IsTypeOf(e);if(h.containsError(a))return a;r|=a}if(e&&_typeof(e.TwineScript_IsTypeOf)===w){if(a=e.TwineScript_IsTypeOf(n),h.containsError(a))return a;r|=a}if(r)return!0;if(k(n)&&k(e)){for(var o=0,i=0,s=!0;s&&o<n.length&&i<e.length;){var c=n[o],l=e[i];if(c.rest){for(;i<e.length&&t(c,l);)l=e[i+=1];o+=1}else if(l.rest){for(;o<n.length&&t(c,l);)c=n[o+=1];i+=1}else t(c,l)?(o+=1,i+=1):s=!1}return s&&o>=n.length&&i>=e.length}return n instanceof Map&&e instanceof Map?t(Array.from(n.entries()).sort(),Array.from(e.entries()).sort()):n instanceof Set&&e instanceof Set?(n=_toConsumableArray(n),u.apply(void 0,_toConsumableArray(e)).some(function(e){return t(n,e)})):p(n,e)},subset:function e(t,n,r){if(!n||!r)return h.create("macrocall","The sub"+o(t)+" index value must not be "+(n&&r)+".");var a=_typeof(t)===v;if(a&&(t=Array.from(t)),n<0&&(n=Math.max(0,t.length+n+1)),(r=r<0?Math.max(0,t.length+r+1):r)<n)return e(arguments[0],r,n);t=t.slice(0<n?n-1:n,r).map(i);return a?t.join(""):t},range:function e(t,n){if(n<t)return e(n,t);var r=[t];for(n-=t;0<n--;)r.push(++t);return r},printBuiltinValue:function r(e){return h.containsError(e)?e:e&&_typeof(e.TwineScript_Print)===w?e.TwineScript_Print():e instanceof Map?(e=Array.from(e.entries()),h.containsError(e)?e:e.reduce(function(e,t){var n=(t=_slicedToArray(t,2))[0],t=t[1];return e+"<tr><td>`"+r(n)+"`</td><td>`"+r(t)+"`</td></tr>"},"<table class=datamap>")+"</table>"):e instanceof Set?Array.from(e.values()).map(r)+"":k(e)?e.map(r)+"":e&&_typeof(e.jquery)===v?e:a(e)?h.create("unimplemented","I don't know how to print this value yet."):e+""},unique:function(t,e,n){return n.findIndex(function(e){return p(t,e)})===e}})}),define("utils/polyfills",[],function(){var o=Array.prototype;"function"!=typeof o.includes&&(o.includes=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(e)&&Number.isFinite(t)&&void 0!==e)return-1<o.indexOf.call(this,e,t);var n=Object(this),r=parseInt(n.length);if(!(r<=0))for(var a=0<=t?t:Math.max(0,r+t);a<r;){if(Object.is(e,n[a]))return!0;a+=1}return!1}),window.Symbol||(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils/renderutils",["jquery","utils","renderer"],function(l,u,p){var n=RegExp(u.realWhitespace+"+"),s=RegExp(u.realWhitespace+"+","g");function d(e,t,n){var r,a=e.textContent.length;if(!(a<=t))return r=[e=0===t?e:e.splitText(t)],n&&(n=n<=0?a-n:n)<a&&r.push(e.splitText(n-t)),r}var t,c=function(){if(void 0!==t)return t;var e=l("<p>");return t=!!e[0].normalize&&(e.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),1===e.contents().length)};var f="tw-collapsed,[collapsing=true]";var o=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var e,t=(c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).section,n=void 0===(n=c.parent)?u.storyElement:n,r=c.cd,a=void 0===(a=c.message)?"":a,o=c.defaultValue,i=void 0===(c=c.buttons)?[{name:"OK",confirm:!0,callback:Object}]:c,s=("a code hook"===a.TwineScript_TypeName&&(a=a.code),l("<tw-backdrop><tw-dialog>"+(o||""===o?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(i.length?i.reduce(function(e,t,n){t=t.name;return e+"<tw-link style='margin:0 "+(n===i.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+t+"</tw-link>"},""):"<tw-link tabindex=0>"+i[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>")),c=s.find("tw-dialog");return n.append(s),t?(t.renderInto(a,c,Object.assign({},r,{append:"prepend"})),null!=(n=(null==r?void 0:r.transition)&&s.find("tw-dialog > tw-transition-container"))&&n.length&&n.appendTo(s).append(c.prepend(n.contents().detach()))):c.prepend(p.exec(a)),o&&((e=s.find("input").last()).val(o).on("keypress",function(e){13===e.which&&(s.remove(),i.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return e.focus()},100)),i.reverse().forEach(function(e,t){l(s.find("tw-link").get(-t-1)).on("click",function(){u.options.debug&&u.options.ignoreClickEvents&&!l(s).is(".eval-replay, .harlowe-crash")||(s.remove(),e.callback())})}),s},realWhitespace:n,textNodeToChars:function(r){var e=_toConsumableArray(r.textContent);return 1===e.length?[r]:e.reduce(function(e,t){return t.match(n)&&e.length&&e[e.length-1].match(n)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(e,t){var n=r;return t.length<r.textContent.length&&(r=r.splitText(t.length)),e.concat(n)},[])},findTextInNodes:function e(t,n){var r=[],a="",o=[];if(!t.length||!n)return o;for(;0<t.length;){r.push(t[0]),a+=t[0].textContent,t.shift();var i=a.indexOf(n);if(-1<i){for(var s=a.length-(i+n.length);i>=r[0].textContent.length;)i-=r[0].textContent.length,r.shift();if(1===r.length){var c=d(r[0],i,i+n.length);o.push(c[0]),c[1]&&t.unshift(c[1]);break}o.push(d(r[0],i,r[0].length)[0]),o.push.apply(o,_toConsumableArray(r.slice(1,-1))),c=d(r[r.length-1],0,r[r.length-1].textContent.length-s),o.push(c[0]),c[1]&&t.unshift(c[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(e){function n(e){return 0===l(this||e).parentsUntil(f).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var t=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;t=r.textNodes().filter(function(e){return 4&(e=e.compareDocumentPosition(n))&&!(8&e)});return t[t.length-1]||e(r)}(e),r=(l(t).parents(f).length||(t=null),function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;t=r.textNodes().filter(function(e){return 2&(e=e.compareDocumentPosition(n))&&!(8&e)})[0];return t||e(r)}(e)),a=(l(r).parents(f).length||(r=null),"br:not([data-raw]),tw-consecutive-br:not([data-raw])"),o=(e.find(a).filter(n).replaceWith(document.createTextNode(" ")),(e=l(e.get().map(function(e){return l(e).filter(n).is(a)?l(document.createTextNode(" ")).replaceAll(e)[0]:e}))).textNodes()),i=0;o.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(s," ")," "!==t.textContent[0]||e&&e.textContent&&!(-1<e.textContent.search(/\s$/))||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},t),_toConsumableArray(o).reverse().every(function(e){return!!n(e)&&(e.textContent.match(/^\s*$/)?(i+=e.textContent.length,!(e.textContent="")):(e.textContent=e.textContent.replace(/\s+$/,function(e){return i+=e.length,""}),!1))}),0<i&&r&&(o[o.length-1].textContent+=" "),e[0]&&c()&&e[0].normalize()},geomStringRegExp:o,geomParse:function(e){if(!e)return{marginLeft:0,size:0};var t=e.length,n=(a=_slicedToArray(o.exec(e)||[],3))[0],r=a[1],a=a[2];return!n||a===e&&1<a.length?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}})}),define("utils/scripttag",["state","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(a,o,i,s){return function(e,r){Function("script","scope","with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}")(e,Object.create(null,Object.keys(a.variables).map(function(e){return!e.startsWith("TwineScript_")&&"$"+e}).concat(Object.keys(r).map(function(e){return!e.startsWith("TwineScript_")&&"_"+e})).reduce(function(e,n){return n&&(e[n]={get:function(){var e=("$"===n[0]?a.variables:r)[n.slice(1)];if(o.isHarloweJSValue(e))return o.clone(e);throw s.create("","The contents of the variable ".concat(n,", ").concat(o.objectName(e),", couldn't be converted to a Javascript value."),"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.")},set:function(e){var t="$"===n[0]?a.variables:r;if(!o.isHarloweJSValue(e))throw s.create("","The Javascript value, ".concat(e,", couldn't be converted to a Harlowe value and assigned to the variable ").concat(n,"."),"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.");e=o.clone(e);t=i.create(t,n.slice(1)).set(e);if(s.containsError(t))throw t}}),e},{})))}}),!function(){function e(t,n,r){return function(e){return"background-color: hsla(".concat(t,",").concat(n,"%,").concat(r,"%,").concat(e,");")}}var t={boolean:"color:hsla(0,0%,30%,1.0)",array:"color:hsla(0,100%,30%,1.0)",dataset:"color:hsla(30,100%,40%,1.0)",number:"color:hsla(30,100%,30%,1.0)",datamap:"color:hsla(60,100%,30%,1.0)",changer:"color:hsla(90,100%,30%,1.0)",lambda:"color:hsla(120,100%,40%,1.0)",hookName:"color:hsla(160,100%,30%,1.0)",string:"color:hsla(180,100%,30%,1.0)",identifier:"color:hsla(200,80%,40%,1.0)",variable:"color:hsla(200,100%,30%,1.0)",tempVariable:"color:hsla(200,70%,20%,1.0)",datatype:"color:hsla(220,100%,30%,1.0)",colour:"color:hsla(280,100%,30%,1.0)",macro:"color:hsla(320,80%,30%,1.0)",twineLink:"color:hsla(240,100%,20%,1.0)"},o=(t.gradient=t.colour,t.command=t.twineLink,t.instant=t.metadata=t.any=t.customMacro=t.macro,Math.min),n=e(40,100,50),r=e(220,100,50),i=/hsla\((\d+),\s*(\d+)%,\s*(\d+)%,\s*(\d+\.\d+)\)/g,s="cm-harlowe-3-",a=(_defineProperty(n={root:"box-sizing:border-box;",hook:n(.05),"hook-2":n(.1),"hook-3":n(.15),"hook-4":n(.2),"hook-5":n(.25),"hook-6":n(.3),"hook-7":n(.35),"hook-8":n(.4),"^=hook , ^=hook-":"font-weight:bold;",unclosedHook:n(.05)+"font-weight:bold;"},"error:not([class*='"+s+"string'])","background-color: hsla(17,100%,50%,0.5) !important;"),_defineProperty(n,"^=macroName","font-style:italic;"),_defineProperty(n,"macroName-boolean",t.boolean),_defineProperty(n,"macroName-array",t.array),_defineProperty(n,"macroName-dataset",t.dataset),_defineProperty(n,"macroName-datatype",t.datatype),_defineProperty(n,"macroName-number",t.number),_defineProperty(n,"macroName-datamap",t.datamap),_defineProperty(n,"macroName-changer",t.changer),_defineProperty(n,"macroName-string",t.string),_defineProperty(n,"macroName-colour, macroName-gradient",t.colour),_defineProperty(n,"macroName-command, macroName-instant, macroName-metadata",t.command),_defineProperty(n,"macroName-custommacro, macroName-macro, macroName-any",t.macro),_defineProperty(n,"^=macro ","font-weight:bold;"+t.macro),_defineProperty(n,"comma, spread",t.macro),_defineProperty(n,"addition",t.any),_defineProperty(n,"subtraction, multiplication, division",t.number),_defineProperty(n,"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch",t.boolean),_defineProperty(n,"bold, strong","font-weight:bold;"),_defineProperty(n,"italic, em","font-style:italic;"),_defineProperty(n,"sup","vertical-align: super;font-size:0.8em;"),_defineProperty(n,"strike","text-decoration: line-through;"),_defineProperty(n,"verbatim","background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)"),_defineProperty(n,"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike","font-weight:100; color: hsla(0,0%,0%,0.5)"),_defineProperty(n,"^=collapsed","font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(n,"unclosedCollapsed",r(.025)+"font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(n,"collapsed",r(.025)),_defineProperty(n,"collapsed.hook",r(.05)),_defineProperty(n,"collapsed.hook-2",r(.1)),_defineProperty(n,"collapsed.hook-3",r(.15)),_defineProperty(n,"collapsed.hook-4",r(.2)),_defineProperty(n,"collapsed.hook-5",r(.25)),_defineProperty(n,"collapsed.hook-6",r(.3)),_defineProperty(n,"collapsed.hook-7",r(.35)),_defineProperty(n,"collapsed.hook-8",r(.4)),_defineProperty(n,"twineLink:not(.text)",t.twineLink),_defineProperty(n,"tag, scriptStyleTag, comment","color: hsla(240,34%,25%,1.0);"),_defineProperty(n,"boolean",t.boolean),_defineProperty(n,"string",t.string),_defineProperty(n,"number",t.number),_defineProperty(n,"variable",t.variable),_defineProperty(n,"tempVariable",t.tempVariable),_defineProperty(n,"hookName",t.hookName),_defineProperty(n,"datatype",t.datatype),_defineProperty(n,"colour",t.colour),_defineProperty(n,"cssTime",t.number),_defineProperty(n,"passageString",t.variable+";text-decoration:underline 1px;"),_defineProperty(n,"tagString",t.variable+";text-decoration:underline 1px dotted;"),_defineProperty(n,"variableOccurrence, hookOccurrence","background: hsla(159,50%,75%,1.0) !important;"),_defineProperty(n,"^=where, ^=via, ^=with, ^=making, ^=each, ^=when",t.lambda+"; font-style:italic;"),_defineProperty(n,"heading","font-weight:bold;"),_defineProperty(n,"hr","background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);"),_defineProperty(n,"align","color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);"),_defineProperty(n,"column","color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);"),_defineProperty(n,"escapedLine","font-weight:bold; color: hsla(51,100%,30%,1.0);"),_defineProperty(n,"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator",t.identifier),_defineProperty(n,"toString",function(){var a=this;return Object.keys(this).reduce(function(e,n){var r;return"toString"!==n&&(r=n.split(", ").map(function e(t){return-1<t.indexOf(".")?t.split(/\./g).map(e).join(""):0===t.indexOf("^=")?"[class^='"+s+t.slice(2)+"']":"."+s+t}),e+=r.join(", ")+"{"+a[n]+"}",a[n].match(i)&&[".theme-dark","[data-app-theme=dark]"].forEach(function(t){e+=r.map(function(e){return t+" "+e}).join(", ")+"{"+a[n].replace(i,function(e,t,n,r,a){return"hsla("+t+","+o(100,1.5*+n)+"%,"+(100-r)+"%,"+a+")"})+"}"})),e},"")}),n+"");"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports={Colours:t,CSS:a,versionClass:s}:"function"==typeof define&&define.amd&&define("utils/typecolours",[],function(){return{Colours:t,CSS:a,versionClass:s}})}.call(void 0);
;require("harlowe")}());
</script>

</body>
</html>
